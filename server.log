nohup: ignoring input
INFO:     Will watch for changes in these directories: ['/home/azureuser/azure_chatapp']
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [1121443] using WatchFiles
2025-05-29 15:08:10 INFO root: SIGUSR2 handler registered for log level cycling
2025-05-29 15:08:10 INFO root: Structured logging initialized.
2025-05-29 15:08:10 INFO utils.bootstrap: Structured JSON logging initialized
2025-05-29 15:08:10 INFO root: Sentry disabled via env flag; skipping initialisation.
2025-05-29 15:08:10 INFO utils.bootstrap: Telemetry initialization complete
2025-05-29 15:08:10 INFO db.db: Using PostgreSQL CA bundle: static/certs/DigiCertGlobalRootG2.crt.pem
2025-05-29 15:08:14 INFO faiss.loader: Loading faiss with AVX512 support.
2025-05-29 15:08:14 INFO faiss.loader: Successfully loaded faiss with AVX512 support.
2025-05-29 15:08:14 INFO faiss: Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
Process SpawnProcess-1:
Traceback (most recent call last):
  File "/usr/lib/python3.12/multiprocessing/process.py", line 314, in _bootstrap
    self.run()
  File "/usr/lib/python3.12/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
  File "/home/azureuser/azure_chatapp/venv/lib/python3.12/site-packages/uvicorn/_subprocess.py", line 80, in subprocess_started
    target(sockets=sockets)
  File "/home/azureuser/azure_chatapp/venv/lib/python3.12/site-packages/uvicorn/server.py", line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 194, in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/asyncio/runners.py", line 118, in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "uvloop/loop.pyx", line 1518, in uvloop.loop.Loop.run_until_complete
  File "/home/azureuser/azure_chatapp/venv/lib/python3.12/site-packages/uvicorn/server.py", line 70, in serve
    await self._serve(sockets)
  File "/home/azureuser/azure_chatapp/venv/lib/python3.12/site-packages/uvicorn/server.py", line 77, in _serve
    config.load()
  File "/home/azureuser/azure_chatapp/venv/lib/python3.12/site-packages/uvicorn/config.py", line 435, in load
    self.loaded_app = import_from_string(self.app)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/azureuser/azure_chatapp/venv/lib/python3.12/site-packages/uvicorn/importer.py", line 19, in import_from_string
    module = importlib.import_module(module_str)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.12/importlib/__init__.py", line 90, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1387, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1360, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1331, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 935, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 995, in exec_module
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/azureuser/azure_chatapp/main.py", line 77, in <module>
    from routes.logs import router as logs_router  # noqa: E402
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/azureuser/azure_chatapp/routes/logs.py", line 37, in <module>
    logger.info(f"Client logs rate limit set to: {LOGS_RATE_LIMIT} (DEBUG={is_debug})")
    ^^^^^^
NameError: name 'logger' is not defined
WARNING:  WatchFiles detected changes in 'routes/logs.py'. Reloading...
2025-05-29 15:18:30 INFO root: SIGUSR2 handler registered for log level cycling
2025-05-29 15:18:30 INFO root: Structured logging initialized.
2025-05-29 15:18:30 INFO utils.bootstrap: Structured JSON logging initialized
2025-05-29 15:18:31 INFO root: Sentry disabled via env flag; skipping initialisation.
2025-05-29 15:18:31 INFO utils.bootstrap: Telemetry initialization complete
2025-05-29 15:18:31 INFO db.db: Using PostgreSQL CA bundle: static/certs/DigiCertGlobalRootG2.crt.pem
2025-05-29 15:18:34 INFO faiss.loader: Loading faiss with AVX512 support.
2025-05-29 15:18:34 INFO faiss.loader: Successfully loaded faiss with AVX512 support.
2025-05-29 15:18:34 INFO faiss: Failed to load GPU Faiss: name 'GpuIndexIVFFlat' is not defined. Will not load constructor refs for GPU indexes. This is only an error if you're trying to use GPU Faiss.
2025-05-29 15:18:34 INFO api.logs: Client logs rate limit set to: 10000/minute (DEBUG=True)
2025-05-29 15:18:34 INFO main: Found modals.html at: /home/azureuser/azure_chatapp/static/html/modals.html
2025-05-29 15:18:34 INFO main: Static files mounted from /home/azureuser/azure_chatapp/static
INFO:     Started server process [1122518]
INFO:     Waiting for application startup.
2025-05-29 15:18:34 INFO db.schema_manager: Starting database initialization...
2025-05-29 15:18:34 INFO db.schema_manager: Starting database initialization...
2025-05-29 15:18:34 INFO db.schema_manager: Starting database migration process from /home/azureuser/azure_chatapp/db/migrations...
2025-05-29 15:18:34 INFO db.schema_manager: Starting database migration process from /home/azureuser/azure_chatapp/db/migrations...
2025-05-29 15:18:34 INFO db.schema_manager: Ensured schema_history table exists.
2025-05-29 15:18:34 INFO db.schema_manager: Ensured schema_history table exists.
2025-05-29 15:18:34 INFO db.schema_manager: Found 0 successfully applied migration versions: set()
2025-05-29 15:18:34 INFO db.schema_manager: Found 0 successfully applied migration versions.
2025-05-29 15:18:34 WARNING db.schema_manager: Migrations directory /home/azureuser/azure_chatapp/db/migrations does not exist. No migrations to apply.
2025-05-29 15:18:34 WARNING db.schema_manager: Migrations directory /home/azureuser/azure_chatapp/db/migrations does not exist. No migrations to apply.
2025-05-29 15:18:34 INFO db.schema_manager: Released schema migration lock.
2025-05-29 15:18:34 INFO db.schema_manager: Released schema migration lock.
2025-05-29 15:18:34 INFO db.schema_manager: Running schema alignment (fix_schema)...
2025-05-29 15:18:34 INFO db.schema_manager: Running schema alignment (fix_schema)...
2025-05-29 15:18:34 INFO db.schema_manager: Starting schema alignment...
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for users.created_at: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for users.updated_at: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for users.last_login: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for users.last_activity: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for token_blacklist.expires: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for token_blacklist.created_at: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for knowledge_bases.last_used: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for knowledge_bases.created_at: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for knowledge_bases.updated_at: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for projects.created_at: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for projects.updated_at: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for project_users.joined_at: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for project_files.created_at: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for project_files.updated_at: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for conversations.created_at: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for conversations.updated_at: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for conversations.deleted_at: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for messages.created_at: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for messages.updated_at: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for artifacts.created_at: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 WARNING db.schema_manager: Type mismatch for artifacts.updated_at: DB=TIMESTAMP, ORM=TIMESTAMP WITHOUT TIME ZONE. Manual intervention may be required.
2025-05-29 15:18:34 INFO db.schema_manager: Schema alignment completed
2025-05-29 15:18:34 INFO db.schema_manager: Validating schema...
2025-05-29 15:18:34 INFO db.schema_manager: Validating schema...
2025-05-29 15:18:34 INFO db.schema_manager: Validating database schema...
2025-05-29 15:18:35 INFO db.schema_manager: Schema validation successful - no issues found
2025-05-29 15:18:35 INFO auth: Skipping default user creation in non-local environment.
2025-05-29 15:18:35 INFO utils.db_utils: Scheduled token cleanup to run every 30 minutes
2025-05-29 15:18:35 INFO utils.db_utils: Scheduled database health check to run every minute
2025-05-29 15:18:35 INFO main: Insecure Debug App vunknown started in debug mode.
2025-05-29 15:18:35 INFO utils.db_utils: Starting periodic task: token_cleanup
2025-05-29 15:18:35 INFO utils.db_utils: Starting periodic task: db_health_check
INFO:     Application startup complete.
2025-05-29 15:18:35 INFO utils.auth_utils: Active blacklisted tokens by type
2025-05-29 15:18:35 INFO utils.db_utils: Periodic task 'token_cleanup' completed in 0.22s: 0
2025-05-29 15:18:35 INFO utils.db_utils: Periodic task 'db_health_check' completed in 0.05s: Database connection healthy
2025-05-29 15:19:35 INFO utils.db_utils: Periodic task 'db_health_check' completed in 0.00s: Database connection healthy
INFO:     Shutting down
INFO:     Waiting for application shutdown.
2025-05-29 15:20:05 INFO utils.auth_utils: Active blacklisted tokens by type
2025-05-29 15:20:05 INFO main: Application shutdown complete (debug mode).
INFO:     Application shutdown complete.
INFO:     Finished server process [1122518]
INFO:     Stopping reloader process [1121443]
