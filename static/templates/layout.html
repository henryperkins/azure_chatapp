<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8" />
    <!-- Example Sentry Loader (removed integrity for clarity) -->
    <script>
        // Load Sentry script only if not localhost
        if (window.location.hostname !== 'localhost' && window.location.hostname !== '127.0.0.1') {
            const script = document.createElement('script');
            script.src = 'https://js.sentry-cdn.com/b03711f63d1160f48dcaeda3edae14ac.min.js';
            script.crossOrigin = 'anonymous';
            document.head.appendChild(script);
        }
    </script>
    <script>
        window.sentryOnLoad = function () {
            if (window.Sentry && typeof window.initSentry === 'function') {
                window.initSentry();
            } else {
                console.warn('Sentry or initSentry function not available');
            }
        };
    </script>

    <!-- Example Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="
      default-src 'self' blob:;
      script-src 'self' 'unsafe-inline' blob: https://js.sentry-cdn.com https://browser.sentry-cdn.com;
      script-src-elem 'self' 'unsafe-inline' blob: https://js.sentry-cdn.com https://browser.sentry-cdn.com;
      worker-src 'self' blob:;
      child-src 'self' blob:;
      connect-src 'self' https://o4508070823395328.ingest.us.sentry.io https://js.sentry-cdn.com https://browser.sentry-cdn.com;
      img-src 'self' data: blob: https://*.sentry.io https://*.sentry-cdn.com;
      style-src 'self' 'unsafe-inline';
      frame-src 'self';
    ">

    <title>{{ page_title|default("Azure OpenAI Chat") }}</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico" />

    <!-- Tailwind CSS/DaisyUI (example paths) -->
    <link rel="stylesheet" href="/static/css/dist/tailwind.css">

    <!-- Example: Jinja block for additional HEAD elements -->
    {% block head_extras %}{% endblock %}

    <!-- Ensure responsive, mobile-friendly behavior -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Example: move inline CSS to external file if possible -->
    <style>
        /* Minimal custom styles can go here, or place in an external .css */
        #projectListView {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
    </style>

    <!-- Load global scripts (DependencySystem, app.js, etc.) -->
    <script src="/static/js/sentry-init.js"></script>
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/formatting.js"></script>
    <script src="/static/js/eventHandler.js"></script>
    <script src="/static/js/accessibility-utils.js"></script>
    <script src="/static/js/app.js"></script>
    <script src="/static/js/kb-result-handlers.js"></script>

    <!-- Load debug scripts only in dev environment -->
    {% if debug_mode %}
    <script src="/static/js/debug-project.js"></script>
    <script src="/static/js/fixes-verification.js"></script>
    {% endif %}
    </head>

<body class="bg-base-200 text-base-content h-screen flex flex-col font-sans">
    <!-- Skip link for A11y -->
    <a href="#mainContent" class="skip-to-content">Skip to content</a>

    {% include "_header.html" %}

    <!-- Main container with sidebar + content -->
    <div class="flex flex-1 overflow-hidden container-md">
        {% include "_sidebar.html" %}
        <main id="mainContent" class="flex-1 flex flex-col overflow-hidden">
            <div id="notificationArea" role="status" aria-live="polite" class="fixed top-16 right-4 z-50 w-72 gap-2">
            </div>

            <!-- Keyboard shortcuts help overlay (visible on button click) -->
            <div id="keyboardHelp"
                class="hidden fixed inset-0 bg-base-300 bg-opacity-70 z-50 flex items-center justify-center"
                role="dialog" aria-modal="true" aria-labelledby="keyboardHelpTitle">
                <div class="card max-w-lg w-full bg-base-100 shadow-xl p-6 relative">
                    <button class="btn btn-sm btn-ghost btn-circle absolute top-2 right-2"
                        aria-label="Close keyboard shortcuts"
                        onclick="document.getElementById('keyboardHelp').classList.add('hidden');">Ã—</button>
                    <h3 id="keyboardHelpTitle" class="text-lg font-bold mb-4">Keyboard Shortcuts</h3>
                    <div class="kbd-container grid grid-cols-2 gap-2 text-sm">
                        <div class="flex items-center">
                            <kbd class="kbd kbd-sm">Tab</kbd>
                            <span class="ml-2">Focus next element</span>
                        </div>
                        <div class="flex items-center">
                            <kbd class="kbd kbd-sm">Esc</kbd>
                            <span class="ml-2">Close modal</span>
                        </div>
                        <div class="flex items-center">
                            <kbd class="kbd kbd-sm">s</kbd>
                            <span class="ml-2">Focus search</span>
                        </div>
                        <div class="flex items-center">
                            <kbd class="kbd kbd-sm">n</kbd>
                            <span class="ml-2">New project/chat</span>
                        </div>
                        <div class="flex items-center">
                            <kbd class="kbd kbd-sm">?</kbd>
                            <span class="ml-2">Toggle help</span>
                        </div>
                    </div>
                </div>
            </div>

            {% block content %}
            <!-- Default/fallback content -->
            <section class="p-4 md:p-6">
                <h2 class="text-xl font-semibold mb-4">Welcome</h2>
                <p class="text-base-content/70">
                    If you see this, no specific template extended layout.html.
                </p>
            </section>
            {% endblock %}
        </main>
    </div>

    <!-- Global modals for project creation, instructions, etc. -->
    {% include "_modals.html" %}

</body>

</html>
