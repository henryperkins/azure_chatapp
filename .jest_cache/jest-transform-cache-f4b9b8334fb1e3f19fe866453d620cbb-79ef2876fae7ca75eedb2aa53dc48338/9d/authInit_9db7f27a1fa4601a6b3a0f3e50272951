7e1aec3329c9c4c93384905fb9fa84a9
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createAuthInit = createAuthInit;
// ========================================
// FILE: /initialization/phases/authInit.js
// ========================================
/**
 * Authentication System Initialization
 * Handles auth setup, state changes, and UI updates
 * ~180 lines
 */

function createAuthInit(deps) {
  const {
    DependencySystem,
    domAPI,
    eventHandlers,
    logger,
    sanitizer,
    safeHandler,
    domReadinessService,
    APP_CONFIG
  } = deps;
  if (!DependencySystem || !domAPI || !eventHandlers || !logger || !sanitizer || !safeHandler || !domReadinessService || !APP_CONFIG) {
    throw new Error('[authInit] Missing required dependencies for auth initialization.');
  }
  async function initializeAuthSystem() {
    await domReadinessService.documentReady();
    await domReadinessService.dependenciesAndElements({
      deps: ['auth', 'eventHandlers'],
      domSelectors: ['#loginModalForm', '#authButton'],
      timeout: 8000,
      context: 'authInit.initializeAuthSystem'
    });
    const auth = DependencySystem.modules.get('auth');
    if (!auth?.init) {
      throw new Error('[authInit] Auth module is missing or invalid.');
    }

    // Register auth event listeners
    if (auth.AuthBus) {
      logger.info('[authInit] Registering AuthBus listeners', {
        context: 'authInit:init'
      });
      eventHandlers.trackListener(auth.AuthBus, 'authStateChanged', safeHandler(event => {
        logger.info('[authInit][AuthBus] Received authStateChanged', event?.detail, {
          context: 'authInit:authStateChanged'
        });
        handleAuthStateChange(event);
      }, 'AuthBus authStateChanged handler'), {
        description: '[authInit] AuthBus authStateChanged',
        context: 'authInit'
      });
      eventHandlers.trackListener(auth.AuthBus, 'authReady', safeHandler(event => {
        logger.info('[authInit][AuthBus] Received authReady', event?.detail, {
          context: 'authInit:authReady'
        });
        handleAuthStateChange(event);
      }, 'AuthBus authReady handler'), {
        description: '[authInit] AuthBus authReady',
        context: 'authInit'
      });
    } else {
      logger.warn('[authInit] No AuthBus instance for registration', {
        context: 'authInit:init'
      });
    }
    try {
      logger.info('[authInit] Calling auth.init()', {
        context: 'authInit:init'
      });
      await auth.init();
      eventHandlers.dispatch('authReady');
      renderAuthHeader();
      return true;
    } catch (err) {
      logger.error('[authInit] Auth system initialization failed', err, {
        context: 'authInit:init'
      });
      throw err;
    }
  }
  function handleAuthStateChange(event) {
    const appModuleLocal = DependencySystem.modules.get('appModule');
    const projectManager = DependencySystem.modules.get('projectManager');
    logger.info('[authInit][handleAuthStateChange]', {
      eventDetail: event?.detail,
      appModuleState: JSON.stringify(appModuleLocal.state),
      context: 'authInit:handleAuthStateChange'
    });
    const isAuthenticated = appModuleLocal.state.isAuthenticated;
    const navService = DependencySystem.modules.get('navigationService');
    const appReadyDispatched = DependencySystem.modules.get('appModule')?._appReadyDispatched;
    const readyNow = appReadyDispatched || appModuleLocal.state.isReady;
    const proceed = () => {
      if (navService?.navigateToProjectList) {
        navService.navigateToProjectList().catch(() => {});
      } else if (projectManager?.loadProjects) {
        projectManager.loadProjects('all').catch(() => {});
      }

      // Ensure auth modals are closed after successful authentication
      if (isAuthenticated) {
        try {
          const modalManager = DependencySystem.modules.get?.('modalManager');
          if (modalManager && typeof modalManager.hide === 'function') {
            ['login', 'register'].forEach(modalName => {
              try {
                modalManager.hide(modalName);
              } catch {/* ignore */}
            });
          }
        } catch (modalErr) {
          logger.warn('[authInit][handleAuthStateChange] Unable to hide auth modals after login', modalErr, {
            context: 'authInit:handleAuthStateChange'
          });
        }
      }
    };
    if (isAuthenticated) {
      if (readyNow) {
        proceed();
      } else {
        domReadinessService.waitForEvent('app:ready', {
          timeout: APP_CONFIG.TIMEOUTS?.APP_READY_WAIT ?? 30000,
          context: 'authInit:handleAuthStateChange'
        }).then(proceed).catch(() => {});
      }
    }
    renderAuthHeader();
  }
  function renderAuthHeader() {
    try {
      const appModuleLocal = DependencySystem.modules.get('appModule');
      if (!appModuleLocal) {
        logger.error('[authInit][renderAuthHeader] appModule not found.', {
          context: 'authInit:renderAuthHeader'
        });
        return;
      }
      const isAuth = appModuleLocal.state.isAuthenticated;
      const user = appModuleLocal.state.currentUser;
      const displayName = user?.name || user?.username || 'User';
      logger.debug('[authInit][renderAuthHeader] Rendering auth header', {
        isAuth,
        user,
        context: 'authInit:renderAuthHeader'
      });

      // Update auth UI elements
      const authBtn = domAPI.getElementById('authButton');
      const userMenu = domAPI.getElementById('userMenu');
      const logoutBtn = domAPI.getElementById('logoutBtn');
      const userInitialsEl = domAPI.getElementById('userInitials');
      const authStatus = domAPI.getElementById('authStatus');
      const userStatus = domAPI.getElementById('userStatus');

      // Toggle visibility based on auth state
      if (authBtn) {
        if (isAuth) {
          domAPI.addClass(authBtn, 'hidden');
          domAPI.setStyle(authBtn, 'display', 'none');
          domAPI.setAttribute(authBtn, 'hidden', 'hidden');
        } else {
          domAPI.removeClass(authBtn, 'hidden');
          domAPI.setStyle(authBtn, 'display', '');
          domAPI.removeAttribute(authBtn, 'hidden');
        }
      }
      if (userMenu) {
        domAPI.toggleClass(userMenu, 'hidden', !isAuth);
        domAPI.setStyle(userMenu, 'display', isAuth ? '' : 'none');
        isAuth ? domAPI.removeAttribute(userMenu, 'hidden') : domAPI.setAttribute(userMenu, 'hidden', 'hidden');
      }

      // Update user initials
      if (userMenu && userInitialsEl) {
        let initials = 'U';
        if (isAuth) {
          if (typeof user?.name === 'string' && user.name.trim().length > 0) {
            initials = user.name.trim().split(/\s+/).map(p => p[0]).join('').toUpperCase();
          } else if (typeof user?.username === 'string' && user.username.trim().length > 0) {
            initials = user.username.slice(0, 2).toUpperCase();
          }
        }
        domAPI.setTextContent(userInitialsEl, initials);
      }

      // Update status texts
      if (authStatus) {
        domAPI.setTextContent(authStatus, isAuth ? `Signed in as ${displayName}` : 'Not Authenticated');
      }
      if (userStatus) {
        domAPI.setTextContent(userStatus, isAuth ? `Hello, ${displayName}` : 'Offline');
      }

      // Setup logout handler
      if (logoutBtn) {
        eventHandlers.trackListener(logoutBtn, 'click', safeHandler(e => {
          domAPI.preventDefault(e);
          logger.debug('[authInit][renderAuthHeader] Logout clicked.', {
            context: 'authInit:logout'
          });
          const authMod = DependencySystem.modules.get('auth');
          authMod?.logout?.().catch(err => {
            logger.error('[authInit] Error during logout:', err, {
              context: 'authInit:logout'
            });
          });
        }, 'Auth logout click'), {
          description: 'Auth logout click',
          context: 'authInit'
        });
      }
    } catch (err) {
      logger.error('[authInit][renderAuthHeader] Error during rendering', err, {
        context: 'authInit:renderAuthHeader'
      });
    }
  }
  function forceShowLoginModal() {
    const appModuleLocal = DependencySystem.modules.get?.('appModule');
    if (appModuleLocal && !appModuleLocal.state?.isAuthenticated) {
      const modalManager = DependencySystem.modules.get?.('modalManager');
      if (modalManager && typeof modalManager.show === 'function') {
        modalManager.show('login');
      } else {
        throw new Error('[authInit][forceShowLoginModal] modalManager missing.');
      }
    }
  }
  function cleanup() {
    eventHandlers.cleanupListeners({
      context: 'authInit'
    });
    logger.debug('[authInit] Cleanup completed', {
      context: 'authInit:cleanup'
    });
  }
  return {
    initializeAuthSystem,
    handleAuthStateChange,
    renderAuthHeader,
    forceShowLoginModal,
    cleanup
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVBdXRoSW5pdCIsImRlcHMiLCJEZXBlbmRlbmN5U3lzdGVtIiwiZG9tQVBJIiwiZXZlbnRIYW5kbGVycyIsImxvZ2dlciIsInNhbml0aXplciIsInNhZmVIYW5kbGVyIiwiZG9tUmVhZGluZXNzU2VydmljZSIsIkFQUF9DT05GSUciLCJFcnJvciIsImluaXRpYWxpemVBdXRoU3lzdGVtIiwiZG9jdW1lbnRSZWFkeSIsImRlcGVuZGVuY2llc0FuZEVsZW1lbnRzIiwiZG9tU2VsZWN0b3JzIiwidGltZW91dCIsImNvbnRleHQiLCJhdXRoIiwibW9kdWxlcyIsImdldCIsImluaXQiLCJBdXRoQnVzIiwiaW5mbyIsInRyYWNrTGlzdGVuZXIiLCJldmVudCIsImRldGFpbCIsImhhbmRsZUF1dGhTdGF0ZUNoYW5nZSIsImRlc2NyaXB0aW9uIiwid2FybiIsImRpc3BhdGNoIiwicmVuZGVyQXV0aEhlYWRlciIsImVyciIsImVycm9yIiwiYXBwTW9kdWxlTG9jYWwiLCJwcm9qZWN0TWFuYWdlciIsImV2ZW50RGV0YWlsIiwiYXBwTW9kdWxlU3RhdGUiLCJKU09OIiwic3RyaW5naWZ5Iiwic3RhdGUiLCJpc0F1dGhlbnRpY2F0ZWQiLCJuYXZTZXJ2aWNlIiwiYXBwUmVhZHlEaXNwYXRjaGVkIiwiX2FwcFJlYWR5RGlzcGF0Y2hlZCIsInJlYWR5Tm93IiwiaXNSZWFkeSIsInByb2NlZWQiLCJuYXZpZ2F0ZVRvUHJvamVjdExpc3QiLCJjYXRjaCIsImxvYWRQcm9qZWN0cyIsIm1vZGFsTWFuYWdlciIsImhpZGUiLCJmb3JFYWNoIiwibW9kYWxOYW1lIiwibW9kYWxFcnIiLCJ3YWl0Rm9yRXZlbnQiLCJUSU1FT1VUUyIsIkFQUF9SRUFEWV9XQUlUIiwidGhlbiIsImlzQXV0aCIsInVzZXIiLCJjdXJyZW50VXNlciIsImRpc3BsYXlOYW1lIiwibmFtZSIsInVzZXJuYW1lIiwiZGVidWciLCJhdXRoQnRuIiwiZ2V0RWxlbWVudEJ5SWQiLCJ1c2VyTWVudSIsImxvZ291dEJ0biIsInVzZXJJbml0aWFsc0VsIiwiYXV0aFN0YXR1cyIsInVzZXJTdGF0dXMiLCJhZGRDbGFzcyIsInNldFN0eWxlIiwic2V0QXR0cmlidXRlIiwicmVtb3ZlQ2xhc3MiLCJyZW1vdmVBdHRyaWJ1dGUiLCJ0b2dnbGVDbGFzcyIsImluaXRpYWxzIiwidHJpbSIsImxlbmd0aCIsInNwbGl0IiwibWFwIiwicCIsImpvaW4iLCJ0b1VwcGVyQ2FzZSIsInNsaWNlIiwic2V0VGV4dENvbnRlbnQiLCJlIiwicHJldmVudERlZmF1bHQiLCJhdXRoTW9kIiwibG9nb3V0IiwiZm9yY2VTaG93TG9naW5Nb2RhbCIsInNob3ciLCJjbGVhbnVwIiwiY2xlYW51cExpc3RlbmVycyJdLCJzb3VyY2VzIjpbImF1dGhJbml0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEZJTEU6IC9pbml0aWFsaXphdGlvbi9waGFzZXMvYXV0aEluaXQuanNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8qKlxuICogQXV0aGVudGljYXRpb24gU3lzdGVtIEluaXRpYWxpemF0aW9uXG4gKiBIYW5kbGVzIGF1dGggc2V0dXAsIHN0YXRlIGNoYW5nZXMsIGFuZCBVSSB1cGRhdGVzXG4gKiB+MTgwIGxpbmVzXG4gKi9cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUF1dGhJbml0KGRlcHMpIHtcbiAgICBjb25zdCB7XG4gICAgICAgIERlcGVuZGVuY3lTeXN0ZW0sIGRvbUFQSSwgZXZlbnRIYW5kbGVycyxcbiAgICAgICAgbG9nZ2VyLCBzYW5pdGl6ZXIsIHNhZmVIYW5kbGVyLFxuICAgICAgICBkb21SZWFkaW5lc3NTZXJ2aWNlLCBBUFBfQ09ORklHXG4gICAgfSA9IGRlcHM7XG5cbiAgICBpZiAoIURlcGVuZGVuY3lTeXN0ZW0gfHwgIWRvbUFQSSB8fCAhZXZlbnRIYW5kbGVycyB8fFxuICAgICAgICAhbG9nZ2VyIHx8ICFzYW5pdGl6ZXIgfHwgIXNhZmVIYW5kbGVyIHx8XG4gICAgICAgICFkb21SZWFkaW5lc3NTZXJ2aWNlIHx8ICFBUFBfQ09ORklHKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignW2F1dGhJbml0XSBNaXNzaW5nIHJlcXVpcmVkIGRlcGVuZGVuY2llcyBmb3IgYXV0aCBpbml0aWFsaXphdGlvbi4nKTtcbiAgICB9XG5cbiAgICBhc3luYyBmdW5jdGlvbiBpbml0aWFsaXplQXV0aFN5c3RlbSgpIHtcbiAgICAgICAgYXdhaXQgZG9tUmVhZGluZXNzU2VydmljZS5kb2N1bWVudFJlYWR5KCk7XG4gICAgICAgIGF3YWl0IGRvbVJlYWRpbmVzc1NlcnZpY2UuZGVwZW5kZW5jaWVzQW5kRWxlbWVudHMoe1xuICAgICAgICAgICAgZGVwczogWydhdXRoJywgJ2V2ZW50SGFuZGxlcnMnXSxcbiAgICAgICAgICAgIGRvbVNlbGVjdG9yczogWycjbG9naW5Nb2RhbEZvcm0nLCAnI2F1dGhCdXR0b24nXSxcbiAgICAgICAgICAgIHRpbWVvdXQ6IDgwMDAsXG4gICAgICAgICAgICBjb250ZXh0OiAnYXV0aEluaXQuaW5pdGlhbGl6ZUF1dGhTeXN0ZW0nXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGF1dGggPSBEZXBlbmRlbmN5U3lzdGVtLm1vZHVsZXMuZ2V0KCdhdXRoJyk7XG4gICAgICAgIGlmICghYXV0aD8uaW5pdCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdbYXV0aEluaXRdIEF1dGggbW9kdWxlIGlzIG1pc3Npbmcgb3IgaW52YWxpZC4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlZ2lzdGVyIGF1dGggZXZlbnQgbGlzdGVuZXJzXG4gICAgICAgIGlmIChhdXRoLkF1dGhCdXMpIHtcbiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCdbYXV0aEluaXRdIFJlZ2lzdGVyaW5nIEF1dGhCdXMgbGlzdGVuZXJzJywgeyBjb250ZXh0OiAnYXV0aEluaXQ6aW5pdCcgfSk7XG5cbiAgICAgICAgICAgIGV2ZW50SGFuZGxlcnMudHJhY2tMaXN0ZW5lcihcbiAgICAgICAgICAgICAgICBhdXRoLkF1dGhCdXMsXG4gICAgICAgICAgICAgICAgJ2F1dGhTdGF0ZUNoYW5nZWQnLFxuICAgICAgICAgICAgICAgIHNhZmVIYW5kbGVyKChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygnW2F1dGhJbml0XVtBdXRoQnVzXSBSZWNlaXZlZCBhdXRoU3RhdGVDaGFuZ2VkJywgZXZlbnQ/LmRldGFpbCwgeyBjb250ZXh0OiAnYXV0aEluaXQ6YXV0aFN0YXRlQ2hhbmdlZCcgfSk7XG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZUF1dGhTdGF0ZUNoYW5nZShldmVudCk7XG4gICAgICAgICAgICAgICAgfSwgJ0F1dGhCdXMgYXV0aFN0YXRlQ2hhbmdlZCBoYW5kbGVyJyksXG4gICAgICAgICAgICAgICAgeyBkZXNjcmlwdGlvbjogJ1thdXRoSW5pdF0gQXV0aEJ1cyBhdXRoU3RhdGVDaGFuZ2VkJywgY29udGV4dDogJ2F1dGhJbml0JyB9XG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBldmVudEhhbmRsZXJzLnRyYWNrTGlzdGVuZXIoXG4gICAgICAgICAgICAgICAgYXV0aC5BdXRoQnVzLFxuICAgICAgICAgICAgICAgICdhdXRoUmVhZHknLFxuICAgICAgICAgICAgICAgIHNhZmVIYW5kbGVyKChldmVudCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygnW2F1dGhJbml0XVtBdXRoQnVzXSBSZWNlaXZlZCBhdXRoUmVhZHknLCBldmVudD8uZGV0YWlsLCB7IGNvbnRleHQ6ICdhdXRoSW5pdDphdXRoUmVhZHknIH0pO1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVBdXRoU3RhdGVDaGFuZ2UoZXZlbnQpO1xuICAgICAgICAgICAgICAgIH0sICdBdXRoQnVzIGF1dGhSZWFkeSBoYW5kbGVyJyksXG4gICAgICAgICAgICAgICAgeyBkZXNjcmlwdGlvbjogJ1thdXRoSW5pdF0gQXV0aEJ1cyBhdXRoUmVhZHknLCBjb250ZXh0OiAnYXV0aEluaXQnIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBsb2dnZXIud2FybignW2F1dGhJbml0XSBObyBBdXRoQnVzIGluc3RhbmNlIGZvciByZWdpc3RyYXRpb24nLCB7IGNvbnRleHQ6ICdhdXRoSW5pdDppbml0JyB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBsb2dnZXIuaW5mbygnW2F1dGhJbml0XSBDYWxsaW5nIGF1dGguaW5pdCgpJywgeyBjb250ZXh0OiAnYXV0aEluaXQ6aW5pdCcgfSk7XG4gICAgICAgICAgICBhd2FpdCBhdXRoLmluaXQoKTtcbiAgICAgICAgICAgIGV2ZW50SGFuZGxlcnMuZGlzcGF0Y2goJ2F1dGhSZWFkeScpO1xuICAgICAgICAgICAgcmVuZGVyQXV0aEhlYWRlcigpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCdbYXV0aEluaXRdIEF1dGggc3lzdGVtIGluaXRpYWxpemF0aW9uIGZhaWxlZCcsIGVyciwge1xuICAgICAgICAgICAgICAgIGNvbnRleHQ6ICdhdXRoSW5pdDppbml0J1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBoYW5kbGVBdXRoU3RhdGVDaGFuZ2UoZXZlbnQpIHtcbiAgICAgICAgY29uc3QgYXBwTW9kdWxlTG9jYWwgPSBEZXBlbmRlbmN5U3lzdGVtLm1vZHVsZXMuZ2V0KCdhcHBNb2R1bGUnKTtcbiAgICAgICAgY29uc3QgcHJvamVjdE1hbmFnZXIgPSBEZXBlbmRlbmN5U3lzdGVtLm1vZHVsZXMuZ2V0KCdwcm9qZWN0TWFuYWdlcicpO1xuXG4gICAgICAgIGxvZ2dlci5pbmZvKCdbYXV0aEluaXRdW2hhbmRsZUF1dGhTdGF0ZUNoYW5nZV0nLCB7XG4gICAgICAgICAgICBldmVudERldGFpbDogZXZlbnQ/LmRldGFpbCxcbiAgICAgICAgICAgIGFwcE1vZHVsZVN0YXRlOiBKU09OLnN0cmluZ2lmeShhcHBNb2R1bGVMb2NhbC5zdGF0ZSksXG4gICAgICAgICAgICBjb250ZXh0OiAnYXV0aEluaXQ6aGFuZGxlQXV0aFN0YXRlQ2hhbmdlJ1xuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBpc0F1dGhlbnRpY2F0ZWQgPSBhcHBNb2R1bGVMb2NhbC5zdGF0ZS5pc0F1dGhlbnRpY2F0ZWQ7XG4gICAgICAgIGNvbnN0IG5hdlNlcnZpY2UgPSBEZXBlbmRlbmN5U3lzdGVtLm1vZHVsZXMuZ2V0KCduYXZpZ2F0aW9uU2VydmljZScpO1xuICAgICAgICBjb25zdCBhcHBSZWFkeURpc3BhdGNoZWQgPSBEZXBlbmRlbmN5U3lzdGVtLm1vZHVsZXMuZ2V0KCdhcHBNb2R1bGUnKT8uX2FwcFJlYWR5RGlzcGF0Y2hlZDtcbiAgICAgICAgY29uc3QgcmVhZHlOb3cgPSBhcHBSZWFkeURpc3BhdGNoZWQgfHwgYXBwTW9kdWxlTG9jYWwuc3RhdGUuaXNSZWFkeTtcblxuICAgICAgICBjb25zdCBwcm9jZWVkID0gKCkgPT4ge1xuICAgICAgICAgICAgaWYgKG5hdlNlcnZpY2U/Lm5hdmlnYXRlVG9Qcm9qZWN0TGlzdCkge1xuICAgICAgICAgICAgICAgIG5hdlNlcnZpY2UubmF2aWdhdGVUb1Byb2plY3RMaXN0KCkuY2F0Y2goKCkgPT4ge30pO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChwcm9qZWN0TWFuYWdlcj8ubG9hZFByb2plY3RzKSB7XG4gICAgICAgICAgICAgICAgcHJvamVjdE1hbmFnZXIubG9hZFByb2plY3RzKCdhbGwnKS5jYXRjaCgoKSA9PiB7fSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIEVuc3VyZSBhdXRoIG1vZGFscyBhcmUgY2xvc2VkIGFmdGVyIHN1Y2Nlc3NmdWwgYXV0aGVudGljYXRpb25cbiAgICAgICAgICAgIGlmIChpc0F1dGhlbnRpY2F0ZWQpIHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBtb2RhbE1hbmFnZXIgPSBEZXBlbmRlbmN5U3lzdGVtLm1vZHVsZXMuZ2V0Py4oJ21vZGFsTWFuYWdlcicpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobW9kYWxNYW5hZ2VyICYmIHR5cGVvZiBtb2RhbE1hbmFnZXIuaGlkZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgWydsb2dpbicsICdyZWdpc3RlciddLmZvckVhY2goKG1vZGFsTmFtZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7IG1vZGFsTWFuYWdlci5oaWRlKG1vZGFsTmFtZSk7IH0gY2F0Y2ggeyAvKiBpZ25vcmUgKi8gfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGNhdGNoIChtb2RhbEVycikge1xuICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybignW2F1dGhJbml0XVtoYW5kbGVBdXRoU3RhdGVDaGFuZ2VdIFVuYWJsZSB0byBoaWRlIGF1dGggbW9kYWxzIGFmdGVyIGxvZ2luJywgbW9kYWxFcnIsIHsgY29udGV4dDogJ2F1dGhJbml0OmhhbmRsZUF1dGhTdGF0ZUNoYW5nZScgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGlmIChpc0F1dGhlbnRpY2F0ZWQpIHtcbiAgICAgICAgICAgIGlmIChyZWFkeU5vdykge1xuICAgICAgICAgICAgICAgIHByb2NlZWQoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgZG9tUmVhZGluZXNzU2VydmljZS53YWl0Rm9yRXZlbnQoJ2FwcDpyZWFkeScsIHtcbiAgICAgICAgICAgICAgICAgICAgdGltZW91dDogQVBQX0NPTkZJRy5USU1FT1VUUz8uQVBQX1JFQURZX1dBSVQgPz8gMzAwMDAsXG4gICAgICAgICAgICAgICAgICAgIGNvbnRleHQ6ICdhdXRoSW5pdDpoYW5kbGVBdXRoU3RhdGVDaGFuZ2UnXG4gICAgICAgICAgICAgICAgfSkudGhlbihwcm9jZWVkKS5jYXRjaCgoKSA9PiB7fSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZW5kZXJBdXRoSGVhZGVyKCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gcmVuZGVyQXV0aEhlYWRlcigpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGFwcE1vZHVsZUxvY2FsID0gRGVwZW5kZW5jeVN5c3RlbS5tb2R1bGVzLmdldCgnYXBwTW9kdWxlJyk7XG4gICAgICAgICAgICBpZiAoIWFwcE1vZHVsZUxvY2FsKSB7XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCdbYXV0aEluaXRdW3JlbmRlckF1dGhIZWFkZXJdIGFwcE1vZHVsZSBub3QgZm91bmQuJywge1xuICAgICAgICAgICAgICAgICAgICBjb250ZXh0OiAnYXV0aEluaXQ6cmVuZGVyQXV0aEhlYWRlcidcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGlzQXV0aCA9IGFwcE1vZHVsZUxvY2FsLnN0YXRlLmlzQXV0aGVudGljYXRlZDtcbiAgICAgICAgICAgIGNvbnN0IHVzZXIgPSBhcHBNb2R1bGVMb2NhbC5zdGF0ZS5jdXJyZW50VXNlcjtcbiAgICAgICAgICAgIGNvbnN0IGRpc3BsYXlOYW1lID0gdXNlcj8ubmFtZSB8fCB1c2VyPy51c2VybmFtZSB8fCAnVXNlcic7XG5cbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnW2F1dGhJbml0XVtyZW5kZXJBdXRoSGVhZGVyXSBSZW5kZXJpbmcgYXV0aCBoZWFkZXInLCB7XG4gICAgICAgICAgICAgICAgaXNBdXRoLCB1c2VyLCBjb250ZXh0OiAnYXV0aEluaXQ6cmVuZGVyQXV0aEhlYWRlcidcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBVcGRhdGUgYXV0aCBVSSBlbGVtZW50c1xuICAgICAgICAgICAgY29uc3QgYXV0aEJ0biA9IGRvbUFQSS5nZXRFbGVtZW50QnlJZCgnYXV0aEJ1dHRvbicpO1xuICAgICAgICAgICAgY29uc3QgdXNlck1lbnUgPSBkb21BUEkuZ2V0RWxlbWVudEJ5SWQoJ3VzZXJNZW51Jyk7XG4gICAgICAgICAgICBjb25zdCBsb2dvdXRCdG4gPSBkb21BUEkuZ2V0RWxlbWVudEJ5SWQoJ2xvZ291dEJ0bicpO1xuICAgICAgICAgICAgY29uc3QgdXNlckluaXRpYWxzRWwgPSBkb21BUEkuZ2V0RWxlbWVudEJ5SWQoJ3VzZXJJbml0aWFscycpO1xuICAgICAgICAgICAgY29uc3QgYXV0aFN0YXR1cyA9IGRvbUFQSS5nZXRFbGVtZW50QnlJZCgnYXV0aFN0YXR1cycpO1xuICAgICAgICAgICAgY29uc3QgdXNlclN0YXR1cyA9IGRvbUFQSS5nZXRFbGVtZW50QnlJZCgndXNlclN0YXR1cycpO1xuXG4gICAgICAgICAgICAvLyBUb2dnbGUgdmlzaWJpbGl0eSBiYXNlZCBvbiBhdXRoIHN0YXRlXG4gICAgICAgICAgICBpZiAoYXV0aEJ0bikge1xuICAgICAgICAgICAgICAgIGlmIChpc0F1dGgpIHtcbiAgICAgICAgICAgICAgICAgICAgZG9tQVBJLmFkZENsYXNzKGF1dGhCdG4sICdoaWRkZW4nKTtcbiAgICAgICAgICAgICAgICAgICAgZG9tQVBJLnNldFN0eWxlKGF1dGhCdG4sICdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICAgICAgICAgICAgZG9tQVBJLnNldEF0dHJpYnV0ZShhdXRoQnRuLCAnaGlkZGVuJywgJ2hpZGRlbicpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRvbUFQSS5yZW1vdmVDbGFzcyhhdXRoQnRuLCAnaGlkZGVuJyk7XG4gICAgICAgICAgICAgICAgICAgIGRvbUFQSS5zZXRTdHlsZShhdXRoQnRuLCAnZGlzcGxheScsICcnKTtcbiAgICAgICAgICAgICAgICAgICAgZG9tQVBJLnJlbW92ZUF0dHJpYnV0ZShhdXRoQnRuLCAnaGlkZGVuJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodXNlck1lbnUpIHtcbiAgICAgICAgICAgICAgICBkb21BUEkudG9nZ2xlQ2xhc3ModXNlck1lbnUsICdoaWRkZW4nLCAhaXNBdXRoKTtcbiAgICAgICAgICAgICAgICBkb21BUEkuc2V0U3R5bGUodXNlck1lbnUsICdkaXNwbGF5JywgaXNBdXRoID8gJycgOiAnbm9uZScpO1xuICAgICAgICAgICAgICAgIGlzQXV0aFxuICAgICAgICAgICAgICAgICAgICA/IGRvbUFQSS5yZW1vdmVBdHRyaWJ1dGUodXNlck1lbnUsICdoaWRkZW4nKVxuICAgICAgICAgICAgICAgICAgICA6IGRvbUFQSS5zZXRBdHRyaWJ1dGUodXNlck1lbnUsICdoaWRkZW4nLCAnaGlkZGVuJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFVwZGF0ZSB1c2VyIGluaXRpYWxzXG4gICAgICAgICAgICBpZiAodXNlck1lbnUgJiYgdXNlckluaXRpYWxzRWwpIHtcbiAgICAgICAgICAgICAgICBsZXQgaW5pdGlhbHMgPSAnVSc7XG4gICAgICAgICAgICAgICAgaWYgKGlzQXV0aCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHVzZXI/Lm5hbWUgPT09ICdzdHJpbmcnICYmIHVzZXIubmFtZS50cmltKCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5pdGlhbHMgPSB1c2VyLm5hbWUudHJpbSgpLnNwbGl0KC9cXHMrLykubWFwKHAgPT4gcFswXSkuam9pbignJykudG9VcHBlckNhc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgdXNlcj8udXNlcm5hbWUgPT09ICdzdHJpbmcnICYmIHVzZXIudXNlcm5hbWUudHJpbSgpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluaXRpYWxzID0gdXNlci51c2VybmFtZS5zbGljZSgwLCAyKS50b1VwcGVyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRvbUFQSS5zZXRUZXh0Q29udGVudCh1c2VySW5pdGlhbHNFbCwgaW5pdGlhbHMpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBVcGRhdGUgc3RhdHVzIHRleHRzXG4gICAgICAgICAgICBpZiAoYXV0aFN0YXR1cykge1xuICAgICAgICAgICAgICAgIGRvbUFQSS5zZXRUZXh0Q29udGVudChhdXRoU3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICBpc0F1dGggPyBgU2lnbmVkIGluIGFzICR7ZGlzcGxheU5hbWV9YCA6ICdOb3QgQXV0aGVudGljYXRlZCdcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodXNlclN0YXR1cykge1xuICAgICAgICAgICAgICAgIGRvbUFQSS5zZXRUZXh0Q29udGVudCh1c2VyU3RhdHVzLFxuICAgICAgICAgICAgICAgICAgICBpc0F1dGggPyBgSGVsbG8sICR7ZGlzcGxheU5hbWV9YCA6ICdPZmZsaW5lJ1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFNldHVwIGxvZ291dCBoYW5kbGVyXG4gICAgICAgICAgICBpZiAobG9nb3V0QnRuKSB7XG4gICAgICAgICAgICAgICAgZXZlbnRIYW5kbGVycy50cmFja0xpc3RlbmVyKFxuICAgICAgICAgICAgICAgICAgICBsb2dvdXRCdG4sXG4gICAgICAgICAgICAgICAgICAgICdjbGljaycsXG4gICAgICAgICAgICAgICAgICAgIHNhZmVIYW5kbGVyKChlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkb21BUEkucHJldmVudERlZmF1bHQoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoJ1thdXRoSW5pdF1bcmVuZGVyQXV0aEhlYWRlcl0gTG9nb3V0IGNsaWNrZWQuJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQ6ICdhdXRoSW5pdDpsb2dvdXQnXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGF1dGhNb2QgPSBEZXBlbmRlbmN5U3lzdGVtLm1vZHVsZXMuZ2V0KCdhdXRoJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhdXRoTW9kPy5sb2dvdXQ/LigpLmNhdGNoKGVyciA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCdbYXV0aEluaXRdIEVycm9yIGR1cmluZyBsb2dvdXQ6JywgZXJyLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRleHQ6ICdhdXRoSW5pdDpsb2dvdXQnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSwgJ0F1dGggbG9nb3V0IGNsaWNrJyksXG4gICAgICAgICAgICAgICAgICAgIHsgZGVzY3JpcHRpb246ICdBdXRoIGxvZ291dCBjbGljaycsIGNvbnRleHQ6ICdhdXRoSW5pdCcgfVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKCdbYXV0aEluaXRdW3JlbmRlckF1dGhIZWFkZXJdIEVycm9yIGR1cmluZyByZW5kZXJpbmcnLCBlcnIsIHtcbiAgICAgICAgICAgICAgICBjb250ZXh0OiAnYXV0aEluaXQ6cmVuZGVyQXV0aEhlYWRlcidcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZm9yY2VTaG93TG9naW5Nb2RhbCgpIHtcbiAgICAgICAgY29uc3QgYXBwTW9kdWxlTG9jYWwgPSBEZXBlbmRlbmN5U3lzdGVtLm1vZHVsZXMuZ2V0Py4oJ2FwcE1vZHVsZScpO1xuICAgICAgICBpZiAoYXBwTW9kdWxlTG9jYWwgJiYgIWFwcE1vZHVsZUxvY2FsLnN0YXRlPy5pc0F1dGhlbnRpY2F0ZWQpIHtcbiAgICAgICAgICAgIGNvbnN0IG1vZGFsTWFuYWdlciA9IERlcGVuZGVuY3lTeXN0ZW0ubW9kdWxlcy5nZXQ/LignbW9kYWxNYW5hZ2VyJyk7XG4gICAgICAgICAgICBpZiAobW9kYWxNYW5hZ2VyICYmIHR5cGVvZiBtb2RhbE1hbmFnZXIuc2hvdyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICAgIG1vZGFsTWFuYWdlci5zaG93KCdsb2dpbicpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1thdXRoSW5pdF1bZm9yY2VTaG93TG9naW5Nb2RhbF0gbW9kYWxNYW5hZ2VyIG1pc3NpbmcuJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBjbGVhbnVwKCkge1xuICAgICAgICBldmVudEhhbmRsZXJzLmNsZWFudXBMaXN0ZW5lcnMoeyBjb250ZXh0OiAnYXV0aEluaXQnIH0pO1xuICAgICAgICBsb2dnZXIuZGVidWcoJ1thdXRoSW5pdF0gQ2xlYW51cCBjb21wbGV0ZWQnLCB7IGNvbnRleHQ6ICdhdXRoSW5pdDpjbGVhbnVwJyB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBpbml0aWFsaXplQXV0aFN5c3RlbSxcbiAgICAgICAgaGFuZGxlQXV0aFN0YXRlQ2hhbmdlLFxuICAgICAgICByZW5kZXJBdXRoSGVhZGVyLFxuICAgICAgICBmb3JjZVNob3dMb2dpbk1vZGFsLFxuICAgICAgICBjbGVhbnVwXG4gICAgfTtcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFTyxTQUFTQSxjQUFjQSxDQUFDQyxJQUFJLEVBQUU7RUFDakMsTUFBTTtJQUNGQyxnQkFBZ0I7SUFBRUMsTUFBTTtJQUFFQyxhQUFhO0lBQ3ZDQyxNQUFNO0lBQUVDLFNBQVM7SUFBRUMsV0FBVztJQUM5QkMsbUJBQW1CO0lBQUVDO0VBQ3pCLENBQUMsR0FBR1IsSUFBSTtFQUVSLElBQUksQ0FBQ0MsZ0JBQWdCLElBQUksQ0FBQ0MsTUFBTSxJQUFJLENBQUNDLGFBQWEsSUFDOUMsQ0FBQ0MsTUFBTSxJQUFJLENBQUNDLFNBQVMsSUFBSSxDQUFDQyxXQUFXLElBQ3JDLENBQUNDLG1CQUFtQixJQUFJLENBQUNDLFVBQVUsRUFBRTtJQUNyQyxNQUFNLElBQUlDLEtBQUssQ0FBQyxtRUFBbUUsQ0FBQztFQUN4RjtFQUVBLGVBQWVDLG9CQUFvQkEsQ0FBQSxFQUFHO0lBQ2xDLE1BQU1ILG1CQUFtQixDQUFDSSxhQUFhLENBQUMsQ0FBQztJQUN6QyxNQUFNSixtQkFBbUIsQ0FBQ0ssdUJBQXVCLENBQUM7TUFDOUNaLElBQUksRUFBRSxDQUFDLE1BQU0sRUFBRSxlQUFlLENBQUM7TUFDL0JhLFlBQVksRUFBRSxDQUFDLGlCQUFpQixFQUFFLGFBQWEsQ0FBQztNQUNoREMsT0FBTyxFQUFFLElBQUk7TUFDYkMsT0FBTyxFQUFFO0lBQ2IsQ0FBQyxDQUFDO0lBRUYsTUFBTUMsSUFBSSxHQUFHZixnQkFBZ0IsQ0FBQ2dCLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLE1BQU0sQ0FBQztJQUNqRCxJQUFJLENBQUNGLElBQUksRUFBRUcsSUFBSSxFQUFFO01BQ2IsTUFBTSxJQUFJVixLQUFLLENBQUMsK0NBQStDLENBQUM7SUFDcEU7O0lBRUE7SUFDQSxJQUFJTyxJQUFJ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