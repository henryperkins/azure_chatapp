ed5864027d4c925a6abb73292025d13c
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createAuthStateManager = createAuthStateManager;
exports.default = void 0;
/**
 * AuthStateManager - extracted state and event management (Phase-2)
 * ----------------------------------------------------------------
 * Handles authentication state management, event broadcasting,
 * and session management. Extracted from oversized auth.js.
 */

function createAuthStateManager({
  eventService,
  logger,
  browserService,
  storageService
} = {}) {
  const MODULE = 'AuthStateManager';
  if (!eventService || !logger || !browserService) {
    throw new Error(`[${MODULE}] Required dependencies missing: eventService, logger, browserService`);
  }
  const _log = (msg, extra = {}) => logger?.debug?.(`[${MODULE}] ${msg}`, {
    context: MODULE,
    ...extra
  });
  const _logError = (msg, err, extra = {}) => {
    logger?.error?.(`[${MODULE}] ${msg}`, err?.stack || err, {
      context: MODULE,
      ...extra
    });
  };

  // Internal state
  let authState = {
    isAuthenticated: false,
    currentUser: null,
    lastVerification: null,
    sessionStartTime: null
  };

  // Session management constants
  const SESSION_CHECK_INTERVAL = 5 * 60 * 1000; // 5 minutes
  const SESSION_WARNING_THRESHOLD = 10 * 60 * 1000; // 10 minutes before expiry
  let sessionCheckTimer = null;
  function getAuthState() {
    return {
      isAuthenticated: authState.isAuthenticated,
      currentUser: authState.currentUser ? {
        ...authState.currentUser
      } : null,
      lastVerification: authState.lastVerification,
      sessionStartTime: authState.sessionStartTime
    };
  }
  function setAuthenticatedState(user) {
    if (!user || !user.id) {
      _logError('setAuthenticatedState called with invalid user object', null, {
        user
      });
      return;
    }
    const previousState = getAuthState();
    authState.isAuthenticated = true;
    authState.currentUser = {
      ...user
    };
    authState.lastVerification = Date.now();
    if (!authState.sessionStartTime) {
      authState.sessionStartTime = Date.now();
    }
    _log('Authentication state updated', {
      userId: user.id,
      username: user.username,
      previouslyAuthenticated: previousState.isAuthenticated
    });

    // Start session monitoring
    startSessionMonitoring();

    // Broadcast state change
    broadcastAuthStateChange(previousState, getAuthState());

    // Store user info if storage service available
    if (storageService) {
      try {
        storageService.setItem('lastUser', JSON.stringify({
          id: user.id,
          username: user.username,
          lastLogin: Date.now()
        }));
      } catch (err) {
        _logError('Failed to store user info', err);
      }
    }
  }
  function setUnauthenticatedState() {
    const previousState = getAuthState();
    authState.isAuthenticated = false;
    authState.currentUser = null;
    authState.lastVerification = null;
    authState.sessionStartTime = null;
    _log('Authentication state cleared', {
      wasAuthenticated: previousState.isAuthenticated,
      previousUser: previousState.currentUser?.username
    });

    // Stop session monitoring
    stopSessionMonitoring();

    // Broadcast state change
    broadcastAuthStateChange(previousState, getAuthState());

    // Clear stored user info if storage service available
    if (storageService) {
      try {
        storageService.removeItem('lastUser');
      } catch (err) {
        _logError('Failed to clear stored user info', err);
      }
    }
  }
  function updateLastVerification() {
    authState.lastVerification = Date.now();
    _log('Last verification timestamp updated');
  }
  function broadcastAuthStateChange(previousState, newState) {
    try {
      const eventData = {
        authenticated: newState.isAuthenticated,
        user: newState.currentUser,
        previouslyAuthenticated: previousState.isAuthenticated,
        timestamp: Date.now()
      };

      // Emit on multiple event names for compatibility
      eventService.emit('authStateChanged', eventData);
      eventService.emit('auth:stateChanged', eventData);

      // Legacy event for backward compatibility
      if (newState.isAuthenticated && !previousState.isAuthenticated) {
        eventService.emit('user:loggedIn', eventData);
      } else if (!newState.isAuthenticated && previousState.isAuthenticated) {
        eventService.emit('user:loggedOut', eventData);
      }
      _log('Auth state change broadcasted', {
        authenticated: newState.isAuthenticated,
        userId: newState.currentUser?.id,
        eventTimestamp: eventData.timestamp
      });
    } catch (err) {
      _logError('Failed to broadcast auth state change', err);
    }
  }
  function startSessionMonitoring() {
    if (sessionCheckTimer) {
      clearInterval(sessionCheckTimer);
    }
    sessionCheckTimer = setInterval(() => {
      if (!authState.isAuthenticated) {
        stopSessionMonitoring();
        return;
      }
      const now = Date.now();
      const timeSinceLastVerification = now - (authState.lastVerification || 0);

      // Emit session warning if approaching timeout
      if (timeSinceLastVerification > SESSION_WARNING_THRESHOLD) {
        eventService.emit('auth:sessionWarning', {
          timeSinceLastVerification,
          user: authState.currentUser
        });
      }
      _log('Session monitoring check', {
        timeSinceLastVerification,
        sessionAge: now - (authState.sessionStartTime || 0)
      });
    }, SESSION_CHECK_INTERVAL);
    _log('Session monitoring started');
  }
  function stopSessionMonitoring() {
    if (sessionCheckTimer) {
      clearInterval(sessionCheckTimer);
      sessionCheckTimer = null;
      _log('Session monitoring stopped');
    }
  }
  function isAuthenticated() {
    return authState.isAuthenticated;
  }
  function getCurrentUser() {
    return authState.currentUser ? {
      ...authState.currentUser
    } : null;
  }
  function getCurrentUserId() {
    return authState.currentUser?.id || null;
  }
  function getCurrentUsername() {
    return authState.currentUser?.username || null;
  }
  function getSessionAge() {
    if (!authState.sessionStartTime) return 0;
    return Date.now() - authState.sessionStartTime;
  }
  function getTimeSinceLastVerification() {
    if (!authState.lastVerification) return Infinity;
    return Date.now() - authState.lastVerification;
  }
  function shouldVerifySession(threshold = 5 * 60 * 1000) {
    // 5 minutes default
    if (!authState.isAuthenticated) return false;
    return getTimeSinceLastVerification() > threshold;
  }

  // Initialize from stored data if available
  function initializeFromStorage() {
    if (!storageService) return;
    try {
      const storedUser = storageService.getItem('lastUser');
      if (storedUser) {
        const userData = JSON.parse(storedUser);
        _log('Found stored user data', {
          username: userData.username
        });
        // Don't automatically set as authenticated - will verify with server
        return userData;
      }
    } catch (err) {
      _logError('Failed to initialize from storage', err);
    }
    return null;
  }
  return {
    // State queries
    isAuthenticated,
    getCurrentUser,
    getCurrentUserId,
    getCurrentUsername,
    getAuthState,
    // Session info
    getSessionAge,
    getTimeSinceLastVerification,
    shouldVerifySession,
    // State management
    setAuthenticatedState,
    setUnauthenticatedState,
    updateLastVerification,
    // Session monitoring
    startSessionMonitoring,
    stopSessionMonitoring,
    // Initialization
    initializeFromStorage,
    // Event broadcasting (for manual triggers)
    broadcastAuthStateChange,
    cleanup() {
      _log('cleanup()');
      stopSessionMonitoring();
      setUnauthenticatedState();
    }
  };
}
var _default = exports.default = createAuthStateManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVBdXRoU3RhdGVNYW5hZ2VyIiwiZXZlbnRTZXJ2aWNlIiwibG9nZ2VyIiwiYnJvd3NlclNlcnZpY2UiLCJzdG9yYWdlU2VydmljZSIsIk1PRFVMRSIsIkVycm9yIiwiX2xvZyIsIm1zZyIsImV4dHJhIiwiZGVidWciLCJjb250ZXh0IiwiX2xvZ0Vycm9yIiwiZXJyIiwiZXJyb3IiLCJzdGFjayIsImF1dGhTdGF0ZSIsImlzQXV0aGVudGljYXRlZCIsImN1cnJlbnRVc2VyIiwibGFzdFZlcmlmaWNhdGlvbiIsInNlc3Npb25TdGFydFRpbWUiLCJTRVNTSU9OX0NIRUNLX0lOVEVSVkFMIiwiU0VTU0lPTl9XQVJOSU5HX1RIUkVTSE9MRCIsInNlc3Npb25DaGVja1RpbWVyIiwiZ2V0QXV0aFN0YXRlIiwic2V0QXV0aGVudGljYXRlZFN0YXRlIiwidXNlciIsImlkIiwicHJldmlvdXNTdGF0ZSIsIkRhdGUiLCJub3ciLCJ1c2VySWQiLCJ1c2VybmFtZSIsInByZXZpb3VzbHlBdXRoZW50aWNhdGVkIiwic3RhcnRTZXNzaW9uTW9uaXRvcmluZyIsImJyb2FkY2FzdEF1dGhTdGF0ZUNoYW5nZSIsInNldEl0ZW0iLCJKU09OIiwic3RyaW5naWZ5IiwibGFzdExvZ2luIiwic2V0VW5hdXRoZW50aWNhdGVkU3RhdGUiLCJ3YXNBdXRoZW50aWNhdGVkIiwicHJldmlvdXNVc2VyIiwic3RvcFNlc3Npb25Nb25pdG9yaW5nIiwicmVtb3ZlSXRlbSIsInVwZGF0ZUxhc3RWZXJpZmljYXRpb24iLCJuZXdTdGF0ZSIsImV2ZW50RGF0YSIsImF1dGhlbnRpY2F0ZWQiLCJ0aW1lc3RhbXAiLCJlbWl0IiwiZXZlbnRUaW1lc3RhbXAiLCJjbGVhckludGVydmFsIiwic2V0SW50ZXJ2YWwiLCJ0aW1lU2luY2VMYXN0VmVyaWZpY2F0aW9uIiwic2Vzc2lvbkFnZSIsImdldEN1cnJlbnRVc2VyIiwiZ2V0Q3VycmVudFVzZXJJZCIsImdldEN1cnJlbnRVc2VybmFtZSIsImdldFNlc3Npb25BZ2UiLCJnZXRUaW1lU2luY2VMYXN0VmVyaWZpY2F0aW9uIiwiSW5maW5pdHkiLCJzaG91bGRWZXJpZnlTZXNzaW9uIiwidGhyZXNob2xkIiwiaW5pdGlhbGl6ZUZyb21TdG9yYWdlIiwic3RvcmVkVXNlciIsImdldEl0ZW0iLCJ1c2VyRGF0YSIsInBhcnNlIiwiY2xlYW51cCIsIl9kZWZhdWx0IiwiZXhwb3J0cyIsImRlZmF1bHQiXSwic291cmNlcyI6WyJhdXRoU3RhdGVNYW5hZ2VyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQXV0aFN0YXRlTWFuYWdlciAtIGV4dHJhY3RlZCBzdGF0ZSBhbmQgZXZlbnQgbWFuYWdlbWVudCAoUGhhc2UtMilcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIEhhbmRsZXMgYXV0aGVudGljYXRpb24gc3RhdGUgbWFuYWdlbWVudCwgZXZlbnQgYnJvYWRjYXN0aW5nLFxuICogYW5kIHNlc3Npb24gbWFuYWdlbWVudC4gRXh0cmFjdGVkIGZyb20gb3ZlcnNpemVkIGF1dGguanMuXG4gKi9cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUF1dGhTdGF0ZU1hbmFnZXIoe1xuICBldmVudFNlcnZpY2UsXG4gIGxvZ2dlcixcbiAgYnJvd3NlclNlcnZpY2UsXG4gIHN0b3JhZ2VTZXJ2aWNlXG59ID0ge30pIHtcbiAgY29uc3QgTU9EVUxFID0gJ0F1dGhTdGF0ZU1hbmFnZXInO1xuXG4gIGlmICghZXZlbnRTZXJ2aWNlIHx8ICFsb2dnZXIgfHwgIWJyb3dzZXJTZXJ2aWNlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBbJHtNT0RVTEV9XSBSZXF1aXJlZCBkZXBlbmRlbmNpZXMgbWlzc2luZzogZXZlbnRTZXJ2aWNlLCBsb2dnZXIsIGJyb3dzZXJTZXJ2aWNlYCk7XG4gIH1cblxuICBjb25zdCBfbG9nID0gKG1zZywgZXh0cmEgPSB7fSkgPT4gbG9nZ2VyPy5kZWJ1Zz8uKGBbJHtNT0RVTEV9XSAke21zZ31gLCB7XG4gICAgY29udGV4dDogTU9EVUxFLFxuICAgIC4uLmV4dHJhXG4gIH0pO1xuXG4gIGNvbnN0IF9sb2dFcnJvciA9IChtc2csIGVyciwgZXh0cmEgPSB7fSkgPT4ge1xuICAgIGxvZ2dlcj8uZXJyb3I/LihgWyR7TU9EVUxFfV0gJHttc2d9YCwgZXJyPy5zdGFjayB8fCBlcnIsIHtcbiAgICAgIGNvbnRleHQ6IE1PRFVMRSxcbiAgICAgIC4uLmV4dHJhXG4gICAgfSk7XG4gIH07XG5cbiAgLy8gSW50ZXJuYWwgc3RhdGVcbiAgbGV0IGF1dGhTdGF0ZSA9IHtcbiAgICBpc0F1dGhlbnRpY2F0ZWQ6IGZhbHNlLFxuICAgIGN1cnJlbnRVc2VyOiBudWxsLFxuICAgIGxhc3RWZXJpZmljYXRpb246IG51bGwsXG4gICAgc2Vzc2lvblN0YXJ0VGltZTogbnVsbFxuICB9O1xuXG4gIC8vIFNlc3Npb24gbWFuYWdlbWVudCBjb25zdGFudHNcbiAgY29uc3QgU0VTU0lPTl9DSEVDS19JTlRFUlZBTCA9IDUgKiA2MCAqIDEwMDA7IC8vIDUgbWludXRlc1xuICBjb25zdCBTRVNTSU9OX1dBUk5JTkdfVEhSRVNIT0xEID0gMTAgKiA2MCAqIDEwMDA7IC8vIDEwIG1pbnV0ZXMgYmVmb3JlIGV4cGlyeVxuICBsZXQgc2Vzc2lvbkNoZWNrVGltZXIgPSBudWxsO1xuXG4gIGZ1bmN0aW9uIGdldEF1dGhTdGF0ZSgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgaXNBdXRoZW50aWNhdGVkOiBhdXRoU3RhdGUuaXNBdXRoZW50aWNhdGVkLFxuICAgICAgY3VycmVudFVzZXI6IGF1dGhTdGF0ZS5jdXJyZW50VXNlciA/IHsgLi4uYXV0aFN0YXRlLmN1cnJlbnRVc2VyIH0gOiBudWxsLFxuICAgICAgbGFzdFZlcmlmaWNhdGlvbjogYXV0aFN0YXRlLmxhc3RWZXJpZmljYXRpb24sXG4gICAgICBzZXNzaW9uU3RhcnRUaW1lOiBhdXRoU3RhdGUuc2Vzc2lvblN0YXJ0VGltZVxuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBzZXRBdXRoZW50aWNhdGVkU3RhdGUodXNlcikge1xuICAgIGlmICghdXNlciB8fCAhdXNlci5pZCkge1xuICAgICAgX2xvZ0Vycm9yKCdzZXRBdXRoZW50aWNhdGVkU3RhdGUgY2FsbGVkIHdpdGggaW52YWxpZCB1c2VyIG9iamVjdCcsIG51bGwsIHsgdXNlciB9KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZ2V0QXV0aFN0YXRlKCk7XG4gICAgXG4gICAgYXV0aFN0YXRlLmlzQXV0aGVudGljYXRlZCA9IHRydWU7XG4gICAgYXV0aFN0YXRlLmN1cnJlbnRVc2VyID0geyAuLi51c2VyIH07XG4gICAgYXV0aFN0YXRlLmxhc3RWZXJpZmljYXRpb24gPSBEYXRlLm5vdygpO1xuICAgIFxuICAgIGlmICghYXV0aFN0YXRlLnNlc3Npb25TdGFydFRpbWUpIHtcbiAgICAgIGF1dGhTdGF0ZS5zZXNzaW9uU3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICB9XG5cbiAgICBfbG9nKCdBdXRoZW50aWNhdGlvbiBzdGF0ZSB1cGRhdGVkJywge1xuICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgdXNlcm5hbWU6IHVzZXIudXNlcm5hbWUsXG4gICAgICBwcmV2aW91c2x5QXV0aGVudGljYXRlZDogcHJldmlvdXNTdGF0ZS5pc0F1dGhlbnRpY2F0ZWRcbiAgICB9KTtcblxuICAgIC8vIFN0YXJ0IHNlc3Npb24gbW9uaXRvcmluZ1xuICAgIHN0YXJ0U2Vzc2lvbk1vbml0b3JpbmcoKTtcblxuICAgIC8vIEJyb2FkY2FzdCBzdGF0ZSBjaGFuZ2VcbiAgICBicm9hZGNhc3RBdXRoU3RhdGVDaGFuZ2UocHJldmlvdXNTdGF0ZSwgZ2V0QXV0aFN0YXRlKCkpO1xuXG4gICAgLy8gU3RvcmUgdXNlciBpbmZvIGlmIHN0b3JhZ2Ugc2VydmljZSBhdmFpbGFibGVcbiAgICBpZiAoc3RvcmFnZVNlcnZpY2UpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHN0b3JhZ2VTZXJ2aWNlLnNldEl0ZW0oJ2xhc3RVc2VyJywgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgIGlkOiB1c2VyLmlkLFxuICAgICAgICAgIHVzZXJuYW1lOiB1c2VyLnVzZXJuYW1lLFxuICAgICAgICAgIGxhc3RMb2dpbjogRGF0ZS5ub3coKVxuICAgICAgICB9KSk7XG4gICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgX2xvZ0Vycm9yKCdGYWlsZWQgdG8gc3RvcmUgdXNlciBpbmZvJywgZXJyKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBzZXRVbmF1dGhlbnRpY2F0ZWRTdGF0ZSgpIHtcbiAgICBjb25zdCBwcmV2aW91c1N0YXRlID0gZ2V0QXV0aFN0YXRlKCk7XG4gICAgXG4gICAgYXV0aFN0YXRlLmlzQXV0aGVudGljYXRlZCA9IGZhbHNlO1xuICAgIGF1dGhTdGF0ZS5jdXJyZW50VXNlciA9IG51bGw7XG4gICAgYXV0aFN0YXRlLmxhc3RWZXJpZmljYXRpb24gPSBudWxsO1xuICAgIGF1dGhTdGF0ZS5zZXNzaW9uU3RhcnRUaW1lID0gbnVsbDtcblxuICAgIF9sb2coJ0F1dGhlbnRpY2F0aW9uIHN0YXRlIGNsZWFyZWQnLCB7XG4gICAgICB3YXNBdXRoZW50aWNhdGVkOiBwcmV2aW91c1N0YXRlLmlzQXV0aGVudGljYXRlZCxcbiAgICAgIHByZXZpb3VzVXNlcjogcHJldmlvdXNTdGF0ZS5jdXJyZW50VXNlcj8udXNlcm5hbWVcbiAgICB9KTtcblxuICAgIC8vIFN0b3Agc2Vzc2lvbiBtb25pdG9yaW5nXG4gICAgc3RvcFNlc3Npb25Nb25pdG9yaW5nKCk7XG5cbiAgICAvLyBCcm9hZGNhc3Qgc3RhdGUgY2hhbmdlXG4gICAgYnJvYWRjYXN0QXV0aFN0YXRlQ2hhbmdlKHByZXZpb3VzU3RhdGUsIGdldEF1dGhTdGF0ZSgpKTtcblxuICAgIC8vIENsZWFyIHN0b3JlZCB1c2VyIGluZm8gaWYgc3RvcmFnZSBzZXJ2aWNlIGF2YWlsYWJsZVxuICAgIGlmIChzdG9yYWdlU2VydmljZSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgc3RvcmFnZVNlcnZpY2UucmVtb3ZlSXRlbSgnbGFzdFVzZXInKTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBfbG9nRXJyb3IoJ0ZhaWxlZCB0byBjbGVhciBzdG9yZWQgdXNlciBpbmZvJywgZXJyKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiB1cGRhdGVMYXN0VmVyaWZpY2F0aW9uKCkge1xuICAgIGF1dGhTdGF0ZS5sYXN0VmVyaWZpY2F0aW9uID0gRGF0ZS5ub3coKTtcbiAgICBfbG9nKCdMYXN0IHZlcmlmaWNhdGlvbiB0aW1lc3RhbXAgdXBkYXRlZCcpO1xuICB9XG5cbiAgZnVuY3Rpb24gYnJvYWRjYXN0QXV0aFN0YXRlQ2hhbmdlKHByZXZpb3VzU3RhdGUsIG5ld1N0YXRlKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGV2ZW50RGF0YSA9IHtcbiAgICAgICAgYXV0aGVudGljYXRlZDogbmV3U3RhdGUuaXNBdXRoZW50aWNhdGVkLFxuICAgICAgICB1c2VyOiBuZXdTdGF0ZS5jdXJyZW50VXNlcixcbiAgICAgICAgcHJldmlvdXNseUF1dGhlbnRpY2F0ZWQ6IHByZXZpb3VzU3RhdGUuaXNBdXRoZW50aWNhdGVkLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICAgIH07XG5cbiAgICAgIC8vIEVtaXQgb24gbXVsdGlwbGUgZXZlbnQgbmFtZXMgZm9yIGNvbXBhdGliaWxpdHlcbiAgICAgIGV2ZW50U2VydmljZS5lbWl0KCdhdXRoU3RhdGVDaGFuZ2VkJywgZXZlbnREYXRhKTtcbiAgICAgIGV2ZW50U2VydmljZS5lbWl0KCdhdXRoOnN0YXRlQ2hhbmdlZCcsIGV2ZW50RGF0YSk7XG4gICAgICBcbiAgICAgIC8vIExlZ2FjeSBldmVudCBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eVxuICAgICAgaWYgKG5ld1N0YXRlLmlzQXV0aGVudGljYXRlZCAmJiAhcHJldmlvdXNTdGF0ZS5pc0F1dGhlbnRpY2F0ZWQpIHtcbiAgICAgICAgZXZlbnRTZXJ2aWNlLmVtaXQoJ3VzZXI6bG9nZ2VkSW4nLCBldmVudERhdGEpO1xuICAgICAgfSBlbHNlIGlmICghbmV3U3RhdGUuaXNBdXRoZW50aWNhdGVkICYmIHByZXZpb3VzU3RhdGUuaXNBdXRoZW50aWNhdGVkKSB7XG4gICAgICAgIGV2ZW50U2VydmljZS5lbWl0KCd1c2VyOmxvZ2dlZE91dCcsIGV2ZW50RGF0YSk7XG4gICAgICB9XG5cbiAgICAgIF9sb2coJ0F1dGggc3RhdGUgY2hhbmdlIGJyb2FkY2FzdGVkJywge1xuICAgICAgICBhdXRoZW50aWNhdGVkOiBuZXdTdGF0ZS5pc0F1dGhlbnRpY2F0ZWQsXG4gICAgICAgIHVzZXJJZDogbmV3U3RhdGUuY3VycmVudFVzZXI/LmlkLFxuICAgICAgICBldmVudFRpbWVzdGFtcDogZXZlbnREYXRhLnRpbWVzdGFtcFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBfbG9nRXJyb3IoJ0ZhaWxlZCB0byBicm9hZGNhc3QgYXV0aCBzdGF0ZSBjaGFuZ2UnLCBlcnIpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHN0YXJ0U2Vzc2lvbk1vbml0b3JpbmcoKSB7XG4gICAgaWYgKHNlc3Npb25DaGVja1RpbWVyKSB7XG4gICAgICBjbGVhckludGVydmFsKHNlc3Npb25DaGVja1RpbWVyKTtcbiAgICB9XG5cbiAgICBzZXNzaW9uQ2hlY2tUaW1lciA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgIGlmICghYXV0aFN0YXRlLmlzQXV0aGVudGljYXRlZCkge1xuICAgICAgICBzdG9wU2Vzc2lvbk1vbml0b3JpbmcoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICAgICAgY29uc3QgdGltZVNpbmNlTGFzdFZlcmlmaWNhdGlvbiA9IG5vdyAtIChhdXRoU3RhdGUubGFzdFZlcmlmaWNhdGlvbiB8fCAwKTtcbiAgICAgIFxuICAgICAgLy8gRW1pdCBzZXNzaW9uIHdhcm5pbmcgaWYgYXBwcm9hY2hpbmcgdGltZW91dFxuICAgICAgaWYgKHRpbWVTaW5jZUxhc3RWZXJpZmljYXRpb24gPiBTRVNTSU9OX1dBUk5JTkdfVEhSRVNIT0xEKSB7XG4gICAgICAgIGV2ZW50U2VydmljZS5lbWl0KCdhdXRoOnNlc3Npb25XYXJuaW5nJywge1xuICAgICAgICAgIHRpbWVTaW5jZUxhc3RWZXJpZmljYXRpb24sXG4gICAgICAgICAgdXNlcjogYXV0aFN0YXRlLmN1cnJlbnRVc2VyXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBfbG9nKCdTZXNzaW9uIG1vbml0b3JpbmcgY2hlY2snLCB7XG4gICAgICAgIHRpbWVTaW5jZUxhc3RWZXJpZmljYXRpb24sXG4gICAgICAgIHNlc3Npb25BZ2U6IG5vdyAtIChhdXRoU3RhdGUuc2Vzc2lvblN0YXJ0VGltZSB8fCAwKVxuICAgICAgfSk7XG4gICAgfSwgU0VTU0lPTl9DSEVDS19JTlRFUlZBTCk7XG5cbiAgICBfbG9nKCdTZXNzaW9uIG1vbml0b3Jpbmcgc3RhcnRlZCcpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3RvcFNlc3Npb25Nb25pdG9yaW5nKCkge1xuICAgIGlmIChzZXNzaW9uQ2hlY2tUaW1lcikge1xuICAgICAgY2xlYXJJbnRlcnZhbChzZXNzaW9uQ2hlY2tUaW1lcik7XG4gICAgICBzZXNzaW9uQ2hlY2tUaW1lciA9IG51bGw7XG4gICAgICBfbG9nKCdTZXNzaW9uIG1vbml0b3Jpbmcgc3RvcHBlZCcpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGlzQXV0aGVudGljYXRlZCgpIHtcbiAgICByZXR1cm4gYXV0aFN0YXRlLmlzQXV0aGVudGljYXRlZDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEN1cnJlbnRVc2VyKCkge1xuICAgIHJldHVybiBhdXRoU3RhdGUuY3VycmVudFVzZXIgPyB7IC4uLmF1dGhTdGF0ZS5jdXJyZW50VXNlciB9IDogbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEN1cnJlbnRVc2VySWQoKSB7XG4gICAgcmV0dXJuIGF1dGhTdGF0ZS5jdXJyZW50VXNlcj8uaWQgfHwgbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldEN1cnJlbnRVc2VybmFtZSgpIHtcbiAgICByZXR1cm4gYXV0aFN0YXRlLmN1cnJlbnRVc2VyPy51c2VybmFtZSB8fCBudWxsO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0U2Vzc2lvbkFnZSgpIHtcbiAgICBpZiAoIWF1dGhTdGF0ZS5zZXNzaW9uU3RhcnRUaW1lKSByZXR1cm4gMDtcbiAgICByZXR1cm4gRGF0ZS5ub3coKSAtIGF1dGhTdGF0ZS5zZXNzaW9uU3RhcnRUaW1lO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0VGltZVNpbmNlTGFzdFZlcmlmaWNhdGlvbigpIHtcbiAgICBpZiAoIWF1dGhTdGF0ZS5sYXN0VmVyaWZpY2F0aW9uKSByZXR1cm4gSW5maW5pdHk7XG4gICAgcmV0dXJuIERhdGUubm93KCkgLSBhdXRoU3RhdGUubGFzdFZlcmlmaWNhdGlvbjtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNob3VsZFZlcmlmeVNlc3Npb24odGhyZXNob2xkID0gNSAqIDYwICogMTAwMCkgeyAvLyA1IG1pbnV0ZXMgZGVmYXVsdFxuICAgIGlmICghYXV0aFN0YXRlLmlzQXV0aGVudGljYXRlZCkgcmV0dXJuIGZhbHNlO1xuICAgIHJldHVybiBnZXRUaW1lU2luY2VMYXN0VmVyaWZpY2F0aW9uKCkgPiB0aHJlc2hvbGQ7XG4gIH1cblxuICAvLyBJbml0aWFsaXplIGZyb20gc3RvcmVkIGRhdGEgaWYgYXZhaWxhYmxlXG4gIGZ1bmN0aW9uIGluaXRpYWxpemVGcm9tU3RvcmFnZSgpIHtcbiAgICBpZiAoIXN0b3JhZ2VTZXJ2aWNlKSByZXR1cm47XG5cbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3RvcmVkVXNlciA9IHN0b3JhZ2VTZXJ2aWNlLmdldEl0ZW0oJ2xhc3RVc2VyJyk7XG4gICAgICBpZiAoc3RvcmVkVXNlcikge1xuICAgICAgICBjb25zdCB1c2VyRGF0YSA9IEpTT04ucGFyc2Uoc3RvcmVkVXNlcik7XG4gICAgICAgIF9sb2coJ0ZvdW5kIHN0b3JlZCB1c2VyIGRhdGEnLCB7IHVzZXJuYW1lOiB1c2VyRGF0YS51c2VybmFtZSB9KTtcbiAgICAgICAgLy8gRG9uJ3QgYXV0b21hdGljYWxseSBzZXQgYXMgYXV0aGVudGljYXRlZCAtIHdpbGwgdmVyaWZ5IHdpdGggc2VydmVyXG4gICAgICAgIHJldHVybiB1c2VyRGF0YTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIF9sb2dFcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgZnJvbSBzdG9yYWdlJywgZXJyKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIC8vIFN0YXRlIHF1ZXJpZXNcbiAgICBpc0F1dGhlbnRpY2F0ZWQsXG4gICAgZ2V0Q3VycmVudFVzZXIsXG4gICAgZ2V0Q3VycmVudFVzZXJJZCxcbiAgICBnZXRDdXJyZW50VXNlcm5hbWUsXG4gICAgZ2V0QXV0aFN0YXRlLFxuICAgIFxuICAgIC8vIFNlc3Npb24gaW5mb1xuICAgIGdldFNlc3Npb25BZ2UsXG4gICAgZ2V0VGltZVNpbmNlTGFzdFZlcmlmaWNhdGlvbixcbiAgICBzaG91bGRWZXJpZnlTZXNzaW9uLFxuXG4gICAgLy8gU3RhdGUgbWFuYWdlbWVudFxuICAgIHNldEF1dGhlbnRpY2F0ZWRTdGF0ZSxcbiAgICBzZXRVbmF1dGhlbnRpY2F0ZWRTdGF0ZSxcbiAgICB1cGRhdGVMYXN0VmVyaWZpY2F0aW9uLFxuXG4gICAgLy8gU2Vzc2lvbiBtb25pdG9yaW5nXG4gICAgc3RhcnRTZXNzaW9uTW9uaXRvcmluZyxcbiAgICBzdG9wU2Vzc2lvbk1vbml0b3JpbmcsXG5cbiAgICAvLyBJbml0aWFsaXphdGlvblxuICAgIGluaXRpYWxpemVGcm9tU3RvcmFnZSxcblxuICAgIC8vIEV2ZW50IGJyb2FkY2FzdGluZyAoZm9yIG1hbnVhbCB0cmlnZ2VycylcbiAgICBicm9hZGNhc3RBdXRoU3RhdGVDaGFuZ2UsXG5cbiAgICBjbGVhbnVwKCkge1xuICAgICAgX2xvZygnY2xlYW51cCgpJyk7XG4gICAgICBzdG9wU2Vzc2lvbk1vbml0b3JpbmcoKTtcbiAgICAgIHNldFVuYXV0aGVudGljYXRlZFN0YXRlKCk7XG4gICAgfVxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVBdXRoU3RhdGVNYW5hZ2VyOyJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFTyxTQUFTQSxzQkFBc0JBLENBQUM7RUFDckNDLFlBQVk7RUFDWkMsTUFBTTtFQUNOQyxjQUFjO0VBQ2RDO0FBQ0YsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFO0VBQ04sTUFBTUMsTUFBTSxHQUFHLGtCQUFrQjtFQUVqQyxJQUFJLENBQUNKLFlBQVksSUFBSSxDQUFDQyxNQUFNLElBQUksQ0FBQ0MsY0FBYyxFQUFFO0lBQy9DLE1BQU0sSUFBSUcsS0FBSyxDQUFDLElBQUlELE1BQU0sdUVBQXVFLENBQUM7RUFDcEc7RUFFQSxNQUFNRSxJQUFJLEdBQUdBLENBQUNDLEdBQUcsRUFBRUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxLQUFLUCxNQUFNLEVBQUVRLEtBQUssR0FBRyxJQUFJTCxNQUFNLEtBQUtHLEdBQUcsRUFBRSxFQUFFO0lBQ3RFRyxPQUFPLEVBQUVOLE1BQU07SUFDZixHQUFHSTtFQUNMLENBQUMsQ0FBQztFQUVGLE1BQU1HLFNBQVMsR0FBR0EsQ0FBQ0osR0FBRyxFQUFFSyxHQUFHLEVBQUVKLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSztJQUMxQ1AsTUFBTSxFQUFFWSxLQUFLLEdBQUcsSUFBSVQsTUFBTSxLQUFLRyxHQUFHLEVBQUUsRUFBRUssR0FBRyxFQUFFRSxLQUFLLElBQUlGLEdBQUcsRUFBRTtNQUN2REYsT0FBTyxFQUFFTixNQUFNO01BQ2YsR0FBR0k7SUFDTCxDQUFDLENBQUM7RUFDSixDQUFDOztFQUVEO0VBQ0EsSUFBSU8sU0FBUyxHQUFHO0lBQ2RDLGVBQWUsRUFBRSxLQUFLO0lBQ3RCQyxXQUFXLEVBQUUsSUFBSTtJQUNqQkMsZ0JBQWdCLEVBQUUsSUFBSTtJQUN0QkMsZ0JBQWdCLEVBQUU7RUFDcEIsQ0FBQzs7RUFFRDtFQUNBLE1BQU1DLHNCQUFzQixHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUM7RUFDOUMsTUFBTUMseUJBQXlCLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQztFQUNsRCxJQUFJQyxpQkFBaUIsR0FBRyxJQUFJO0VBRTVCLFNBQVNDLFlBQVlBLENBQUEsRUFBRztJQUN0QixPQUFPO01BQ0xQLGVBQWUsRUFBRUQsU0FBUyxDQUFDQyxlQUFlO01BQzFDQyxXQUFXLEVBQUVGLFNBQVMsQ0FBQ0UsV0FBVyxHQUFHO1FBQUUsR0FBR0YsU0FBUyxDQUFDRTtNQUFZLENBQUMsR0FBRyxJQUFJO01BQ3hFQyxnQkFBZ0IsRUFBRUgsU0FBUyxDQUFDRyxnQkFBZ0I7TUFDNUNDLGdCQUFnQixFQUFFSixTQUFTLENBQUNJO0lBQzlCLENBQUM7RUFDSDtFQUVBLFNBQVNLLHFCQUFxQkEsQ0FBQ0MsSUFBSSxFQUFFO0lBQ25DLElBQUksQ0FBQ0EsSUFBSSxJQUFJLENBQUNBLElBQUksQ0FBQ0MsRUFBRSxFQUFFO01BQ3JCZixTQUFTLENBQUMsdURBQXVELEVBQUUsSUFBSSxFQUFFO1FBQUVjO01BQUssQ0FBQyxDQUFDO01BQ2xGO0lBQ0Y7SUFFQSxNQUFNRSxhQUFhLEdBQUdKLFlBQVksQ0FBQyxDQUFDO0lBRXBDUixTQUFTLENBQUNDLGVBQWUsR0FBRyxJQUFJO0lBQ2hDRCxTQUFTLENBQUNFLFdBQVcsR0FBRztNQUFFLEdBQUdRO0lBQUssQ0FBQztJQUNuQ1YsU0FBUyxDQUFDRyxnQkFBZ0IsR0FBR1UsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQztJQUV2QyxJQUFJLENBQUNkLFNBQVMsQ0FBQ0ksZ0JBQWdCLEVBQUU7TUFDL0JKLFNBQVMsQ0FBQ0ksZ0JBQWdCLEdBQUdTLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUM7SUFDekM7SUFFQXZCLElBQUksQ0FBQyw4QkFBOEIsRUFBRTtNQUNuQ3dCLE1BQU0sRUFBRUwsSUFBSSxDQUFDQyxFQUFFO01BQ2ZLLFFBQVEsRUFBRU4sSUFBSSxDQUFDTSxRQUFRO01BQ3ZCQyx1QkFBdUIsRUFBRUwsYUFBYSxDQUFDWDtJQUN6QyxDQUFDLENBQUM7O0lBRUY7SUFDQWlCLHNCQUFzQixDQUFDLENBQUM7O0lBRXhCO0lBQ0FDLHdCQUF3QixDQUFDUCxhQUFhLEVBQUVKLFlBQVksQ0FBQyxDQUFDLENBQUM7O0lBRXZEO0lBQ0EsSUFBSXBCLGNBQWMsRUFBRTtNQUNsQixJQUFJO1FBQ0ZBLGNBQWMsQ0FBQ2dDLE9BQU8sQ0FBQyxVQUFVLEVBQUVDLElBQUksQ0FBQ0MsU0FBUyxDQUFDO1VBQ2hEWCxFQUFFLEVBQUVELElBQUksQ0FBQ0MsRUFBRTtVQUNYSyxRQUFRLEVBQUVOLElBQUksQ0FBQ00sUUFBUTtVQUN2Qk8sU0FBUyxFQUFFVixJQUFJLENBQUNDLEdBQUcsQ0FBQztRQUN0QixDQUFDLENBQUMsQ0FBQztNQUNMLENBQUMsQ0FBQyxPQUFPakIsR0FBRyxFQUFFO1FBQ1pELFNBQVMsQ0FBQywyQkFBMkIsRUFBRUMsR0FBRyxDQUFDO01BQzdDO0lBQ0Y7RUFDRjtFQUVBLFNBQVMyQix1QkFBdUJBLENBQUEsRUFBRztJQUNqQyxNQUFNWixhQUFhLEdBQUdKLFlBQVksQ0FBQyxDQUFDO0lBRXBDUixTQUFTLENBQUNDLGVBQWUsR0FBRyxLQUFLO0lBQ2pDRCxTQUFTLENBQUNFLFdBQVcsR0FBRyxJQUFJO0lBQzVCRixTQUFTLENBQUNHLGdCQUFnQixHQUFHLElBQUk7SUFDakNILFNBQVMsQ0FBQ0ksZ0JBQWdCLEdBQUcsSUFBSTtJQUVqQ2IsSUFBSSxDQUFDLDhCQUE4QixFQUFFO01BQ25Da0MsZ0JBQWdCLEVBQUViLGFBQWEsQ0FBQ1gsZUFBZTtNQUMvQ3lCLFlBQVksRUFBRWQsYUFBYSxDQUFDVixXQUFXLEVBQUVjO0lBQzNDLENBQUMsQ0FBQzs7SUFFRjtJQUNBVyxxQkFBcUIsQ0FBQyxDQUFDOztJQUV2QjtJQUNBUix3QkFBd0IsQ0FBQ1AsYUFBYSxFQUFFSixZQUFZLENBQUMsQ0FBQyxDQUFDOztJQUV2RDtJQUNBLElBQUlwQixjQUFjLEVBQUU7TUFDbEIsSUFBSTtRQUNGQSxjQUFjLENBQUN3QyxVQUFVLENBQUMsVUFBVSxDQUFDO01BQ3ZDLENBQUMsQ0FBQyxPQUFPL0IsR0FBRyxFQUFFO1FBQ1pELFNBQVMsQ0FBQyxrQ0FBa0MsRUFBRUMsR0FBRyxDQUFDO01BQ3BEO0lBQ0Y7RUFDRjtFQUVBLFNBQVNnQyxzQkFBc0JBLENBQUEsRUFBRztJQUNoQzdCLFNBQVMsQ0FBQ0csZ0JBQWdCLEdBQUdVLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUM7SUFDdkN2QixJQUFJLENBQUMscUNBQXFDLENBQUM7RUFDN0M7RUFFQSxTQUFTNEIsd0JBQXdCQSxDQUFDUCxhQUFhLEVBQUVrQixRQUFRLEVBQUU7SUFDekQsSUFBSTtNQUNGLE1BQU1DLFNBQVMsR0FBRztRQUNoQkMsYUFBYSxFQUFFRixRQUFRLENBQUM3QixlQUFlO1FBQ3ZDUyxJQUFJLEVBQUVvQixRQUFRLENBQUM1QixXQUFXO1FBQzFCZSx1QkFBdUIsRUFBRUwsYUFBYSxDQUFDWCxlQUFlO1FBQ3REZ0MsU0FBUyxFQUFFcEIsSUFBSSxDQUFDQyxHQUFHLENBQUM7TUFDdEIsQ0FBQzs7TUFFRDtNQUNBN0IsWUFBWSxDQUFDaUQsSUFBSSxDQUFDLGtCQUFrQixFQUFFSCxTQUFTLENBQUM7TUFDaEQ5QyxZQUFZLENBQUNpRCxJQUFJLENBQUMsbUJBQW1CLEVBQUVILFNBQVMsQ0FBQzs7TUFFakQ7TUFDQSxJQUFJRCxRQUFRLENBQUM3QixlQUFlLElBQUksQ0FBQ1csYUFBYSxDQUFDWCxlQUFlLEVBQUU7UUFDOURoQixZQUFZLENBQUNpRCxJQUFJLENBQUMsZUFBZSxFQUFFSCxTQUFTLENBQUM7TUFDL0MsQ0FBQyxNQUFNLElBQUksQ0FBQ0QsUUFBUSxDQUFDN0IsZUFBZSxJQUFJVyxhQUFhLENBQUNYLGVBQWUsRUFBRTtRQUNyRWhCLFlBQVksQ0FBQ2lELElBQUksQ0FBQyxnQkFBZ0IsRUFBRUgsU0FBUyxDQUFDO01BQ2hEO01BRUF4QyxJQUFJLENBQUMsK0JBQStCLEVBQUU7UUFDcEN5QyxhQUFhLEVBQUVGLFFBQVEsQ0FBQzdCLGVBQWU7UUFDdkNjLE1BQU0sRUFBRWUsUUFBUSxDQUFDNUIsV0FBVyxFQUFFUyxFQUFFO1FBQ2hDd0IsY0FBYyxFQUFFSixTQUFTLENBQUNFO01BQzVCLENBQUMsQ0FBQztJQUNKLENBQUMsQ0FBQyxPQUFPcEMsR0FBRyxFQUFFO01BQ1pELFNBQVMsQ0FBQyx1Q0FBdUMsRUFBRUMsR0FBRyxDQUFDO0lBQ3pEO0VBQ0Y7RUFFQSxTQUFTcUIsc0JBQXNCQSxDQUFBLEVBQUc7SUFDaEMsSUFBSVgsaUJBQWlCLEVBQUU7TUFDckI2QixhQUFhLENBQUM3QixpQkFBaUIsQ0FBQztJQUNsQztJQUVBQSxpQkFBaUIsR0FBRzhCLFdBQVcsQ0FBQyxNQUFNO01BQ3BDLElBQUksQ0FBQ3JDLFNBQVMsQ0FBQ0MsZUFBZSxFQUFFO1FBQzlCMEIscUJBQXFCLENBQUMsQ0FBQztRQUN2QjtNQUNGO01BRUEsTUFBTWIsR0FBRyxHQUFHRCxJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFDO01BQ3RCLE1BQU13Qix5QkFBeUIsR0FBR3hCLEdBQUcsSUFBSWQsU0FBUyxDQUFDRyxnQkFBZ0IsSUFBSSxDQUFDLENBQUM7O01BRXpFO01BQ0EsSUFBSW1DLHlCQUF5QixHQUFHaEMseUJBQXlCLEVBQUU7UUFDekRyQixZQUFZLENBQUNpRCxJQUFJLENBQUMscUJBQXFCLEVBQUU7VUFDdkNJLHlCQUF5QjtVQUN6QjVCLElBQUksRUFBRVYsU0FBUyxDQUFDRTtRQUNsQixDQUFDLENBQUM7TUFDSjtNQUVBWCxJQUFJLENBQUMsMEJBQTBCLEVBQUU7UUFDL0IrQyx5QkFBeUI7UUFDekJDLFVBQVUsRUFBRXpCLEdBQUcsSUFBSWQsU0FBUyxDQUFDSSxnQkFBZ0IsSUFBSSxDQUFDO01BQ3BELENBQUMsQ0FBQztJQUNKLENBQUMsRUFBRUMsc0JBQXNCLENBQUM7SUFFMUJkLElBQUksQ0FBQyw0QkFBNEIsQ0FBQztFQUNwQztFQUVBLFNBQVNvQyxxQkFBcUJBLENBQUEsRUFBRztJQUMvQixJQUFJcEIsaUJBQWlCLEVBQUU7TUFDckI2QixhQUFhLENBQUM3QixpQkFBaUIsQ0FBQztNQUNoQ0EsaUJBQWlCLEdBQUcsSUFBSTtNQUN4QmhCLElBQUksQ0FBQyw0QkFBNEIsQ0FBQztJQUNwQztFQUNGO0VBRUEsU0FBU1UsZUFBZUEsQ0FBQSxFQUFHO0lBQ3pCLE9BQU9ELFNBQVMsQ0FBQ0MsZUFBZTtFQUNsQztFQUVBLFNBQVN1QyxjQUFjQSxDQUFBLEVBQUc7SUFDeEIsT0FBT3hDLFNBQVMsQ0FBQ0UsV0FBVyxHQUFHO01BQUUsR0FBR0YsU0FBUyxDQUFDRTtJQUFZLENBQUMsR0FBRyxJQUFJO0VBQ3BFO0VBRUEsU0FBU3VDLGdCQUFnQkEsQ0FBQSxFQUFHO0lBQzFCLE9BQU96QyxTQUFTLENBQUNFLFdBQVcsRUFBRVMsRUFBRSxJQUFJLElBQUk7RUFDMUM7RUFFQSxTQUFTK0Isa0JBQWtCQSxDQUFBLEVBQUc7SUFDNUIsT0FBTzFDLFNBQVMsQ0FBQ0UsV0FBVyxFQUFFYyxRQUFRLElBQUksSUFBSTtFQUNoRDtFQUVBLFNBQVMyQixhQUFhQSxDQUFBLEVBQUc7SUFDdkIsSUFBSSxDQUFDM0MsU0FBUyxDQUFDSSxnQkFBZ0IsRUFBRSxPQUFPLENBQUM7SUFDekMsT0FBT1MsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQyxHQUFHZCxTQUFTLENBQUNJLGdCQUFnQjtFQUNoRDtFQUVBLFNBQVN3Qyw0QkFBNEJBLENBQUEsRUFBRztJQUN0QyxJQUFJLENBQUM1QyxTQUFTLENBQUNHLGdCQUFnQixFQUFFLE9BQU8wQyxRQUFRO0lBQ2hELE9BQU9oQyxJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFDLEdBQUdkLFNBQVMsQ0FBQ0csZ0JBQWdCO0VBQ2hEO0VBRUEsU0FBUzJDLG1CQUFtQkEsQ0FBQ0MsU0FBUyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsSUFBSSxFQUFFO0lBQUU7SUFDeEQsSUFBSSxDQUFDL0MsU0FBUyxDQUFDQyxlQUFlLEVBQUUsT0FBTyxLQUFLO0lBQzVDLE9BQU8yQyw0QkFBNEIsQ0FBQyxDQUFDLEdBQUdHLFNBQVM7RUFDbkQ7O0VBRUE7RUFDQSxTQUFTQyxxQkFBcUJBLENBQUEsRUFBRztJQUMvQixJQUFJLENBQUM1RCxjQUFjLEVBQUU7SUFFckIsSUFBSTtNQUNGLE1BQU02RCxVQUFVLEdBQUc3RCxjQUFjLENBQUM4RCxPQUFPLENBQUMsVUFBVSxDQUFDO01BQ3JELElBQUlELFVBQVUsRUFBRTtRQUNkLE1BQU1FLFFBQVEsR0FBRzlCLElBQUksQ0FBQytCLEtBQUssQ0FBQ0gsVUFBVSxDQUFDO1FBQ3ZDMUQsSUFBSSxDQUFDLHdCQUF3QixFQUFFO1VBQUV5QixRQUFRLEVBQUVtQyxRQUFRLENBQUNuQztRQUFTLENBQUMsQ0FBQztRQUMvRDtRQUNBLE9BQU9tQyxRQUFRO01BQ2pCO0lBQ0YsQ0FBQyxDQUFDLE9BQU90RCxHQUFHLEVBQUU7TUFDWkQsU0FBUyxDQUFDLG1DQUFtQyxFQUFFQyxHQUFHLENBQUM7SUFDckQ7SUFDQSxPQUFPLElBQUk7RUFDYjtFQUVBLE9BQU87SUFDTDtJQUNBSSxlQUFlO0lBQ2Z1QyxjQUFjO0lBQ2RDLGdCQUFnQjtJQUNoQkMsa0JBQWtCO0lBQ2xCbEMsWUFBWTtJQUVaO0lBQ0FtQyxhQUFhO0lBQ2JDLDRCQUE0QjtJQUM1QkUsbUJBQW1CO0lBRW5CO0lBQ0FyQyxxQkFBcUI7SUFDckJlLHVCQUF1QjtJQUN2Qkssc0JBQXNCO0lBRXRCO0lBQ0FYLHNCQUFzQjtJQUN0QlMscUJBQXFCO0lBRXJCO0lBQ0FxQixxQkFBcUI7SUFFckI7SUFDQTdCLHdCQUF3QjtJQUV4QmtDLE9BQU9BLENBQUEsRUFBRztNQUNSOUQsSUFBSSxDQUFDLFdBQVcsQ0FBQztNQUNqQm9DLHFCQUFxQixDQUFDLENBQUM7TUFDdkJILHVCQUF1QixDQUFDLENBQUM7SUFDM0I7RUFDRixDQUFDO0FBQ0g7QUFBQyxJQUFBOEIsUUFBQSxHQUFBQyxPQUFBLENBQUFDLE9BQUEsR0FFY3hFLHNCQUFzQiIsImlnbm9yZUxpc3QiOltdfQ==