{"version":3,"names":["isValidProjectId","id","idStr","String","trim","test","UUID_REGEX","createProjectManager","DependencySystem","domReadinessService","logger","timer","eventHandlers","eventService","otherDeps","Error","MODULE","normalizeProjectResponse","res","debug","type","keys","Object","hasData","data","hasProject","project","hasDataProject","dataKeys","response","JSON","stringify","Array","isArray","dataId","extractedId","uuid","project_id","projectId","name","title","project_name","description","details","project_description","goals","project_goals","customInstructions","instructions","custom_instructions","project_instructions","length","error","status","rawResponse","responseType","responseKeys","finalData","finalId","idLength","isValid","receivedId","idType","extractResourceList","k","retryWithBackoff","fn","maxRetries","timerRef","attempt","err","context","Promise","r","ProjectManager","constructor","app","chatManager","modelConfig","listenerTracker","timerFunc","setTimeout","cb","storage","setItem","getItem","apiEndpoints","apiRequest","browserService","domAPI","authModule","appBus","moduleName","trackListener","add","t","e","h","dsc","remove","cleanupListeners","_loadingProjects","_loadProjectsDebounceTimer","_DEBOUNCE_DELAY","_CONFIG","PROJECTS","DETAIL","STATS","FILES","CONVOS","CONVERSATIONS","ARTIFACTS","KB_LIST_URL_TEMPLATE","KB_DETAIL_URL_TEMPLATE","ARCHIVE","FILE_DETAIL","FILE_DOWNLOAD","ARTIFACT_DOWNLOAD","_req","url","opts","contextLabel","mergedOpts","credentials","_emit","event","detail","emit","getDocument","doc","evh","modules","get","domEvt","createCustomEvent","CustomEvent","dispatchEvent","warn","loadProjects","filter","clearTimeout","resolve","call","projects","state","isAuthenticated","baseUrl","USER_PROJECTS","endsWith","includes","origin","getLocation","urlObj","URL","searchParams","set","delete","undefined","list","_handleErr","loadProjectDetails","currentUser","detailUrlTemplate","detailUrl","substring","indexOf","replace","info","authHeader","getAuthHeader","authState","hasAuthToken","Authorization","detailRes","apiError","message","isAuthError","currentProjectObj","globalCurrentProjectId","getCurrentProject","setCurrentProject","loadedProject","currentGlobalProjectId","archived","kbLoadResult","value","knowledge_base_id","kbValue","loadProjectKnowledgeBase","kbError","reason","knowledgeBase","otherResourcesPromises","loadProjectStats","loadProjectFiles","loadProjectConversations","loadProjectArtifacts","otherResults","allSettled","stats","files","convos","artifacts","allResults","criticalErrors","map","errors","userId","endpoint","backendDetail","originalError","knowledgeBaseId","kb","convosUrl","conversations","saveProject","payload","isUpdate","Boolean","method","body","proj","deleteProject","currentProject","toggleArchiveProject","createConversation","createNewConversation","origErr","finalErr","msg","toLowerCase","_ensureKnowledgeBase","retryErr","source","_getEffectiveProjectId","candidates","getProjectId","urlSearch","search","params","URLSearchParams","candidate","getConversation","conversationId","convo","conversation","deleteProjectConversation","deleteConversation","prepareFileUploads","fileList","validatedFiles","invalidFiles","file","size","push","uploadFileWithRetry","index_kb","formData","FormData","append","jobId","job_id","evt","fileName","deleteFile","fileId","listUrl","items","active","find","is_active","listError","embedding_model","createRes","kbData","createError","downloadFile","downloadArtifact","artifactId","createProject","projectData","ensureConversation","hasConvo","Number","conversation_count","createDefaultConversation","model_id","getConfig","modelName","initialize","dependenciesAndElements","deps","timeout","auth","appModule","authIsReadyFn","isReady","bind","authReady","AuthBus","once","authenticated","poll","setInterval","clearInterval","_setupEventListeners","initialProject","authBus","_handleCurrentProjectChanged","_handleAuthStateChanged","newProject","oldProject","previousProject","newProjectId","oldProjectId","eventType","fallbackValue","additionalDetails","destroy","fullDeps","instance","register","cleanup"],"sources":["projectManager.js"],"sourcesContent":["// VENDOR-EXEMPT-SIZE: Core module pending refactor in Q3-25\n// Refactored to comply with factory export, pure imports, domReadinessService usage, event bus for module events,\n// and logger-based error handling per guardrails. No top-level logic is executed here; all initialization occurs inside createProjectManager.\n\n// ----------------------------------------------------------------------------\n// 1) Provide a top-level export for isValidProjectId (cannot export from inside a function)\n// ----------------------------------------------------------------------------\nexport function isValidProjectId(id) {\n  if (id == null) return false;\n\n  const idStr = String(id).trim();\n\n  if (/^\\d+$/.test(idStr)) return true;\n\n  const UUID_REGEX = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n  if (UUID_REGEX.test(idStr)) return true;\n\n  if (/^[0-9a-f]{32}$/i.test(idStr)) return true;\n\n  return false;\n}\n\n// ----------------------------------------------------------------------------\n// 2) Primary factory export: createProjectManager\n/**\n * Factory function that creates and configures a ProjectManager instance for managing projects and related resources.\n *\n * The returned object includes the ProjectManager instance, a cleanup method, and utility functions for normalizing project responses, extracting resource lists, and retrying asynchronous operations with backoff.\n *\n * @returns {Object} An object containing:\n *   - `instance`: The ProjectManager instance.\n *   - `cleanup`: Function to destroy the instance and clean up listeners.\n *   - `normalizeProjectResponse`: Utility to normalize project server responses.\n *   - `extractResourceList`: Utility to extract resource arrays from API responses.\n *   - `retryWithBackoff`: Utility to retry async functions with exponential backoff.\n *\n * @throws {Error} If required dependencies (`DependencySystem`, `domReadinessService`, or `logger`) are missing.\n *\n * @remark\n * The ProjectManager instance is registered with the DependencySystem under the name `'projectManager'`.\n */\nexport function createProjectManager({\n  DependencySystem,\n  domReadinessService,\n  logger,\n  timer,\n  eventHandlers,  // Phase-1.3: Extract eventHandlers from otherDeps\n  eventService = null,\n  ...otherDeps\n} = {}) {\n  if (!DependencySystem) {\n    throw new Error('[createProjectManager] Missing DependencySystem');\n  }\n  if (!domReadinessService) {\n    throw new Error('[createProjectManager] Missing domReadinessService');\n  }\n  if (!logger) {\n    throw new Error('[createProjectManager] Missing logger');\n  }\n\n  const MODULE = 'ProjectManager';\n\n  function normalizeProjectResponse(res) {\n    // Raw response diagnostic – debug level to avoid Sentry noise\n    logger.debug('[ProjectManager] normalizeProjectResponse - raw response:', {\n      type: typeof res,\n      keys: res ? Object.keys(res) : [],\n      hasData: !!res?.data,\n      hasProject: !!res?.project,\n      hasDataProject: !!res?.data?.project,\n      dataKeys: res?.data ? Object.keys(res.data) : [],\n      response: JSON.stringify(res, null, 2)\n    });\n\n    let data = Array.isArray(res)\n      ? res[0]\n      : res?.data?.project?.id\n        ? res.data.project\n        : res?.project?.id\n          ? res.project\n          : res?.data?.id\n            ? res.data\n            : res?.id\n              ? res\n              : null;\n\n    logger.debug('[ProjectManager] normalizeProjectResponse - extracted data:', {\n      data: data,\n      dataId: data?.id,\n      extractedId: data?.id ?? data?.uuid ?? data?.project_id ?? data?.projectId\n    });\n\n    if (data) {\n      data = { ...data, id: String(data.id ?? data.uuid ?? data.project_id ?? data.projectId ?? '').trim() };\n      // Robust frontend field mapping for key project details\n      data.name =\n        data.name ??\n        data.title ??\n        data.project_name ??\n        \"\";\n      data.description =\n        data.description ??\n        data.details ??\n        data.project_description ??\n        \"\";\n      data.goals =\n        data.goals ??\n        data.project_goals ??\n        \"\";\n      data.customInstructions =\n        data.customInstructions ??\n        data.instructions ??\n        data.custom_instructions ??\n        data.project_instructions ??\n        \"\";\n    }\n\n    // Check if data extraction failed completely\n    if (!data) {\n      // Check if this is an empty response (likely 404 or server error)\n      if (res && typeof res === 'object' && Object.keys(res).length === 0) {\n        logger.error('[ProjectManager] Server returned empty response - likely project not found or access denied');\n        const error = new Error('Project not found or access denied');\n        error.status = 404;\n        throw error;\n      }\n      logger.error('[ProjectManager] Could not extract project data from response:', {\n        rawResponse: res,\n        responseType: typeof res,\n        responseKeys: res ? Object.keys(res) : []\n      });\n      throw new Error('Invalid response structure - no project data found');\n    }\n\n    logger.debug('[ProjectManager] normalizeProjectResponse - final validation:', {\n      finalData: data,\n      finalId: data?.id,\n      idLength: data?.id?.length,\n      isValid: isValidProjectId(data?.id)\n    });\n\n    if (!isValidProjectId(data?.id)) {\n      logger.error('[ProjectManager] Invalid project ID detected:', {\n        receivedId: data?.id,\n        idType: typeof data?.id,\n        idLength: data?.id?.length,\n        rawResponse: res\n      });\n      throw new Error('Invalid project ID in server response');\n    }\n    return data;\n  }\n\n  function extractResourceList(res, keys = ['projects', 'conversations', 'files', 'artifacts']) {\n    for (const k of keys) {\n      if (Array.isArray(res?.[k])) return res[k];\n      if (Array.isArray(res?.data?.[k])) return res.data[k];\n      if (res?.[k]?.id) return [res[k]];\n      if (res?.data?.[k]?.id) return [res.data[k]];\n    }\n    if (Array.isArray(res?.data)) return res.data;\n    if (Array.isArray(res)) return res;\n    if (res?.id) return [res];\n    return [];\n  }\n\n  async function retryWithBackoff(fn, maxRetries, timerRef) {\n    let attempt = 0;\n    while (true) {\n      try {\n        return await fn();\n      } catch (err) {\n        logger.error('[ProjectManager][retryWithBackoff-fn]', err, { context: MODULE });\n        // rethrow if 4xx not 429 or if we exceeded max retries\n        if (\n          err &&\n          err.status &&\n          ((err.status >= 400 && err.status < 500 && err.status !== 429) || err.status === 405)\n        ) {\n          throw err;\n        }\n        if (++attempt > maxRetries) {\n          throw err;\n        }\n        await new Promise((r) => timerRef(r, 1000 * attempt));\n      }\n    }\n  }\n\n  class ProjectManager {\n    constructor({\n      app,\n      chatManager,\n      DependencySystem,\n      logger,\n      modelConfig = null,\n      listenerTracker = null,\n      timer: timerFunc = typeof setTimeout === 'function' ? setTimeout : (cb) => cb(),\n      storage = { setItem: () => { }, getItem: () => null },\n      apiEndpoints,\n      apiRequest = null,\n      browserService = null,\n      domReadinessService,\n      domAPI = null,\n      eventHandlers = null,      // Phase-1.3: DI compliance - injected instead of runtime lookup\n      authModule = null,         // Phase-1.3: DI compliance - injected instead of runtime lookup\n      appBus = null,             // Phase-1.3: DI compliance - injected instead of runtime lookup\n      eventService = null        // Phase-3: Unified event system\n    } = {}) {\n      if (!DependencySystem) {\n        throw new Error('DependencySystem required');\n      }\n      if (!apiEndpoints) {\n        throw new Error('apiEndpoints required');\n      }\n      if (!domReadinessService) {\n        throw new Error('[createProjectManager] Missing domReadinessService');\n      }\n\n      this.moduleName = MODULE;\n      this.logger = logger;\n      this.DependencySystem = DependencySystem;\n      this.domReadinessService = domReadinessService;\n\n      // Phase-1.3: Store injected dependencies (no runtime lookups)\n      this.app = app;\n      this.chatManager = chatManager;\n      this.modelConfig = modelConfig;\n      this.timer = timerFunc;\n      this.storage = storage;\n      this.apiRequest = apiRequest ?? this.app?.apiRequest;\n      this.browserService = browserService;\n      this.domAPI = domAPI;\n      this.eventHandlers = eventHandlers;\n      this.authModule = authModule;\n      this.appBus = appBus;\n      this.eventService = eventService;\n\n      // track listeners if provided\n      if (!listenerTracker) {\n        // Phase-1.3: Use injected eventHandlers instead of runtime lookup\n        if (!this.eventHandlers?.trackListener) {\n          throw new Error('eventHandlers.trackListener missing');\n        }\n        listenerTracker = {\n          add: (t, e, h, dsc) => this.eventHandlers.trackListener(t, e, h, { description: dsc, context: MODULE }),\n          remove: () => this.eventHandlers.cleanupListeners?.({ context: MODULE })\n        };\n      }\n      this.listenerTracker = listenerTracker;\n\n      this._loadingProjects = false;\n      this._loadProjectsDebounceTimer = null;\n      this._DEBOUNCE_DELAY = 300;\n      // CONSOLIDATED: Removed _activeProjectId - use canonical appModule.state.currentProjectId instead\n\n      this.apiEndpoints = apiEndpoints;\n      this._CONFIG = {\n        PROJECTS: apiEndpoints.PROJECTS || '/api/projects/',\n        DETAIL: apiEndpoints.DETAIL || '/api/projects/{id}/',\n        STATS: apiEndpoints.STATS || '/api/projects/{id}/stats/',\n        FILES: apiEndpoints.FILES || '/api/projects/{id}/files/',\n        // Always store a string template; never invoke endpoint factories here\n        CONVOS: (typeof apiEndpoints.CONVERSATIONS === 'string'\n          ? apiEndpoints.CONVERSATIONS\n          : '/api/projects/{id}/conversations/'),\n        ARTIFACTS: apiEndpoints.ARTIFACTS || '/api/projects/{id}/artifacts/',\n        KB_LIST_URL_TEMPLATE:\n          apiEndpoints.KB_LIST_URL_TEMPLATE || '/api/projects/{id}/knowledge-bases/',\n        KB_DETAIL_URL_TEMPLATE:\n          apiEndpoints.KB_DETAIL_URL_TEMPLATE || '/api/projects/{id}/knowledge-bases/{kb_id}/',\n        ARCHIVE: apiEndpoints.ARCHIVE || '/api/projects/{id}/archive/',\n        FILE_DETAIL: apiEndpoints.FILE_DETAIL || '/api/projects/{id}/files/{file_id}/',\n        FILE_DOWNLOAD: apiEndpoints.FILE_DOWNLOAD || '/api/projects/{id}/files/{file_id}/download/',\n        ARTIFACT_DOWNLOAD:\n          apiEndpoints.ARTIFACT_DOWNLOAD || '/api/projects/{id}/artifacts/{artifact_id}/download/'\n      };\n    }\n    _req(url, opts = {}, contextLabel = 'n/a') {\n      if (typeof this.apiRequest !== 'function') {\n        throw new Error('[ProjectManager] apiRequest missing');\n      }\n      /* Always include cookies so authenticated calls reach the server.\n         Merge with caller-supplied opts without overwriting them.          */\n      const mergedOpts =\n        opts && typeof opts === 'object'\n          ? { credentials: 'include', ...opts }\n          : { credentials: 'include' };\n\n      return this.apiRequest(url, mergedOpts, contextLabel);\n    }\n\n    _emit(event, detail) {\n      /* Use unified eventService for project events */\n      if (this.eventService?.emit) {\n        this.eventService.emit(`project:${event}`, detail);\n      } else {\n        /* Fallback to global document dispatch if eventService not available */\n        try {\n          if (this.domAPI?.getDocument) {\n            const doc = this.domAPI.getDocument();\n            if (doc) {\n              /* use DependencySystem-provided eventHandlers.createCustomEvent\n                 when available, else fall back to new CustomEvent               */\n              const evh = this.DependencySystem?.modules?.get?.('eventHandlers');\n              const domEvt = evh?.createCustomEvent\n                ? evh.createCustomEvent(`project:${event}`, { detail })\n                : new CustomEvent(`project:${event}`, { detail });\n\n              this.domAPI.dispatchEvent(doc, domEvt);\n            }\n          }\n        } catch (err) {\n          /* non-fatal: log and continue */\n          this.logger?.warn?.(`[ProjectManager] failed to rebroadcast \"${event}\"`, err, {\n            context: this.moduleName\n          });\n        }\n      }\n    }\n\n    async loadProjects(filter = 'all') {\n      if (this._loadProjectsDebounceTimer) {\n        clearTimeout(this._loadProjectsDebounceTimer);\n      }\n      return new Promise((resolve) => {\n        this._loadProjectsDebounceTimer = this.timer.call(null, async () => {\n          if (this._loadingProjects) {\n            resolve(this.projects || []);\n            return;\n          }\n          if (!this.app?.state?.isAuthenticated) {\n            resolve([]);\n            return;\n          }\n          this._loadingProjects = true;\n          this._emit('projectsLoading', { filter });\n          try {\n            let baseUrl;\n            if (typeof this.apiEndpoints.USER_PROJECTS === 'function') {\n              baseUrl = this.apiEndpoints.USER_PROJECTS();\n            } else if (this.apiEndpoints.USER_PROJECTS) {\n              baseUrl = this.apiEndpoints.USER_PROJECTS;\n            } else if (typeof this.apiEndpoints.PROJECTS === 'function') {\n              baseUrl = this.apiEndpoints.PROJECTS();\n            } else {\n              baseUrl = this.apiEndpoints.PROJECTS || this._CONFIG.PROJECTS;\n            }\n\n            if (typeof baseUrl === 'string' && !baseUrl.endsWith('/') && !baseUrl.includes('?')) {\n              baseUrl += '/';\n            }\n            const origin = this.browserService?.getLocation?.().origin || '';\n            const urlObj = new URL(baseUrl, origin);\n            if (filter && filter !== 'all') {\n              urlObj.searchParams.set('filter', filter);\n            } else {\n              urlObj.searchParams.delete('filter');\n            }\n            const res = await this._req(String(urlObj), undefined, 'loadProjects');\n            const list = extractResourceList(res, ['projects']);\n            this.projects = list;\n            this._emit('projectsLoaded', { projects: list, filter });\n            resolve(list);\n          } catch (err) {\n            logger.error('[ProjectManager][loadProjects]', err, { context: MODULE });\n            resolve(this._handleErr('projectsLoaded', err, []));\n          } finally {\n            this._loadingProjects = false;\n          }\n        }, this._DEBOUNCE_DELAY);\n      });\n    }\n\n    async loadProjectDetails(id) {\n      if (!isValidProjectId(id)) {\n        throw new Error('Invalid projectId');\n      }\n      if (!this.app || !this.app.state || !this.app.state.currentUser) {\n        this._emit('projectDetailsError', { error: 'User not authenticated', status: 403 });\n        return null;\n      }\n      let detailUrlTemplate;\n      if (typeof this.apiEndpoints.DETAIL === 'function') {\n        detailUrlTemplate = null;\n      } else {\n        detailUrlTemplate = String(this.apiEndpoints.DETAIL || this._CONFIG.DETAIL);\n      }\n      let detailUrl;\n      if (detailUrlTemplate) {\n        if (\n          detailUrlTemplate.includes('{id}') &&\n          !detailUrlTemplate.endsWith('/') &&\n          detailUrlTemplate.substring(detailUrlTemplate.indexOf('{id}') + '{id}'.length).length === 0\n        ) {\n          detailUrlTemplate += '/';\n        }\n        detailUrl = detailUrlTemplate.replace('{id}', id);\n      } else if (typeof this.apiEndpoints.DETAIL === 'function') {\n        detailUrl = this.apiEndpoints.DETAIL(id);\n      } else {\n        throw new Error('Invalid DETAIL endpoint configuration');\n      }\n\n      try {\n        logger.info(`[${MODULE}] Requesting project details from URL: ${detailUrl}`);\n        \n        // Check authentication state first\n        const authModule = this.DependencySystem?.modules?.get('auth');\n        const authHeader = authModule?.getAuthHeader?.() || this.app?.getAuthHeader?.() || {};\n        \n        const authState = {\n          isAuthenticated: this.app?.state?.isAuthenticated,\n          currentUser: this.app?.state?.currentUser?.id || 'none',\n          hasAuthToken: !!authHeader.Authorization,\n        };\n        logger.debug(`[${MODULE}] Authentication state:`, authState);\n        \n        /*\n         * Previous logic threw an error when the in-memory token cache was empty\n         * even though the user was considered authenticated (isAuthenticated).\n         * This is a common situation when the backend issued the access token\n         * as an **HttpOnly cookie** – JavaScript cannot read that cookie, so\n         * getAuthHeader() understandably returns an empty object.\n         *\n         * The backend, however, will still receive the cookie because all\n         * requests are executed with `credentials: 'include'` inside the\n         * projectManager _req wrapper.  Rejecting the call on the client side\n         * therefore leads to false “Please log in again” errors even though\n         * the session is perfectly valid.\n         *\n         * Fix: do **not** treat the missing Authorization header as fatal.\n         * We simply proceed – if the server really cannot authenticate the\n         * request it will reply with 401/403 and the normal error handling\n         * path (this._handleErr) will take over.\n         */\n        \n        let detailRes;\n        try {\n          detailRes = await this._req(detailUrl, undefined, 'loadProjectDetails');\n        } catch (apiError) {\n          logger.error(`[${MODULE}] API request failed with error:`, {\n            error: apiError,\n            status: apiError?.status,\n            message: apiError?.message,\n            data: apiError?.data,\n            isAuthError: apiError?.status === 401\n          });\n          \n          // Special handling for auth errors\n          if (apiError?.status === 401) {\n            logger.error(`[${MODULE}] Authentication failed - user may need to re-login`);\n          }\n          \n          throw apiError; // Re-throw to handle in outer catch\n        }\n        logger.debug(`[${MODULE}] Received response from server:`, {\n          type: typeof detailRes,\n          keys: detailRes ? Object.keys(detailRes) : [],\n          hasData: !!(detailRes?.data || detailRes?.project)\n        });\n        const currentProjectObj = normalizeProjectResponse(detailRes);\n\n        // Race condition check: Only update global state if the loaded project is still the active one.\n        const globalCurrentProjectId = this.app?.getCurrentProject?.()?.id;\n        if (globalCurrentProjectId === id) {\n          this.logger.info(`[${MODULE}][loadProjectDetails] Setting current project in app state.`, { projectId: id, context: MODULE });\n          this.app.setCurrentProject(currentProjectObj); // This will trigger AppBus 'currentProjectChanged'\n        } else {\n          this.logger.warn(`[${MODULE}][loadProjectDetails] Global current project changed (${globalCurrentProjectId}) while loading details for ${id}. Not updating global state.`, { context: MODULE });\n          // Decide if we should still emit 'projectLoaded' on local bus or a different event.\n          // For now, let's assume other components will react to AppBus 'currentProjectChanged'.\n          // If this component specifically needs to signal it loaded 'an old project', add custom event.\n          this._emit('projectDetailsLoadedForStaleId', { loadedProject: currentProjectObj, currentGlobalProjectId: globalCurrentProjectId, context: MODULE });\n          return currentProjectObj; // Return the loaded data, but don't make it the global current\n        }\n\n        this._emit('projectLoaded', currentProjectObj); // Emit on local bus\n\n        if (currentProjectObj.archived) {\n          this._emit('projectArchivedNotice', { id: currentProjectObj.id });\n          return { ...currentProjectObj };\n        }\n\n        let kbLoadResult = { status: 'fulfilled', value: null };\n        if (currentProjectObj && currentProjectObj.knowledge_base_id) {\n          try {\n            const kbValue = await this.loadProjectKnowledgeBase(\n              currentProjectObj.id,\n              currentProjectObj.knowledge_base_id\n            );\n            kbLoadResult = { status: 'fulfilled', value: kbValue };\n          } catch (kbError) {\n            logger.error('[ProjectManager][loadProjectDetails-kbError]', kbError, { context: MODULE });\n            kbLoadResult = { status: 'rejected', reason: kbError };\n          }\n        } else {\n          this._emit('projectKnowledgeBaseLoaded', { id, knowledgeBase: null });\n        }\n\n        const otherResourcesPromises = [\n          this.loadProjectStats(id),\n          this.loadProjectFiles(id),\n          this.loadProjectConversations(id),\n          this.loadProjectArtifacts(id)\n        ];\n        const otherResults = await Promise.allSettled(otherResourcesPromises);\n        const [stats, files, convos, artifacts] = otherResults;\n\n        const allResults = [kbLoadResult, stats, files, convos, artifacts];\n        const criticalErrors = allResults\n          .filter((r) => r.status === 'rejected')\n          .map((r) => r.reason);\n        if (criticalErrors.length > 0) {\n          this._emit('projectDetailsLoadError', { id, errors: criticalErrors });\n        }\n\n        this._emit('projectDetailsFullyLoaded', { projectId: currentProjectObj.id });\n        return { ...currentProjectObj };\n      } catch (err) {\n        logger.error('[ProjectManager][loadProjectDetails]', err, { context: MODULE });\n        const userId = this.app?.state?.currentUser?.id || null;\n        const status = err?.status || err?.response?.status;\n        const endpoint = detailUrl;\n        const backendDetail = err?.detail || err?.response?.data?.detail || err?.response?.detail;\n        this._handleErr('projectDetailsError', err, null, {\n          projectId: id,\n          userId,\n          status,\n          endpoint,\n          backendDetail,\n          originalError: err\n        });\n        if (status === 404) {\n          this._emit('projectNotFound', { id });\n        }\n        return null;\n      }\n    }\n\n    async loadProjectKnowledgeBase(projectId, knowledgeBaseId) {\n      if (!knowledgeBaseId) {\n        this._emit('projectKnowledgeBaseLoaded', { id: projectId, knowledgeBase: null });\n        return null;\n      }\n      try {\n        const url = this._CONFIG.KB_DETAIL_URL_TEMPLATE\n          .replace('{id}', projectId)\n          .replace('{kb_id}', knowledgeBaseId);\n        const res = await this._req(url, undefined, 'loadProjectKnowledgeBase');\n        const kb = res?.data || res;\n        if (!kb || !kb.id) {\n          this._emit('projectKnowledgeBaseLoaded', { id: projectId, knowledgeBase: null });\n          return null;\n        } else {\n          this._emit('projectKnowledgeBaseLoaded', { id: projectId, knowledgeBase: kb });\n          return kb;\n        }\n      } catch (err) {\n        logger.error('[ProjectManager][loadProjectKnowledgeBase]', err, { context: MODULE });\n        this._emit('projectKnowledgeBaseLoaded', { id: projectId, knowledgeBase: null });\n        throw err;\n      }\n    }\n\n    async loadProjectStats(id) {\n      try {\n        const res = await this._req(\n          this._CONFIG.STATS.replace('{id}', id),\n          undefined,\n          'loadProjectStats'\n        );\n        const stats = res?.data ?? {};\n        this._emit('projectStatsLoaded', { id, ...stats });\n        return stats;\n      } catch (err) {\n        logger.error('[ProjectManager][loadProjectStats]', err, { context: MODULE });\n        return this._handleErr('projectStatsError', err, {});\n      }\n    }\n\n    async loadProjectFiles(id) {\n      try {\n        const res = await this._req(\n          this._CONFIG.FILES.replace('{id}', id),\n          undefined,\n          'loadProjectFiles'\n        );\n        const files = extractResourceList(res, ['files', 'file']) ?? [];\n        this._emit('projectFilesLoaded', { id, files });\n        return files;\n      } catch (err) {\n        logger.error('[ProjectManager][loadProjectFiles]', err, { context: MODULE });\n        return this._handleErr('projectFilesError', err, []);\n      }\n    }\n\n    async loadProjectConversations(id) {\n      try {\n        const convosUrl =\n          typeof this._CONFIG.CONVOS === 'function'\n            ? this._CONFIG.CONVOS(id)\n            : this._CONFIG.CONVOS.replace('{id}', id);\n\n        const res = await this._req(\n          convosUrl,\n          undefined,\n          'loadProjectConversations'\n        );\n        const conversations = extractResourceList(res, ['conversations']) ?? [];\n        this._emit('projectConversationsLoaded', { id, conversations });\n        return conversations;\n      } catch (err) {\n        logger.error('[ProjectManager][loadProjectConversations]', err, { context: MODULE });\n        return this._handleErr('projectConversationsError', err, []);\n      }\n    }\n\n    async loadProjectArtifacts(id) {\n      try {\n        const res = await this._req(\n          this._CONFIG.ARTIFACTS.replace('{id}', id),\n          undefined,\n          'loadProjectArtifacts'\n        );\n        const artifacts = extractResourceList(res, ['artifacts']) ?? [];\n        this._emit('projectArtifactsLoaded', { id, artifacts });\n        return artifacts;\n      } catch (err) {\n        logger.error('[ProjectManager][loadProjectArtifacts]', err, { context: MODULE });\n        return this._handleErr('projectArtifactsError', err, []);\n      }\n    }\n\n    async saveProject(id, payload) {\n      if (!this.app?.state?.isAuthenticated) throw new Error('auth');\n      const isUpdate = Boolean(id);\n      const url = isUpdate ? this._CONFIG.DETAIL.replace('{id}', id) : this._CONFIG.PROJECTS;\n      const method = isUpdate ? 'PATCH' : 'POST';\n      try {\n        const res = await this._req(url, { method, body: payload }, 'saveProject');\n        const proj = res?.data ?? res;\n        this._emit(isUpdate ? 'projectUpdated' : 'projectCreated', proj);\n        return proj;\n      } catch (err) {\n        logger.error('[ProjectManager][saveProject]', err, { context: MODULE });\n        this._handleErr('projectSaveError', err, null, {\n          method: 'saveProject',\n          endpoint: url\n        });\n        throw err;\n      }\n    }\n\n    async deleteProject(id) {\n      if (!this.app?.state?.isAuthenticated) throw new Error('auth');\n      try {\n        await this._req(\n          this._CONFIG.DETAIL.replace('{id}', id),\n          { method: 'DELETE' },\n          'deleteProject'\n        );\n        if (this.currentProject?.id === id) {\n          this.currentProject = null;\n        }\n        this._emit('projectDeleted', { id });\n      } catch (err) {\n        logger.error('[ProjectManager][deleteProject]', err, { context: MODULE });\n        this._handleErr('projectDeleteError', err, null, {\n          method: 'deleteProject',\n          endpoint: this._CONFIG.DETAIL.replace('{id}', id)\n        });\n        throw err;\n      }\n    }\n\n    async toggleArchiveProject(id) {\n      if (!this.app?.state?.isAuthenticated) throw new Error('auth');\n      try {\n        const res = await this._req(\n          this._CONFIG.ARCHIVE.replace('{id}', id),\n          { method: 'PATCH' },\n          'toggleArchiveProject'\n        );\n        this._emit('projectArchiveToggled', {\n          id,\n          archived: res?.archived ?? !this.currentProject?.archived\n        });\n        return res;\n      } catch (err) {\n        logger.error('[ProjectManager][toggleArchiveProject]', err, { context: MODULE });\n        this._handleErr('projectArchiveToggled', err, null, {\n          method: 'toggleArchiveProject',\n          endpoint: this._CONFIG.ARCHIVE.replace('{id}', id)\n        });\n        throw err;\n      }\n    }\n\n    async createConversation(projectId, opts = {}) {\n      try {\n        this.storage.setItem?.('selectedProjectId', projectId);\n        return await this.chatManager.createNewConversation(projectId);\n      } catch (origErr) {\n        logger.error('[ProjectManager][createConversation]', origErr, { context: MODULE });\n        let finalErr = origErr;\n        const msg = String(origErr?.message ?? '').toLowerCase();\n        if (msg.includes('no knowledge base')) {\n          try {\n            await this._ensureKnowledgeBase(projectId);\n            return await this.chatManager.createNewConversation(projectId, opts);\n          } catch (retryErr) {\n            logger.error('[ProjectManager][createConversation-retryErr]', retryErr, { context: MODULE });\n            finalErr = retryErr;\n          }\n        }\n        this._handleErr('conversationCreateError', finalErr, null, {\n          source: 'createConversation',\n          detail: { projectId }\n        });\n        throw finalErr;\n      }\n    }\n\n    // CONSOLIDATED: Get projectId from canonical sources only\n    _getEffectiveProjectId() {\n      // Priority order: canonical appModule state, app.getProjectId(), browserService location param\n      const candidates = [\n        // CONSOLIDATED: Use canonical appModule state first\n        (this.app?.getCurrentProject && this.app.getCurrentProject()?.id),\n        (this.app?.getProjectId && this.app.getProjectId())\n      ];\n      for (const id of candidates) {\n        if (isValidProjectId(id)) return id;\n      }\n      // Fallback: extract from URL if browserService provides it\n      const urlSearch = this.browserService?.getLocation?.().search;\n      if (urlSearch) {\n        try {\n          const params = new URLSearchParams(urlSearch);\n          const candidate = params.get('project');\n          if (isValidProjectId(candidate)) return candidate;\n        } catch {\n          // Ignore URL parsing errors for robustness (URL may be malformed or not present)\n        }\n      }\n      return null;\n    }\n\n    async getConversation(conversationId) {\n      if (!this.app?.state?.isAuthenticated) {\n        throw new Error('auth');\n      }\n      const projectId = this._getEffectiveProjectId();\n      if (!isValidProjectId(projectId)) {\n        this._handleErr('conversationLoadError', new Error('No valid project context'), null, {\n          source: 'getConversation',\n          detail: { conversationId }\n        });\n        throw new Error('No valid project context');\n      }\n      try {\n        const endpoint = `/api/projects/${projectId}/conversations/${conversationId}/`;\n        const res = await this._req(endpoint, undefined, 'getConversation');\n        const convo = res?.conversation;\n        if (!convo || !convo.id) {\n          throw new Error('Invalid conversation data received');\n        }\n        return convo;\n      } catch (err) {\n        logger.error('[ProjectManager][getConversation]', err, { context: MODULE });\n        this._handleErr('conversationLoadError', err, null, {\n          source: 'getConversation',\n          detail: { conversationId, projectId }\n        });\n        throw err;\n      }\n    }\n\n    async deleteProjectConversation(projectId, conversationId) {\n      try {\n        this.storage.setItem?.('selectedProjectId', projectId);\n        await this.chatManager.deleteConversation(conversationId);\n        return true;\n      } catch (err) {\n        logger.error('[ProjectManager][deleteProjectConversation]', err, { context: MODULE });\n        this._handleErr('deleteProjectConversationError', err, null, {\n          source: 'deleteProjectConversation',\n          detail: { conversationId, projectId }\n        });\n        throw err;\n      }\n    }\n\n    // getCurrentProject is now synchronous and does not block on app:ready.\n    getCurrentProject() {\n      if (this.app && typeof this.app.getCurrentProject === 'function') {\n        const proj = this.app.getCurrentProject();\n        // this.logger.debug(`[${MODULE}][getCurrentProject] Fetched from app.getCurrentProject()`, { projectId: proj?.id, context: MODULE });\n        return proj;\n      }\n      this.logger.warn(`[${MODULE}][getCurrentProject] app.getCurrentProject is not available.`, { context: MODULE });\n      return null;\n    }\n\n    // CONSOLIDATED: ProjectManager should delegate to canonical appModule state\n    // This method is for when ProjectManager ITSELF decides to change the project.\n    setCurrentProject(project) {\n      if (!project || !project.id) {\n        this.logger.warn(`[${MODULE}][setCurrentProject] Invalid project object provided.`, { project, context: MODULE });\n        return null;\n      }\n      this.logger.info(`[${MODULE}][setCurrentProject] Delegating to canonical appModule state.`, { projectId: project.id, context: MODULE });\n\n      // Store in localStorage for persistence\n      this.storage?.setItem?.('selectedProjectId', project.id);\n\n      // CONSOLIDATED: Delegate to canonical appModule state instead of maintaining local state\n      if (this.app && typeof this.app.setCurrentProject === 'function') {\n        this.logger.debug(`[${MODULE}][setCurrentProject] Calling app.setCurrentProject().`, { projectId: project.id, context: MODULE });\n        this.app.setCurrentProject(project); // This will trigger AppBus event and update appModule.state\n      } else {\n        this.logger.warn(`[${MODULE}][setCurrentProject] app.setCurrentProject is not available. Cannot set project globally.`, { context: MODULE });\n        // Fallback: emit local event if global state update fails\n        this._emit('currentProjectChanged', { project });\n      }\n      return project;\n    }\n\n    async prepareFileUploads(projectId, fileList) {\n      const validatedFiles = [];\n      const invalidFiles = [];\n      for (const file of fileList) {\n        if (file.size > 30000000) {\n          invalidFiles.push({ file, reason: 'Max size exceeded (30MB)' });\n        } else {\n          validatedFiles.push({ file });\n        }\n      }\n      return { validatedFiles, invalidFiles };\n    }\n\n    async uploadFileWithRetry(projectId, { file, index_kb = true } = {}, maxRetries = 3) {\n      return retryWithBackoff(\n        async () => {\n          const formData = new FormData();\n          formData.append('file', file);\n          formData.append('projectId', projectId);\n          formData.append('index_kb', index_kb ? 'true' : 'false');\n          const res = await this._req(\n            `/api/projects/${projectId}/files/`,\n            { method: 'POST', body: formData },\n            'uploadFileWithRetry'\n          );\n\n          // Emit AppBus knowledgebase:fileQueued when backend provides job_id\n          try {\n            const jobId = res?.job_id ?? res?.data?.job_id ?? null;\n            const appBus = this.DependencySystem?.modules?.get('AppBus');\n            if (appBus && jobId) {\n              const evt = new CustomEvent('knowledgebase:fileQueued', {\n                detail: { jobId, fileName: file?.name || '' }\n              });\n              appBus.dispatchEvent(evt);\n            }\n          } catch (err) {\n            this.logger?.warn?.('[ProjectManager] failed to dispatch knowledgebase:fileQueued', err, { context: MODULE });\n          }\n\n          return res;\n        },\n        maxRetries,\n        this.timer\n      );\n    }\n\n    async deleteFile(projectId, fileId) {\n      if (!this.app?.state?.isAuthenticated) {\n        throw new Error('auth');\n      }\n      const url = this._CONFIG.FILE_DETAIL.replace('{id}', projectId).replace('{file_id}', fileId);\n      return this._req(url, { method: 'DELETE' }, 'deleteFile');\n    }\n\n    async _ensureKnowledgeBase(projectId) {\n      if (!projectId) return null;\n      const listUrl = this._CONFIG.KB_LIST_URL_TEMPLATE.replace('{id}', projectId);\n      try {\n        const res = await this._req(listUrl, undefined, '_ensureKnowledgeBase:list');\n        const items = Array.isArray(res?.data) ? res.data : Array.isArray(res) ? res : [];\n        const active = items.find((kb) => kb && kb.is_active !== false);\n        if (active) return active;\n      } catch (listError) {\n        logger.error('[ProjectManager][_ensureKnowledgeBase:listError]', listError, { context: MODULE });\n        this._emit('projectKnowledgeBaseWarning', {\n          projectId,\n          message: `No active knowledge base found: ${listError?.message || 'Unknown error'}`\n        });\n      }\n      try {\n        const payload = {\n          name: 'Project Knowledge Base',\n          embedding_model: 'all-MiniLM-L6-v2',\n          is_active: true\n        };\n        const createRes = await this._req(\n          listUrl,\n          { method: 'POST', body: payload },\n          '_ensureKnowledgeBase:create'\n        );\n        const kbData = createRes?.data ?? createRes;\n        this._emit('projectKnowledgeBaseCreated', {\n          projectId,\n          knowledgeBaseId: kbData?.id,\n          message: `Created new knowledge base for project ${projectId}`\n        });\n        return kbData;\n      } catch (createError) {\n        logger.error('[ProjectManager][_ensureKnowledgeBase:createError]', createError, { context: MODULE });\n        this._emit('projectKnowledgeBaseError', {\n          projectId,\n          error: createError,\n          message: `Failed to create knowledge base for project ${projectId}: ${createError?.message || 'Unknown error'\n            }`\n        });\n        throw createError;\n      }\n    }\n\n    async downloadFile(projectId, fileId) {\n      const url = this._CONFIG.FILE_DOWNLOAD.replace('{id}', projectId).replace('{file_id}', fileId);\n      /* Request the response as a Blob so the caller can trigger a browser download */\n      return this._req(\n        url,\n        { responseType: 'blob' },\n        'downloadFile'\n      );\n    }\n\n    async downloadArtifact(projectId, artifactId) {\n      const url = this._CONFIG.ARTIFACT_DOWNLOAD.replace('{id}', projectId).replace('{artifact_id}', artifactId);\n      return this._req(url, undefined, 'downloadArtifact');\n    }\n\n    async createProject(projectData) {\n      const response = await this._req(\n        this._CONFIG.PROJECTS,\n        { method: 'POST', body: projectData },\n        'createProject'\n      );\n      const project = response.data || response;\n      if (!project || !project.id) {\n        throw new Error('Invalid project response');\n      }\n      const ensureConversation = async () => {\n        const hasConvo =\n          (Array.isArray(project.conversations) && project.conversations.length > 0) ||\n          Number(project.conversation_count) > 0;\n        if (hasConvo) return project.conversations?.[0];\n        return await this.createDefaultConversation(project.id);\n      };\n      const conversation = await ensureConversation();\n      if (conversation) {\n        project.conversations = [conversation];\n        project.conversation_count = 1;\n      }\n      this._emit('projectCreated', project);\n      this._emit('projectConversationsLoaded', { id: project.id, conversations: project.conversations });\n      return project;\n    }\n\n    async createDefaultConversation(projectId) {\n      try {\n        const response = await this._req(\n          `/api/projects/${projectId}/conversations/`,\n          {\n            method: 'POST',\n            body: {\n              title: 'Default Conversation',\n              model_id:\n                this.modelConfig?.getConfig?.()?.modelName || 'claude-3-sonnet-20240229'\n            }\n          },\n          'createDefaultConversation'\n        );\n        const conversation =\n          response?.data?.conversation || response?.data || response?.conversation || response;\n        if (!conversation || !conversation.id) {\n          throw new Error('Failed to create default conversation');\n        }\n        return conversation;\n      } catch (err) {\n        logger.error('[ProjectManager][createDefaultConversation]', err, { context: MODULE });\n        return null;\n      }\n    }\n\n    async retryWithBackoff(fn, maxRetries = 3) {\n      return retryWithBackoff(fn, maxRetries, this.timer);\n    }\n\n    async initialize() {\n      this.logger.info(`[${MODULE}] Initializing...`, { context: MODULE });\n      await this.domReadinessService.dependenciesAndElements({\n        deps: ['app', 'auth', 'AppBus', 'eventHandlers'], // Ensure AppBus and eventHandlers are available for listeners\n        timeout: 30000,\n        context: `${MODULE}_dependenciesAndElements_wait1`\n      });\n      this.logger.debug(`[${MODULE}] Core dependencies (app, auth, AppBus, eventHandlers) ready.`, { context: MODULE });\n\n      // Phase-1.3: Use injected dependencies instead of runtime lookup\n      const auth = this.authModule;\n      const appModule = this.app;\n\n      /* ---------------------------------------------------------------------\n       * Guard against legacy or partially-initialised auth modules that do\n       * not expose `.isReady()`.  Per Dec 2024 guardrails, the canonical\n       * readiness signal is `auth.AuthBus` → `authReady` OR the presence of\n       * `appModule.state.isAuthenticated`.\n       * ------------------------------------------------------------------- */\n      const authIsReadyFn = typeof auth?.isReady === 'function' ? auth.isReady.bind(auth) : null;\n      const authReady =\n        (authIsReadyFn && authIsReadyFn()) ||\n        Boolean(appModule?.state?.isAuthenticated);\n\n      if (!authReady) {\n        this.logger.info(`[${MODULE}] Auth not ready yet, waiting for authReady/authStateChanged.`, { context: MODULE });\n        await new Promise((resolve) => {\n          if (auth?.AuthBus) {\n            this.listenerTracker.add(\n              auth.AuthBus,\n              'authReady',\n              () => {\n                this.logger.info(`[${MODULE}] Received authReady event.`, { context: MODULE });\n                resolve();\n              },\n              'ProjectManager_AuthReadyListener',\n              { once: true }\n            );\n            /* Fallback: also resolve when authenticated state flips true */\n            this.listenerTracker.add(\n              auth.AuthBus,\n              'authStateChanged',\n              (e) => {\n                if (e?.detail?.authenticated) resolve();\n              },\n              'ProjectManager_AuthStateChangedListener',\n              { once: true }\n            );\n          } else {\n            /* No AuthBus available – poll appModule.state as last resort */\n            const poll = setInterval(() => {\n              // Phase-1.3: Use injected dependency instead of runtime lookup\n              if (this.app?.state?.isAuthenticated) {\n                clearInterval(poll);\n                resolve();\n              }\n            }, 200);\n          }\n        });\n      }\n      this.logger.info(`[${MODULE}] Auth module is ready. Current appModule auth state: ${appModule?.state?.isAuthenticated}`, { context: MODULE });\n\n      this._setupEventListeners();\n\n      // CONSOLIDATED: No need to track local _activeProjectId - canonical state is in appModule\n      const initialProject = this.app?.getCurrentProject?.();\n      if (initialProject?.id) {\n        this.logger.info(`[${MODULE}] Initial project found from canonical app state.`, { projectId: initialProject.id, context: MODULE });\n        // Optionally, load project details or list if required on init and project exists\n        // For now, deferring to explicit calls or UI-triggered loads.\n      } else {\n        this.logger.info(`[${MODULE}] No initial project found from canonical app state.`, { context: MODULE });\n      }\n\n      this.logger.info(`[${MODULE}] Initialization complete.`, { context: MODULE });\n      return true;\n    }\n\n    _setupEventListeners() {\n      this.logger.debug(`[${MODULE}] Setting up event listeners.`, { context: MODULE });\n      // Phase-1.3: Use injected dependencies instead of runtime lookup\n      const appBus = this.appBus;\n      const authBus = this.authModule?.AuthBus;\n\n      if (appBus) {\n        this.listenerTracker.add(appBus, 'currentProjectChanged', this._handleCurrentProjectChanged.bind(this), 'ProjectManager_AppBus_CurrentProjectChanged');\n        this.logger.debug(`[${MODULE}] Subscribed to AppBus \"currentProjectChanged\".`, { context: MODULE });\n      } else {\n        this.logger.warn(`[${MODULE}] AppBus not available. Cannot subscribe to \"currentProjectChanged\".`, { context: MODULE });\n      }\n\n      if (authBus) {\n        this.listenerTracker.add(authBus, 'authStateChanged', this._handleAuthStateChanged.bind(this), 'ProjectManager_AuthBus_AuthStateChanged');\n        this.logger.debug(`[${MODULE}] Subscribed to AuthBus \"authStateChanged\".`, { context: MODULE });\n      } else {\n        this.logger.warn(`[${MODULE}] AuthBus not available. Cannot subscribe to \"authStateChanged\".`, { context: MODULE });\n      }\n    }\n\n    _handleCurrentProjectChanged(event) {\n      const newProject = event?.detail?.project;\n      const oldProject = event?.detail?.previousProject;\n      this.logger.info(`[${MODULE}] Received \"currentProjectChanged\" event via AppBus.`, {\n        newProjectId: newProject?.id,\n        oldProjectId: oldProject?.id,\n        context: MODULE\n      });\n      // CONSOLIDATED: No need to track local _activeProjectId - canonical state is in appModule\n      if (newProject?.id) {\n        this.logger.debug(`[${MODULE}] Project changed to ${newProject.id} via canonical state.`, { context: MODULE });\n        // Clear any data specific to the old project, IF projectManager caches such details.\n        // For example, if this.projects was a list of files for ONLY the current project, clear it.\n        // Currently, loadProjects fetches all projects, so it's less of an issue for the main list.\n        // However, if specific details like current project's files, stats etc., were cached directly\n        // on `this`, they would need clearing here.\n        // Example: if (this.detailedFilesCache?.projectId !== newProject.id) this.detailedFilesCache = null;\n\n        // Optionally, trigger a reload of project-specific data if this component is responsible\n        // for displaying details of the active project.\n        // e.g., if it maintained a this.detailedProjectObject, it might call this.loadProjectDetails(newProject.id);\n        // For now, this manager primarily provides methods; UI components would drive reloads.\n\n      } else {\n        this.logger.info(`[${MODULE}] Current project cleared (null) via canonical state.`, { context: MODULE });\n        // Clear project-specific cached data\n      }\n    }\n\n    _handleAuthStateChanged(event) {\n      const isAuthenticated = event?.detail?.authenticated;\n      this.logger.info(`[${MODULE}] Received \"authStateChanged\" event. Authenticated: ${isAuthenticated}`, { detail: event?.detail, context: MODULE });\n      if (!isAuthenticated) {\n        this.logger.info(`[${MODULE}] User is now unauthenticated. Clearing cached projects list.`, { context: MODULE });\n        this.projects = []; // Clear cached list of all projects\n        // CONSOLIDATED: No need to clear local _activeProjectId - canonical state is in appModule\n        // Emit an event that project data has been cleared due to auth change, if other parts rely on this.\n        this._emit('projectDataClearedDueToAuth', { reason: 'User unauthenticated' });\n      } else {\n        // User is now authenticated. We might want to trigger a reload of projects.\n        // However, UI components or app.js init flow typically handle initial loads post-auth.\n        // Only trigger if projectManager is expected to proactively refresh its list on login.\n        this.logger.debug(`[${MODULE}] User is now authenticated. Project list can be reloaded if necessary.`, { context: MODULE });\n        // Example: this.loadProjects(); // If proactive reload is desired.\n      }\n    }\n\n    // centralized error handler – simplified per guardrail\n    _handleErr(eventType, error, fallbackValue, additionalDetails = {}) {\n      this.logger.error(`[${this.moduleName}][${eventType}]`, error, additionalDetails);\n      this._emit(eventType, { error, ...additionalDetails });\n      return fallbackValue;\n    }\n\n    destroy() {\n      this.logger.info(`[${MODULE}] Destroying and cleaning up listeners.`, { context: MODULE });\n      this.listenerTracker?.remove?.(); // Cleans up listeners tracked via eventHandlers\n      if (this._loadProjectsDebounceTimer) {\n        clearTimeout(this._loadProjectsDebounceTimer);\n      }\n    }\n  }\n\n  // ----------------------------------------------------------------------------\n  // 4) Instantiate manager and expose cleanup in the returned object\n  // ----------------------------------------------------------------------------\n  const fullDeps = {\n    DependencySystem,\n    domReadinessService,\n    logger,\n    timer,\n    eventService,\n    ...otherDeps\n  };\n  const instance = new ProjectManager(fullDeps);\n  DependencySystem.register?.('projectManager', instance);\n\n  function cleanup() {\n    // Canonical event listener cleanup per guardrails\n    // Centralized cleanup for event listeners via eventHandlers module per guardrails\n    // Phase-1.3: Use injected eventHandlers parameter instead of runtime lookup\n    // const eventHandlers = deps.eventHandlers;  // eventHandlers is now in scope from factory parameters\n    if (eventHandlers?.cleanupListeners) {\n      eventHandlers.cleanupListeners({ context: MODULE });\n    }\n    // Phase-1.3: Remove duplicate runtime lookup - already handled above\n    // Event listeners cleaned via injected eventHandlers – no container look-up needed here.\n    instance.destroy();\n  }\n\n  return {\n    instance,\n    cleanup,\n    normalizeProjectResponse,\n    extractResourceList,\n    retryWithBackoff\n  };\n}\n"],"mappings":"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","ignoreList":[]}