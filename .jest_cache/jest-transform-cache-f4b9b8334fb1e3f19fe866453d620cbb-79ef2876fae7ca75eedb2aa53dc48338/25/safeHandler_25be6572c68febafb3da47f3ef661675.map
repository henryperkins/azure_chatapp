{"version":3,"names":["createSafeHandler","logger","eventHandlers","error","Error","safeHandlerFunction","fn","description","TypeError","args","apply","err","context","safeHandler","cleanup","cleanupListeners"],"sources":["safeHandler.js"],"sourcesContent":["// Canonical SafeHandler implementation for DI\n// Exports createSafeHandler({ logger }) factory ONLY\n// Enforces: strict DI, no direct global/console/window access,\n// required \"cleanup\" method, single source of truth.\n\nexport function createSafeHandler({ logger, eventHandlers } = {}) {\n  if (!logger || typeof logger.error !== 'function') {\n    throw new Error('[SafeHandler] DI logger with .error() required');\n  }\n\n  // Wrap a handler function for safety, context, and traceability.\n  // Usage: safeHandlerFunction(fn, description), or safeHandlerFunction(fn)\n  function safeHandlerFunction(fn, description) {\n    if (typeof fn !== 'function') {\n      throw new TypeError('[SafeHandler] Provided arg is not a function');\n    }\n    // Description is for structured log context; may be omitted.\n    return function (...args) {\n      try {\n        return fn.apply(this, args);\n      } catch (err) {\n        // Always use structured logging (never direct console).\n        logger.error(\n          '[SafeHandler] Unhandled error in handler',\n          err,\n          { context: `SafeHandler:${description || 'unknown'}` }\n        );\n        // Optionally rethrow or swallow; here, swallow to suppress UI breakage.\n        // Uncomment this line to propagate errors if needed:\n        // throw err;\n      }\n    };\n  }\n\n  // Return object with cleanup method as required by factory pattern\n  return {\n    // Main safeHandler function\n    safeHandler: safeHandlerFunction,\n\n    // Required cleanup method\n    cleanup() {\n      if (eventHandlers && eventHandlers.cleanupListeners) {\n        eventHandlers.cleanupListeners({ context: 'SafeHandler' });\n      }\n    }\n  };\n}\n"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;;AAEO,SAASA,iBAAiBA,CAAC;EAAEC,MAAM;EAAEC;AAAc,CAAC,GAAG,CAAC,CAAC,EAAE;EAChE,IAAI,CAACD,MAAM,IAAI,OAAOA,MAAM,CAACE,KAAK,KAAK,UAAU,EAAE;IACjD,MAAM,IAAIC,KAAK,CAAC,gDAAgD,CAAC;EACnE;;EAEA;EACA;EACA,SAASC,mBAAmBA,CAACC,EAAE,EAAEC,WAAW,EAAE;IAC5C,IAAI,OAAOD,EAAE,KAAK,UAAU,EAAE;MAC5B,MAAM,IAAIE,SAAS,CAAC,8CAA8C,CAAC;IACrE;IACA;IACA,OAAO,UAAU,GAAGC,IAAI,EAAE;MACxB,IAAI;QACF,OAAOH,EAAE,CAACI,KAAK,CAAC,IAAI,EAAED,IAAI,CAAC;MAC7B,CAAC,CAAC,OAAOE,GAAG,EAAE;QACZ;QACAV,MAAM,CAACE,KAAK,CACV,0CAA0C,EAC1CQ,GAAG,EACH;UAAEC,OAAO,EAAE,eAAeL,WAAW,IAAI,SAAS;QAAG,CACvD,CAAC;QACD;QACA;QACA;MACF;IACF,CAAC;EACH;;EAEA;EACA,OAAO;IACL;IACAM,WAAW,EAAER,mBAAmB;IAEhC;IACAS,OAAOA,CAAA,EAAG;MACR,IAAIZ,aAAa,IAAIA,aAAa,CAACa,gBAAgB,EAAE;QACnDb,aAAa,CAACa,gBAAgB,CAAC;UAAEH,OAAO,EAAE;QAAc,CAAC,CAAC;MAC5D;IACF;EACF,CAAC;AACH","ignoreList":[]}