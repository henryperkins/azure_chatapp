{"version":3,"names":["MODULE_CONTEXT","createFileUploadComponent","app","eventHandlers","projectManager","domAPI","logger","domReadinessService","scheduler","projectId","onUploadComplete","elements","DependencySystem","explicitDS","eventService","Error","fileConstants","allowedExtensions","maxSizeMB","_elements","fileInput","uploadBtn","dragZone","uploadProgress","progressBar","uploadStatus","selectors","indexKbCheckbox","_projectId","_onUploadComplete","uploadState","total","completed","failed","_handlersBound","_updateAuthState","authenticated","elsToDisable","filter","Boolean","forEach","el","disabled","addClass","removeClass","DS","_eventService","modules","get","_setupAuthListeners","ds","auth","AuthBus","trackListener","e","detail","context","description","currentAuth","state","isAuthenticated","warn","appBus","destroy","doc","getDocument","win","getWindow","_scheduler","setTimeout","args","clearTimeout","setProjectId","pid","init","REQUIRED_SELECTOR_KEYS","stringSelectors","map","key","selector","length","dependenciesAndElements","domSelectors","_findElements","error","_bindEvents","dispatchEvent","createCustomEvent","success","els","sources","elementKeys","value","nodeType","querySelector","setAttribute","EH","track","type","handler","module","_handleFileSelection","click","eventName","preventDefault","stopPropagation","isEnter","classList","add","remove","removeAttribute","_handleFileDrop","cleanupListeners","cleanup","initialize","files","target","_uploadFiles","dataTransfer","getProjectId","validateUUID","validFiles","invalidFiles","_validateFiles","firstErr","setCustomValidity","message","reportValidity","file","status","data","fileName","name","String","_setupUploadProgress","BATCH_SIZE","i","batch","slice","Promise","all","_uploadFile","emit","count","err","indexKbChecked","checked","uploadFileWithRetry","uploadRes","index_kb","jobId","job_id","pollingService","startJob","pollErr","_updateUploadProgress","sanitizedName","split","c","code","charCodeAt","includes","test","join","tempFile","File","push","ext","pop","toLowerCase","isValidExt","isValidSize","size","toFixed","statusEl","setProperty","setTextContent","successCount","failedCount","percent","Math","round","newClassName"],"sources":["FileUploadComponent.js"],"sourcesContent":["/**\n * @module FileUploadComponent\n * @description Handles file upload UI and logic for projects using strict Dependency Injection.\n * Manages drag-and-drop, file selection, validation, and upload progress display.\n *\n * @param {Object} deps - Dependency Injection options.\n * @param {Object} deps.app - Required. App core utilities (validateUUID).\n * @param {Object} deps.eventHandlers - Required. Event listener management (trackListener).\n * @param {Object} deps.projectManager - Required. Handles the actual file upload API calls.\n * @param {Object} deps.domAPI - Required. DOM manipulation abstraction.\n * @param {Object} deps.logger - Required. Logging utility.\n * @param {Object} [deps.domReadinessService] - Optional. DOM readiness service.\n * @param {Object} [deps.scheduler] - Optional. Timing utilities (setTimeout, clearTimeout).\n * @param {string} [deps.projectId] - Optional initial project ID.\n * @param {Function} [deps.onUploadComplete] - Optional callback after uploads finish.\n * @param {Object} [deps.elements] - Optional pre-resolved DOM element references.\n * @returns {Object} FileUploadComponent API.\n */\n\nconst MODULE_CONTEXT = \"FileUploadComponentContext\";\n\nexport function createFileUploadComponent({\n  app,\n  eventHandlers,\n  projectManager,\n  domAPI,\n  logger,\n  domReadinessService,\n  scheduler,\n  projectId,\n  onUploadComplete,\n  elements,\n  DependencySystem: explicitDS,\n  eventService\n} = {}) {\n  // Explicit DI requirement – no implicit auto-resolve allowed (Week-1 rule)\n  if (!logger) {\n    throw new Error('[FileUploadComponent] Missing required dependency: logger');\n  }\n  // === Dependency validation block ===\n  if (!app) throw new Error(\"[FileUploadComponent] Missing app\");\n  if (!eventHandlers) throw new Error(\"[FileUploadComponent] Missing eventHandlers\");\n  if (!projectManager) throw new Error(\"[FileUploadComponent] Missing projectManager\");\n  if (!domAPI) throw new Error(\"[FileUploadComponent] Missing domAPI\");\n  if (!logger) throw new Error(\"[FileUploadComponent] Missing logger\");\n  if (!eventService) throw new Error('[FileUploadComponent] Missing eventService');\n  // domReadinessService and scheduler are optional\n\n  // --- Configuration ---\n  const fileConstants = {\n    allowedExtensions: ['.txt', '.md', '.csv', '.json', '.pdf', '.doc', '.docx', '.py', '.js', '.html', '.css', '.ini'],\n    maxSizeMB: 30\n  };\n\n  // --- Elements (Lookup via domAPI on init) ---\n  const _elements = {\n    fileInput: null, uploadBtn: null, dragZone: null,\n    uploadProgress: null, progressBar: null, uploadStatus: null,\n    selectors: {\n      fileInput: elements?.fileInput || '#fileInput',\n      uploadBtn: elements?.uploadBtn || '#uploadFileBtn',\n      dragZone: elements?.dragZone || '#dragDropZone',\n      uploadProgress: elements?.uploadProgress || '#filesUploadProgress',\n      progressBar: elements?.progressBar || '#fileProgressBar',\n      uploadStatus: elements?.uploadStatus || '#uploadStatus',\n      // optional aria enhancements added below\n      indexKbCheckbox: elements?.indexKbCheckbox || '#indexKbCheckbox'\n    }\n  };\n\n  let _projectId = projectId || null;\n  let _onUploadComplete = typeof onUploadComplete === 'function' ? onUploadComplete : () => {};\n  let uploadState = { total: 0, completed: 0, failed: 0 };\n  let _handlersBound = false;\n\n  // ───────────────────────────────────────────────────────────\n  // Auth state handling & view lifecycle\n  // ───────────────────────────────────────────────────────────\n\n  function _updateAuthState (authenticated) {\n    const elsToDisable = [\n      _elements.fileInput,\n      _elements.uploadBtn,\n      _elements.dragZone\n    ].filter(Boolean);\n    elsToDisable.forEach(el => {\n      el.disabled = !authenticated;\n      if (!authenticated) {\n        domAPI.addClass?.(el, 'opacity-50');\n        domAPI.addClass?.(el, 'cursor-not-allowed');\n      } else {\n        domAPI.removeClass?.(el, 'opacity-50');\n        domAPI.removeClass?.(el, 'cursor-not-allowed');\n      }\n    });\n  }\n\n  const DS = explicitDS || eventHandlers?.DependencySystem || null;\n  const _eventService = eventService || DS?.modules?.get?.('eventService') || null;\n\n  function _setupAuthListeners () {\n    const ds = DS;\n    const auth = ds?.modules?.get('auth');\n    if (auth?.AuthBus && typeof eventHandlers.trackListener === 'function') {\n      eventHandlers.trackListener(\n        auth.AuthBus,\n        'authStateChanged',\n        (e) => _updateAuthState(e?.detail?.authenticated),\n        { context: MODULE_CONTEXT, description: 'FileUpload_AuthStateChanged' }\n      );\n      // Initialise state based on current auth flag if available\n      const currentAuth = ds?.modules?.get('appModule')?.state?.isAuthenticated;\n      if (typeof currentAuth === 'boolean') {\n        _updateAuthState(currentAuth);\n      }\n    } else {\n      logger.warn('[FileUploadComponent] AuthBus not available – cannot disable upload inputs on logout.', { context: MODULE_CONTEXT });\n    }\n\n    // View lifecycle hooks – destroy on deactivateView / project change\n    const appBus = ds?.modules?.get('AppBus');\n    if (appBus) {\n      eventHandlers.trackListener(\n        appBus,\n        'currentProjectChanged',\n        () => destroy(),\n        { context: MODULE_CONTEXT, description: 'FileUpload_AppBus_ProjectChanged' }\n      );\n    }\n\n    // Listen for navigation:deactivateView dispatched on document\n    const doc = domAPI.getDocument();\n    if (doc) {\n      eventHandlers.trackListener(\n        doc,\n        'navigation:deactivateView',\n        () => destroy(),\n        { context: MODULE_CONTEXT, description: 'FileUpload_Navigation_Deactivate' }\n      );\n    }\n  }\n\n/* Deterministic timers (DI-friendly) — bind to global window to avoid “Illegal invocation” */\nconst win = domAPI?.getWindow?.();\nif (!win) throw new Error(\"[FileUploadComponent] browserService.getWindow() required\");\nconst _scheduler = scheduler || {\n  setTimeout: (...args) => win?.setTimeout?.(...args),\n  clearTimeout: (...args) => win?.clearTimeout?.(...args)\n};\n\n  // --- API Methods ---\n\n  function setProjectId(pid) {\n    _projectId = pid;\n  }\n\n  async function init() {\n    if (_handlersBound) return;\n    try {\n      if (domReadinessService) {\n        // Only pass string selectors, not DOM element objects\n        // Only wait for selectors that are strictly required for a successful\n        // bootstrap. Optional elements (e.g. the \"Index KB\" checkbox) must *not*\n        // block initialization – their absence should be tolerated.\n\n        const REQUIRED_SELECTOR_KEYS = [\n          'fileInput',\n          'uploadBtn',\n          'dragZone',\n          'uploadProgress',\n          'progressBar',\n          'uploadStatus'\n        ];\n\n        const stringSelectors = REQUIRED_SELECTOR_KEYS\n          .map((key) => _elements.selectors[key])\n          .filter((selector) => typeof selector === 'string');\n        if (stringSelectors.length > 0) {\n          await domReadinessService.dependenciesAndElements({\n            domSelectors: stringSelectors,\n            context: MODULE_CONTEXT + '::init'\n          });\n        }\n      }\n      if (!_findElements()) {\n        logger.error('[FileUploadComponent] Required DOM elements not found', {\n          context: MODULE_CONTEXT, projectId: _projectId || 'unknown'\n        });\n        throw new Error('[FileUploadComponent] Initialization failed: required DOM elements not found');\n      }\n      _bindEvents();\n      _handlersBound = true;\n\n      // After DOM + event bindings, wire auth / lifecycle listeners\n      _setupAuthListeners();\n\n      // Standardized \"fileuploadcomponent:initialized\" event\n      const doc = domAPI?.getDocument?.();\n      if (!doc) throw new Error('[FileUploadComponent] DOM unavailable via domAPI');\n      if (domAPI?.dispatchEvent) {\n        domAPI.dispatchEvent(\n          doc,\n          eventHandlers.createCustomEvent('fileuploadcomponent:initialized',{ detail:{ success:true } })\n        );\n      }\n    } catch (error) {\n      logger.error('[FileUploadComponent][init] Initialization failed',\n        error,\n        { context: \"FileUploadComponentContext:init\" });\n      throw error;\n    }\n  }\n\n  function _findElements() {\n    const els = _elements;\n    const sources = els.selectors;\n    const elementKeys = [\n      'fileInput',\n      'uploadBtn',\n      'dragZone',\n      'uploadProgress',\n      'progressBar',\n      'uploadStatus',\n      'indexKbCheckbox'\n    ];\n\n    for (const key of elementKeys) {\n      const value = sources[key];\n\n      if (\n        typeof value === \"object\" &&\n        value !== null &&\n        typeof value.nodeType === \"number\"\n      ) {\n        els[key] = value;\n      } else if (typeof value === \"string\") {\n        els[key] = domAPI.querySelector(value);\n      } else {\n        els[key] = null;\n      }\n    }\n\n    if (\n      !(\n        els.fileInput &&\n        els.uploadBtn &&\n        els.dragZone &&\n        els.uploadProgress &&\n        els.progressBar &&\n        els.uploadStatus\n      )\n    ) {\n      return false;\n    }\n\n    // Accessibility enhancements for dragZone\n    if (els.dragZone) {\n      domAPI.setAttribute?.(els.dragZone, 'role', 'button');\n      domAPI.setAttribute?.(els.dragZone, 'tabindex', '0');\n      domAPI.setAttribute?.(els.dragZone, 'aria-label', 'Upload files by clicking or dropping');\n    }\n\n    return true;\n  }\n\n  function _bindEvents() {\n    const { fileInput, uploadBtn, dragZone } = _elements;\n    const EH = eventHandlers;\n\n    const track = (el, type, handler, description) => {\n      if (!el) return;\n      EH.trackListener(el, type, handler, {\n        description: `FileUpload: ${description}`,\n        module: 'FileUploadComponent',\n        context: MODULE_CONTEXT\n      });\n    };\n\n    // File input\n    track(fileInput, 'change', (e) => _handleFileSelection(e), 'File Input Change');\n\n    // Upload button\n    track(uploadBtn, 'click', () => fileInput?.click(), 'Upload Button Click');\n\n    // Drag-n-drop\n    if (dragZone) {\n      [\"dragenter\", \"dragover\", \"dragleave\", \"drop\"].forEach(eventName => {\n        track(dragZone, eventName, (e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          const isEnter = (eventName === 'dragenter' || eventName === 'dragover');\n          if (isEnter) {\n            dragZone.classList.add('border-primary');\n            domAPI.setAttribute?.(dragZone, 'aria-busy', 'true');\n          } else {\n            dragZone.classList.remove('border-primary');\n            domAPI.removeAttribute?.(dragZone, 'aria-busy');\n            if (eventName === 'drop') {\n              _handleFileDrop(e);\n            }\n          }\n        }, `DragZone ${eventName}`);\n      });\n      track(dragZone, 'click', () => fileInput?.click(), 'DragZone Click');\n    }\n  }\n\n  function destroy() {\n    if (eventHandlers && typeof eventHandlers.cleanupListeners === 'function') {\n      eventHandlers.cleanupListeners({ context: MODULE_CONTEXT });\n    }\n    _handlersBound = false;\n  }\n\n  function cleanup() {\n    destroy();\n  }\n\n  function initialize(...args) {\n    return init(...args);\n  }\n\n  function _handleFileSelection(e) {\n    const files = e.target?.files;\n    if (!files || files.length === 0) return;\n    _uploadFiles(files);\n    if (e.target) e.target.value = null;\n  }\n\n  function _handleFileDrop(e) {\n    const files = e.dataTransfer?.files;\n    if (!files || files.length === 0) return;\n    _uploadFiles(files);\n  }\n\n  async function _uploadFiles(files) {\n    const pid = _projectId || app.getProjectId?.();\n    if (!pid || !app.validateUUID?.(pid)) {\n      logger.error('[FileUploadComponent][_uploadFiles] Invalid or missing projectId', { context: MODULE_CONTEXT });\n      return;\n    }\n\n    const { validFiles, invalidFiles } = _validateFiles(files);\n\n    if (invalidFiles.length > 0) {\n      const firstErr = invalidFiles[0];\n      if (_elements.fileInput && typeof _elements.fileInput.setCustomValidity === 'function') {\n        _elements.fileInput.setCustomValidity(firstErr.message || 'Invalid file');\n        _elements.fileInput.reportValidity?.();\n        // clear message after a short delay so subsequent opens are clean\n        _scheduler.setTimeout(() => {\n          _elements.fileInput.setCustomValidity('');\n        }, 4000);\n      }\n      invalidFiles.forEach(({ file, error }) => {\n        logger.error('[FileUploadComponent][_uploadFiles] Invalid file',\n          {\n            status: 400,\n            data: { fileName: file?.name },\n            message: String(error)\n          },\n          { context: MODULE_CONTEXT }\n        );\n      });\n    }\n\n    if (validFiles.length === 0) {\n      return;\n    }\n\n    _setupUploadProgress(validFiles.length);\n\n    // Batching logic remains the same\n    const BATCH_SIZE = 3;\n    for (let i = 0; i < validFiles.length; i += BATCH_SIZE) {\n      const batch = validFiles.slice(i, i + BATCH_SIZE);\n      await Promise.all(batch.map(file => _uploadFile(pid, file)));\n    }\n\n    if (typeof _onUploadComplete === 'function') {\n      _onUploadComplete();\n    }\n\n    // Emit analytics event via unified eventService\n    try {\n      _eventService?.emit?.('knowledgebase:filesUploaded', { count: validFiles.length });\n    } catch (err) {\n      logger.warn('[FileUploadComponent] Failed to emit knowledgebase:filesUploaded', err, { context: MODULE_CONTEXT });\n    }\n  }\n\n  async function _uploadFile(pid, file) {\n    const indexKbChecked = _elements.indexKbCheckbox\n      ? Boolean(_elements.indexKbCheckbox.checked)\n      : true;\n    try {\n      if (typeof projectManager.uploadFileWithRetry !== \"function\") {\n        throw new Error('projectManager.uploadFileWithRetry function not available');\n      }\n      const uploadRes = await projectManager.uploadFileWithRetry(pid, { file, index_kb: indexKbChecked });\n\n      // If backend returns a background job_id, start polling via PollingService\n      try {\n        const jobId = uploadRes?.job_id ?? uploadRes?.data?.job_id ?? null;\n        const pollingService = (DS || eventHandlers?.DependencySystem)?.modules?.get('pollingService');\n        if (jobId && pollingService?.startJob) {\n          pollingService.startJob(jobId);\n        }\n      } catch (pollErr) {\n        logger.warn('[FileUploadComponent] Failed to start polling', pollErr, { context: MODULE_CONTEXT });\n      }\n\n      _updateUploadProgress(1, 0);\n    } catch (err) {\n      logger.error(\"[FileUploadComponent] uploadFile\",\n        err,\n        { context: \"FileUploadComponentContext:uploadFile\" });\n      _updateUploadProgress(0, 1);\n    }\n  }\n\n  function _validateFiles(files) {\n    const { allowedExtensions, maxSizeMB } = fileConstants;\n    const validFiles = [];\n    const invalidFiles = [];\n    for (let file of files) {\n      // Replace forbidden characters and control chars with '_'\n      const sanitizedName = file.name\n        .split('')\n        .map(c => {\n          const code = c.charCodeAt(0);\n          // Forbidden: < > : \" / \\ | ? * # % whitespace, DEL, or ASCII control chars\n          if (\n            '<>:\"/\\\\|?*#%'.includes(c) ||\n            /\\s/.test(c) ||\n            code < 32 || code === 127\n          ) {\n            return '_';\n          }\n          return c;\n        })\n        .join('');\n      if (sanitizedName !== file.name) {\n        try {\n          const tempFile = new File([file], sanitizedName, { type: file.type });\n          file = tempFile;\n        } catch (err) {\n          logger.error(\"[FileUploadComponent] validateFiles\",\n            err,\n            { context: \"FileUploadComponentContext:validateFiles\" });\n          invalidFiles.push({\n            status: 400,\n            data: { file },\n            message: 'Filename contains invalid characters'\n          });\n          continue;\n        }\n      }\n\n      if (file.name.length === 0 || file.name === '.' || file.name === '..') {\n        invalidFiles.push({\n          status: 400,\n          data: { file },\n          message: 'Invalid filename'\n        });\n        continue;\n      }\n\n      const ext = file.name.includes('.') ? '.' + file.name.split('.').pop().toLowerCase() : '';\n      const isValidExt = allowedExtensions.includes(ext);\n      const isValidSize = file.size <= maxSizeMB * 1024 * 1024;\n\n      if (!isValidExt) {\n        invalidFiles.push({\n          status: 400,\n          data: { file },\n          message: `Invalid file type (${ext || 'none'}). Allowed: ${allowedExtensions.join(', ')}`\n        });\n      } else if (!isValidSize) {\n        invalidFiles.push({\n          status: 400,\n          data: { file },\n          message: `File too large (${(file.size / (1024 * 1024)).toFixed(1)}MB > ${maxSizeMB}MB)`\n        });\n      } else {\n        validFiles.push(file);\n      }\n    }\n    return { validFiles, invalidFiles };\n  }\n\n  function _setupUploadProgress(total) {\n    uploadState = { total, completed: 0, failed: 0 };\n    const { uploadProgress, progressBar, uploadStatus: statusEl } = _elements;\n    if (uploadProgress) domAPI.removeClass(uploadProgress, 'hidden');\n    if (progressBar) {\n      domAPI.setProperty(progressBar, 'value', 0);\n      domAPI.setProperty(progressBar, 'max', 100);\n      domAPI.setProperty(progressBar, 'className', 'progress progress-info');\n    }\n    if (statusEl) domAPI.setTextContent(statusEl, `Uploading 0/${total} files...`);\n  }\n\n  function _updateUploadProgress(successCount, failedCount) {\n    uploadState.completed += successCount;\n    uploadState.failed += failedCount;\n    const { total, completed, failed } = uploadState;\n    const { progressBar, uploadStatus: statusEl, uploadProgress } = _elements;\n\n    const percent = total > 0 ? Math.round((completed / total) * 100) : 0;\n\n    if (progressBar) {\n      domAPI.setProperty(progressBar, 'value', String(percent));\n\n      let newClassName = 'progress';\n      if (failed > 0) {\n        newClassName += (completed === total ? ' progress-error' : ' progress-warning');\n      } else if (completed === total) {\n        newClassName += ' progress-success';\n      } else {\n        newClassName += ' progress-info';\n      }\n      domAPI.setProperty(progressBar, 'className', newClassName);\n    }\n\n    if (statusEl) {\n      domAPI.setTextContent(statusEl, `Uploaded ${completed}/${total} files${failed > 0 ? ` (${failed} failed)` : ''}.`);\n    }\n\n    if (completed === total && uploadProgress) {\n      _scheduler.setTimeout(() => {\n        if (uploadProgress) domAPI.addClass(uploadProgress, 'hidden');\n      }, 2500);\n    }\n  }\n\n  // Expose API\n  return {\n    setProjectId,\n    init,\n    initialize,\n    destroy,\n    cleanup,\n    _handleFileSelection,\n    _handleFileDrop\n  };\n}\n"],"mappings":"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","ignoreList":[]}