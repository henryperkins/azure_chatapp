{"version":3,"names":["_FileUploadComponent","require","createDependencySystem","modules","Map","register","n","v","set","stubDomAPI","querySelector","disabled","classList","add","remove","addClass","removeClass","setProperty","getWindow","getDocument","addEventListener","removeEventListener","dispatchEvent","stubEventHandlers","DependencySystem","trackListener","target","event","handler","options","cleanupListeners","createCustomEvent","d","type","detail","describe","test","DS","authBus","EventTarget","global","CustomEvent","constructor","name","opts","AuthBus","logger","debug","info","warn","error","fileInputEl","uploadBtnEl","dragZoneEl","uploadProgressEl","progressBarEl","uploadStatusEl","callIndex","elementsArr","eventServiceStub","emit","on","off","component","createFileUploadComponent","app","validateUUID","eventHandlers","projectManager","domAPI","eventService","domReadinessService","dependenciesAndElements","Promise","resolve","scheduler","setTimeout","clearTimeout","init","authenticated","expect","toBe"],"sources":["auth-compliance.test.js"],"sourcesContent":["import { createFileUploadComponent } from '../../static/js/FileUploadComponent.js';\n\nfunction createDependencySystem () {\n  const modules = new Map();\n  return {\n    modules,\n    register (n, v) { modules.set(n, v); }\n  };\n}\n\nconst stubDomAPI = {\n  querySelector: () => ({ disabled: false, classList: { add () {}, remove () {} } }),\n  addClass () {},\n  removeClass () {},\n  setProperty () {},\n  getWindow: () => ({}),\n  getDocument: () => ({ addEventListener () {}, removeEventListener () {} }),\n  dispatchEvent () {}\n};\n\nconst stubEventHandlers = {\n  DependencySystem: null, // will be wired after creation\n  trackListener (target, event, handler, options) {\n    // Actually register the event listener for testing\n    if (target && typeof target.addEventListener === 'function') {\n      target.addEventListener(event, handler, options);\n    }\n  },\n  cleanupListeners () {},\n  createCustomEvent: (n,d) => ({ type: n, detail: d })\n};\n\ndescribe('FileUploadComponent â€“ AuthBus compliance', () => {\n  test('disables and re-enables inputs on auth state change', async () => {\n    const DS = createDependencySystem();\n    stubEventHandlers.DependencySystem = DS;\n\n    const authBus = new EventTarget();\n\n    if (typeof global.CustomEvent !== 'function') {\n      global.CustomEvent = class CustomEvent {\n        constructor (name, opts) { this.type = name; this.detail = opts?.detail; }\n      };\n    }\n    DS.register('auth', { AuthBus: authBus });\n    DS.register('AppBus', new EventTarget());\n\n    const logger = { debug () {}, info () {}, warn () {}, error () {} };\n\n    const fileInputEl = { disabled: false, classList: { add () {}, remove () {} } };\n    const uploadBtnEl = { disabled: false, classList: { add () {}, remove () {} } };\n    const dragZoneEl = { disabled: false, classList: { add () {}, remove () {} } };\n    const uploadProgressEl = { disabled: false, classList: { add () {}, remove () {} } };\n    const progressBarEl = { disabled: false, classList: { add () {}, remove () {} } };\n    const uploadStatusEl = { disabled: false, classList: { add () {}, remove () {} } };\n\n    // Override domAPI.querySelector to return stub elements in sequence matching _findElements order\n    let callIndex = 0;\n    const elementsArr = [\n      fileInputEl,      // fileInput\n      uploadBtnEl,      // uploadBtn\n      dragZoneEl,       // dragZone\n      uploadProgressEl, // uploadProgress\n      progressBarEl,    // progressBar\n      uploadStatusEl,   // uploadStatus\n      {}                // indexKbCheckbox (optional)\n    ];\n    stubDomAPI.querySelector = () => elementsArr[callIndex++] || {};\n\n    const eventServiceStub = {\n      emit: () => {},\n      on: () => {},\n      off: () => {}\n    };\n\n    const component = createFileUploadComponent({\n      app: { validateUUID: () => true },\n      eventHandlers: stubEventHandlers,\n      projectManager: {},\n      domAPI: stubDomAPI,\n      logger,\n      eventService: eventServiceStub,\n      domReadinessService: { dependenciesAndElements: () => Promise.resolve() },\n      scheduler: { setTimeout: () => {}, clearTimeout: () => {} }\n    });\n\n    await component.init();\n\n    // Trigger logout\n    authBus.dispatchEvent(new CustomEvent('authStateChanged', { detail: { authenticated: false } }));\n    await new Promise(resolve => setTimeout(resolve, 0)); // Allow async operations\n    expect(fileInputEl.disabled).toBe(true);\n\n    // Trigger login\n    authBus.dispatchEvent(new CustomEvent('authStateChanged', { detail: { authenticated: true } }));\n    await new Promise(resolve => setTimeout(resolve, 0)); // Allow async operations\n    expect(fileInputEl.disabled).toBe(false);\n  });\n});\n"],"mappings":"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","ignoreList":[]}