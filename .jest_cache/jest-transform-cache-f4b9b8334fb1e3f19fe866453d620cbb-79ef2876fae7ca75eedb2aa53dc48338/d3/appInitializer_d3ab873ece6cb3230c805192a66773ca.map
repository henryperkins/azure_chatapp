{"version":3,"names":["_appState","require","_errorInit","_serviceInit","_authInit","_coreInit","_uiInit","_bootstrapCore","createAppInitializer","opts","required","key","Error","DependencySystem","browserService","APP_CONFIG","bootstrap","createBootstrapCore","coreServices","initializeCoreServices","Object","assign","noopFactory","cleanup","createProjectDetailsEnhancements","createTokenStatsManager","createKnowledgeBaseComponent","appModule","createAppState","logger","eventService","globalUtils","register","serviceInit","createServiceInit","errorInit","createErrorInit","coreInit","createCoreInit","authInit","createAuthInit","uiInit","createUIInit","initializeApp","eventHandlers","info","setAppLifecycleState","initializing","currentPhase","phaseRunner","name","fn","start","performance","now","result","duration","toFixed","err","error","context","initialized","isReady","dispatch","registerBasicServices","registerAdvancedServices","initializeErrorHandling","initializeCoreSystems","initializeAuthSystem","initializeUIComponents","state","domReadinessService","emitReplayable","loadingEl","domAPI","querySelector","setStyle","setTimeout","warn","cleanupListeners"],"sources":["appInitializer.js"],"sourcesContent":["// ========================================\n// FILE: /initialization/appInitializer.js (REFACTORED)\n// ========================================\n/**\n * Main Application Initializer - Refactored Version\n * Target: <200 lines of pure orchestration\n */\n\n// Import external dependencies (already extracted)\n// External helper factories are provided indirectly via BootstrapCore.  They\n// are *not* imported here to keep the orchestrator lean and to avoid circular\n// dependency pitfalls.  All heavy lifting (logger, domAPI, eventHandlers,\n// etc.) happens inside bootstrapCore.initializeCoreServices().\n\n// Import extracted initialization modules\nimport { createAppState } from \"../initialization/state/appState.js\";\nimport { createErrorInit } from \"../initialization/phases/errorInit.js\";\nimport { createServiceInit } from \"../initialization/phases/serviceInit.js\";\nimport { createAuthInit } from \"../initialization/phases/authInit.js\";\nimport { createCoreInit } from \"../initialization/phases/coreInit.js\";\nimport { createUIInit } from \"../initialization/phases/uiInit.js\";\nimport { createBootstrapCore } from \"../initialization/bootstrap/bootstrapCore.js\";\n\nexport function createAppInitializer(opts = {}) {\n    // Validate required dependencies\n    const required = [\n        'DependencySystem', 'browserService', 'APP_CONFIG',\n        'createApiEndpoints', 'MODAL_MAPPINGS', 'createChatManager'\n        // ... list all required factory functions\n    ];\n\n    for (const key of required) {\n        if (!opts[key]) {\n            throw new Error(`[appInitializer] Missing required dependency: ${key}`);\n        }\n    }\n\n    // Extract commonly used options\n    const { DependencySystem, browserService, APP_CONFIG } = opts;\n\n    // Phase 1: Bootstrap core infrastructure\n    const bootstrap = createBootstrapCore(opts);\n    const coreServices = bootstrap.initializeCoreServices();\n\n    // Merge core services back into opts for downstream usage\n    Object.assign(opts, coreServices);\n\n    // ------------------------------------------------------------------\n    // Ensure optional UI factory dependencies exist (tests may omit them)\n    // ------------------------------------------------------------------\n    const noopFactory = () => ({ cleanup() {} });\n    if (!opts.createProjectDetailsEnhancements) {\n        opts.createProjectDetailsEnhancements = noopFactory;\n    }\n    if (!opts.createTokenStatsManager) {\n        opts.createTokenStatsManager = noopFactory;\n    }\n    if (!opts.createKnowledgeBaseComponent) {\n        opts.createKnowledgeBaseComponent = noopFactory;\n    }\n\n    // Phase 2: Create application state\n    const appModule = createAppState({\n        DependencySystem,\n        logger: coreServices.logger,\n        eventService: coreServices.eventService,\n        globalUtils: coreServices.globalUtils\n    });\n    DependencySystem.register('appModule', appModule);\n    DependencySystem.register('app', appModule); // Legacy alias\n\n    // Phase 3: Create initialization modules\n    const serviceInit = createServiceInit(opts);\n    const errorInit = createErrorInit(opts);\n    const coreInit = createCoreInit(opts);\n    const authInit = createAuthInit(opts);\n    const uiInit = createUIInit(opts);\n\n    // Main initialization orchestrator\n    async function initializeApp() {\n        const { logger, eventHandlers } = coreServices;\n\n        logger.info('[appInitializer] Boot sequence start');\n        appModule.setAppLifecycleState({\n            initializing: true,\n            currentPhase: 'starting_init_process'\n        });\n\n        // Unified phase runner for structured logging & error handling\n        const phaseRunner = async (name, fn) => {\n            const start = performance.now();\n            logger.info(`[appInitializer] ▶ Phase start: ${name}`);\n            try {\n                const result = await fn();\n                const duration = performance.now() - start;\n                logger.info(`[appInitializer] ✔ Phase complete: ${name} (${duration.toFixed(0)} ms)`);\n                return result;\n            } catch (err) {\n                const duration = performance.now() - start;\n                logger.error(`[appInitializer] ✖ Phase failed: ${name} after ${duration.toFixed(0)} ms`, err, {\n                    context: `appInitializer:${name}`\n                });\n\n                appModule.setAppLifecycleState({\n                    initializing: false,\n                    initialized: false,\n                    currentPhase: 'failed_idle',\n                    isReady: false\n                });\n                eventHandlers.dispatch('app:failed');\n                throw err;\n            }\n        };\n\n        // Execute phases sequentially\n        await phaseRunner('services:basic', () => serviceInit.registerBasicServices());\n        await phaseRunner('services:advanced', () => serviceInit.registerAdvancedServices());\n        await phaseRunner('errors', () => errorInit.initializeErrorHandling());\n        await phaseRunner('core', () => coreInit.initializeCoreSystems());\n        await phaseRunner('auth', () => authInit.initializeAuthSystem());\n        await phaseRunner('ui', () => uiInit.initializeUIComponents());\n\n        // Mark initialization complete\n        appModule.setAppLifecycleState({\n            initializing: false,\n            initialized: true,\n            currentPhase: 'initialized_idle',\n            isReady: true\n        });\n\n        // Emit app ready event\n        if (!appModule.state.isReady) {\n            coreServices.domReadinessService.emitReplayable('app:ready');\n        }\n\n        logger.info('[appInitializer] Boot sequence complete – app is READY');\n\n        // Hide loading overlay\n        try {\n            const loadingEl = coreServices.domAPI.querySelector('#appLoading');\n            if (loadingEl) {\n                coreServices.domAPI.setStyle(loadingEl, 'opacity', '0');\n                browserService.setTimeout(() => {\n                    coreServices.domAPI.setStyle(loadingEl, 'display', 'none');\n                }, 300);\n            }\n        } catch (err) {\n            logger.warn('[appInitializer] Failed to hide loading overlay', err);\n        }\n    }\n\n    // Cleanup orchestrator\n    async function cleanup() {\n        const { logger } = coreServices;\n\n        logger.info('[appInitializer] Shutdown start');\n        await uiInit.cleanup();\n        await authInit.cleanup();\n        await coreInit.cleanup();\n        await serviceInit.cleanup();\n        await errorInit.cleanup();\n        appModule.cleanup();\n        coreServices.eventHandlers.cleanupListeners({ context: 'appInitializer' });\n        logger.info('[appInitializer] Shutdown complete');\n    }\n\n    // Public API\n    return {\n        initializeApp,\n        cleanup,\n        // Expose sub-APIs for backward compatibility\n        appModule,\n        serviceInit,\n        errorInit,\n        coreInit,\n        authInit,\n        uiInit\n    };\n}\n"],"mappings":"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","ignoreList":[]}