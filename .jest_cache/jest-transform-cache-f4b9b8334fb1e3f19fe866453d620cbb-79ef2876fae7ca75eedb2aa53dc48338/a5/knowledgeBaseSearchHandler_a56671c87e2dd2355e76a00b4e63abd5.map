{"version":3,"names":["MODULE","createKnowledgeBaseSearchHandler","ctx","domReadinessService","Error","initialize","dependenciesAndElements","deps","context","searchKnowledgeBase","query","state","isSearching","trimmed","trim","length","config","minQueryLength","maxQueryLength","_showNoResults","pid","_getCurrentProjectId","kbId","knowledgeBase","id","cacheKey","_getSelectedTopKValue","searchCache","has","_renderSearchResults","get","_showSearchLoading","endpoint","resp","apiRequest","method","body","top_k","results","Array","isArray","data","MAX_CACHE_ENTRIES","size","firstKey","keys","next","value","delete","set","err","logger","error","_hideSearchLoading","debouncedSearch","_debounce","searchDebounceTime","triggerSearch","elements","searchInput","_clearSearchResults","_appendSearchResults","_toggleResultSections","resultsContainer","resultsSection","noResultsSection","textContent","classList","add","forEach","res","item","_createResultItem","eventHandlers","trackListener","_showResultDetail","e","includes","key","preventDefault","appendChild","show","toggle","result","domAPI","createElement","className","setAttribute","fileInfo","file_info","filename","metadata","file_name","scorePct","Math","round","score","badgeClass","_getBadgeClass","_safeSetInnerHTML","uiUtils","fileIcon","file_type","text","modal","resultModal","showModal","_populateResultDetail","resultTitle","resultSource","resultScore","resultContent","useInChatBtn","style","whiteSpace","onclick","_useInConversation","_hideResultDetailModal","close","chatInput","getElementById","querySelector","undefined","refText","current","focus","inputEvt","Event","bubbles","doc","getDocument","dispatchEvent","remove","loadingEl","val","parseInt","topKSelect","isNaN","handleResultModalKeydown","hideResultDetailModal","cleanup","cleanupListeners","clear","_default","exports","default"],"sources":["knowledgeBaseSearchHandler.js"],"sourcesContent":["/**\n * @module knowledgeBaseSearchHandler\n * @description Handles search functionality for the KnowledgeBaseComponent.\n */\nconst MODULE = \"KnowledgeBaseSearchHandler\";\n\n/**\n * Factory function to create a search handler for KnowledgeBaseComponent.\n * @param {Object} ctx - The KnowledgeBaseComponent instance (context).\n * @param {Object} ctx.elements - DOM element references.\n * @param {Object} ctx.state - Component's internal state.\n * @param {Object} ctx.config - Component's configuration.\n * @param {Function} ctx.apiRequest - API request function.\n * @param {Object} ctx.eventHandlers - Event handling utility.\n * @param {Object} ctx.uiUtils - UI utility functions.\n * @param {Object} ctx.scheduler - Scheduler for debounce (setTimeout, clearTimeout).\n * @param {Function} ctx._getCurrentProjectId - Function to get current project ID.\n * @param {Function} ctx.validateUUID - UUID validation function.\n * @param {Function} ctx._safeSetInnerHTML - Function to safely set innerHTML.\n * @returns {Object} Search handler instance with public methods.\n */\nexport function createKnowledgeBaseSearchHandler(ctx) {\n  if (!ctx.domReadinessService)\n    throw new Error(`[${MODULE}] domReadinessService missing for readiness check`);\n\n  async function initialize() {\n    await ctx.domReadinessService.dependenciesAndElements({\n      deps     : ['app', 'projectManager', 'eventHandlers', 'domAPI'],\n      context  : MODULE + ':init'\n    });\n  }\n\n\n  /**\n   * Perform a search against the knowledge base\n   * @param {string} query - Search query\n   * @returns {Promise<void>}\n   */\n  async function searchKnowledgeBase(query) {\n    if (ctx.state.isSearching) return;\n    const trimmed = (query || \"\").trim();\n    if (\n      !trimmed ||\n      trimmed.length < ctx.config.minQueryLength ||\n      trimmed.length > ctx.config.maxQueryLength\n    ) {\n      _showNoResults();\n      return;\n    }\n\n    const pid = ctx._getCurrentProjectId();\n    const kbId = ctx.state.knowledgeBase?.id;\n    if (!pid) {\n      return;\n    }\n\n    const cacheKey = `${pid}-${trimmed}-${_getSelectedTopKValue()}`;\n    if (ctx.state.searchCache.has(cacheKey)) {\n      _renderSearchResults(ctx.state.searchCache.get(cacheKey));\n      return;\n    }\n\n    ctx.state.isSearching = true;\n    _showSearchLoading();\n\n    try {\n      const endpoint = kbId\n        ? `/api/projects/${pid}/knowledge-bases/${kbId}/search`\n        : `/api/projects/${pid}/knowledge-bases/search`;\n      const resp = await ctx.apiRequest(\n        endpoint,\n        {\n          method: \"POST\",\n          body: { query: trimmed, top_k: _getSelectedTopKValue() },\n        },\n        false,\n      );\n      const results = Array.isArray(resp?.data?.results)\n        ? resp.data.results\n        : [];\n      if (results.length) {\n        // Basic LRU eviction – cap cache to 100 entries.\n        const MAX_CACHE_ENTRIES = 100;\n        if (ctx.state.searchCache.size >= MAX_CACHE_ENTRIES) {\n          // Delete the first (oldest) entry – Map preserves insertion order\n          const firstKey = ctx.state.searchCache.keys().next().value;\n          ctx.state.searchCache.delete(firstKey);\n        }\n        ctx.state.searchCache.set(cacheKey, results);\n        _renderSearchResults(results);\n      } else {\n        _showNoResults();\n      }\n    } catch (err) {\n      ctx.logger.error('[KnowledgeBaseSearchHandler] searchKnowledgeBase failed',\n                       err,\n                       { context: 'knowledgeBaseSearchHandler:search' });\n    } finally {\n      ctx.state.isSearching = false;\n      _hideSearchLoading();\n    }\n  }\n\n  const debouncedSearch = ctx._debounce(\n    searchKnowledgeBase,\n    ctx.config.searchDebounceTime,\n  );\n\n  /**\n   * Trigger search from input field\n   */\n  function triggerSearch() {\n    if (ctx.elements.searchInput) {\n      searchKnowledgeBase(ctx.elements.searchInput.value);\n    }\n  }\n\n  /**\n   * Render search results in the UI\n   * @param {Array<Object>} results\n   */\n  function _renderSearchResults(results) {\n    _clearSearchResults();\n    if (!results?.length) return _showNoResults();\n    _appendSearchResults(results);\n    _toggleResultSections(true);\n  }\n\n  function _clearSearchResults() {\n    const { resultsContainer, resultsSection, noResultsSection } = ctx.elements;\n    if (resultsContainer) resultsContainer.textContent = \"\";\n    resultsSection?.classList.add(\"hidden\");\n    noResultsSection?.classList.add(\"hidden\");\n  }\n\n  function _appendSearchResults(results) {\n    const { resultsContainer } = ctx.elements;\n    if (!resultsContainer) return;\n    results.forEach((res) => {\n      const item = _createResultItem(res);\n      ctx.eventHandlers.trackListener(item, \"click\", () =>\n        _showResultDetail(res),\n      );\n      ctx.eventHandlers.trackListener(item, \"keydown\", (e) => {\n        if ([\"Enter\", \" \"].includes(e.key)) {\n          e.preventDefault();\n          _showResultDetail(res);\n        }\n      });\n      resultsContainer.appendChild(item);\n    });\n  }\n\n  function _toggleResultSections(show) {\n    const { resultsSection, noResultsSection } = ctx.elements;\n    if (resultsSection) resultsSection.classList.toggle(\"hidden\", !show);\n    if (noResultsSection) noResultsSection.classList.toggle(\"hidden\", show);\n  }\n\n  /**\n   * Create a single result card element\n   * @param {Object} result\n   * @returns {HTMLElement}\n   */\n  function _createResultItem(result) {\n    const item = ctx.domAPI.createElement(\"div\");\n    item.className =\n      \"card card-compact bg-base-100 shadow-md hover:shadow-lg transition-shadow mb-3 cursor-pointer border border-base-300\";\n    item.setAttribute(\"role\", \"button\");\n    item.setAttribute(\"tabindex\", \"0\");\n\n    const fileInfo = result.file_info || {};\n    const filename =\n      fileInfo.filename || result.metadata?.file_name || \"Unknown source\";\n    const scorePct = Math.round((result.score || 0) * 100);\n\n    const badgeClass = _getBadgeClass(scorePct);\n\n    ctx._safeSetInnerHTML(item, `\n      <div class=\"card-body p-3\">\n        <div class=\"card-title text-sm justify-between items-center mb-1\">\n          <div class=\"flex items-center gap-2 truncate\">\n            <span class=\"text-lg\">${ctx.uiUtils.fileIcon(fileInfo.file_type)}</span>\n            <span class=\"truncate\" title=\"${filename}\">${filename}</span>\n          </div>\n          <div class=\"badge ${badgeClass} badge-sm\" title=\"Relevance: ${scorePct}%\">\n            ${scorePct}%\n          </div>\n        </div>\n        <p class=\"text-xs text-base-content/80 kb-line-clamp-3 mb-2\">\n          ${result.text || \"No content available.\"}\n        </p>\n      </div>\n    `);\n    return item;\n  }\n\n  function _getBadgeClass(scorePct) {\n    if (scorePct >= 80) return \"badge-success\";\n    if (scorePct >= 60) return \"badge-warning\";\n    return \"badge-ghost\";\n  }\n\n  /**\n   * Show detailed view of a search result\n   * @param {Object} result\n   */\n  function _showResultDetail(result) {\n    const modal = ctx.elements.resultModal;\n    if (!modal || typeof modal.showModal !== \"function\") {\n      return;\n    }\n    _populateResultDetail(result);\n    modal.showModal();\n  }\n\n  function _populateResultDetail(result) {\n    const {\n      resultTitle,\n      resultSource,\n      resultScore,\n      resultContent,\n      useInChatBtn,\n    } = ctx.elements;\n    if (!resultTitle || !resultSource || !resultScore || !resultContent)\n      return;\n\n    const fileInfo = result.file_info || {};\n    const filename =\n      fileInfo.filename || result.metadata?.file_name || \"Unknown Source\";\n    const scorePct = Math.round((result.score || 0) * 100);\n\n    const badgeClass = _getBadgeClass(scorePct);\n\n    resultTitle.textContent = `Detail: ${filename}`;\n    resultSource.textContent = filename;\n    resultScore.className = `badge ${badgeClass}`;\n    resultScore.textContent = `${scorePct}%`;\n    resultContent.textContent = result.text || \"No content available.\";\n    resultContent.style.whiteSpace = \"pre-wrap\";\n\n    if (useInChatBtn) {\n      useInChatBtn.onclick = () => {\n        _useInConversation(result);\n        _hideResultDetailModal();\n      };\n    }\n  }\n\n  /**\n   * Hide the result detail modal\n   */\n  function _hideResultDetailModal() {\n    const modal = ctx.elements.resultModal;\n    if (modal && typeof modal.close === \"function\") {\n      modal.close();\n    }\n  }\n\n  /**\n   * Insert result reference into chat input\n   * @param {Object} result\n   */\n  function _useInConversation(result) {\n    const chatInput =\n      ctx.domAPI.getElementById(\"chatUIInput\") ||\n      ctx.domAPI.getElementById(\"projectChatInput\") ||\n      ctx.domAPI.getElementById(\"chatInput\") ||\n      ctx.domAPI.querySelector('textarea[placeholder*=\"Send a message\"]', undefined);\n\n    if (!chatInput) return;\n    const filename = result.metadata?.file_name || \"the knowledge base\";\n    const refText = `Referring to content from \"${filename}\":\\n\\n> ${result.text.trim()}\\n\\nBased on this, `;\n    const current = chatInput.value.trim();\n\n    try {\n      chatInput.value = current ? `${current}\\n\\n${refText}` : refText;\n      chatInput.focus();\n      const inputEvt = new Event('input', { bubbles: true });\n      const doc = ctx.domAPI.getDocument();\n      ctx.domAPI.dispatchEvent(doc, inputEvt);\n    } catch (err) {\n      ctx.logger.error('[KnowledgeBaseSearchHandler] _useInConversation failed',\n                       err, { context: MODULE });\n    }\n  }\n\n  /**\n   * Show loading indicator for search\n   */\n  function _showSearchLoading() {\n    const { resultsContainer, resultsSection, noResultsSection } =\n      ctx.elements;\n    resultsSection?.classList.remove(\"hidden\");\n    noResultsSection?.classList.add(\"hidden\");\n    if (resultsContainer) {\n      ctx._safeSetInnerHTML(resultsContainer, `\n        <div class=\"flex justify-center items-center p-4 text-base-content/70\">\n          <span class=\"loading loading-dots loading-md mr-2\"></span>\n          <span>Searching knowledge base...</span>\n        </div>\n      `);\n    }\n  }\n\n  /**\n   * Hide search loading indicator\n   */\n  function _hideSearchLoading() {\n    if (!ctx.state.isSearching) {\n      const loadingEl = ctx.elements.resultsContainer?.querySelector(\n        \".flex.justify-center.items-center\",\n      );\n      if (loadingEl && loadingEl.textContent.includes(\"Searching\")) {\n        loadingEl.remove();\n      }\n    }\n  }\n\n  /**\n   * Show \"no results\" UI\n   */\n  function _showNoResults() {\n    const { resultsSection, noResultsSection, resultsContainer } =\n      ctx.elements;\n    if (resultsContainer) resultsContainer.textContent = \"\";\n    resultsSection?.classList.add(\"hidden\");\n    noResultsSection?.classList.remove(\"hidden\");\n  }\n\n  /**\n   * Get selected Top-K value\n   * @returns {number}\n   */\n  function _getSelectedTopKValue() {\n    const val = parseInt(ctx.elements.topKSelect?.value, 10);\n    return isNaN(val) ? 5 : val;\n  }\n\n  function handleResultModalKeydown(e) {\n    if (e.key === \"Escape\") _hideResultDetailModal();\n  }\n\n  return {\n    searchKnowledgeBase,\n    debouncedSearch,\n    triggerSearch,\n    hideResultDetailModal: _hideResultDetailModal, // expose for direct calls if needed\n    handleResultModalKeydown,\n    initialize,\n    cleanup() {\n      // Use the already-injected eventHandlers reference on ctx; no DI lookup.\n      if (ctx.eventHandlers?.cleanupListeners) {\n        ctx.eventHandlers.cleanupListeners({ context: 'KnowledgeBaseSearchHandler' });\n      }\n      // Clear local search cache to avoid memory leaks when component unmounts\n      ctx.state?.searchCache?.clear?.();\n    }\n  };\n}\n\nexport default createKnowledgeBaseSearchHandler;\n"],"mappings":"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","ignoreList":[]}