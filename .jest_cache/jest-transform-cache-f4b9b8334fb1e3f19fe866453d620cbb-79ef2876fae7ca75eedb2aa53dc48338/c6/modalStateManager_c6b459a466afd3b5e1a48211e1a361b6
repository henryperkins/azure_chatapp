e28db6a82ab952579e5dd05eae88c2d2
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createModalStateManager = createModalStateManager;
exports.default = void 0;
/**
 * ModalStateManager - extracted modal state and lifecycle (Phase-2)
 * ----------------------------------------------------------------
 * Handles modal state tracking, lifecycle events, modal mapping,
 * and coordination between modals. Extracted from oversized modalManager.js.
 */

function createModalStateManager({
  eventService,
  logger,
  modalMappings = {}
} = {}) {
  const MODULE = 'ModalStateManager';
  if (!eventService || !logger) {
    throw new Error(`[${MODULE}] Required dependencies missing: eventService, logger`);
  }
  const _log = (msg, extra = {}) => logger?.debug?.(`[${MODULE}] ${msg}`, {
    context: MODULE,
    ...extra
  });
  const _logError = (msg, err, extra = {}) => {
    logger?.error?.(`[${MODULE}] ${msg}`, err?.stack || err, {
      context: MODULE,
      ...extra
    });
  };

  // Modal state tracking
  let activeModal = null;
  let modalStack = [];
  let modalHistory = [];
  const modalStates = new Map();

  // Modal configuration
  let currentModalMappings = {
    ...modalMappings
  };
  function setActiveModal(modalName) {
    const previousModal = activeModal;
    activeModal = modalName;
    if (modalName) {
      // Add to stack if not already present
      if (!modalStack.includes(modalName)) {
        modalStack.push(modalName);
      }

      // Add to history
      modalHistory.push({
        modal: modalName,
        timestamp: Date.now(),
        action: 'opened'
      });

      // Update modal state
      modalStates.set(modalName, {
        isOpen: true,
        openedAt: Date.now(),
        zIndex: modalStack.length + 1000
      });
    } else {
      // Remove from stack
      if (previousModal) {
        const index = modalStack.indexOf(previousModal);
        if (index > -1) {
          modalStack.splice(index, 1);
        }

        // Add to history
        modalHistory.push({
          modal: previousModal,
          timestamp: Date.now(),
          action: 'closed'
        });

        // Update modal state
        modalStates.set(previousModal, {
          isOpen: false,
          closedAt: Date.now(),
          zIndex: null
        });
      }
    }

    // Emit state change event
    eventService.emit('modal:stateChanged', {
      activeModal,
      previousModal,
      modalStack: [...modalStack],
      timestamp: Date.now()
    });
    _log('Active modal changed', {
      activeModal,
      previousModal,
      stackDepth: modalStack.length
    });
  }
  function getActiveModal() {
    return activeModal;
  }
  function isModalOpen(modalName) {
    if (!modalName) return false;
    const state = modalStates.get(modalName);
    return state?.isOpen || false;
  }
  function getModalState(modalName) {
    if (!modalName) return null;
    return modalStates.get(modalName) || null;
  }
  function getAllModalStates() {
    return Object.fromEntries(modalStates);
  }
  function getModalStack() {
    return [...modalStack];
  }
  function getModalHistory(limit = 10) {
    return modalHistory.slice(-limit);
  }
  function clearModalHistory() {
    modalHistory = [];
    _log('Modal history cleared');
  }
  function getTopModal() {
    return modalStack.length > 0 ? modalStack[modalStack.length - 1] : null;
  }
  function getModalId(modalName) {
    if (!modalName) return null;
    return currentModalMappings[modalName] || modalName;
  }
  function getModalName(modalId) {
    if (!modalId) return null;
    for (const [name, id] of Object.entries(currentModalMappings)) {
      if (id === modalId) {
        return name;
      }
    }
    return modalId; // Return original if no mapping found
  }
  function registerModal(modalName, modalId, options = {}) {
    if (!modalName || !modalId) {
      _logError('registerModal: modalName and modalId required');
      return false;
    }
    try {
      currentModalMappings[modalName] = modalId;

      // Initialize modal state
      modalStates.set(modalName, {
        isOpen: false,
        registeredAt: Date.now(),
        options: {
          ...options
        },
        zIndex: null
      });
      eventService.emit('modal:registered', {
        modalName,
        modalId,
        options,
        timestamp: Date.now()
      });
      _log('Modal registered', {
        modalName,
        modalId,
        options
      });
      return true;
    } catch (err) {
      _logError('Failed to register modal', err, {
        modalName,
        modalId
      });
      return false;
    }
  }
  function unregisterModal(modalName) {
    if (!modalName) return false;
    try {
      const modalId = currentModalMappings[modalName];
      if (modalId) {
        delete currentModalMappings[modalName];
        modalStates.delete(modalName);

        // Remove from stack if present
        const index = modalStack.indexOf(modalName);
        if (index > -1) {
          modalStack.splice(index, 1);
        }

        // Clear as active if it was active
        if (activeModal === modalName) {
          activeModal = null;
        }
        eventService.emit('modal:unregistered', {
          modalName,
          modalId,
          timestamp: Date.now()
        });
        _log('Modal unregistered', {
          modalName,
          modalId
        });
        return true;
      }
      return false;
    } catch (err) {
      _logError('Failed to unregister modal', err, {
        modalName
      });
      return false;
    }
  }
  function updateModalMappings(newMappings) {
    if (!newMappings || typeof newMappings !== 'object') {
      _logError('updateModalMappings: valid mappings object required');
      return false;
    }
    try {
      currentModalMappings = {
        ...currentModalMappings,
        ...newMappings
      };
      eventService.emit('modal:mappingsUpdated', {
        newMappings,
        allMappings: {
          ...currentModalMappings
        },
        timestamp: Date.now()
      });
      _log('Modal mappings updated', {
        newCount: Object.keys(newMappings).length,
        totalCount: Object.keys(currentModalMappings).length
      });
      return true;
    } catch (err) {
      _logError('Failed to update modal mappings', err);
      return false;
    }
  }
  function getModalMappings() {
    return {
      ...currentModalMappings
    };
  }
  function canOpenModal(modalName) {
    if (!modalName) return false;

    // Check if modal is registered
    if (!currentModalMappings[modalName]) {
      _log('Cannot open modal - not registered', {
        modalName
      });
      return false;
    }

    // Check if already open
    if (isModalOpen(modalName)) {
      _log('Cannot open modal - already open', {
        modalName
      });
      return false;
    }
    return true;
  }
  function canCloseModal(modalName) {
    if (!modalName) return false;

    // Check if modal is open
    if (!isModalOpen(modalName)) {
      _log('Cannot close modal - not open', {
        modalName
      });
      return false;
    }
    return true;
  }
  function closeAllModals() {
    const openModals = [...modalStack];
    try {
      modalStack = [];
      modalStates.forEach((state, modalName) => {
        if (state.isOpen) {
          modalStates.set(modalName, {
            ...state,
            isOpen: false,
            closedAt: Date.now(),
            zIndex: null
          });
        }
      });
      activeModal = null;
      eventService.emit('modal:allClosed', {
        closedModals: openModals,
        timestamp: Date.now()
      });
      _log('All modals closed', {
        closedCount: openModals.length
      });
      return openModals;
    } catch (err) {
      _logError('Failed to close all modals', err);
      return [];
    }
  }
  function getZIndex(modalName) {
    if (!modalName) return null;
    const state = modalStates.get(modalName);
    return state?.zIndex || null;
  }
  function setZIndex(modalName, zIndex) {
    if (!modalName || typeof zIndex !== 'number') return false;
    try {
      const state = modalStates.get(modalName);
      if (state) {
        modalStates.set(modalName, {
          ...state,
          zIndex
        });
        _log('Modal z-index updated', {
          modalName,
          zIndex
        });
        return true;
      }
      return false;
    } catch (err) {
      _logError('Failed to set modal z-index', err, {
        modalName,
        zIndex
      });
      return false;
    }
  }
  return {
    // Active modal management
    setActiveModal,
    getActiveModal,
    getTopModal,
    // Modal state queries
    isModalOpen,
    getModalState,
    getAllModalStates,
    canOpenModal,
    canCloseModal,
    // Modal stack management
    getModalStack,
    closeAllModals,
    // Modal registration
    registerModal,
    unregisterModal,
    // Modal mapping
    getModalId,
    getModalName,
    getModalMappings,
    updateModalMappings,
    // History and tracking
    getModalHistory,
    clearModalHistory,
    // Z-index management
    getZIndex,
    setZIndex,
    cleanup() {
      _log('cleanup()');
      closeAllModals();
      modalStates.clear();
      modalHistory = [];
      currentModalMappings = {};
    }
  };
}
var _default = exports.default = createModalStateManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVNb2RhbFN0YXRlTWFuYWdlciIsImV2ZW50U2VydmljZSIsImxvZ2dlciIsIm1vZGFsTWFwcGluZ3MiLCJNT0RVTEUiLCJFcnJvciIsIl9sb2ciLCJtc2ciLCJleHRyYSIsImRlYnVnIiwiY29udGV4dCIsIl9sb2dFcnJvciIsImVyciIsImVycm9yIiwic3RhY2siLCJhY3RpdmVNb2RhbCIsIm1vZGFsU3RhY2siLCJtb2RhbEhpc3RvcnkiLCJtb2RhbFN0YXRlcyIsIk1hcCIsImN1cnJlbnRNb2RhbE1hcHBpbmdzIiwic2V0QWN0aXZlTW9kYWwiLCJtb2RhbE5hbWUiLCJwcmV2aW91c01vZGFsIiwiaW5jbHVkZXMiLCJwdXNoIiwibW9kYWwiLCJ0aW1lc3RhbXAiLCJEYXRlIiwibm93IiwiYWN0aW9uIiwic2V0IiwiaXNPcGVuIiwib3BlbmVkQXQiLCJ6SW5kZXgiLCJsZW5ndGgiLCJpbmRleCIsImluZGV4T2YiLCJzcGxpY2UiLCJjbG9zZWRBdCIsImVtaXQiLCJzdGFja0RlcHRoIiwiZ2V0QWN0aXZlTW9kYWwiLCJpc01vZGFsT3BlbiIsInN0YXRlIiwiZ2V0IiwiZ2V0TW9kYWxTdGF0ZSIsImdldEFsbE1vZGFsU3RhdGVzIiwiT2JqZWN0IiwiZnJvbUVudHJpZXMiLCJnZXRNb2RhbFN0YWNrIiwiZ2V0TW9kYWxIaXN0b3J5IiwibGltaXQiLCJzbGljZSIsImNsZWFyTW9kYWxIaXN0b3J5IiwiZ2V0VG9wTW9kYWwiLCJnZXRNb2RhbElkIiwiZ2V0TW9kYWxOYW1lIiwibW9kYWxJZCIsIm5hbWUiLCJpZCIsImVudHJpZXMiLCJyZWdpc3Rlck1vZGFsIiwib3B0aW9ucyIsInJlZ2lzdGVyZWRBdCIsInVucmVnaXN0ZXJNb2RhbCIsImRlbGV0ZSIsInVwZGF0ZU1vZGFsTWFwcGluZ3MiLCJuZXdNYXBwaW5ncyIsImFsbE1hcHBpbmdzIiwibmV3Q291bnQiLCJrZXlzIiwidG90YWxDb3VudCIsImdldE1vZGFsTWFwcGluZ3MiLCJjYW5PcGVuTW9kYWwiLCJjYW5DbG9zZU1vZGFsIiwiY2xvc2VBbGxNb2RhbHMiLCJvcGVuTW9kYWxzIiwiZm9yRWFjaCIsImNsb3NlZE1vZGFscyIsImNsb3NlZENvdW50IiwiZ2V0WkluZGV4Iiwic2V0WkluZGV4IiwiY2xlYW51cCIsImNsZWFyIiwiX2RlZmF1bHQiLCJleHBvcnRzIiwiZGVmYXVsdCJdLCJzb3VyY2VzIjpbIm1vZGFsU3RhdGVNYW5hZ2VyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTW9kYWxTdGF0ZU1hbmFnZXIgLSBleHRyYWN0ZWQgbW9kYWwgc3RhdGUgYW5kIGxpZmVjeWNsZSAoUGhhc2UtMilcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIEhhbmRsZXMgbW9kYWwgc3RhdGUgdHJhY2tpbmcsIGxpZmVjeWNsZSBldmVudHMsIG1vZGFsIG1hcHBpbmcsXG4gKiBhbmQgY29vcmRpbmF0aW9uIGJldHdlZW4gbW9kYWxzLiBFeHRyYWN0ZWQgZnJvbSBvdmVyc2l6ZWQgbW9kYWxNYW5hZ2VyLmpzLlxuICovXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVNb2RhbFN0YXRlTWFuYWdlcih7XG4gIGV2ZW50U2VydmljZSxcbiAgbG9nZ2VyLFxuICBtb2RhbE1hcHBpbmdzID0ge31cbn0gPSB7fSkge1xuICBjb25zdCBNT0RVTEUgPSAnTW9kYWxTdGF0ZU1hbmFnZXInO1xuXG4gIGlmICghZXZlbnRTZXJ2aWNlIHx8ICFsb2dnZXIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFske01PRFVMRX1dIFJlcXVpcmVkIGRlcGVuZGVuY2llcyBtaXNzaW5nOiBldmVudFNlcnZpY2UsIGxvZ2dlcmApO1xuICB9XG5cbiAgY29uc3QgX2xvZyA9IChtc2csIGV4dHJhID0ge30pID0+IGxvZ2dlcj8uZGVidWc/LihgWyR7TU9EVUxFfV0gJHttc2d9YCwge1xuICAgIGNvbnRleHQ6IE1PRFVMRSxcbiAgICAuLi5leHRyYVxuICB9KTtcblxuICBjb25zdCBfbG9nRXJyb3IgPSAobXNnLCBlcnIsIGV4dHJhID0ge30pID0+IHtcbiAgICBsb2dnZXI/LmVycm9yPy4oYFske01PRFVMRX1dICR7bXNnfWAsIGVycj8uc3RhY2sgfHwgZXJyLCB7XG4gICAgICBjb250ZXh0OiBNT0RVTEUsXG4gICAgICAuLi5leHRyYVxuICAgIH0pO1xuICB9O1xuXG4gIC8vIE1vZGFsIHN0YXRlIHRyYWNraW5nXG4gIGxldCBhY3RpdmVNb2RhbCA9IG51bGw7XG4gIGxldCBtb2RhbFN0YWNrID0gW107XG4gIGxldCBtb2RhbEhpc3RvcnkgPSBbXTtcbiAgY29uc3QgbW9kYWxTdGF0ZXMgPSBuZXcgTWFwKCk7XG5cbiAgLy8gTW9kYWwgY29uZmlndXJhdGlvblxuICBsZXQgY3VycmVudE1vZGFsTWFwcGluZ3MgPSB7IC4uLm1vZGFsTWFwcGluZ3MgfTtcblxuICBmdW5jdGlvbiBzZXRBY3RpdmVNb2RhbChtb2RhbE5hbWUpIHtcbiAgICBjb25zdCBwcmV2aW91c01vZGFsID0gYWN0aXZlTW9kYWw7XG4gICAgYWN0aXZlTW9kYWwgPSBtb2RhbE5hbWU7XG5cbiAgICBpZiAobW9kYWxOYW1lKSB7XG4gICAgICAvLyBBZGQgdG8gc3RhY2sgaWYgbm90IGFscmVhZHkgcHJlc2VudFxuICAgICAgaWYgKCFtb2RhbFN0YWNrLmluY2x1ZGVzKG1vZGFsTmFtZSkpIHtcbiAgICAgICAgbW9kYWxTdGFjay5wdXNoKG1vZGFsTmFtZSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEFkZCB0byBoaXN0b3J5XG4gICAgICBtb2RhbEhpc3RvcnkucHVzaCh7XG4gICAgICAgIG1vZGFsOiBtb2RhbE5hbWUsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgYWN0aW9uOiAnb3BlbmVkJ1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFVwZGF0ZSBtb2RhbCBzdGF0ZVxuICAgICAgbW9kYWxTdGF0ZXMuc2V0KG1vZGFsTmFtZSwge1xuICAgICAgICBpc09wZW46IHRydWUsXG4gICAgICAgIG9wZW5lZEF0OiBEYXRlLm5vdygpLFxuICAgICAgICB6SW5kZXg6IG1vZGFsU3RhY2subGVuZ3RoICsgMTAwMFxuICAgICAgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFJlbW92ZSBmcm9tIHN0YWNrXG4gICAgICBpZiAocHJldmlvdXNNb2RhbCkge1xuICAgICAgICBjb25zdCBpbmRleCA9IG1vZGFsU3RhY2suaW5kZXhPZihwcmV2aW91c01vZGFsKTtcbiAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgICAgICBtb2RhbFN0YWNrLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZGQgdG8gaGlzdG9yeVxuICAgICAgICBtb2RhbEhpc3RvcnkucHVzaCh7XG4gICAgICAgICAgbW9kYWw6IHByZXZpb3VzTW9kYWwsXG4gICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgICAgIGFjdGlvbjogJ2Nsb3NlZCdcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gVXBkYXRlIG1vZGFsIHN0YXRlXG4gICAgICAgIG1vZGFsU3RhdGVzLnNldChwcmV2aW91c01vZGFsLCB7XG4gICAgICAgICAgaXNPcGVuOiBmYWxzZSxcbiAgICAgICAgICBjbG9zZWRBdDogRGF0ZS5ub3coKSxcbiAgICAgICAgICB6SW5kZXg6IG51bGxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRW1pdCBzdGF0ZSBjaGFuZ2UgZXZlbnRcbiAgICBldmVudFNlcnZpY2UuZW1pdCgnbW9kYWw6c3RhdGVDaGFuZ2VkJywge1xuICAgICAgYWN0aXZlTW9kYWwsXG4gICAgICBwcmV2aW91c01vZGFsLFxuICAgICAgbW9kYWxTdGFjazogWy4uLm1vZGFsU3RhY2tdLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpXG4gICAgfSk7XG5cbiAgICBfbG9nKCdBY3RpdmUgbW9kYWwgY2hhbmdlZCcsIHsgXG4gICAgICBhY3RpdmVNb2RhbCwgXG4gICAgICBwcmV2aW91c01vZGFsLCBcbiAgICAgIHN0YWNrRGVwdGg6IG1vZGFsU3RhY2subGVuZ3RoIFxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0QWN0aXZlTW9kYWwoKSB7XG4gICAgcmV0dXJuIGFjdGl2ZU1vZGFsO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNNb2RhbE9wZW4obW9kYWxOYW1lKSB7XG4gICAgaWYgKCFtb2RhbE5hbWUpIHJldHVybiBmYWxzZTtcbiAgICBjb25zdCBzdGF0ZSA9IG1vZGFsU3RhdGVzLmdldChtb2RhbE5hbWUpO1xuICAgIHJldHVybiBzdGF0ZT8uaXNPcGVuIHx8IGZhbHNlO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0TW9kYWxTdGF0ZShtb2RhbE5hbWUpIHtcbiAgICBpZiAoIW1vZGFsTmFtZSkgcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuIG1vZGFsU3RhdGVzLmdldChtb2RhbE5hbWUpIHx8IG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRBbGxNb2RhbFN0YXRlcygpIHtcbiAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKG1vZGFsU3RhdGVzKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldE1vZGFsU3RhY2soKSB7XG4gICAgcmV0dXJuIFsuLi5tb2RhbFN0YWNrXTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldE1vZGFsSGlzdG9yeShsaW1pdCA9IDEwKSB7XG4gICAgcmV0dXJuIG1vZGFsSGlzdG9yeS5zbGljZSgtbGltaXQpO1xuICB9XG5cbiAgZnVuY3Rpb24gY2xlYXJNb2RhbEhpc3RvcnkoKSB7XG4gICAgbW9kYWxIaXN0b3J5ID0gW107XG4gICAgX2xvZygnTW9kYWwgaGlzdG9yeSBjbGVhcmVkJyk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRUb3BNb2RhbCgpIHtcbiAgICByZXR1cm4gbW9kYWxTdGFjay5sZW5ndGggPiAwID8gbW9kYWxTdGFja1ttb2RhbFN0YWNrLmxlbmd0aCAtIDFdIDogbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldE1vZGFsSWQobW9kYWxOYW1lKSB7XG4gICAgaWYgKCFtb2RhbE5hbWUpIHJldHVybiBudWxsO1xuICAgIHJldHVybiBjdXJyZW50TW9kYWxNYXBwaW5nc1ttb2RhbE5hbWVdIHx8IG1vZGFsTmFtZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldE1vZGFsTmFtZShtb2RhbElkKSB7XG4gICAgaWYgKCFtb2RhbElkKSByZXR1cm4gbnVsbDtcbiAgICBcbiAgICBmb3IgKGNvbnN0IFtuYW1lLCBpZF0gb2YgT2JqZWN0LmVudHJpZXMoY3VycmVudE1vZGFsTWFwcGluZ3MpKSB7XG4gICAgICBpZiAoaWQgPT09IG1vZGFsSWQpIHtcbiAgICAgICAgcmV0dXJuIG5hbWU7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBtb2RhbElkOyAvLyBSZXR1cm4gb3JpZ2luYWwgaWYgbm8gbWFwcGluZyBmb3VuZFxuICB9XG5cbiAgZnVuY3Rpb24gcmVnaXN0ZXJNb2RhbChtb2RhbE5hbWUsIG1vZGFsSWQsIG9wdGlvbnMgPSB7fSkge1xuICAgIGlmICghbW9kYWxOYW1lIHx8ICFtb2RhbElkKSB7XG4gICAgICBfbG9nRXJyb3IoJ3JlZ2lzdGVyTW9kYWw6IG1vZGFsTmFtZSBhbmQgbW9kYWxJZCByZXF1aXJlZCcpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjdXJyZW50TW9kYWxNYXBwaW5nc1ttb2RhbE5hbWVdID0gbW9kYWxJZDtcbiAgICAgIFxuICAgICAgLy8gSW5pdGlhbGl6ZSBtb2RhbCBzdGF0ZVxuICAgICAgbW9kYWxTdGF0ZXMuc2V0KG1vZGFsTmFtZSwge1xuICAgICAgICBpc09wZW46IGZhbHNlLFxuICAgICAgICByZWdpc3RlcmVkQXQ6IERhdGUubm93KCksXG4gICAgICAgIG9wdGlvbnM6IHsgLi4ub3B0aW9ucyB9LFxuICAgICAgICB6SW5kZXg6IG51bGxcbiAgICAgIH0pO1xuXG4gICAgICBldmVudFNlcnZpY2UuZW1pdCgnbW9kYWw6cmVnaXN0ZXJlZCcsIHtcbiAgICAgICAgbW9kYWxOYW1lLFxuICAgICAgICBtb2RhbElkLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICAgIH0pO1xuXG4gICAgICBfbG9nKCdNb2RhbCByZWdpc3RlcmVkJywgeyBtb2RhbE5hbWUsIG1vZGFsSWQsIG9wdGlvbnMgfSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIF9sb2dFcnJvcignRmFpbGVkIHRvIHJlZ2lzdGVyIG1vZGFsJywgZXJyLCB7IG1vZGFsTmFtZSwgbW9kYWxJZCB9KTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiB1bnJlZ2lzdGVyTW9kYWwobW9kYWxOYW1lKSB7XG4gICAgaWYgKCFtb2RhbE5hbWUpIHJldHVybiBmYWxzZTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBtb2RhbElkID0gY3VycmVudE1vZGFsTWFwcGluZ3NbbW9kYWxOYW1lXTtcbiAgICAgIFxuICAgICAgaWYgKG1vZGFsSWQpIHtcbiAgICAgICAgZGVsZXRlIGN1cnJlbnRNb2RhbE1hcHBpbmdzW21vZGFsTmFtZV07XG4gICAgICAgIG1vZGFsU3RhdGVzLmRlbGV0ZShtb2RhbE5hbWUpO1xuXG4gICAgICAgIC8vIFJlbW92ZSBmcm9tIHN0YWNrIGlmIHByZXNlbnRcbiAgICAgICAgY29uc3QgaW5kZXggPSBtb2RhbFN0YWNrLmluZGV4T2YobW9kYWxOYW1lKTtcbiAgICAgICAgaWYgKGluZGV4ID4gLTEpIHtcbiAgICAgICAgICBtb2RhbFN0YWNrLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDbGVhciBhcyBhY3RpdmUgaWYgaXQgd2FzIGFjdGl2ZVxuICAgICAgICBpZiAoYWN0aXZlTW9kYWwgPT09IG1vZGFsTmFtZSkge1xuICAgICAgICAgIGFjdGl2ZU1vZGFsID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIGV2ZW50U2VydmljZS5lbWl0KCdtb2RhbDp1bnJlZ2lzdGVyZWQnLCB7XG4gICAgICAgICAgbW9kYWxOYW1lLFxuICAgICAgICAgIG1vZGFsSWQsXG4gICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpXG4gICAgICAgIH0pO1xuXG4gICAgICAgIF9sb2coJ01vZGFsIHVucmVnaXN0ZXJlZCcsIHsgbW9kYWxOYW1lLCBtb2RhbElkIH0pO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgX2xvZ0Vycm9yKCdGYWlsZWQgdG8gdW5yZWdpc3RlciBtb2RhbCcsIGVyciwgeyBtb2RhbE5hbWUgfSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gdXBkYXRlTW9kYWxNYXBwaW5ncyhuZXdNYXBwaW5ncykge1xuICAgIGlmICghbmV3TWFwcGluZ3MgfHwgdHlwZW9mIG5ld01hcHBpbmdzICE9PSAnb2JqZWN0Jykge1xuICAgICAgX2xvZ0Vycm9yKCd1cGRhdGVNb2RhbE1hcHBpbmdzOiB2YWxpZCBtYXBwaW5ncyBvYmplY3QgcmVxdWlyZWQnKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY3VycmVudE1vZGFsTWFwcGluZ3MgPSB7IC4uLmN1cnJlbnRNb2RhbE1hcHBpbmdzLCAuLi5uZXdNYXBwaW5ncyB9O1xuICAgICAgXG4gICAgICBldmVudFNlcnZpY2UuZW1pdCgnbW9kYWw6bWFwcGluZ3NVcGRhdGVkJywge1xuICAgICAgICBuZXdNYXBwaW5ncyxcbiAgICAgICAgYWxsTWFwcGluZ3M6IHsgLi4uY3VycmVudE1vZGFsTWFwcGluZ3MgfSxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpXG4gICAgICB9KTtcblxuICAgICAgX2xvZygnTW9kYWwgbWFwcGluZ3MgdXBkYXRlZCcsIHsgXG4gICAgICAgIG5ld0NvdW50OiBPYmplY3Qua2V5cyhuZXdNYXBwaW5ncykubGVuZ3RoLFxuICAgICAgICB0b3RhbENvdW50OiBPYmplY3Qua2V5cyhjdXJyZW50TW9kYWxNYXBwaW5ncykubGVuZ3RoIFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIF9sb2dFcnJvcignRmFpbGVkIHRvIHVwZGF0ZSBtb2RhbCBtYXBwaW5ncycsIGVycik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZ2V0TW9kYWxNYXBwaW5ncygpIHtcbiAgICByZXR1cm4geyAuLi5jdXJyZW50TW9kYWxNYXBwaW5ncyB9O1xuICB9XG5cbiAgZnVuY3Rpb24gY2FuT3Blbk1vZGFsKG1vZGFsTmFtZSkge1xuICAgIGlmICghbW9kYWxOYW1lKSByZXR1cm4gZmFsc2U7XG5cbiAgICAvLyBDaGVjayBpZiBtb2RhbCBpcyByZWdpc3RlcmVkXG4gICAgaWYgKCFjdXJyZW50TW9kYWxNYXBwaW5nc1ttb2RhbE5hbWVdKSB7XG4gICAgICBfbG9nKCdDYW5ub3Qgb3BlbiBtb2RhbCAtIG5vdCByZWdpc3RlcmVkJywgeyBtb2RhbE5hbWUgfSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgYWxyZWFkeSBvcGVuXG4gICAgaWYgKGlzTW9kYWxPcGVuKG1vZGFsTmFtZSkpIHtcbiAgICAgIF9sb2coJ0Nhbm5vdCBvcGVuIG1vZGFsIC0gYWxyZWFkeSBvcGVuJywgeyBtb2RhbE5hbWUgfSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBmdW5jdGlvbiBjYW5DbG9zZU1vZGFsKG1vZGFsTmFtZSkge1xuICAgIGlmICghbW9kYWxOYW1lKSByZXR1cm4gZmFsc2U7XG5cbiAgICAvLyBDaGVjayBpZiBtb2RhbCBpcyBvcGVuXG4gICAgaWYgKCFpc01vZGFsT3Blbihtb2RhbE5hbWUpKSB7XG4gICAgICBfbG9nKCdDYW5ub3QgY2xvc2UgbW9kYWwgLSBub3Qgb3BlbicsIHsgbW9kYWxOYW1lIH0pO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgZnVuY3Rpb24gY2xvc2VBbGxNb2RhbHMoKSB7XG4gICAgY29uc3Qgb3Blbk1vZGFscyA9IFsuLi5tb2RhbFN0YWNrXTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgbW9kYWxTdGFjayA9IFtdO1xuICAgICAgbW9kYWxTdGF0ZXMuZm9yRWFjaCgoc3RhdGUsIG1vZGFsTmFtZSkgPT4ge1xuICAgICAgICBpZiAoc3RhdGUuaXNPcGVuKSB7XG4gICAgICAgICAgbW9kYWxTdGF0ZXMuc2V0KG1vZGFsTmFtZSwge1xuICAgICAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgICAgICBpc09wZW46IGZhbHNlLFxuICAgICAgICAgICAgY2xvc2VkQXQ6IERhdGUubm93KCksXG4gICAgICAgICAgICB6SW5kZXg6IG51bGxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGFjdGl2ZU1vZGFsID0gbnVsbDtcblxuICAgICAgZXZlbnRTZXJ2aWNlLmVtaXQoJ21vZGFsOmFsbENsb3NlZCcsIHtcbiAgICAgICAgY2xvc2VkTW9kYWxzOiBvcGVuTW9kYWxzLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICAgIH0pO1xuXG4gICAgICBfbG9nKCdBbGwgbW9kYWxzIGNsb3NlZCcsIHsgY2xvc2VkQ291bnQ6IG9wZW5Nb2RhbHMubGVuZ3RoIH0pO1xuICAgICAgcmV0dXJuIG9wZW5Nb2RhbHM7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBfbG9nRXJyb3IoJ0ZhaWxlZCB0byBjbG9zZSBhbGwgbW9kYWxzJywgZXJyKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBnZXRaSW5kZXgobW9kYWxOYW1lKSB7XG4gICAgaWYgKCFtb2RhbE5hbWUpIHJldHVybiBudWxsO1xuICAgIGNvbnN0IHN0YXRlID0gbW9kYWxTdGF0ZXMuZ2V0KG1vZGFsTmFtZSk7XG4gICAgcmV0dXJuIHN0YXRlPy56SW5kZXggfHwgbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldFpJbmRleChtb2RhbE5hbWUsIHpJbmRleCkge1xuICAgIGlmICghbW9kYWxOYW1lIHx8IHR5cGVvZiB6SW5kZXggIT09ICdudW1iZXInKSByZXR1cm4gZmFsc2U7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3RhdGUgPSBtb2RhbFN0YXRlcy5nZXQobW9kYWxOYW1lKTtcbiAgICAgIGlmIChzdGF0ZSkge1xuICAgICAgICBtb2RhbFN0YXRlcy5zZXQobW9kYWxOYW1lLCB7IC4uLnN0YXRlLCB6SW5kZXggfSk7XG4gICAgICAgIF9sb2coJ01vZGFsIHotaW5kZXggdXBkYXRlZCcsIHsgbW9kYWxOYW1lLCB6SW5kZXggfSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgX2xvZ0Vycm9yKCdGYWlsZWQgdG8gc2V0IG1vZGFsIHotaW5kZXgnLCBlcnIsIHsgbW9kYWxOYW1lLCB6SW5kZXggfSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHtcbiAgICAvLyBBY3RpdmUgbW9kYWwgbWFuYWdlbWVudFxuICAgIHNldEFjdGl2ZU1vZGFsLFxuICAgIGdldEFjdGl2ZU1vZGFsLFxuICAgIGdldFRvcE1vZGFsLFxuXG4gICAgLy8gTW9kYWwgc3RhdGUgcXVlcmllc1xuICAgIGlzTW9kYWxPcGVuLFxuICAgIGdldE1vZGFsU3RhdGUsXG4gICAgZ2V0QWxsTW9kYWxTdGF0ZXMsXG4gICAgY2FuT3Blbk1vZGFsLFxuICAgIGNhbkNsb3NlTW9kYWwsXG5cbiAgICAvLyBNb2RhbCBzdGFjayBtYW5hZ2VtZW50XG4gICAgZ2V0TW9kYWxTdGFjayxcbiAgICBjbG9zZUFsbE1vZGFscyxcblxuICAgIC8vIE1vZGFsIHJlZ2lzdHJhdGlvblxuICAgIHJlZ2lzdGVyTW9kYWwsXG4gICAgdW5yZWdpc3Rlck1vZGFsLFxuXG4gICAgLy8gTW9kYWwgbWFwcGluZ1xuICAgIGdldE1vZGFsSWQsXG4gICAgZ2V0TW9kYWxOYW1lLFxuICAgIGdldE1vZGFsTWFwcGluZ3MsXG4gICAgdXBkYXRlTW9kYWxNYXBwaW5ncyxcblxuICAgIC8vIEhpc3RvcnkgYW5kIHRyYWNraW5nXG4gICAgZ2V0TW9kYWxIaXN0b3J5LFxuICAgIGNsZWFyTW9kYWxIaXN0b3J5LFxuXG4gICAgLy8gWi1pbmRleCBtYW5hZ2VtZW50XG4gICAgZ2V0WkluZGV4LFxuICAgIHNldFpJbmRleCxcblxuICAgIGNsZWFudXAoKSB7XG4gICAgICBfbG9nKCdjbGVhbnVwKCknKTtcbiAgICAgIGNsb3NlQWxsTW9kYWxzKCk7XG4gICAgICBtb2RhbFN0YXRlcy5jbGVhcigpO1xuICAgICAgbW9kYWxIaXN0b3J5ID0gW107XG4gICAgICBjdXJyZW50TW9kYWxNYXBwaW5ncyA9IHt9O1xuICAgIH1cbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY3JlYXRlTW9kYWxTdGF0ZU1hbmFnZXI7Il0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVPLFNBQVNBLHVCQUF1QkEsQ0FBQztFQUN0Q0MsWUFBWTtFQUNaQyxNQUFNO0VBQ05DLGFBQWEsR0FBRyxDQUFDO0FBQ25CLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRTtFQUNOLE1BQU1DLE1BQU0sR0FBRyxtQkFBbUI7RUFFbEMsSUFBSSxDQUFDSCxZQUFZLElBQUksQ0FBQ0MsTUFBTSxFQUFFO0lBQzVCLE1BQU0sSUFBSUcsS0FBSyxDQUFDLElBQUlELE1BQU0sdURBQXVELENBQUM7RUFDcEY7RUFFQSxNQUFNRSxJQUFJLEdBQUdBLENBQUNDLEdB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