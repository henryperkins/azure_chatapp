{"version":3,"names":["_appInitializer","require","createMockDependencySystem","DS","modules","Map","register","key","value","set","createStubBrowserService","documentObject","windowObject","win","DOMPurify","EventTarget","addEventListener","removeEventListener","dispatchEvent","setTimeout","fn","clearTimeout","performance","now","URL","createObjectURL","revokeObjectURL","document","doc","readyState","getElementById","querySelector","createElement","style","body","appendChild","removeChild","getWindow","getDocument","createStubApiEndpoints","endpoints","AUTH_CSRF","AUTH_LOGIN","AUTH_LOGOUT","AUTH_REGISTER","AUTH_VERIFY","AUTH_REFRESH","resolveApiEndpoints","cleanup","test","DependencySystem","appInit","createAppInitializer","browserService","createChatManager","createApiEndpoints","APP_CONFIG","TIMEOUTS","DOM_READY","serviceInit","registerBasicServices","registerAdvancedServices","expect","get","toBeDefined"],"sources":["token-stats-di.test.js"],"sourcesContent":["/**\n * Regression test – ensures that a placeholder implementation for\n * `tokenStatsManager` is present in the DependencySystem **before** the\n * core bootstrap phase (specifically before `coreInit` would attempt to\n * resolve the dependency via `createMessageHandler`).  The placeholder is\n * provided by `tokenStatsManagerProxy` during the early DI setup inside\n * `createAppInitializer`.\n *\n * The test only executes the Basic & Advanced service registration phases\n * (matching the order that runs before `coreInit`).  It does **not** fully\n * initialize the app – keeping the scope minimal while still catching\n * regressions where the proxy registration might be removed or renamed.\n */\n\nimport { createAppInitializer } from '../init/appInitializer.js';\n\nfunction createMockDependencySystem() {\n  const DS = {\n    modules: new Map(),\n    register(key, value) {\n      this.modules.set(key, value);\n    }\n  };\n  return DS;\n}\n\nfunction createStubBrowserService({ documentObject, windowObject } = {}) {\n  const win = windowObject ?? {\n    DOMPurify: {},\n    EventTarget: class {\n      addEventListener() {}\n      removeEventListener() {}\n      dispatchEvent() { return false; }\n    },\n    setTimeout(fn) { if (typeof fn === 'function') fn(); return 0; },\n    clearTimeout() {},\n    performance: { now: () => 0 },\n    URL: { createObjectURL: () => '', revokeObjectURL: () => '' },\n    document : documentObject\n  };\n\n  const doc = documentObject ?? {\n    readyState: 'complete',\n    getElementById: () => null,\n    querySelector : () => null,\n    addEventListener: () => {},\n    removeEventListener: () => {},\n    createElement: () => ({ style: {} }),\n    body: { appendChild: () => {}, removeChild: () => {} }\n  };\n\n  win.document = doc;\n\n  return {\n    getWindow: () => win,\n    getDocument: () => doc,\n    setTimeout: win.setTimeout,\n    clearTimeout: win.clearTimeout\n  };\n}\n\nfunction createStubApiEndpoints() {\n  return {\n    endpoints: {\n      AUTH_CSRF: '/api/csrf',\n      AUTH_LOGIN: '/api/login',\n      AUTH_LOGOUT: '/api/logout',\n      AUTH_REGISTER: '/api/register',\n      AUTH_VERIFY: '/api/verify',\n      AUTH_REFRESH: '/api/refresh'\n    },\n    resolveApiEndpoints: () => ({}),\n    cleanup: () => {}\n  };\n}\n\ntest('tokenStatsManager placeholder exists before coreInit', async () => {\n  const DependencySystem = createMockDependencySystem();\n\n  const appInit = createAppInitializer({\n    DependencySystem,\n    browserService: createStubBrowserService(),\n    createChatManager: () => ({}),\n    createApiEndpoints: () => createStubApiEndpoints(),\n    APP_CONFIG: {\n      TIMEOUTS: { DOM_READY: 1000 }\n    },\n    // The remaining optional config/factories are left undefined intentionally\n  });\n\n  // Execute only the DI service registration phases that precede coreInit\n  await appInit.serviceInit.registerBasicServices();\n  await appInit.serviceInit.registerAdvancedServices();\n\n  expect(DependencySystem.modules.get('tokenStatsManager')).toBeDefined();\n});\n"],"mappings":"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","ignoreList":[]}