{"version":3,"names":["createAuthFormHandler","domAPI","sanitizer","eventHandlers","logger","safeHandler","MODULE","Error","_log","msg","extra","debug","context","_logError","err","error","stack","validateUsername","username","valid","message","trimmed","trim","length","test","value","validatePassword","password","validateEmail","email","emailRegex","setButtonLoading","btn","isLoading","loadingText","disabled","dataset","originalText","textContent","addClass","removeClass","showError","container","errorEl","querySelector","createElement","className","appendChild","setTextContent","sanitize","hideError","clearForm","formEl","inputs","querySelectorAll","forEach","input","parentElement","bindFormSubmission","onSubmit","handler","event","preventDefault","stopPropagation","formData","FormData","data","Object","fromEntries","entries","formId","id","trackListener","description","bindInputValidation","inputEl","validator","result","extendProps","target","props","assign","applyStyles","styles","style","cleanup","cleanupListeners","_default","exports","default"],"sources":["authFormHandler.js"],"sourcesContent":["/**\n * AuthFormHandler - extracted form management helpers (Phase-2)\n * -----------------------------------------------------------\n * Handles form validation, UI interactions, and form-specific logic\n * for authentication forms. Extracted from oversized auth.js module.\n */\n\nexport function createAuthFormHandler({\n  domAPI,\n  sanitizer,\n  eventHandlers,\n  logger,\n  safeHandler\n} = {}) {\n  const MODULE = 'AuthFormHandler';\n\n  if (!domAPI || !sanitizer || !eventHandlers || !logger || !safeHandler) {\n    throw new Error(`[${MODULE}] Required dependencies missing: domAPI, sanitizer, eventHandlers, logger, safeHandler`);\n  }\n\n  const _log = (msg, extra = {}) => logger?.debug?.(`[${MODULE}] ${msg}`, {\n    context: MODULE,\n    ...extra\n  });\n\n  const _logError = (msg, err, extra = {}) => {\n    logger?.error?.(`[${MODULE}] ${msg}`, err?.stack || err, {\n      context: MODULE,\n      ...extra\n    });\n  };\n\n  function validateUsername(username) {\n    if (!username || typeof username !== 'string') {\n      return { valid: false, message: 'Username is required' };\n    }\n    const trimmed = username.trim();\n    if (trimmed.length < 3) {\n      return { valid: false, message: 'Username must be at least 3 characters' };\n    }\n    if (trimmed.length > 50) {\n      return { valid: false, message: 'Username must be 50 characters or less' };\n    }\n    if (!/^[a-zA-Z0-9_.-]+$/.test(trimmed)) {\n      return { valid: false, message: 'Username can only contain letters, numbers, dots, dashes, and underscores' };\n    }\n    return { valid: true, value: trimmed };\n  }\n\n  function validatePassword(password) {\n    if (!password || typeof password !== 'string') {\n      return { valid: false, message: 'Password is required' };\n    }\n    if (password.length < 8) {\n      return { valid: false, message: 'Password must be at least 8 characters' };\n    }\n    if (password.length > 128) {\n      return { valid: false, message: 'Password must be 128 characters or less' };\n    }\n    return { valid: true, value: password };\n  }\n\n  function validateEmail(email) {\n    if (!email || typeof email !== 'string') {\n      return { valid: false, message: 'Email is required' };\n    }\n    const trimmed = email.trim();\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(trimmed)) {\n      return { valid: false, message: 'Please enter a valid email address' };\n    }\n    return { valid: true, value: trimmed };\n  }\n\n  function setButtonLoading(btn, isLoading, loadingText = 'Processing...') {\n    if (!btn) return;\n\n    try {\n      if (isLoading) {\n        btn.disabled = true;\n        btn.dataset.originalText = btn.textContent;\n        btn.textContent = loadingText;\n        domAPI.addClass(btn, 'loading');\n      } else {\n        btn.disabled = false;\n        btn.textContent = btn.dataset.originalText || btn.textContent;\n        domAPI.removeClass(btn, 'loading');\n        delete btn.dataset.originalText;\n      }\n    } catch (err) {\n      _logError('Failed to set button loading state', err, { isLoading, loadingText });\n    }\n  }\n\n  function showError(container, message) {\n    if (!container || !message) return;\n\n    try {\n      let errorEl = container.querySelector('.error-message');\n      if (!errorEl) {\n        errorEl = domAPI.createElement('div');\n        errorEl.className = 'error-message text-error text-sm mt-2';\n        domAPI.appendChild(container, errorEl);\n      }\n      domAPI.setTextContent(errorEl, sanitizer.sanitize(message));\n      domAPI.removeClass(errorEl, 'hidden');\n    } catch (err) {\n      _logError('Failed to show error message', err, { message });\n    }\n  }\n\n  function hideError(container) {\n    if (!container) return;\n\n    try {\n      const errorEl = container.querySelector('.error-message');\n      if (errorEl) {\n        domAPI.addClass(errorEl, 'hidden');\n      }\n    } catch (err) {\n      _logError('Failed to hide error message', err);\n    }\n  }\n\n  function clearForm(formEl) {\n    if (!formEl) return;\n\n    try {\n      const inputs = formEl.querySelectorAll('input[type=\"text\"], input[type=\"email\"], input[type=\"password\"]');\n      inputs.forEach(input => {\n        input.value = '';\n        hideError(input.parentElement);\n      });\n    } catch (err) {\n      _logError('Failed to clear form', err);\n    }\n  }\n\n  function bindFormSubmission(formEl, onSubmit, { context = MODULE } = {}) {\n    if (!formEl || typeof onSubmit !== 'function') {\n      _logError('bindFormSubmission: form and onSubmit handler required');\n      return;\n    }\n\n    const handler = safeHandler(async (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      const formData = new FormData(formEl);\n      const data = Object.fromEntries(formData.entries());\n\n      try {\n        await onSubmit(data, formEl);\n      } catch (err) {\n        _logError('Form submission failed', err, { formId: formEl.id });\n      }\n    }, `${context}:FormSubmit`);\n\n    eventHandlers.trackListener(formEl, 'submit', handler, {\n      context,\n      description: 'FormSubmission'\n    });\n\n    _log('Form submission bound', { formId: formEl.id, context });\n  }\n\n  function bindInputValidation(inputEl, validator, { context = MODULE } = {}) {\n    if (!inputEl || typeof validator !== 'function') {\n      _logError('bindInputValidation: input and validator required');\n      return;\n    }\n\n    const handler = safeHandler(() => {\n      const value = inputEl.value;\n      const result = validator(value);\n\n      const container = inputEl.parentElement;\n      if (result.valid) {\n        hideError(container);\n        domAPI.removeClass(inputEl, 'input-error');\n      } else {\n        showError(container, result.message);\n        domAPI.addClass(inputEl, 'input-error');\n      }\n    }, `${context}:InputValidation`);\n\n    eventHandlers.trackListener(inputEl, 'blur', handler, {\n      context,\n      description: 'InputValidation'\n    });\n  }\n\n  function extendProps(target, props) {\n    if (target && props) Object.assign(target, props);\n  }\n\n  function applyStyles(target, styles) {\n    if (target && styles) Object.assign(target.style, styles);\n  }\n\n  return {\n    // Validation functions\n    validateUsername,\n    validatePassword,\n    validateEmail,\n\n    // UI helper functions\n    setButtonLoading,\n    showError,\n    hideError,\n    clearForm,\n\n    // Event binding functions\n    bindFormSubmission,\n    bindInputValidation,\n\n    // Utility functions\n    extendProps,\n    applyStyles,\n\n    cleanup() {\n      _log('cleanup()');\n      eventHandlers.cleanupListeners({ context: 'authFormHandler' });\n    }\n  };\n}\n\nexport default createAuthFormHandler;\n"],"mappings":"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","ignoreList":[]}