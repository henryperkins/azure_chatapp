0b7a3da9d60c1b9ae329bb43dd2beced
"use strict";

var _appInitializer = require("../init/appInitializer.js");
/**
 * Regression test – ensures that a placeholder implementation for
 * `tokenStatsManager` is present in the DependencySystem **before** the
 * core bootstrap phase (specifically before `coreInit` would attempt to
 * resolve the dependency via `createMessageHandler`).  The placeholder is
 * provided by `tokenStatsManagerProxy` during the early DI setup inside
 * `createAppInitializer`.
 *
 * The test only executes the Basic & Advanced service registration phases
 * (matching the order that runs before `coreInit`).  It does **not** fully
 * initialize the app – keeping the scope minimal while still catching
 * regressions where the proxy registration might be removed or renamed.
 */

function createMockDependencySystem() {
  const DS = {
    modules: new Map(),
    register(key, value) {
      this.modules.set(key, value);
    }
  };
  return DS;
}
function createStubBrowserService({
  documentObject,
  windowObject
} = {}) {
  const win = windowObject ?? {
    DOMPurify: {},
    EventTarget: class {
      addEventListener() {}
      removeEventListener() {}
      dispatchEvent() {
        return false;
      }
    },
    setTimeout(fn) {
      if (typeof fn === 'function') fn();
      return 0;
    },
    clearTimeout() {},
    performance: {
      now: () => 0
    },
    URL: {
      createObjectURL: () => '',
      revokeObjectURL: () => ''
    },
    document: documentObject
  };
  const doc = documentObject ?? {
    readyState: 'complete',
    getElementById: () => null,
    querySelector: () => null,
    addEventListener: () => {},
    removeEventListener: () => {},
    createElement: () => ({
      style: {}
    }),
    body: {
      appendChild: () => {},
      removeChild: () => {}
    }
  };
  win.document = doc;
  return {
    getWindow: () => win,
    getDocument: () => doc,
    setTimeout: win.setTimeout,
    clearTimeout: win.clearTimeout
  };
}
function createStubApiEndpoints() {
  return {
    endpoints: {
      AUTH_CSRF: '/api/csrf',
      AUTH_LOGIN: '/api/login',
      AUTH_LOGOUT: '/api/logout',
      AUTH_REGISTER: '/api/register',
      AUTH_VERIFY: '/api/verify',
      AUTH_REFRESH: '/api/refresh'
    },
    resolveApiEndpoints: () => ({}),
    cleanup: () => {}
  };
}
test('tokenStatsManager placeholder exists before coreInit', async () => {
  const DependencySystem = createMockDependencySystem();
  const appInit = (0, _appInitializer.createAppInitializer)({
    DependencySystem,
    browserService: createStubBrowserService(),
    createChatManager: () => ({}),
    createApiEndpoints: () => createStubApiEndpoints(),
    APP_CONFIG: {
      TIMEOUTS: {
        DOM_READY: 1000
      }
    },
    MODAL_MAPPINGS: {}
    // The remaining optional config/factories are left undefined intentionally
  });

  // Execute only the DI service registration phases that precede coreInit
  await appInit.serviceInit.registerBasicServices();
  await appInit.serviceInit.registerAdvancedServices();
  expect(DependencySystem.modules.get('tokenStatsManager')).toBeDefined();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYXBwSW5pdGlhbGl6ZXIiLCJyZXF1aXJlIiwiY3JlYXRlTW9ja0RlcGVuZGVuY3lTeXN0ZW0iLCJEUyIsIm1vZHVsZXMiLCJNYXAiLCJyZWdpc3RlciIsImtleSIsInZhbHVlIiwic2V0IiwiY3JlYXRlU3R1YkJyb3dzZXJTZXJ2aWNlIiwiZG9jdW1lbnRPYmplY3QiLCJ3aW5kb3dPYmplY3QiLCJ3aW4iLCJET01QdXJpZnkiLCJFdmVudFRhcmdldCIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZGlzcGF0Y2hFdmVudCIsInNldFRpbWVvdXQiLCJmbiIsImNsZWFyVGltZW91dCIsInBlcmZvcm1hbmNlIiwibm93IiwiVVJMIiwiY3JlYXRlT2JqZWN0VVJMIiwicmV2b2tlT2JqZWN0VVJMIiwiZG9jdW1lbnQiLCJkb2MiLCJyZWFkeVN0YXRlIiwiZ2V0RWxlbWVudEJ5SWQiLCJxdWVyeVNlbGVjdG9yIiwiY3JlYXRlRWxlbWVudCIsInN0eWxlIiwiYm9keSIsImFwcGVuZENoaWxkIiwicmVtb3ZlQ2hpbGQiLCJnZXRXaW5kb3ciLCJnZXREb2N1bWVudCIsImNyZWF0ZVN0dWJBcGlFbmRwb2ludHMiLCJlbmRwb2ludHMiLCJBVVRIX0NTUkYiLCJBVVRIX0xPR0lOIiwiQVVUSF9MT0dPVVQiLCJBVVRIX1JFR0lTVEVSIiwiQVVUSF9WRVJJRlkiLCJBVVRIX1JFRlJFU0giLCJyZXNvbHZlQXBpRW5kcG9pbnRzIiwiY2xlYW51cCIsInRlc3QiLCJEZXBlbmRlbmN5U3lzdGVtIiwiYXBwSW5pdCIsImNyZWF0ZUFwcEluaXRpYWxpemVyIiwiYnJvd3NlclNlcnZpY2UiLCJjcmVhdGVDaGF0TWFuYWdlciIsImNyZWF0ZUFwaUVuZHBvaW50cyIsIkFQUF9DT05GSUciLCJUSU1FT1VUUyIsIkRPTV9SRUFEWSIsIk1PREFMX01BUFBJTkdTIiwic2VydmljZUluaXQiLCJyZWdpc3RlckJhc2ljU2VydmljZXMiLCJyZWdpc3RlckFkdmFuY2VkU2VydmljZXMiLCJleHBlY3QiLCJnZXQiLCJ0b0JlRGVmaW5lZCJdLCJzb3VyY2VzIjpbInRva2VuLXN0YXRzLWRpLnRlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBSZWdyZXNzaW9uIHRlc3Qg4oCTIGVuc3VyZXMgdGhhdCBhIHBsYWNlaG9sZGVyIGltcGxlbWVudGF0aW9uIGZvclxuICogYHRva2VuU3RhdHNNYW5hZ2VyYCBpcyBwcmVzZW50IGluIHRoZSBEZXBlbmRlbmN5U3lzdGVtICoqYmVmb3JlKiogdGhlXG4gKiBjb3JlIGJvb3RzdHJhcCBwaGFzZSAoc3BlY2lmaWNhbGx5IGJlZm9yZSBgY29yZUluaXRgIHdvdWxkIGF0dGVtcHQgdG9cbiAqIHJlc29sdmUgdGhlIGRlcGVuZGVuY3kgdmlhIGBjcmVhdGVNZXNzYWdlSGFuZGxlcmApLiAgVGhlIHBsYWNlaG9sZGVyIGlzXG4gKiBwcm92aWRlZCBieSBgdG9rZW5TdGF0c01hbmFnZXJQcm94eWAgZHVyaW5nIHRoZSBlYXJseSBESSBzZXR1cCBpbnNpZGVcbiAqIGBjcmVhdGVBcHBJbml0aWFsaXplcmAuXG4gKlxuICogVGhlIHRlc3Qgb25seSBleGVjdXRlcyB0aGUgQmFzaWMgJiBBZHZhbmNlZCBzZXJ2aWNlIHJlZ2lzdHJhdGlvbiBwaGFzZXNcbiAqIChtYXRjaGluZyB0aGUgb3JkZXIgdGhhdCBydW5zIGJlZm9yZSBgY29yZUluaXRgKS4gIEl0IGRvZXMgKipub3QqKiBmdWxseVxuICogaW5pdGlhbGl6ZSB0aGUgYXBwIOKAkyBrZWVwaW5nIHRoZSBzY29wZSBtaW5pbWFsIHdoaWxlIHN0aWxsIGNhdGNoaW5nXG4gKiByZWdyZXNzaW9ucyB3aGVyZSB0aGUgcHJveHkgcmVnaXN0cmF0aW9uIG1pZ2h0IGJlIHJlbW92ZWQgb3IgcmVuYW1lZC5cbiAqL1xuXG5pbXBvcnQgeyBjcmVhdGVBcHBJbml0aWFsaXplciB9IGZyb20gJy4uL2luaXQvYXBwSW5pdGlhbGl6ZXIuanMnO1xuXG5mdW5jdGlvbiBjcmVhdGVNb2NrRGVwZW5kZW5jeVN5c3RlbSgpIHtcbiAgY29uc3QgRFMgPSB7XG4gICAgbW9kdWxlczogbmV3IE1hcCgpLFxuICAgIHJlZ2lzdGVyKGtleSwgdmFsdWUpIHtcbiAgICAgIHRoaXMubW9kdWxlcy5zZXQoa2V5LCB2YWx1ZSk7XG4gICAgfVxuICB9O1xuICByZXR1cm4gRFM7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVN0dWJCcm93c2VyU2VydmljZSh7IGRvY3VtZW50T2JqZWN0LCB3aW5kb3dPYmplY3QgfSA9IHt9KSB7XG4gIGNvbnN0IHdpbiA9IHdpbmRvd09iamVjdCA/PyB7XG4gICAgRE9NUHVyaWZ5OiB7fSxcbiAgICBFdmVudFRhcmdldDogY2xhc3Mge1xuICAgICAgYWRkRXZlbnRMaXN0ZW5lcigpIHt9XG4gICAgICByZW1vdmVFdmVudExpc3RlbmVyKCkge31cbiAgICAgIGRpc3BhdGNoRXZlbnQoKSB7IHJldHVybiBmYWxzZTsgfVxuICAgIH0sXG4gICAgc2V0VGltZW91dChmbikgeyBpZiAodHlwZW9mIGZuID09PSAnZnVuY3Rpb24nKSBmbigpOyByZXR1cm4gMDsgfSxcbiAgICBjbGVhclRpbWVvdXQoKSB7fSxcbiAgICBwZXJmb3JtYW5jZTogeyBub3c6ICgpID0+IDAgfSxcbiAgICBVUkw6IHsgY3JlYXRlT2JqZWN0VVJMOiAoKSA9PiAnJywgcmV2b2tlT2JqZWN0VVJMOiAoKSA9PiAnJyB9LFxuICAgIGRvY3VtZW50IDogZG9jdW1lbnRPYmplY3RcbiAgfTtcblxuICBjb25zdCBkb2MgPSBkb2N1bWVudE9iamVjdCA/PyB7XG4gICAgcmVhZHlTdGF0ZTogJ2NvbXBsZXRlJyxcbiAgICBnZXRFbGVtZW50QnlJZDogKCkgPT4gbnVsbCxcbiAgICBxdWVyeVNlbGVjdG9yIDogKCkgPT4gbnVsbCxcbiAgICBhZGRFdmVudExpc3RlbmVyOiAoKSA9PiB7fSxcbiAgICByZW1vdmVFdmVudExpc3RlbmVyOiAoKSA9PiB7fSxcbiAgICBjcmVhdGVFbGVtZW50OiAoKSA9PiAoeyBzdHlsZToge30gfSksXG4gICAgYm9keTogeyBhcHBlbmRDaGlsZDogKCkgPT4ge30sIHJlbW92ZUNoaWxkOiAoKSA9PiB7fSB9XG4gIH07XG5cbiAgd2luLmRvY3VtZW50ID0gZG9jO1xuXG4gIHJldHVybiB7XG4gICAgZ2V0V2luZG93OiAoKSA9PiB3aW4sXG4gICAgZ2V0RG9jdW1lbnQ6ICgpID0+IGRvYyxcbiAgICBzZXRUaW1lb3V0OiB3aW4uc2V0VGltZW91dCxcbiAgICBjbGVhclRpbWVvdXQ6IHdpbi5jbGVhclRpbWVvdXRcbiAgfTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlU3R1YkFwaUVuZHBvaW50cygpIHtcbiAgcmV0dXJuIHtcbiAgICBlbmRwb2ludHM6IHtcbiAgICAgIEFVVEhfQ1NSRjogJy9hcGkvY3NyZicsXG4gICAgICBBVVRIX0xPR0lOOiAnL2FwaS9sb2dpbicsXG4gICAgICBBVVRIX0xPR09VVDogJy9hcGkvbG9nb3V0JyxcbiAgICAgIEFVVEhfUkVHSVNURVI6ICcvYXBpL3JlZ2lzdGVyJyxcbiAgICAgIEFVVEhfVkVSSUZZOiAnL2FwaS92ZXJpZnknLFxuICAgICAgQVVUSF9SRUZSRVNIOiAnL2FwaS9yZWZyZXNoJ1xuICAgIH0sXG4gICAgcmVzb2x2ZUFwaUVuZHBvaW50czogKCkgPT4gKHt9KSxcbiAgICBjbGVhbnVwOiAoKSA9PiB7fVxuICB9O1xufVxuXG50ZXN0KCd0b2tlblN0YXRzTWFuYWdlciBwbGFjZWhvbGRlciBleGlzdHMgYmVmb3JlIGNvcmVJbml0JywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCBEZXBlbmRlbmN5U3lzdGVtID0gY3JlYXRlTW9ja0RlcGVuZGVuY3lTeXN0ZW0oKTtcblxuICBjb25zdCBhcHBJbml0ID0gY3JlYXRlQXBwSW5pdGlhbGl6ZXIoe1xuICAgIERlcGVuZGVuY3lTeXN0ZW0sXG4gICAgYnJvd3NlclNlcnZpY2U6IGNyZWF0ZVN0dWJCcm93c2VyU2VydmljZSgpLFxuICAgIGNyZWF0ZUNoYXRNYW5hZ2VyOiAoKSA9PiAoe30pLFxuICAgIGNyZWF0ZUFwaUVuZHBvaW50czogKCkgPT4gY3JlYXRlU3R1YkFwaUVuZHBvaW50cygpLFxuICAgIEFQUF9DT05GSUc6IHtcbiAgICAgIFRJTUVPVVRTOiB7IERPTV9SRUFEWTogMTAwMCB9XG4gICAgfSxcbiAgICBNT0RBTF9NQVBQSU5HUzoge30sXG4gICAgLy8gVGhlIHJlbWFpbmluZyBvcHRpb25hbCBjb25maWcvZmFjdG9yaWVzIGFyZSBsZWZ0IHVuZGVmaW5lZCBpbnRlbnRpb25hbGx5XG4gIH0pO1xuXG4gIC8vIEV4ZWN1dGUgb25seSB0aGUgREkgc2VydmljZSByZWdpc3RyYXRpb24gcGhhc2VzIHRoYXQgcHJlY2VkZSBjb3JlSW5pdFxuICBhd2FpdCBhcHBJbml0LnNlcnZpY2VJbml0LnJlZ2lzdGVyQmFzaWNTZXJ2aWNlcygpO1xuICBhd2FpdCBhcHBJbml0LnNlcnZpY2VJbml0LnJlZ2lzdGVyQWR2YW5jZWRTZXJ2aWNlcygpO1xuXG4gIGV4cGVjdChEZXBlbmRlbmN5U3lzdGVtLm1vZHVsZXMuZ2V0KCd0b2tlblN0YXRzTWFuYWdlcicpKS50b0JlRGVmaW5lZCgpO1xufSk7XG4iXSwibWFwcGluZ3MiOiI7O0FBY0EsSUFBQUEsZUFBQSxHQUFBQyxPQUFBO0FBZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBSUEsU0FBU0MsMEJBQTBCQSxDQUFBLEVBQUc7RUFDcEMsTUFBTUMsRUFBRSxHQUFHO0lBQ1RDLE9BQU8sRUFBRSxJQUFJQyxHQUFHLENBQUMsQ0FBQztJQUNsQkMsUUFBUUEsQ0FBQ0MsR0FBRyxFQUFFQyxLQUFLLEVBQUU7TUFDbkIsSUFBSSxDQUFDSixPQUFPLENBQUNLLEdBQUcsQ0FBQ0YsR0FBRyxFQUFFQyxLQUFLLENBQUM7SUFDOUI7RUFDRixDQUFDO0VBQ0QsT0FBT0wsRUFBRTtBQUNYO0FBRUEsU0FBU08sd0JBQXdCQSxDQUFDO0VBQUVDLGNBQWM7RUFBRUM7QUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUU7RUFDdkUsTUFBTUMsR0FBRyxHQUFHRCxZQUFZLElBQUk7SUFDMUJFLFNBQVMsRUFBRSxDQUFDLENBQUM7SUFDYkMsV0FBVyxFQUFFLE1BQU07TUFDakJDLGdCQUFnQkEsQ0FBQSxFQUFHLENBQUM7TUFDcEJDLG1CQUFtQkEsQ0FBQSxFQUFHLENBQUM7TUFDdkJDLGFBQWFBLENBQUEsRUFBRztRQUFFLE9BQU8sS0FBSztNQUFFO0lBQ2xDLENBQUM7SUFDREMsVUFBVUEsQ0FBQ0MsRUFBRSxFQUFFO01BQUUsSUFBSSxPQUFPQSxFQUFFLEtBQUssVUFBVSxFQUFFQSxFQUFFLENBQUMsQ0FBQztNQUFFLE9BQU8sQ0FBQztJQUFFLENBQUM7SUFDaEVDLFlBQVlBLENBQUEsRUFBRyxDQUFDLENBQUM7SUFDakJDLFdBQVcsRUFBRTtNQUFFQyxHQUFHLEVBQUVBLENBQUEsS0FBTTtJQUFFLENBQUM7SUFDN0JDLEdBQUcsRUFBRTtNQUFFQyxlQUFlLEVBQUVBLENBQUEsS0FBTSxFQUFFO01BQUVDLGVBQWUsRUFBRUEsQ0FBQSxLQUFNO0lBQUcsQ0FBQztJQUM3REMsUUFBUSxFQUFHaEI7RUFDYixDQUFDO0VBRUQsTUFBTWlCLEdBQUcsR0FBR2pCLGNBQWMsSUFBSTtJQUM1QmtCLFVBQVUsRUFBRSxVQUFVO0lBQ3RCQyxjQUFjLEVBQUVBLENBQUEsS0FBTSxJQUFJO0lBQzFCQyxhQUFhLEVBQUdBLENBQUEsS0FBTSxJQUFJO0lBQzFCZixnQkFBZ0IsRUFBRUEsQ0FBQSxLQUFNLENBQUMsQ0FBQztJQUMxQkMsbUJBQW1CLEVBQUVBLENBQUEsS0FBTSxDQUFDLENBQUM7SUFDN0JlLGFBQWEsRUFBRUEsQ0FBQSxNQUFPO01BQUVDLEtBQUssRUFBRSxDQUFDO0lBQUUsQ0FBQyxDQUFDO0lBQ3BDQyxJQUFJLEVBQUU7TUFBRUMsV0FBVyxFQUFFQSxDQUFBLEtBQU0sQ0FBQyxDQUFDO01BQUVDLFdBQVcsRUFBRUEsQ0FBQSxLQUFNLENBQUM7SUFBRTtFQUN2RCxDQUFDO0VBRUR2QixHQUFHLENBQUNjLFFBQVEsR0FBR0MsR0FBRztFQUVsQixPQUFPO0lBQ0xTLFNBQVMsRUFBRUEsQ0FBQSxLQUFNeEIsR0FBRztJQUNwQnlCLFdBQVcsRUFBRUEsQ0FBQSxLQUFNVixHQUFHO0lBQ3RCVCxVQUFVLEVBQUVOLEdBQUcsQ0FBQ00sVUFBVTtJQUMxQkUsWUFBWSxFQUFFUixHQUFHLENBQUNRO0VBQ3BCLENBQUM7QUFDSDtBQUVBLFNBQVNrQixzQkFBc0JBLENBQUEsRUFBRztFQUNoQyxPQUFPO0lBQ0xDLFNBQVMsRUFBRTtNQUNUQyxTQUFTLEVBQUUsV0FBVztNQUN0QkMsVUFBVSxFQUFFLFlBQVk7TUFDeEJDLFdBQVcsRUFBRSxhQUFhO01BQzFCQyxhQUFhLEVBQUUsZUFBZTtNQUM5QkMsV0FBVyxFQUFFLGFBQWE7TUFDMUJDLFlBQVksRUFBRTtJQUNoQixDQUFDO0lBQ0RDLG1CQUFtQixFQUFFQSxDQUFBLE1BQU8sQ0FBQyxDQUFDLENBQUM7SUFDL0JDLE9BQU8sRUFBRUEsQ0FBQSxLQUFNLENBQUM7RUFDbEIsQ0FBQztBQUNIO0FBRUFDLElBQUksQ0FBQyxzREFBc0QsRUFBRSxZQUFZO0VBQ3ZFLE1BQU1DLGdCQUFnQixHQUFHaEQsMEJBQTBCLENBQUMsQ0FBQztFQUVyRCxNQUFNaUQsT0FBTyxHQUFHLElBQUFDLG9DQUFvQixFQUFDO0lBQ25DRixnQkFBZ0I7SUFDaEJHLGNBQWMsRUFBRTNDLHdCQUF3QixDQUFDLENBQUM7SUFDMUM0QyxpQkFBaUIsRUFBRUEsQ0FBQSxNQUFPLENBQUMsQ0FBQyxDQUFDO0lBQzdCQyxrQkFBa0IsRUFBRUEsQ0FBQSxLQUFNaEIsc0JBQXNCLENBQUMsQ0FBQztJQUNsRGlCLFVBQVUsRUFBRTtNQUNWQyxRQUFRLEVBQUU7UUFBRUMsU0FBUyxFQUFFO01BQUs7SUFDOUIsQ0FBQztJQUNEQyxjQUFjLEVBQUUsQ0FBQztJQUNqQjtFQUNGLENBQUMsQ0FBQzs7RUFFRjtFQUNBLE1BQU1SLE9BQU8sQ0FBQ1MsV0FBVyxDQUFDQyxxQkFBcUIsQ0FBQyxDQUFDO0VBQ2pELE1BQU1WLE9BQU8sQ0FBQ1MsV0FBVyxDQUFDRSx3QkFBd0IsQ0FBQyxDQUFDO0VBRXBEQyxNQUFNLENBQUNiLGdCQUFnQixDQUFDOUMsT0FBTyxDQUFDNEQsR0FBRyxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLENBQUM7QUFDekUsQ0FBQyxDQUFDIiwiaWdub3JlTGlzdCI6W119