{"version":3,"names":["_globalUtils","require","createEventHandlers","app","projectManager","modalManager","DependencySystem","domAPI","browserService","APP_CONFIG","navigate","storage","logger","errorReporter","safeHandler","domReadinessService","Error","MODULE","_domReadinessService","setDomReadinessService","svc","setEventHandlers","eventHandlerAPI","setLogger","newLogger","setSafeHandler","newSH","SH","setErrorReporter","newER","resolveSafeHandler","debug","version","appInjected","context","_projectManager","authButtonDelegationBound","storageBackend","redirect","url","setLocation","trackedListeners","Map","PRIORITY","HIGH","NORMAL","LOW","trackListener","element","type","handler","options","addEventListener","undefined","capture","once","signal","passive","nonPassive","finalOpts","includes","elMap","get","typeMap","has","set","remove","wrapped","evt","call","_wrappedOnce","a","setTimeout","untrackListener","err","error","wrappedHandler","toggleVisible","elementSelectorOrElement","show","querySelector","globalToggleElement","togglePanelFactory","panel","toggleButton","chevron","toggleId","onExpand","togglePanel","expand","toggleClass","setStyle","setAttribute","String","setItem","setupCollapsible","panelId","chevronId","getElementById","savedState","getItem","handleCollapsibleClick","isCurrentlyExpanded","getAttribute","description","module","source","makeModalOpenHandler","modal","modalId","onOpen","open","showModal","removeClass","makeModalCloseHandler","onClose","close","hide","addClass","removeAttribute","setupModal","openBtnId","closeBtnId","openBtn","closeBtn","handleModalEscClose","e","key","handleModalBackdropClick","isSameNode","target","setupForm","formId","submitHandler","form","validateBeforeSubmit","showLoadingState","resetOnSuccess","handleSubmit","preventDefault","hasClass","checkFormValidity","reportFormValidity","submitBtn","setProperty","setDataAttribute","getTextContent","setTextContent","FormData","formData","resetForm","onError","id","originalText","getDataAttribute","removeDataAttribute","setupCommonElements","darkModeToggle","handleDarkModeToggleClick","getDocument","documentElement","isDark","setupNavigationElements","navLinks","querySelectorAll","forEach","link","handleNavLinkClick","href","setupProjectModalForm","formEl","pm","warn","handleProjectFormSubmit","data","Object","fromEntries","entries","name","trim","max_tokens","maxTokens","parseInt","projectName","nameEl","value","saveProject","projectId","loadProjects","handleProjectFormError","setupContentElements","collapsibleToggles","toggle","getId","el","elementMap","details","removeEventListener","delete","size","report","fn","cleanupListeners","cleanupContext","targetFilter","entriesToRemove","originalHandler","push","delegate","container","eventType","selector","delegatedHandler","delegatedEventHandler","event","closest","setupLoginModalTabs","loginModal","handleLoginTabClick","tabElement","registerTabElement","loginPanel","registerPanel","handleRegisterTabClick","loginTabElement","classList","createCustomEvent","windowObject","getWindow","CustomEvent","dispatch","detail","bubbles","tgt","document","dispatchEvent","cleanup","debounce","globalDebounce","setProjectManager","getActiveListenerCount","initialized","init","dependencyWaitTimeout","TIMEOUTS","DEPENDENCY_WAIT","documentReady","dependenciesAndElements","deps","domSelectors","timeout","elementsReady","then","info","catch","bindAuthButtonDelegate","parentNode","parentNodeExists","handleAuthButtonClick","_element","mm","handleRequestLogin","handleModalsLoaded","childElementCount"],"sources":["eventHandler.js"],"sourcesContent":["/**\n * @module eventHandler\n * @description DI-strict, orchestrated UI event utility collection. Manages tracked event listeners\n * and provides common UI setup helpers like forms, modals, and collapsibles.\n * All notifications use the injected `notify` utility. No direct console or global DOM/Window access.\n *\n * @param {Object} deps - Dependencies injected via DI.\n * @param {Object} deps.app - Core application reference (optional, for app-specific logic like redirects).\n * @param {Object} deps.projectManager - Project Manager reference (optional, for project actions).\n * @param {Object} deps.modalManager - Modal Manager reference (optional, for modal actions).\n * @param {Object} deps.DependencySystem - Required. DI registry.\n * @param {Object} deps.domAPI - Required. DOM abstraction layer.\n * @param {Object} deps.browserService - Required. Browser abstraction (URL, storage, etc.).\n * @param {Object} deps.notify - Required. Context-aware notification utility.\n * @param {Object} deps.APP_CONFIG - Required. Application configuration object.\n * @param {Function} [deps.navigate] - Optional navigation function override.\n * @param {Object} [deps.storage] - Optional storage abstraction override (usually from browserService).\n * @param {Object} deps.errorReporter - Required error logging utility.\n * @param {Object} deps.logger - Required logging utility.\n * @param {Object} [deps.domReadinessService] - Readiness service (use setter for DI circularity).\n * @param {Object} [deps.timeAPI] - Optional timing API (defaults to performance.now).\n * @returns {Object} Event handler API { trackListener, cleanupListeners, delegate, etc. }\n */\n\nimport { debounce as globalDebounce, toggleElement as globalToggleElement } from './utils/globalUtils.js';\n\nexport function createEventHandlers({\n  app,\n  projectManager,\n  modalManager,\n  DependencySystem,\n  domAPI,\n  browserService,\n  APP_CONFIG,\n  navigate,\n  storage,\n  logger,           // STRICT: must be provided via DI\n  errorReporter,    // STRICT: must be provided via DI\n  safeHandler,      // NEW – canonical wrapper (required)\n  domReadinessService // Optional, but if provided, must be validated\n} = {}) {\n  // === Dependency validation block (must be at the very top for pattern checker) ===\n  if (!DependencySystem) {\n    throw new Error('[eventHandler] Missing DependencySystem');\n  }\n  if (!domAPI) {\n    throw new Error('[eventHandler] Missing domAPI');\n  }\n  if (!browserService) {\n    throw new Error('[eventHandler] Missing browserService');\n  }\n  if (!APP_CONFIG) {\n    throw new Error('[eventHandler] Missing APP_CONFIG');\n  }\n  if (!logger)\n    throw new Error('[eventHandler] Missing logger dependency');\n  if (!errorReporter) {\n    throw new Error('[eventHandler] Missing errorReporter');\n  }\n  // domReadinessService is optional at factory, but required at init\n  // ================================================================\n  const MODULE = 'EventHandler';\n  let _domReadinessService = domReadinessService || null;\n  function setDomReadinessService(svc) {\n    _domReadinessService = svc;\n    // Break circular dependency: inform domReadinessService about EventHandlers\n    if (svc?.setEventHandlers) {\n      svc.setEventHandlers(eventHandlerAPI);\n    }\n  }\n  function setLogger(newLogger)      { if (newLogger) logger = newLogger; }\n  function setSafeHandler(newSH)     { if (typeof newSH === 'function') SH = newSH; }\n\n  /* allow late upgrade once the real errorReporter exists */\n  function setErrorReporter(newER)   { if (newER) errorReporter = newER; }\n\n  // --- safeHandler canonical dependency check ---\n  let   SH = null;\n  function resolveSafeHandler() {\n    if (SH && typeof SH === 'function') return SH;\n    if (typeof safeHandler === 'function') {\n      SH = safeHandler;\n      return SH;\n    }\n    // Phase-1 compliance: do NOT attempt runtime DI lookup\n    throw new Error('[eventHandler] safeHandler dependency missing – must be injected via factory');\n  }\n\n  logger.debug('[EventHandler] Factory initialized', {\n    MODULE,\n    version: '1.0',\n    appInjected: !!app,\n    context: MODULE\n  });\n  // We allow dynamic injection/update of projectManager\n  let _projectManager = projectManager;\n\n  // Singleton flags, preventing duplicate setup\n  let authButtonDelegationBound = false;\n\n  // Storage fallback\n  const storageBackend = storage || browserService;\n\n  function redirect(url) {\n    if (typeof navigate === 'function') {\n      navigate(url);\n    } else if (app && typeof app.navigate === 'function') {\n      app.navigate(url);\n    } else if (browserService && typeof browserService.setLocation === 'function') {\n      browserService.setLocation(url);\n    }\n  }\n\n  const trackedListeners = new Map();\n  const PRIORITY = { HIGH: 1, NORMAL: 5, LOW: 10 };\n\n  /**\n   * Central method to attach an event listener with bookkeeping for cleanup.\n   * @param {HTMLElement} element\n   * @param {string} type\n   * @param {Function} handler\n   * @param {Object} options\n   * @returns {Function|undefined} The wrapped handler, or undefined on failure\n   */\n  function trackListener(element, type, handler, options = {}) {\n    if (!element || typeof element.addEventListener !== 'function') return undefined;\n\n    const { capture = false, once = false, signal, passive } = options;\n    const nonPassive = ['click', 'submit', 'wheel', 'touchstart', 'touchmove', 'keydown', 'keypress', 'keyup'];\n    const finalOpts = { capture, once, signal, passive: typeof passive === 'boolean' ? passive : !nonPassive.includes(type) };\n\n    // bookkeeping (prevents duplicates)\n    const elMap = trackedListeners.get(element) || new Map();\n    const typeMap = elMap.get(type) || new Map();\n    if (!trackedListeners.has(element)) trackedListeners.set(element, elMap);\n    if (!elMap.has(type)) elMap.set(type, typeMap);\n    if (typeMap.has(handler))\n      return typeMap.get(handler).remove;        // always hand back the “unsubscribe”\n\n    let wrapped = (evt) => handler.call(element, evt);\n\n    if (finalOpts.once) {\n      // make sure our internal maps don’t leak after the handler fires\n      const _wrappedOnce = wrapped;\n      wrapped = (...a) => {\n        try { _wrappedOnce(...a); } finally {\n          // remove record from bookkeeping maps\n          browserService.setTimeout(() => untrackListener(element, type, handler), 0);\n        }\n      };\n    }\n\n    // domAPI is a required dependency, so domAPI.addEventListener should always be used.\n    domAPI.addEventListener(element, type, wrapped, finalOpts);\n\n    const remove = () => {               // función de des-registro\n      try {\n        untrackListener(element, type, handler);\n      } catch (err) {\n        logger.error(`[${MODULE}][trackListener][remove] Failed to untrackListener`, err, { context: MODULE, element, type });\n      }\n    };\n\n    typeMap.set(handler, {\n      wrappedHandler: wrapped,\n      options: finalOpts,\n      context: options.context,\n      remove: remove          // <- new\n    });\n\n    return remove;                       // ← now returns the “unsubscribe” function\n  }\n\n\n  function toggleVisible(elementSelectorOrElement, show) {\n    const element =\n      typeof elementSelectorOrElement === 'string'\n        ? domAPI.querySelector(elementSelectorOrElement)\n        : elementSelectorOrElement;\n    return globalToggleElement(element, show, domAPI);\n  }\n\n  // ---------------------- HANDLER ANONYMITY REMEDIATION: NAMED FUNCS ----------------------------------\n\n  function togglePanelFactory({ panel, toggleButton, chevron, toggleId, storageBackend, domAPI, onExpand }) {\n    return function togglePanel(expand) {\n      domAPI.toggleClass(panel, 'hidden', !expand);\n      if (chevron) domAPI.setStyle(chevron, 'transform', expand ? 'rotate(180deg)' : 'rotate(0deg)');\n      domAPI.setAttribute(toggleButton, 'aria-expanded', String(expand));\n\n      if (expand && typeof onExpand === 'function') {\n        onExpand();\n      }\n      if (toggleId && storageBackend?.setItem) {\n        storageBackend.setItem(`${toggleId}_expanded`, String(expand));\n      }\n    };\n  }\n\n  function setupCollapsible(toggleId, panelId, chevronId, onExpand) {\n    const toggleButton = domAPI.getElementById(toggleId);\n    const panel = domAPI.getElementById(panelId);\n    const chevron = chevronId ? domAPI.getElementById(chevronId) : null;\n\n    if (!toggleButton || !panel) {\n      return;\n    }\n\n    domAPI.setAttribute(toggleButton, 'role', 'button');\n    domAPI.setAttribute(toggleButton, 'aria-controls', panelId);\n    domAPI.setAttribute(toggleButton, 'aria-expanded', 'false');\n\n    const togglePanel = togglePanelFactory({ panel, toggleButton, chevron, toggleId, storageBackend, domAPI, onExpand });\n\n    let savedState = null;\n    if (toggleId && storageBackend?.getItem) {\n      savedState = storageBackend.getItem(`${toggleId}_expanded`);\n    }\n    togglePanel(savedState === 'true');\n\n    // Named handler for collapsible toggle\n    function handleCollapsibleClick() {\n      const isCurrentlyExpanded = domAPI.getAttribute(toggleButton, 'aria-expanded') === 'true';\n      togglePanel(!isCurrentlyExpanded);\n    }\n\n    trackListener(\n      toggleButton,\n      'click',\n      resolveSafeHandler()(handleCollapsibleClick, `EventHandler:Collapsible:${toggleId}`),\n      { description: `Toggle Collapsible ${toggleId}`, module: MODULE, context: 'collapsible', source: 'setupCollapsible' }\n    );\n  }\n\n  // MODAL HANDLERS: All moved to named functions with safeHandler wrapping\n\n  function makeModalOpenHandler(modal, modalId, onOpen, SH, modalManager, domAPI) {\n    return function open() {\n      if (typeof onOpen === 'function') {\n        SH(onOpen, `EventHandler:setupModal:onOpen`)(modal);\n      }\n      if (modalManager?.show) {\n        modalManager.show(modalId);\n      } else if (typeof modal.showModal === 'function') {\n        modal.showModal();\n      } else {\n        domAPI.removeClass(modal, 'hidden');\n        domAPI.setAttribute(modal, 'open', 'true');\n      }\n    };\n  }\n\n  function makeModalCloseHandler(modal, modalId, onClose, SH, modalManager, domAPI) {\n    return function close() {\n      if (modalManager?.hide) {\n        modalManager.hide(modalId);\n      } else if (typeof modal.close === 'function') {\n        modal.close();\n      } else {\n        domAPI.addClass(modal, 'hidden');\n        domAPI.removeAttribute(modal, 'open');\n      }\n      if (typeof onClose === 'function') {\n        SH(onClose, `EventHandler:setupModal:onClose`)(modal);\n      }\n    };\n  }\n\n  function setupModal(modalId, openBtnId, closeBtnId, onOpen, onClose) {\n    const modal = domAPI.getElementById(modalId);\n    const openBtn = openBtnId ? domAPI.getElementById(openBtnId) : null;\n    const closeBtn = closeBtnId ? domAPI.getElementById(closeBtnId) : null;\n\n    if (!modal) {\n      return { open: () => { }, close: () => { } };\n    }\n\n    const open = makeModalOpenHandler(modal, modalId, onOpen, SH, modalManager, domAPI);\n    const close = makeModalCloseHandler(modal, modalId, onClose, SH, modalManager, domAPI);\n\n    // ESC close named handler\n    function handleModalEscClose(e) {\n      if (e.key === 'Escape') close();\n    }\n    // backdrop click close named handler\n    function handleModalBackdropClick(e) {\n      if (domAPI.isSameNode(e.target, modal)) close();\n    }\n\n    // Handlers for buttons\n    if (openBtn) {\n      trackListener(openBtn, 'click', resolveSafeHandler()(open, `EventHandler:setupModal:open`), {\n        description: `Open Modal ${modalId}`,\n        module: MODULE,\n        context: 'modal',\n        source: 'setupModal'\n      });\n    }\n    if (closeBtn) {\n      trackListener(closeBtn, 'click', resolveSafeHandler()(close, `EventHandler:setupModal:closeBtn`), {\n        description: `Close Modal ${modalId} via Button`,\n        module: MODULE,\n        context: 'modal',\n        source: 'setupModal'\n      });\n    }\n\n    trackListener(\n      modal,\n      'keydown',\n      resolveSafeHandler()(handleModalEscClose, `EventHandler:setupModal:keydown`),\n      { description: `Modal ESC Close ${modalId}`, module: MODULE, context: 'modal', source: 'setupModal' }\n    );\n\n    trackListener(\n      modal,\n      'click',\n      resolveSafeHandler()(handleModalBackdropClick, `EventHandler:setupModal:backdropClick`),\n      { description: `Modal Backdrop Close ${modalId}`, module: MODULE, context: 'modal', source: 'setupModal' }\n    );\n\n    return { open, close };\n  }\n\n  // FORM HANDLERS\n\n  function setupForm(formId, submitHandler, options = {}) {\n    const form = domAPI.getElementById(formId);\n    if (!form) {\n      return;\n    }\n\n    const { validateBeforeSubmit = true, showLoadingState = true, resetOnSuccess = true } = options;\n\n    // Named handler for form submit\n    async function handleSubmit(e) {\n      domAPI.preventDefault(e); // Use domAPI to avoid direct event calls\n      if (domAPI.hasClass(form, 'submitting')) return;\n\n      if (validateBeforeSubmit) {\n        if (!domAPI.checkFormValidity(form)) {\n          domAPI.reportFormValidity(form);\n          return;\n        }\n      }\n\n      const submitBtn = domAPI.querySelector('[type=\"submit\"]', form);\n      if (showLoadingState && submitBtn) {\n        domAPI.addClass(form, 'submitting');\n        domAPI.setProperty(submitBtn, 'disabled', true);\n        domAPI.setDataAttribute(submitBtn, 'originalText', domAPI.getTextContent(submitBtn));\n        domAPI.setTextContent(submitBtn, 'Submitting...');\n      }\n\n      try {\n        if (!browserService?.FormData)\n          throw new Error('[EventHandler][setupForm] browserService.FormData unavailable (strict DI)');\n        const formData = new browserService.FormData(form);\n        await SH(submitHandler, 'EventHandler:setupForm:submitHandler')(formData, form);\n        if (resetOnSuccess) {\n          domAPI.resetForm(form);\n        }\n      } catch (error) {\n        if (options.onError) {\n          try {\n            SH(options.onError, 'EventHandler:setupForm:onError')(error);\n          } catch (err) {\n            logger.error(`[${MODULE}][setupForm][handleSubmit][onError]`, err, {\n              context: 'form-submit',\n              formId: form?.id || formId\n            });\n          }\n        }\n        logger.error(`[${MODULE}][setupForm][handleSubmit]`, error, {\n          context: 'form-submit',\n          formId: form?.id || formId\n        });\n      } finally {\n        if (showLoadingState) {\n          domAPI.removeClass(form, 'submitting');\n          if (submitBtn) {\n            domAPI.setProperty(submitBtn, 'disabled', false);\n            const originalText = domAPI.getDataAttribute(submitBtn, 'originalText');\n            if (originalText) {\n              domAPI.setTextContent(submitBtn, originalText);\n              domAPI.removeDataAttribute(submitBtn, 'originalText');\n            }\n          }\n        }\n      }\n    }\n\n    trackListener(form, 'submit', resolveSafeHandler()(handleSubmit, 'EventHandler:setupForm:handleSubmit'), {\n      passive: false,\n      description: `Form Submit ${formId}`,\n      module: MODULE,\n      context: 'form',\n      source: 'setupForm'\n    });\n  }\n\n  // COMMON ELEMENTS\n\n  function setupCommonElements() {\n    const darkModeToggle = domAPI.getElementById('darkModeToggle');\n    if (darkModeToggle && !domAPI.getDataAttribute(darkModeToggle, 'ehBound')) {\n      function handleDarkModeToggleClick() {\n        domAPI.toggleClass(domAPI.getDocument().documentElement, 'dark');\n        const isDark = domAPI.hasClass(domAPI.getDocument().documentElement, 'dark');\n        storageBackend.setItem('darkMode', isDark ? 'true' : 'false');\n      }\n      trackListener(\n        darkModeToggle,\n        'click',\n        resolveSafeHandler()(handleDarkModeToggleClick, 'EventHandler:setupCommonElements:DarkModeToggleClick'),\n        { description: 'Dark Mode Toggle', module: MODULE, context: 'ui', source: 'setupCommonElements' }\n      );\n      domAPI.setDataAttribute(darkModeToggle, 'ehBound', '1'); // marca como enlazado\n      // Initial dark mode state\n      if (storageBackend.getItem('darkMode') === 'true') {\n        domAPI.addClass(domAPI.getDocument().documentElement, 'dark');\n      }\n    }\n  }\n\n  // NAVIGATION ELEMENTS\n\n  function setupNavigationElements() {\n    const navLinks = domAPI.querySelectorAll('.nav-link');\n    navLinks.forEach((link) => {\n      if (!domAPI.getDataAttribute(link, 'ehBound')) {\n        function handleNavLinkClick(e) {\n          domAPI.preventDefault(e);\n          const href = domAPI.getAttribute(link, 'href');\n          if (href) redirect(href);\n        }\n        trackListener(\n          link,\n          'click',\n          resolveSafeHandler()(handleNavLinkClick, `EventHandler:setupNavigationElements:NavLink:${domAPI.getAttribute(link, 'href') || 'unknown'}`),\n          {\n            description: `Navigation Link: ${domAPI.getAttribute(link, 'href') || 'unknown'}`,\n            module: MODULE,\n            context: 'navigation',\n            source: 'setupNavigationElements'\n          }\n        );\n        domAPI.setDataAttribute(link, 'ehBound', '1');\n      }\n    });\n  }\n\n  // PROJECT MODAL FORM\n\n  function setupProjectModalForm() {\n    const formEl = domAPI.getElementById('projectModalForm');\n    /* Prevent duplicate listener registration which led to multiple\n       submissions and validation errors after the first successful save. */\n    if (!formEl || domAPI.getDataAttribute(formEl, 'ehBound')) {\n      return; // Already bound or element missing\n    }\n    const pm = _projectManager;\n    if (!pm) {\n      logger.warn('[EventHandler] projectManager not injected – skipping project modal form setup.', { context: MODULE });\n      return;\n    }\n    async function handleProjectFormSubmit(formData, form) {\n      const data = Object.fromEntries(formData.entries());\n      // Normalise inputs -------------------------------------------------\n      if (typeof data.name === 'string') data.name = data.name.trim();\n      /*\n       * Back-compat: the HTML form was recently updated to use the camel-case\n       * field name `maxTokens` instead of the original snake-case\n       * `max_tokens`.  Accept either version so the handler keeps working even\n       * if only one of them is present.\n       */\n      if (data.max_tokens == null && data.maxTokens != null) {\n        data.max_tokens = data.maxTokens; // normalise to the original API field\n      }\n\n      if (data.max_tokens) {\n        data.max_tokens = parseInt(data.max_tokens, 10);\n      }\n      // Normalise project name (support `projectName` alias used in older HTML)\n      if (data.name == null && typeof data.projectName === 'string') {\n        data.name = data.projectName;\n      }\n\n      /* Safari quirk / dynamic DOM manipulation guard  \n         There are edge-cases where the <input name=\"name\"> element exists in\n         the form but its value is not picked up by `new FormData(form)` – for\n         instance when the element is temporarily removed/disabled by a\n         validation plugin just before the submit event bubbles.  As an extra\n         safety-net we read the current value from the DOM when FormData missed\n         it. */\n      if (!data.name) {\n        const nameEl = form?.querySelector?.('#projectModalNameInput');\n        if (nameEl && typeof nameEl.value === 'string') {\n          data.name = nameEl.value.trim();\n        }\n      }\n\n      // Validation -------------------------------------------------------\n      if (!data.name) {\n        throw new Error('Project name is required.');\n      }\n      await pm.saveProject(data.projectId, data);\n      modalManager?.hide?.('project');\n      pm.loadProjects?.('all');\n    }\n    function handleProjectFormError(err) {\n      logger.error(`[${MODULE}][setupProjectModalForm] Error in project form submit`, err, { context: 'projectModalForm' });\n    }\n    setupForm(\n      'projectModalForm',\n      handleProjectFormSubmit,\n      {\n        resetOnSuccess: true,\n        onError: handleProjectFormError\n      }\n    );\n    // Mark as bound to avoid double registration\n    domAPI.setDataAttribute(formEl, 'ehBound', '1');\n  }\n\n  // CONTENT ELEMENTS\n\n  function setupContentElements() {\n    const collapsibleToggles = domAPI.querySelectorAll('[data-collapsible-toggle]');\n    collapsibleToggles.forEach((toggle) => {\n      const panelId = domAPI.getDataAttribute(toggle, 'collapsible-toggle');\n      const chevronId = domAPI.getDataAttribute(toggle, 'collapsible-chevron');\n      if (panelId) {\n        setupCollapsible(domAPI.getId(toggle) || `gen-toggle-${panelId}`, panelId, chevronId);\n      }\n    });\n  }\n\n  function untrackListener(el, evt, handler) {\n    const elementMap = trackedListeners.get(el);\n    if (!elementMap) return;\n    const typeMap = elementMap.get(evt);\n    if (!typeMap || !typeMap.has(handler)) return;\n\n    const details = typeMap.get(handler);\n    try {\n      if (details.options.once &&\n        !(el && el.removeEventListener)) {\n        /* already auto-removed by the browser – just delete maps */\n        typeMap.delete(handler);\n        if (typeMap.size === 0) elementMap.delete(evt);\n        if (elementMap.size === 0) trackedListeners.delete(el);\n        return;\n      }\n      // domAPI is a required dependency, so domAPI.removeEventListener should always be used.\n      domAPI.removeEventListener(el, evt, details.wrappedHandler, details.options);\n      typeMap.delete(handler);\n      if (typeMap.size === 0) elementMap.delete(evt);\n      if (elementMap.size === 0) trackedListeners.delete(el);\n    } catch (error) {\n      logger.error(`[${MODULE}][untrackListener] Failed to remove event listener`, error, {\n        element: el,\n        evt,\n        handler,\n        context: details.context\n      });\n      errorReporter.report?.(error, { module: MODULE, evt, fn: 'untrackListener' });\n    }\n  }\n\n  function cleanupListeners(options = {}) {\n    const { context: cleanupContext, target: targetFilter } = options;\n\n    const entriesToRemove = [];\n\n    trackedListeners.forEach((elementMap, element) => {\n      if (targetFilter && element !== targetFilter) return;\n      elementMap.forEach((typeMap, type) => {\n        typeMap.forEach((details, originalHandler) => {\n          if (!cleanupContext || details.context === cleanupContext) {\n            try {\n              // domAPI is a required dependency, so domAPI.removeEventListener should always be used.\n              domAPI.removeEventListener(element, type, details.wrappedHandler, details.options);\n              entriesToRemove.push({ element, type, originalHandler });\n            } catch (error) {\n              logger.error(`[${MODULE}][cleanupListeners] Error removing event listener`, error, {\n                element, type, details, context: cleanupContext\n              });\n              errorReporter.report?.(error, { module: MODULE, evt: type, fn: 'cleanupListeners', context: cleanupContext });\n            }\n          }\n        });\n      });\n    });\n\n    // Remove them from the map\n    entriesToRemove.forEach(({ element, type, originalHandler }) => {\n      const elementMap = trackedListeners.get(element);\n      if (elementMap) {\n        const typeMap = elementMap.get(type);\n        if (typeMap) {\n          typeMap.delete(originalHandler);\n          if (typeMap.size === 0) {\n            elementMap.delete(type);\n          }\n        }\n        if (elementMap.size === 0) {\n          trackedListeners.delete(element);\n        }\n      }\n    });\n  }\n\n  // DELEGATE: make sure delegate handler is always a named const for remediation\n  function delegate(container, eventType, selector, handler, options = {}) {\n    const delegatedHandler = function delegatedEventHandler(event) {\n      const target = domAPI.closest(event.target, selector);\n      if (target) {\n        handler.call(target, event, target);\n      }\n    };\n    return trackListener(container, eventType, SH(delegatedHandler, `EventHandler:delegate:${eventType}:${selector}`), {\n      ...options,\n      description: options.description || `Delegate ${eventType} on ${selector}`,\n      context: options.context || MODULE,\n      module: options.module || MODULE,\n      source: options.source || 'delegate'\n    });\n  }\n\n  // login-modal tab handlers as named functions\n  function setupLoginModalTabs() {\n    const loginModal = domAPI.getElementById('loginModal');\n    if (!loginModal) {\n      return;\n    }\n\n    function handleLoginTabClick(event, tabElement) {\n      const registerTabElement = domAPI.querySelector(loginModal, '#modalRegisterTab');\n      const loginPanel = domAPI.querySelector(loginModal, '#loginPanel');\n      const registerPanel = domAPI.querySelector(loginModal, '#registerPanel');\n      if (!registerTabElement || !loginPanel || !registerPanel) {\n        return;\n      }\n      domAPI.addClass(tabElement, 'tab-active');\n      domAPI.setAttribute(tabElement, 'aria-selected', 'true');\n      domAPI.removeClass(registerTabElement, 'tab-active');\n      domAPI.setAttribute(registerTabElement, 'aria-selected', 'false');\n      domAPI.removeClass(loginPanel, 'hidden');\n      domAPI.addClass(registerPanel, 'hidden');\n    }\n\n    function handleRegisterTabClick(event, tabElement) {\n      const loginTabElement = domAPI.querySelector(loginModal, '#modalLoginTab');\n      const loginPanel = domAPI.querySelector(loginModal, '#loginPanel');\n      const registerPanel = domAPI.querySelector(loginModal, '#registerPanel');\n\n      if (!loginTabElement || !loginPanel || !registerPanel) {\n        return;\n      }\n\n      if (tabElement && tabElement.classList) {\n        domAPI.addClass(tabElement, 'tab-active');\n        domAPI.setAttribute(tabElement, 'aria-selected', 'true');\n      }\n      if (loginTabElement && loginTabElement.classList) {\n        domAPI.removeClass(loginTabElement, 'tab-active');\n        domAPI.setAttribute(loginTabElement, 'aria-selected', 'false');\n      }\n      if (registerPanel && registerPanel.classList) {\n        domAPI.removeClass(registerPanel, 'hidden');\n      }\n      if (loginPanel && loginPanel.classList) {\n        domAPI.addClass(loginPanel, 'hidden');\n      }\n    }\n\n    // Delegated listener for Login Tab\n    delegate(\n      loginModal,\n      'click',\n      '#modalLoginTab',\n      handleLoginTabClick,\n      { description: 'Switch to Login Tab (Delegated)', module: MODULE, context: 'authTabs' }\n    );\n\n    // Delegated listener for Register Tab\n    delegate(\n      loginModal,\n      'click',\n      '#modalRegisterTab',\n      handleRegisterTabClick,\n      { description: 'Switch to Register Tab (Delegated)', module: MODULE, context: 'authTabs' }\n    );\n  }\n\n  /**\n   * Creates a CustomEvent in a DI-compliant way.\n   * @param {string} type - The name of the event.\n   * @param {Object} [options={}] - Options for the CustomEvent (e.g., detail, bubbles, cancelable).\n   * @returns {CustomEvent|null} The created CustomEvent, or null if windowObject or CustomEvent API is not available.\n   */\n  function createCustomEvent(type, options = {}) {\n    const windowObject = browserService?.getWindow?.(); // browserService is in the factory's scope\n    if (!windowObject || typeof windowObject.CustomEvent !== 'function') {\n      throw new Error(`[${MODULE}][createCustomEvent] FATAL: windowObject.CustomEvent is not available. This will break app event dispatching. Please ensure the polyfill is loaded before any app code.`);\n    }\n    return new windowObject.CustomEvent(type, options);\n   }\n\n   /**\n    * Dispatch a custom event in a DI-compliant way.\n    *\n    * @param {string}       type               Event name.\n    * @param {Object}       [detail={}]        Detail payload.\n    * @param {EventTarget}  [target=null]      Dispatch target (defaults to document).\n    * @returns {boolean}                       True if dispatched, otherwise false.\n    */\n   function dispatch(type, detail = {}, target = null) {\n     try {\n       const evt = createCustomEvent(type, { detail, bubbles: true });\n       const tgt =\n         target ||\n         (domAPI?.getDocument\n           ? domAPI.getDocument()\n           : browserService?.getWindow?.()?.document);\n\n       if (!tgt || typeof tgt.dispatchEvent !== 'function') {\n         logger.warn(`[${MODULE}][dispatch] Cannot dispatch \"${type}\" – invalid target`, {\n           context: MODULE\n         });\n         return false;\n       }\n       domAPI.dispatchEvent(tgt, evt);\n       return true;\n     } catch (err) {\n       logger.error(`[${MODULE}][dispatch] Failed to dispatch \"${type}\"`, err, {\n         context: MODULE\n       });\n       return false;\n     }\n   }\n\n  function cleanup() {\n    // centralised cleanup – must reference the public API, not the\n    // constructor-scope variable (rule-2 DI compliance)\n    eventHandlerAPI.cleanupListeners({ context: MODULE });\n    // You could add more explicit cleanup logic here if stateful singletons or intervals are added\n  }\n\n  // ─── Public API object (assembled before init) ────────────────────────────\n  const eventHandlerAPI = {\n    trackListener,\n    cleanupListeners,\n    delegate,\n    dispatch,\n    debounce        : globalDebounce,\n    toggleVisible,\n    setupCollapsible,\n    setupModal,\n    setupForm,\n    PRIORITY,\n    untrackListener,\n    createCustomEvent,\n    dispatchEvent: dispatch,\n    setProjectManager : (pm) => { _projectManager = pm; },\n    setDomReadinessService,\n    setLogger,\n    setSafeHandler,\n    setErrorReporter,      // ← NEW\n    DependencySystem,\n    cleanup,\n    /**\n     * Returns the current number of tracked active listeners. Useful for\n     * unit-tests that assert no leaks after `cleanupListeners()`.\n     */\n    getActiveListenerCount () {\n      return trackedListeners.size;\n    }\n  };\n\n  // ――― init becomes a method of the API object ―――\n  let initialized = false;\n  eventHandlerAPI.init = async function () {\n    if (initialized) return eventHandlerAPI;           // ✅ return full API\n\n    if (!_domReadinessService) {\n      throw new Error('[eventHandler.init] domReadinessService must be set via setDomReadinessService before calling init()');\n    }\n\n    const dependencyWaitTimeout = APP_CONFIG?.TIMEOUTS?.DEPENDENCY_WAIT ?? 10000;\n\n    /* --- DOM & dependency readiness --- */\n    await _domReadinessService.documentReady();\n    await _domReadinessService.dependenciesAndElements({\n      deps        : ['app','auth','projectManager','modalManager','domAPI','browserService'],\n      domSelectors: ['body'],\n      timeout     : dependencyWaitTimeout,\n      context     : 'eventHandler.init'\n    });\n\n    /* --- in-DOM setup formerly in the old init() --- */\n    await _domReadinessService.documentReady();\n    setupCommonElements();\n    setupNavigationElements();\n    setupContentElements();\n\n    /* ---- project modal form wait (unchanged) ---- */\n    try {\n      await _domReadinessService.elementsReady('#projectModalForm', {\n        timeout: 3000,\n        context: 'eventHandler.init:modalForm'\n      }).then(() => {\n        setupProjectModalForm();\n        logger.info(`[${MODULE}][init] Project modal form setup completed`,\n                    { context: 'eventHandler.init:modalForm' });\n      }).catch((error) => {\n        logger.warn(`[${MODULE}][init] elementsReady('#projectModalForm') failed`,\n                    error,\n                    { context: 'eventHandler.init:modalForm' });\n      });\n    } catch (error) {\n      logger.error(`[${MODULE}][init] Error during modal form setup`, error,\n                   { context: 'eventHandler.init:modalForm' });\n    }\n\n    /* ---- login-modal delegation (logic kept verbatim) ---- */\n    function bindAuthButtonDelegate() {\n      if (authButtonDelegationBound) return;\n      const parentNode = domAPI.getElementById('header') || domAPI.getDocument();\n\n      logger.info('[EventHandler] bindAuthButtonDelegate', {\n        parentNodeExists: !!parentNode,\n        context: 'eventHandler.bindAuthButtonDelegate'\n      });\n\n      /*\n       * IMPORTANT: The ModalManager may not be registered at the moment this\n       * function is invoked because `modalsLoaded` can fire _before_\n       * createModalManager() finishes wiring itself into the DependencySystem.\n       * We therefore attach the delegated listener unconditionally and resolve\n       * the ModalManager lazily inside the click handler. This guarantees that\n       * the login button starts working as soon as ModalManager becomes\n       * available, without relying on an additional re-bind step.\n       */\n\n      function handleAuthButtonClick(e, _element) {\n        domAPI.preventDefault(e);\n        logger.info('[EventHandler] Auth button clicked', { context: 'eventHandler.authButton' });\n\n        try {\n          const mm = modalManager;\n          if (!mm?.show) {\n            logger.warn('[EventHandler] ModalManager not ready – cannot show login modal yet', {\n              context: 'eventHandler.authButton'\n            });\n            return;\n          }\n          mm.show('login');\n          logger.info('[EventHandler] Login modal requested', { context: 'eventHandler.authButton' });\n        } catch (error) {\n          logger.error(`[${MODULE}][bindAuthButtonDelegate] Failed to open login modal`, error, {\n            context: 'auth'\n          });\n        }\n      }\n\n      delegate(\n        parentNode,\n        'click',\n        '#authButton',\n        handleAuthButtonClick,\n        { description: 'Delegated Login Modal Show', context: 'auth', module: MODULE }\n      );\n      authButtonDelegationBound = true;\n    }\n\n    // global requestLogin listener\n    function handleRequestLogin() {\n      modalManager?.show?.('login');\n    }\n    trackListener(\n      domAPI.getDocument(),\n      'requestLogin',\n      resolveSafeHandler()(handleRequestLogin, 'EventHandler:requestLogin'),\n      { description: 'Show Login Modal (Global Event)', context: 'auth', module: MODULE, source: 'requestLogin' }\n    );\n\n    function handleModalsLoaded() {\n      bindAuthButtonDelegate();\n      setupLoginModalTabs();\n    }\n    trackListener(\n      domAPI.getDocument(),\n      'modalsLoaded',\n      SH(handleModalsLoaded, 'EventHandler:modalsLoaded'),\n      { once: true, description: 'Rebind login / tabs after modalsLoaded', context: 'auth', module: MODULE, source: 'modalsLoaded' }\n    );\n\n    // fast-path if modals already present\n    if (domAPI.getElementById('modalsContainer')?.childElementCount > 0) {\n      // Ensure the login button delegation is wired up immediately\n      bindAuthButtonDelegate();\n      setupLoginModalTabs();\n    }\n\n    initialized = true;\n    return eventHandlerAPI;                             // ✅\n  };\n\n  return eventHandlerAPI;\n}\n"],"mappings":"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","ignoreList":[]}