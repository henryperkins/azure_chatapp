{"version":3,"names":["createAppState","deps","DependencySystem","eventService","globalUtils","_logger","logger","winConsole","modules","get","getWindow","console","info","warn","error","debug","log","setLogger","newLogger","state","isAuthenticated","currentUser","currentProjectId","currentProject","isReady","disableErrorTracking","initialized","initializing","currentPhase","knowledgeBaseComponentReady","setAuthState","newAuthState","oldAuthState","id","username","newAuthStateForLog","context","Object","assign","setAppLifecycleState","newLifecycleState","oldLifecycleStateForLog","oldLifecycleState","prototype","hasOwnProperty","call","setCurrentProject","projectIdOrObject","oldProjectId","oldProject","newProjectId","detail","project","previousProject","projectId","previousProjectId","emit","message","cleanup","handlers","cleanupListeners","getCurrentUser","getCurrentProjectId","getProjectId","validateUUID","isValidProjectId","getCurrentProject","isAppReady","isInitialized","isInitializing","getCurrentPhase"],"sources":["appState.js"],"sourcesContent":["// ========================================\n// FILE: /initialization/state/appState.js\n// ========================================\n/**\n * Application State Management\n * Extracted from appInitializer.js inline appModule\n * ~200 lines\n */\n\nexport function createAppState(deps) {\n    const { DependencySystem, eventService, globalUtils } = deps;\n\n    // Internal logger reference with setter pattern\n    let _logger = deps.logger;\n\n    if (!_logger) {\n        const winConsole = DependencySystem?.modules?.get?.('browserService')?.getWindow?.()?.console;\n        _logger = winConsole ?? { info() {}, warn() {}, error() {}, debug() {}, log() {} };\n    }\n\n    function setLogger(newLogger) {\n        if (newLogger) _logger = newLogger;\n    }\n\n    // Application state object\n    const state = {\n        isAuthenticated: false,\n        currentUser: null,\n        currentProjectId: null,\n        currentProject: null,\n        isReady: false,\n        disableErrorTracking: false,\n        initialized: false,\n        initializing: false,\n        currentPhase: 'idle',\n        knowledgeBaseComponentReady: false\n    };\n\n    function setAuthState(newAuthState) {\n        const oldAuthState = {\n            isAuthenticated: state.isAuthenticated,\n            currentUser: state.currentUser\n                ? { id: state.currentUser.id, username: state.currentUser.username }\n                : null\n        };\n\n        const newAuthStateForLog = {\n            isAuthenticated: newAuthState.isAuthenticated,\n            currentUser: newAuthState.currentUser\n                ? { id: newAuthState.currentUser.id, username: newAuthState.currentUser.username }\n                : null\n        };\n\n        _logger.info('[appState][setAuthState] Updating auth state.', {\n            oldAuthState,\n            newAuthState: newAuthStateForLog,\n            context: 'appState:setAuthState'\n        });\n\n        Object.assign(state, newAuthState);\n    }\n\n    function setAppLifecycleState(newLifecycleState) {\n        const oldLifecycleStateForLog = {\n            isReady: state.isReady,\n            initialized: state.initialized,\n            initializing: state.initializing,\n            currentPhase: state.currentPhase\n        };\n\n        _logger.info('[appState][setAppLifecycleState] Updating app lifecycle state.', {\n            oldLifecycleState: oldLifecycleStateForLog,\n            newLifecycleState,\n            context: 'appState:setAppLifecycleState'\n        });\n\n        Object.assign(state, newLifecycleState);\n\n        if (newLifecycleState.initialized === true) {\n            if (state.currentPhase === 'initialized_idle') {\n                state.isReady = true;\n            } else if (state.currentPhase === 'failed_idle') {\n                state.isReady = false;\n            }\n        } else if (Object.prototype.hasOwnProperty.call(newLifecycleState, 'isReady')) {\n            state.isReady = newLifecycleState.isReady;\n        }\n    }\n\n    function setCurrentProject(projectIdOrObject) {\n        const oldProjectId = state.currentProjectId;\n        const oldProject = state.currentProject;\n\n        if (projectIdOrObject === null) {\n            state.currentProjectId = null;\n            state.currentProject = null;\n            _logger.info('[appState][setCurrentProject] Clearing current project.', {\n                oldProjectId,\n                context: 'appState:setCurrentProject:clear'\n            });\n        } else if (typeof projectIdOrObject === 'string') {\n            state.currentProjectId = projectIdOrObject;\n            if (state.currentProject?.id !== projectIdOrObject) {\n                state.currentProject = null;\n            }\n            _logger.info('[appState][setCurrentProject] Updating current project ID.', {\n                oldProjectId,\n                newProjectId: projectIdOrObject,\n                context: 'appState:setCurrentProject:id'\n            });\n        } else if (\n            projectIdOrObject &&\n            typeof projectIdOrObject === 'object' &&\n            projectIdOrObject.id\n        ) {\n            state.currentProjectId = projectIdOrObject.id;\n            state.currentProject = projectIdOrObject;\n            _logger.info('[appState][setCurrentProject] Updating current project object.', {\n                oldProjectId,\n                newProjectId: projectIdOrObject.id,\n                context: 'appState:setCurrentProject:object'\n            });\n        } else {\n            _logger.warn('[appState][setCurrentProject] Invalid project data provided.', {\n                projectIdOrObject,\n                context: 'appState:setCurrentProject:invalid'\n            });\n            return;\n        }\n\n        // Emit project change events\n        if (oldProjectId !== state.currentProjectId) {\n            try {\n                const detail = {\n                    project: state.currentProject ? { ...state.currentProject } : null,\n                    previousProject: oldProject ? { ...oldProject } : null,\n                    projectId: state.currentProject?.id || null,\n                    previousProjectId: oldProject?.id || null\n                };\n\n                if (eventService?.emit) {\n                    eventService.emit('currentProjectChanged', detail);\n                }\n\n                // Legacy event for backward compatibility\n                if (state.currentProject) {\n                    _logger.debug('[appState] Dispatching legacy \"projectSelected\" event.', {\n                        projectId: state.currentProject.id,\n                        context: 'appState:projectChangeEvent:legacy'\n                    });\n\n                    if (eventService?.emit) {\n                        eventService.emit('projectSelected', {\n                            projectId: state.currentProject.id,\n                            project: { ...state.currentProject }\n                        });\n                    }\n                }\n            } catch (error) {\n                _logger.error('[appState] Failed to dispatch project change event.', {\n                    error: error.message,\n                    context: 'appState:projectChangeEvent:error'\n                });\n            }\n        }\n    }\n\n    function cleanup() {\n        const handlers = DependencySystem.modules.get('eventHandlers');\n        if (handlers) handlers.cleanupListeners({ context: 'appState' });\n        _logger.debug('[appState] Cleanup completed', { context: 'appState:cleanup' });\n    }\n\n    // Public API\n    return {\n        state,\n        setLogger,\n        setAuthState,\n        setAppLifecycleState,\n        setCurrentProject,\n        isAuthenticated: () => state.isAuthenticated,\n        getCurrentUser: () => state.currentUser,\n        getCurrentProjectId: () => state.currentProjectId,\n        getProjectId: () => state.currentProjectId, // Legacy alias\n        validateUUID: (id) => globalUtils?.isValidProjectId?.(id) === true,\n        getCurrentProject: () => state.currentProject,\n        isAppReady: () => state.isReady,\n        isInitialized: () => state.initialized,\n        isInitializing: () => state.initializing,\n        getCurrentPhase: () => state.currentPhase,\n        cleanup\n    };\n}\n"],"mappings":"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","ignoreList":[]}