{"version":3,"names":["_chat","require","createDependencySystem","modules","Map","register","n","v","set","stubDomAPI","querySelector","getElementById","querySelectorAll","length","appendChild","replaceChildren","createElement","removeChild","setInnerHTML","setTextContent","getDocument","addEventListener","removeEventListener","addClass","removeClass","getWindow","dispatchEvent","stubEventHandlers","trackListener","cleanupListeners","createCustomEvent","d","type","detail","stubDomReadinessService","documentReady","Promise","resolve","dependenciesAndElements","stubBrowserService","CustomEvent","global","URLSearchParams","getLocation","search","href","pathname","buildUrl","pushState","replaceState","describe","test","constructor","DS","EventTarget","AuthBus","mgr","createChatManager","apiRequest","status","app","state","isAuthenticated","eventHandlers","modelConfig","getConfig","projectDetailsComponent","isValidProjectId","domAPI","navAPI","getSearch","getHref","getPathname","DOMPurify","sanitize","h","apiEndpoints","domReadinessService","logger","debug","info","warn","error","DependencySystem","APP_CONFIG","browserService","authenticationService","getCurrentUser","id","projectContextService","getCurrentProjectId","getCurrentProject","chatUIEnhancements","appendMessage","clearConversation","showTypingIndicator","hideTypingIndicator","kbReadinessService","checkReadiness","tokenStatsManager","updateConversationStats","clearStats","conversationManager","createConversation","loadConversation","loadConversationHistory","getCurrentConversationId","setCurrentConversationId","cleanup","messageHandler","sendMessage","estimateTokens","handleResponse","chatUIController","attachUI","detachUI","updateInputState","eventService","emit","on","off","once","waitFor","getAppBus","_getBus","expect","initialize","projectId","resolves","not","toThrow"],"sources":["chatmanager-regression.test.js"],"sourcesContent":["import { createChatManager } from '../../static/js/chat.js';\n\nfunction createDependencySystem () {\n  const modules = new Map();\n  return {\n    modules,\n    register (n, v) { modules.set(n, v); }\n  };\n}\n\n// Minimal stub helpers -----------------------------------------------------\nconst stubDomAPI = {\n  querySelector: () => null,\n  getElementById: () => null,\n  querySelectorAll: () => ({ length: 0 }),\n  appendChild () {},\n  replaceChildren () {},\n  createElement: () => ({}),\n  removeChild () {},\n  setInnerHTML () {},\n  setTextContent () {},\n  getDocument: () => ({ addEventListener () {}, removeEventListener () {} }),\n  addClass () {},\n  removeClass () {},\n  getWindow: () => ({ addEventListener () {}, removeEventListener () {} }),\n  dispatchEvent () {}\n};\n\nconst stubEventHandlers = {\n  trackListener () {},\n  cleanupListeners () {},\n  createCustomEvent: (n, d) => ({ type: n, detail: d })\n};\n\nconst stubDomReadinessService = {\n  documentReady: () => Promise.resolve(),\n  dependenciesAndElements: () => Promise.resolve()\n};\n\nconst stubBrowserService = {\n  getWindow: () => ({ CustomEvent: (typeof global.CustomEvent === 'function') ? global.CustomEvent : function () {} }),\n  URLSearchParams: URLSearchParams,\n  getLocation: () => ({ search: '', href: '', pathname: '' }),\n  buildUrl: () => '/',\n  pushState () {},\n  replaceState () {}\n};\n\ndescribe('ChatManager regression â€“ bootstrap sanity', () => {\n  test('initialize() resolves without throwing', async () => {\n    if (typeof global.CustomEvent !== 'function') {\n      global.CustomEvent = class CustomEvent { constructor (n,d){ this.type=n; this.detail=d?.detail; } };\n    }\n    const DS = createDependencySystem();\n    DS.register('chatUIEnhancements', {}); // Skip actual enhancements\n    DS.register('AppBus', new EventTarget());\n    DS.register('auth', { AuthBus: new EventTarget() });\n\n    const mgr = createChatManager({\n      apiRequest: () => Promise.resolve({ status: 'ok' }),\n      app: { state: { isAuthenticated: true } },\n      eventHandlers: stubEventHandlers,\n      modelConfig: { getConfig: () => ({}) },\n      projectDetailsComponent: {},\n      isValidProjectId: () => true,\n      domAPI: stubDomAPI,\n      navAPI: { getSearch: () => '', getHref: () => '', pushState: () => {}, getPathname: () => '' },\n      DOMPurify: { sanitize: (h) => h },\n      apiEndpoints: {},\n      domReadinessService: stubDomReadinessService,\n      logger: { debug () {}, info () {}, warn () {}, error () {} },\n      DependencySystem: DS,\n      APP_CONFIG: {},\n      browserService: stubBrowserService,\n      authenticationService: { isAuthenticated: () => true, getCurrentUser: () => ({ id: 1 }) },\n      projectContextService: { getCurrentProjectId: () => 'abc123', getCurrentProject: () => ({ id: 'abc123' }) },\n      chatUIEnhancements: { \n        appendMessage: () => {}, \n        clearConversation: () => {},\n        showTypingIndicator: () => {},\n        hideTypingIndicator: () => {}\n      },\n      kbReadinessService: { checkReadiness: () => Promise.resolve(true) },\n      tokenStatsManager: { updateConversationStats: () => {}, clearStats: () => {} },\n      // Required Phase 2 modules\n      conversationManager: { \n        createConversation: () => Promise.resolve({ id: 'conv1' }),\n        loadConversation: () => Promise.resolve(),\n        loadConversationHistory: () => Promise.resolve([]),\n        getCurrentConversationId: () => 'conv1',\n        setCurrentConversationId: () => {},\n        cleanup: () => {}\n      },\n      messageHandler: {\n        sendMessage: () => Promise.resolve(),\n        estimateTokens: () => Promise.resolve(100),\n        handleResponse: () => {},\n        cleanup: () => {}\n      },\n      chatUIController: {\n        attachUI: () => {},\n        detachUI: () => {},\n        updateInputState: () => {},\n        cleanup: () => {}\n      },\n      eventService: {\n        emit: () => {},\n        on: () => () => {},\n        off: () => {},\n        once: () => {},\n        waitFor: () => Promise.resolve(),\n        getAppBus () { return new EventTarget(); },\n        _getBus () { return this.getAppBus(); },\n        cleanup: () => {}\n      }\n    });\n\n    await expect(mgr.initialize({ projectId: 'abc123' })).resolves.not.toThrow();\n  });\n});\n"],"mappings":"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","ignoreList":[]}