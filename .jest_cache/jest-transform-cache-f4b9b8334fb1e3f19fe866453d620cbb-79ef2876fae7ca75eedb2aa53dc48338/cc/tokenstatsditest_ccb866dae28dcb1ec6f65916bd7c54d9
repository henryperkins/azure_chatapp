7e77010c1739d3cae58cceb4dc8a141b
"use strict";

var _appInitializer = require("../init/appInitializer.js");
/**
 * Regression test – ensures that a placeholder implementation for
 * `tokenStatsManager` is present in the DependencySystem **before** the
 * core bootstrap phase (specifically before `coreInit` would attempt to
 * resolve the dependency via `createMessageHandler`).  The placeholder is
 * provided by `tokenStatsManagerProxy` during the early DI setup inside
 * `createAppInitializer`.
 *
 * The test only executes the Basic & Advanced service registration phases
 * (matching the order that runs before `coreInit`).  It does **not** fully
 * initialize the app – keeping the scope minimal while still catching
 * regressions where the proxy registration might be removed or renamed.
 */

function createMockDependencySystem() {
  const DS = {
    modules: new Map(),
    register(key, value) {
      this.modules.set(key, value);
    }
  };
  return DS;
}
function createStubBrowserService({
  documentObject,
  windowObject
} = {}) {
  const win = windowObject ?? {
    DOMPurify: {},
    EventTarget: class {
      addEventListener() {}
      removeEventListener() {}
      dispatchEvent() {
        return false;
      }
    },
    setTimeout(fn) {
      if (typeof fn === 'function') fn();
      return 0;
    },
    clearTimeout() {},
    performance: {
      now: () => 0
    },
    URL: {
      createObjectURL: () => '',
      revokeObjectURL: () => ''
    },
    Event: function () {},
    document: documentObject
  };
  const doc = documentObject ?? {
    readyState: 'complete',
    getElementById: () => null,
    querySelector: () => null,
    addEventListener: () => {},
    removeEventListener: () => {},
    createElement: () => ({
      style: {}
    }),
    body: {
      appendChild: () => {},
      removeChild: () => {}
    }
  };
  win.document = doc;
  return {
    getWindow: () => win,
    getDocument: () => doc,
    setTimeout: win.setTimeout,
    clearTimeout: win.clearTimeout
  };
}
function createStubApiEndpoints() {
  return {
    endpoints: {
      AUTH_CSRF: '/api/csrf',
      AUTH_LOGIN: '/api/login',
      AUTH_LOGOUT: '/api/logout',
      AUTH_REGISTER: '/api/register',
      AUTH_VERIFY: '/api/verify',
      AUTH_REFRESH: '/api/refresh'
    },
    resolveApiEndpoints: () => ({}),
    cleanup: () => {}
  };
}
test('tokenStatsManager placeholder exists before coreInit', async () => {
  const DependencySystem = createMockDependencySystem();
  const appInit = (0, _appInitializer.createAppInitializer)({
    DependencySystem,
    browserService: createStubBrowserService(),
    createChatManager: () => ({}),
    createApiEndpoints: () => createStubApiEndpoints(),
    APP_CONFIG: {
      TIMEOUTS: {
        DOM_READY: 1000
      }
    },
    MODAL_MAPPINGS: {}
    // The remaining optional config/factories are left undefined intentionally
  });

  // Execute only the DI service registration phases that precede coreInit
  await appInit.serviceInit.registerBasicServices();
  await appInit.serviceInit.registerAdvancedServices();
  expect(DependencySystem.modules.get('tokenStatsManager')).toBeDefined();
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfYXBwSW5pdGlhbGl6ZXIiLCJyZXF1aXJlIiwiY3JlYXRlTW9ja0RlcGVuZGVuY3lTeXN0ZW0iLCJEUyIsIm1vZHVsZXMiLCJNYXAiLCJyZWdpc3RlciIsImtleSIsInZhbHVlIiwic2V0IiwiY3JlYXRlU3R1YkJyb3dzZXJTZXJ2aWNlIiwiZG9jdW1lbnRPYmplY3QiLCJ3aW5kb3dPYmplY3QiLCJ3aW4iLCJET01QdXJpZnkiLCJFdmVudFRhcmdldCIsImFkZEV2ZW50TGlzdGVuZXIiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZGlzcGF0Y2hFdmVudCIsInNldFRpbWVvdXQiLCJmbiIsImNsZWFyVGltZW91dCIsInBlcmZvcm1hbmNlIiwibm93IiwiVVJMIiwiY3JlYXRlT2JqZWN0VVJMIiwicmV2b2tlT2JqZWN0VVJMIiwiRXZlbnQiLCJkb2N1bWVudCIsImRvYyIsInJlYWR5U3RhdGUiLCJnZXRFbGVtZW50QnlJZCIsInF1ZXJ5U2VsZWN0b3IiLCJjcmVhdGVFbGVtZW50Iiwic3R5bGUiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJyZW1vdmVDaGlsZCIsImdldFdpbmRvdyIsImdldERvY3VtZW50IiwiY3JlYXRlU3R1YkFwaUVuZHBvaW50cyIsImVuZHBvaW50cyIsIkFVVEhfQ1NSRiIsIkFVVEhfTE9HSU4iLCJBVVRIX0xPR09VVCIsIkFVVEhfUkVHSVNURVIiLCJBVVRIX1ZFUklGWSIsIkFVVEhfUkVGUkVTSCIsInJlc29sdmVBcGlFbmRwb2ludHMiLCJjbGVhbnVwIiwidGVzdCIsIkRlcGVuZGVuY3lTeXN0ZW0iLCJhcHBJbml0IiwiY3JlYXRlQXBwSW5pdGlhbGl6ZXIiLCJicm93c2VyU2VydmljZSIsImNyZWF0ZUNoYXRNYW5hZ2VyIiwiY3JlYXRlQXBpRW5kcG9pbnRzIiwiQVBQX0NPTkZJRyIsIlRJTUVPVVRTIiwiRE9NX1JFQURZIiwiTU9EQUxfTUFQUElOR1MiLCJzZXJ2aWNlSW5pdCIsInJlZ2lzdGVyQmFzaWNTZXJ2aWNlcyIsInJlZ2lzdGVyQWR2YW5jZWRTZXJ2aWNlcyIsImV4cGVjdCIsImdldCIsInRvQmVEZWZpbmVkIl0sInNvdXJjZXMiOlsidG9rZW4tc3RhdHMtZGkudGVzdC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlZ3Jlc3Npb24gdGVzdCDigJMgZW5zdXJlcyB0aGF0IGEgcGxhY2Vob2xkZXIgaW1wbGVtZW50YXRpb24gZm9yXG4gKiBgdG9rZW5TdGF0c01hbmFnZXJgIGlzIHByZXNlbnQgaW4gdGhlIERlcGVuZGVuY3lTeXN0ZW0gKipiZWZvcmUqKiB0aGVcbiAqIGNvcmUgYm9vdHN0cmFwIHBoYXNlIChzcGVjaWZpY2FsbHkgYmVmb3JlIGBjb3JlSW5pdGAgd291bGQgYXR0ZW1wdCB0b1xuICogcmVzb2x2ZSB0aGUgZGVwZW5kZW5jeSB2aWEgYGNyZWF0ZU1lc3NhZ2VIYW5kbGVyYCkuICBUaGUgcGxhY2Vob2xkZXIgaXNcbiAqIHByb3ZpZGVkIGJ5IGB0b2tlblN0YXRzTWFuYWdlclByb3h5YCBkdXJpbmcgdGhlIGVhcmx5IERJIHNldHVwIGluc2lkZVxuICogYGNyZWF0ZUFwcEluaXRpYWxpemVyYC5cbiAqXG4gKiBUaGUgdGVzdCBvbmx5IGV4ZWN1dGVzIHRoZSBCYXNpYyAmIEFkdmFuY2VkIHNlcnZpY2UgcmVnaXN0cmF0aW9uIHBoYXNlc1xuICogKG1hdGNoaW5nIHRoZSBvcmRlciB0aGF0IHJ1bnMgYmVmb3JlIGBjb3JlSW5pdGApLiAgSXQgZG9lcyAqKm5vdCoqIGZ1bGx5XG4gKiBpbml0aWFsaXplIHRoZSBhcHAg4oCTIGtlZXBpbmcgdGhlIHNjb3BlIG1pbmltYWwgd2hpbGUgc3RpbGwgY2F0Y2hpbmdcbiAqIHJlZ3Jlc3Npb25zIHdoZXJlIHRoZSBwcm94eSByZWdpc3RyYXRpb24gbWlnaHQgYmUgcmVtb3ZlZCBvciByZW5hbWVkLlxuICovXG5cbmltcG9ydCB7IGNyZWF0ZUFwcEluaXRpYWxpemVyIH0gZnJvbSAnLi4vaW5pdC9hcHBJbml0aWFsaXplci5qcyc7XG5cbmZ1bmN0aW9uIGNyZWF0ZU1vY2tEZXBlbmRlbmN5U3lzdGVtKCkge1xuICBjb25zdCBEUyA9IHtcbiAgICBtb2R1bGVzOiBuZXcgTWFwKCksXG4gICAgcmVnaXN0ZXIoa2V5LCB2YWx1ZSkge1xuICAgICAgdGhpcy5tb2R1bGVzLnNldChrZXksIHZhbHVlKTtcbiAgICB9XG4gIH07XG4gIHJldHVybiBEUztcbn1cblxuZnVuY3Rpb24gY3JlYXRlU3R1YkJyb3dzZXJTZXJ2aWNlKHsgZG9jdW1lbnRPYmplY3QsIHdpbmRvd09iamVjdCB9ID0ge30pIHtcbiAgY29uc3Qgd2luID0gd2luZG93T2JqZWN0ID8/IHtcbiAgICBET01QdXJpZnk6IHt9LFxuICAgIEV2ZW50VGFyZ2V0OiBjbGFzcyB7XG4gICAgICBhZGRFdmVudExpc3RlbmVyKCkge31cbiAgICAgIHJlbW92ZUV2ZW50TGlzdGVuZXIoKSB7fVxuICAgICAgZGlzcGF0Y2hFdmVudCgpIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgfSxcbiAgICBzZXRUaW1lb3V0KGZuKSB7IGlmICh0eXBlb2YgZm4gPT09ICdmdW5jdGlvbicpIGZuKCk7IHJldHVybiAwOyB9LFxuICAgIGNsZWFyVGltZW91dCgpIHt9LFxuICAgIHBlcmZvcm1hbmNlOiB7IG5vdzogKCkgPT4gMCB9LFxuICAgIFVSTDogeyBjcmVhdGVPYmplY3RVUkw6ICgpID0+ICcnLCByZXZva2VPYmplY3RVUkw6ICgpID0+ICcnIH0sXG4gICAgRXZlbnQ6IGZ1bmN0aW9uICgpIHt9LFxuICAgIGRvY3VtZW50IDogZG9jdW1lbnRPYmplY3RcbiAgfTtcblxuICBjb25zdCBkb2MgPSBkb2N1bWVudE9iamVjdCA/PyB7XG4gICAgcmVhZHlTdGF0ZTogJ2NvbXBsZXRlJyxcbiAgICBnZXRFbGVtZW50QnlJZDogKCkgPT4gbnVsbCxcbiAgICBxdWVyeVNlbGVjdG9yIDogKCkgPT4gbnVsbCxcbiAgICBhZGRFdmVudExpc3RlbmVyOiAoKSA9PiB7fSxcbiAgICByZW1vdmVFdmVudExpc3RlbmVyOiAoKSA9PiB7fSxcbiAgICBjcmVhdGVFbGVtZW50OiAoKSA9PiAoeyBzdHlsZToge30gfSksXG4gICAgYm9keTogeyBhcHBlbmRDaGlsZDogKCkgPT4ge30sIHJlbW92ZUNoaWxkOiAoKSA9PiB7fSB9XG4gIH07XG5cbiAgd2luLmRvY3VtZW50ID0gZG9jO1xuXG4gIHJldHVybiB7XG4gICAgZ2V0V2luZG93OiAoKSA9PiB3aW4sXG4gICAgZ2V0RG9jdW1lbnQ6ICgpID0+IGRvYyxcbiAgICBzZXRUaW1lb3V0OiB3aW4uc2V0VGltZW91dCxcbiAgICBjbGVhclRpbWVvdXQ6IHdpbi5jbGVhclRpbWVvdXRcbiAgfTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlU3R1YkFwaUVuZHBvaW50cygpIHtcbiAgcmV0dXJuIHtcbiAgICBlbmRwb2ludHM6IHtcbiAgICAgIEFVVEhfQ1NSRjogJy9hcGkvY3NyZicsXG4gICAgICBBVVRIX0xPR0lOOiAnL2FwaS9sb2dpbicsXG4gICAgICBBVVRIX0xPR09VVDogJy9hcGkvbG9nb3V0JyxcbiAgICAgIEFVVEhfUkVHSVNURVI6ICcvYXBpL3JlZ2lzdGVyJyxcbiAgICAgIEFVVEhfVkVSSUZZOiAnL2FwaS92ZXJpZnknLFxuICAgICAgQVVUSF9SRUZSRVNIOiAnL2FwaS9yZWZyZXNoJ1xuICAgIH0sXG4gICAgcmVzb2x2ZUFwaUVuZHBvaW50czogKCkgPT4gKHt9KSxcbiAgICBjbGVhbnVwOiAoKSA9PiB7fVxuICB9O1xufVxuXG50ZXN0KCd0b2tlblN0YXRzTWFuYWdlciBwbGFjZWhvbGRlciBleGlzdHMgYmVmb3JlIGNvcmVJbml0JywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCBEZXBlbmRlbmN5U3lzdGVtID0gY3JlYXRlTW9ja0RlcGVuZGVuY3lTeXN0ZW0oKTtcblxuICBjb25zdCBhcHBJbml0ID0gY3JlYXRlQXBwSW5pdGlhbGl6ZXIoe1xuICAgIERlcGVuZGVuY3lTeXN0ZW0sXG4gICAgYnJvd3NlclNlcnZpY2U6IGNyZWF0ZVN0dWJCcm93c2VyU2VydmljZSgpLFxuICAgIGNyZWF0ZUNoYXRNYW5hZ2VyOiAoKSA9PiAoe30pLFxuICAgIGNyZWF0ZUFwaUVuZHBvaW50czogKCkgPT4gY3JlYXRlU3R1YkFwaUVuZHBvaW50cygpLFxuICAgIEFQUF9DT05GSUc6IHtcbiAgICAgIFRJTUVPVVRTOiB7IERPTV9SRUFEWTogMTAwMCB9XG4gICAgfSxcbiAgICBNT0RBTF9NQVBQSU5HUzoge30sXG4gICAgLy8gVGhlIHJlbWFpbmluZyBvcHRpb25hbCBjb25maWcvZmFjdG9yaWVzIGFyZSBsZWZ0IHVuZGVmaW5lZCBpbnRlbnRpb25hbGx5XG4gIH0pO1xuXG4gIC8vIEV4ZWN1dGUgb25seSB0aGUgREkgc2VydmljZSByZWdpc3RyYXRpb24gcGhhc2VzIHRoYXQgcHJlY2VkZSBjb3JlSW5pdFxuICBhd2FpdCBhcHBJbml0LnNlcnZpY2VJbml0LnJlZ2lzdGVyQmFzaWNTZXJ2aWNlcygpO1xuICBhd2FpdCBhcHBJbml0LnNlcnZpY2VJbml0LnJlZ2lzdGVyQWR2YW5jZWRTZXJ2aWNlcygpO1xuXG4gIGV4cGVjdChEZXBlbmRlbmN5U3lzdGVtLm1vZHVsZXMuZ2V0KCd0b2tlblN0YXRzTWFuYWdlcicpKS50b0JlRGVmaW5lZCgpO1xufSk7XG4iXSwibWFwcGluZ3MiOiI7O0FBY0EsSUFBQUEsZUFBQSxHQUFBQyxPQUFBO0FBZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBSUEsU0FBU0MsMEJBQTBCQSxDQUFBLEVBQUc7RUFDcEMsTUFBTUMsRUFBRSxHQUFHO0lBQ1RDLE9BQU8sRUFBRSxJQUFJQyxHQUFHLENBQUMsQ0FBQztJQUNsQkMsUUFBUUEsQ0FBQ0MsR0FBRyxFQUFFQyxLQUFLLEVBQUU7TUFDbkIsSUFBSSxDQUFDSixPQUFPLENBQUNLLEdBQUcsQ0FBQ0YsR0FBRyxFQUFFQyxLQUFLLENBQUM7SUFDOUI7RUFDRixDQUFDO0VBQ0QsT0FBT0wsRUFBRTtBQUNYO0FBRUEsU0FBU08sd0JBQXdCQSxDQUFDO0VBQUVDLGNBQWM7RUFBRUM7QUFBYSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUU7RUFDdkUsTUFBTUMsR0FBRyxHQUFHRCxZQUFZLElBQUk7SUFDMUJFLFNBQVMsRUFBRSxDQUFDLENBQUM7SUFDYkMsV0FBVyxFQUFFLE1BQU07TUFDakJDLGdCQUFnQkEsQ0FBQSxFQUFHLENBQUM7TUFDcEJDLG1CQUFtQkEsQ0FBQSxFQUFHLENBQUM7TUFDdkJDLGFBQWFBLENBQUEsRUFBRztRQUFFLE9BQU8sS0FBSztNQUFFO0lBQ2xDLENBQUM7SUFDREMsVUFBVUEsQ0FBQ0MsRUFBRSxFQUFFO01BQUUsSUFBSSxPQUFPQSxFQUFFLEtBQUssVUFBVSxFQUFFQSxFQUFFLENBQUMsQ0FBQztNQUFFLE9BQU8sQ0FBQztJQUFFLENBQUM7SUFDaEVDLFlBQVlBLENBQUEsRUFBRyxDQUFDLENBQUM7SUFDakJDLFdBQVcsRUFBRTtNQUFFQyxHQUFHLEVBQUVBLENBQUEsS0FBTTtJQUFFLENBQUM7SUFDN0JDLEdBQUcsRUFBRTtNQUFFQyxlQUFlLEVBQUVBLENBQUEsS0FBTSxFQUFFO01BQUVDLGVBQWUsRUFBRUEsQ0FBQSxLQUFNO0lBQUcsQ0FBQztJQUM3REMsS0FBSyxFQUFFLFNBQUFBLENBQUEsRUFBWSxDQUFDLENBQUM7SUFDckJDLFFBQVEsRUFBR2pCO0VBQ2IsQ0FBQztFQUVELE1BQU1rQixHQUFHLEdBQUdsQixjQUFjLElBQUk7SUFDNUJtQixVQUFVLEVBQUUsVUFBVTtJQUN0QkMsY0FBYyxFQUFFQSxDQUFBLEtBQU0sSUFBSTtJQUMxQkMsYUFBYSxFQUFHQSxDQUFBLEtBQU0sSUFBSTtJQUMxQmhCLGdCQUFnQixFQUFFQSxDQUFBLEtBQU0sQ0FBQyxDQUFDO0lBQzFCQyxtQkFBbUIsRUFBRUEsQ0FBQSxLQUFNLENBQUMsQ0FBQztJQUM3QmdCLGFBQWEsRUFBRUEsQ0FBQSxNQUFPO01BQUVDLEtBQUssRUFBRSxDQUFDO0lBQUUsQ0FBQyxDQUFDO0lBQ3BDQyxJQUFJLEVBQUU7TUFBRUMsV0FBVyxFQUFFQSxDQUFBLEtBQU0sQ0FBQyxDQUFDO01BQUVDLFdBQVcsRUFBRUEsQ0FBQSxLQUFNLENBQUM7SUFBRTtFQUN2RCxDQUFDO0VBRUR4QixHQUFHLENBQUNlLFFBQVEsR0FBR0MsR0FBRztFQUVsQixPQUFPO0lBQ0xTLFNBQVMsRUFBRUEsQ0FBQSxLQUFNekIsR0FBRztJQUNwQjBCLFdBQVcsRUFBRUEsQ0FBQSxLQUFNVixHQUFHO0lBQ3RCVixVQUFVLEVBQUVOLEdBQUcsQ0FBQ00sVUFBVTtJQUMxQkUsWUFBWSxFQUFFUixHQUFHLENBQUNRO0VBQ3BCLENBQUM7QUFDSDtBQUVBLFNBQVNtQixzQkFBc0JBLENBQUEsRUFBRztFQUNoQyxPQUFPO0lBQ0xDLFNBQVMsRUFBRTtNQUNUQyxTQUFTLEVBQUUsV0FBVztNQUN0QkMsVUFBVSxFQUFFLFlBQVk7TUFDeEJDLFdBQVcsRUFBRSxhQUFhO01BQzFCQyxhQUFhLEVBQUUsZUFBZTtNQUM5QkMsV0FBVyxFQUFFLGFBQWE7TUFDMUJDLFlBQVksRUFBRTtJQUNoQixDQUFDO0lBQ0RDLG1CQUFtQixFQUFFQSxDQUFBLE1BQU8sQ0FBQyxDQUFDLENBQUM7SUFDL0JDLE9BQU8sRUFBRUEsQ0FBQSxLQUFNLENBQUM7RUFDbEIsQ0FBQztBQUNIO0FBRUFDLElBQUksQ0FBQyxzREFBc0QsRUFBRSxZQUFZO0VBQ3ZFLE1BQU1DLGdCQUFnQixHQUFHakQsMEJBQTBCLENBQUMsQ0FBQztFQUVyRCxNQUFNa0QsT0FBTyxHQUFHLElBQUFDLG9DQUFvQixFQUFDO0lBQ25DRixnQkFBZ0I7SUFDaEJHLGNBQWMsRUFBRTVDLHdCQUF3QixDQUFDLENBQUM7SUFDMUM2QyxpQkFBaUIsRUFBRUEsQ0FBQSxNQUFPLENBQUMsQ0FBQyxDQUFDO0lBQzdCQyxrQkFBa0IsRUFBRUEsQ0FBQSxLQUFNaEIsc0JBQXNCLENBQUMsQ0FBQztJQUNsRGlCLFVBQVUsRUFBRTtNQUNWQyxRQUFRLEVBQUU7UUFBRUMsU0FBUyxFQUFFO01BQUs7SUFDOUIsQ0FBQztJQUNEQyxjQUFjLEVBQUUsQ0FBQztJQUNqQjtFQUNGLENBQUMsQ0FBQzs7RUFFRjtFQUNBLE1BQU1SLE9BQU8sQ0FBQ1MsV0FBVyxDQUFDQyxxQkFBcUIsQ0FBQyxDQUFDO0VBQ2pELE1BQU1WLE9BQU8sQ0FBQ1MsV0FBVyxDQUFDRSx3QkFBd0IsQ0FBQyxDQUFDO0VBRXBEQyxNQUFNLENBQUNiLGdCQUFnQixDQUFDL0MsT0FBTyxDQUFDNkQsR0FBRyxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQ0MsV0FBVyxDQUFDLENBQUM7QUFDekUsQ0FBQyxDQUFDIiwiaWdub3JlTGlzdCI6W119