{"version":3,"names":["_eventHandler","require","createDependencySystem","modules","Map","register","n","v","set","createStubDomAPI","addEventListener","el","evt","handler","opts","removeEventListener","closest","getDocument","setProperty","setInnerHTML","setTextContent","querySelector","dispatchEvent","createStubBrowserService","setTimeout","fn","t","id","clearTimeout","getWindow","describe","test","global","CustomEvent","constructor","d","type","detail","DS","domAPI","browserService","logger","debug","info","warn","error","errorReporter","report","EH","createEventHandlers","DependencySystem","APP_CONFIG","safeHandler","target","EventTarget","handler1","jest","handler2","trackListener","context","expect","getActiveListenerCount","toBe","cleanupListeners"],"sources":["view-lifecycle-leak.test.js"],"sourcesContent":["import { createEventHandlers } from '../../static/js/eventHandler.js';\n\nfunction createDependencySystem () {\n  const modules = new Map();\n  return {\n    modules,\n    register (n, v) { modules.set(n, v); }\n  };\n}\n\n/**\n * Minimal stubs required by createEventHandlers.\n */\nfunction createStubDomAPI () {\n  return {\n    addEventListener (el, evt, handler, opts) { el.addEventListener(evt, handler, opts); },\n    removeEventListener (el, evt, handler, opts) { el.removeEventListener(evt, handler, opts); },\n    closest: () => null,\n    getDocument: () => ({ addEventListener () {}, removeEventListener () {} }),\n    setProperty () {},\n    setInnerHTML () {},\n    setTextContent () {},\n    querySelector () { return null; },\n    dispatchEvent () {},\n  };\n}\n\nfunction createStubBrowserService () {\n  return {\n    setTimeout: (fn, t) => { const id = setTimeout(fn, t); return id; },\n    clearTimeout: (id) => clearTimeout(id),\n    getWindow: () => ({})\n  };\n}\n\ndescribe('EventHandlers â€“ listener leak detection', () => {\n  test('cleanupListeners removes all tracked listeners (no leaks)', () => {\n    // Provide CustomEvent polyfill for Node\n    if (typeof global.CustomEvent !== 'function') {\n      global.CustomEvent = class CustomEvent { constructor (n, d) { this.type = n; this.detail = d?.detail; } };\n    }\n\n    const DS = createDependencySystem();\n\n    const domAPI = createStubDomAPI();\n    const browserService = createStubBrowserService();\n\n    const logger = { debug () {}, info () {}, warn () {}, error () {} };\n    const errorReporter = { report () {} };\n\n    const EH = createEventHandlers({\n      DependencySystem: DS,\n      domAPI,\n      browserService,\n      APP_CONFIG: {},\n      logger,\n      errorReporter,\n      safeHandler: (fn) => fn\n    });\n\n    // Track a couple of listeners\n    const target = new EventTarget();\n    const handler1 = jest.fn();\n    const handler2 = jest.fn();\n\n    EH.trackListener(target, 'testEvent', handler1, { context: 'leakTest' });\n    EH.trackListener(target, 'testEvent', handler2, { context: 'leakTest' });\n\n    expect(EH.getActiveListenerCount()).toBe(1); // Same element map, but still >0\n\n    // Cleanup by context\n    EH.cleanupListeners({ context: 'leakTest' });\n\n    expect(EH.getActiveListenerCount()).toBe(0);\n  });\n});\n"],"mappings":"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","ignoreList":[]}