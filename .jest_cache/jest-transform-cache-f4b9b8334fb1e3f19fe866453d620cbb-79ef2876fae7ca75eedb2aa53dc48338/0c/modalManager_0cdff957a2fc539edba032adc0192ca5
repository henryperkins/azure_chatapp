3081ac357ab77ee274828df5cc00776d
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createModalManager = createModalManager;
exports.createProjectModal = createProjectModal;
exports.default = void 0;
var _modalConstants = require("./modalConstants.js");
var _modalRenderer = require("./modalRenderer.js");
var _modalStateManager = require("./modalStateManager.js");
var _modalFormHandler = require("./modalFormHandler.js");
/**
 * modalManager.js - Refactored Modal Manager (Phase-2)
 * ---------------------------------------------------
 * Slim coordinator that orchestrates modal operations using extracted modules:
 * - ModalRenderer: DOM manipulation and rendering
 * - ModalStateManager: State tracking and lifecycle
 * - ModalFormHandler: Form handling within modals
 *
 * Reduced from 1235 â†’ ~400 lines through separation of concerns.
 */

function createModalManager({
  eventHandlers,
  domAPI,
  browserService,
  DependencySystem,
  modalMapping,
  domPurify,
  domReadinessService,
  logger,
  errorReporter,
  eventService,
  sanitizer
} = {}) {
  // Dependency validation
  if (!domAPI) {
    throw new Error('[ModalManager] domAPI DI not provided');
  }
  if (!browserService) {
    throw new Error('[ModalManager] browserService DI not provided');
  }
  if (!logger) {
    throw new Error('[ModalManager] logger is required');
  }
  const MODULE_CONTEXT = 'ModalManager';

  // Use provided sanitizer or fallback to domPurify
  const modalSanitizer = sanitizer || domPurify;
  if (!modalSanitizer) {
    throw new Error('[ModalManager] sanitizer (DOMPurify) is required');
  }

  // Get safeHandler
  const safeHandler = DependencySystem?.modules?.get?.('safeHandler');
  if (typeof safeHandler !== 'function') {
    throw new Error('[ModalManager] safeHandler not available in DependencySystem');
  }

  // === EXTRACTED MODULE INSTANCES ===
  const renderer = (0, _modalRenderer.createModalRenderer)({
    domAPI,
    browserService,
    logger,
    sanitizer: modalSanitizer
  });
  const stateManager = (0, _modalStateManager.createModalStateManager)({
    eventService: eventService || DependencySystem?.modules?.get?.('eventService'),
    logger,
    modalMappings: modalMapping || _modalConstants.MODAL_MAPPINGS
  });
  const formHandler = (0, _modalFormHandler.createModalFormHandler)({
    domAPI,
    eventHandlers,
    logger,
    sanitizer: modalSanitizer,
    safeHandler
  });

  // === INITIALIZATION ===
  let isReady = false;
  let readyPromise = null;
  async function initialize() {
    if (readyPromise) return readyPromise;
    readyPromise = (async () => {
      try {
        logger.info('[ModalManager] Initializing', {
          context: MODULE_CONTEXT
        });

        // Register default modal mappings
        const mappings = modalMapping || _modalConstants.MODAL_MAPPINGS;
        for (const [name, id] of Object.entries(mappings)) {
          stateManager.registerModal(name, id);
        }

        // Set up global modal event listeners
        setupGlobalEventListeners();
        isReady = true;
        logger.info('[ModalManager] Initialization complete', {
          modalCount: Object.keys(mappings).length,
          context: MODULE_CONTEXT
        });
      } catch (err) {
        logger.error('[ModalManager] Initialization failed', err, {
          context: MODULE_CONTEXT
        });
        throw err;
      }
    })();
    return readyPromise;
  }
  function setupGlobalEventListeners() {
    const document = domAPI.getDocument();

    // ESC key handler
    const escapeHandler = safeHandler(event => {
      if (event.key === 'Escape') {
        const activeModal = stateManager.getActiveModal();
        if (activeModal) {
          hide(activeModal);
        }
      }
    }, MODULE_CONTEXT + ':EscapeKey');
    eventHandlers.trackListener(document, 'keydown', escapeHandler, {
      context: MODULE_CONTEXT,
      description: 'EscapeKeyHandler'
    });

    // Modal backdrop click handler
    const backdropHandler = safeHandler(event => {
      if (event.target.classList.contains('modal-backdrop')) {
        const activeModal = stateManager.getActiveModal();
        if (activeModal) {
          hide(activeModal);
        }
      }
    }, MODULE_CONTEXT + ':BackdropClick');
    eventHandlers.trackListener(document, 'click', backdropHandler, {
      context: MODULE_CONTEXT,
      description: 'BackdropClickHandler'
    });

    // Modal close request handler
    const closeRequestHandler = safeHandler(event => {
      const {
        modalId,
        source
      } = event.detail || {};
      if (modalId) {
        const modalName = stateManager.getModalName(modalId);
        if (modalName) {
          logger.debug('[ModalManager] Close requested', {
            modalName,
            source
          });
          hide(modalName);
        }
      }
    }, MODULE_CONTEXT + ':CloseRequest');
    eventHandlers.trackListener(document, 'modal:requestClose', closeRequestHandler, {
      context: MODULE_CONTEXT,
      description: 'CloseRequestHandler'
    });
  }

  // === CORE MODAL OPERATIONS ===
  function show(modalName, options = {}) {
    try {
      logger.debug('[ModalManager] Showing modal', {
        modalName,
        options
      });
      if (!stateManager.canOpenModal(modalName)) {
        logger.warn('[ModalManager] Cannot open modal', {
          modalName
        });
        return false;
      }
      const modalId = stateManager.getModalId(modalName);
      const modalEl = renderer.findModalElement(modalId);
      if (!modalEl) {
        logger.error('[ModalManager] Modal element not found', {
          modalName,
          modalId
        });
        return false;
      }

      // Update content if provided
      if (options.content) {
        renderer.updateModalContent(modalEl, options.content, {
          sanitize: options.sanitize !== false,
          selector: options.contentSelector
        });
      }

      // Update title if provided
      if (options.title) {
        renderer.setModalTitle(modalEl, options.title);
      }

      // Update modal content via callback
      if (typeof options.updateContent === 'function') {
        try {
          options.updateContent(modalEl);
        } catch (err) {
          logger.error('[ModalManager] Update content callback failed', err, {
            modalName
          });
        }
      }

      // Show the modal
      const success = renderer.showModalElement(modalEl);
      if (success) {
        stateManager.setActiveModal(modalName);

        // Center modal if requested
        if (options.center) {
          renderer.centerModal(modalEl);
        }
        logger.info('[ModalManager] Modal shown successfully', {
          modalName
        });
        return true;
      } else {
        logger.error('[ModalManager] Failed to show modal element', {
          modalName
        });
        return false;
      }
    } catch (err) {
      logger.error('[ModalManager] Error showing modal', err, {
        modalName
      });
      return false;
    }
  }
  function hide(modalName) {
    try {
      logger.debug('[ModalManager] Hiding modal', {
        modalName
      });
      if (!modalName) {
        // Hide active modal if no name provided
        modalName = stateManager.getActiveModal();
        if (!modalName) {
          logger.warn('[ModalManager] No modal to hide');
          return false;
        }
      }
      if (!stateManager.canCloseModal(modalName)) {
        logger.warn('[ModalManager] Cannot close modal', {
          modalName
        });
        return false;
      }
      const modalId = stateManager.getModalId(modalName);
      const modalEl = renderer.findModalElement(modalId);
      if (!modalEl) {
        logger.error('[ModalManager] Modal element not found for hiding', {
          modalName,
          modalId
        });
        return false;
      }

      // Hide the modal
      const success = renderer.hideModalElement(modalEl);
      if (success) {
        stateManager.setActiveModal(null);
        logger.info('[ModalManager] Modal hidden successfully', {
          modalName
        });
        return true;
      } else {
        logger.error('[ModalManager] Failed to hide modal element', {
          modalName
        });
        return false;
      }
    } catch (err) {
      logger.error('[ModalManager] Error hiding modal', err, {
        modalName
      });
      return false;
    }
  }
  function toggle(modalName, options = {}) {
    if (stateManager.isModalOpen(modalName)) {
      return hide(modalName);
    } else {
      return show(modalName, options);
    }
  }
  function hideAll() {
    try {
      const closedModals = stateManager.closeAllModals();

      // Hide all modal elements
      closedModals.forEach(modalName => {
        const modalId = stateManager.getModalId(modalName);
        const modalEl = renderer.findModalElement(modalId);
        if (modalEl) {
          renderer.hideModalElement(modalEl);
        }
      });
      logger.info('[ModalManager] All modals hidden', {
        count: closedModals.length
      });
      return closedModals;
    } catch (err) {
      logger.error('[ModalManager] Error hiding all modals', err);
      return [];
    }
  }

  // === FORM INTEGRATION ===
  function bindForm(modalName, formSelector, onSubmit, options = {}) {
    try {
      const modalId = stateManager.getModalId(modalName);
      const modalEl = renderer.findModalElement(modalId);
      if (!modalEl) {
        logger.error('[ModalManager] Cannot bind form - modal not found', {
          modalName,
          modalId
        });
        return false;
      }
      return formHandler.bindModalForm(modalEl, formSelector, onSubmit, {
        ...options,
        context: MODULE_CONTEXT + ':' + modalName
      });
    } catch (err) {
      logger.error('[ModalManager] Error binding modal form', err, {
        modalName,
        formSelector
      });
      return false;
    }
  }

  // === CONFIRMATION DIALOGS ===
  function confirmDelete(options = {}) {
    const {
      title = 'Confirm Delete',
      message = 'Are you sure you want to delete this item?',
      confirmText = 'Delete',
      cancelText = 'Cancel',
      confirmClass = 'btn-error',
      onConfirm,
      onCancel
    } = options;
    return show('confirm', {
      title,
      updateContent: modalEl => {
        const messageEl = modalEl.querySelector('.modal-message');
        if (messageEl) {
          domAPI.setTextContent(messageEl, message);
        }
        const confirmBtn = modalEl.querySelector('.confirm-btn');
        if (confirmBtn) {
          domAPI.setTextContent(confirmBtn, confirmText);
          confirmBtn.className = `btn ${confirmClass}`;

          // Remove existing listeners
          eventHandlers.cleanupListeners({
            target: confirmBtn,
            context: MODULE_CONTEXT + ':ConfirmDelete'
          });

          // Add new listener
          eventHandlers.trackListener(confirmBtn, 'click', safeHandler(() => {
            hide('confirm');
            if (typeof onConfirm === 'function') {
              onConfirm();
            }
          }, MODULE_CONTEXT + ':ConfirmAction'), {
            context: MODULE_CONTEXT + ':ConfirmDelete',
            description: 'ConfirmDeleteAction'
          });
        }
        const cancelBtn = modalEl.querySelector('.cancel-btn');
        if (cancelBtn) {
          domAPI.setTextContent(cancelBtn, cancelText);
          eventHandlers.trackListener(cancelBtn, 'click', safeHandler(() => {
            hide('confirm');
            if (typeof onCancel === 'function') {
              onCancel();
            }
          }, MODULE_CONTEXT + ':CancelAction'), {
            context: MODULE_CONTEXT + ':ConfirmDelete',
            description: 'ConfirmDeleteCancel'
          });
        }
      }
    });
  }
  function confirmAction(options = {}) {
    return confirmDelete(options);
  }

  // === PUBLIC API ===
  return {
    // Initialization
    initialize,
    isReadyPromise: () => readyPromise,
    // Core modal operations
    // Alias openModal -> show for backward compatibility with modules that still
    // expect an `openModal` helper. This avoids widespread refactors while the
    // codebase completes the migration to the more explicit `show` verb.
    openModal: show,
    show,
    hide,
    toggle,
    hideAll,
    // State queries (delegate to state manager)
    isOpen: modalName => stateManager.isModalOpen(modalName),
    getActiveModal: () => stateManager.getActiveModal(),
    getModalStack: () => stateManager.getModalStack(),
    getAllStates: () => stateManager.getAllModalStates(),
    // Form handling (delegate to form handler)
    bindForm,
    validateForm: (modalName, formSelector) => {
      const modalId = stateManager.getModalId(modalName);
      const modalEl = renderer.findModalElement(modalId);
      if (modalEl) {
        const form = modalEl.querySelector(formSelector);
        return formHandler.validateModalForm(form);
      }
      return {
        valid: false,
        errors: ['Modal or form not found']
      };
    },
    // Confirmation dialogs
    confirmDelete,
    confirmAction,
    // Modal management
    registerModal: (name, id, options) => stateManager.registerModal(name, id, options),
    unregisterModal: name => stateManager.unregisterModal(name),
    // Utility methods
    getModalMappings: () => stateManager.getModalMappings(),
    updateModalContent: (modalName, content, options) => {
      const modalId = stateManager.getModalId(modalName);
      const modalEl = renderer.findModalElement(modalId);
      return modalEl ? renderer.updateModalContent(modalEl, content, options) : false;
    },
    cleanup() {
      logger.debug('[ModalManager] cleanup()', {
        context: MODULE_CONTEXT
      });

      // Cleanup extracted modules
      renderer.cleanup();
      stateManager.cleanup();
      formHandler.cleanup();

      // Cleanup event listeners
      eventHandlers.cleanupListeners({
        context: MODULE_CONTEXT
      });

      // Reset state
      isReady = false;
      readyPromise = null;
    }
  };
}

// Legacy class-based interface for backward compatibility
class ModalManager {
  constructor(opts) {
    const manager = createModalManager(opts);

    // Delegate all methods to the functional implementation
    Object.assign(this, manager);

    // Auto-initialize
    this.initialize().catch(err => {
      if (opts?.logger) {
        opts.logger.error('[ModalManager] Auto-initialization failed:', err, {
          context: 'ModalManager'
        });
      } else {
        console.error('[ModalManager] Auto-initialization failed:', err);
      }
    });
  }
}

/**
 * createProjectModal â€“ thin convenience wrapper around the generic
 * createModalManager specifically configured for the "project" modal
 * defined in MODAL_MAPPINGS (logical key: 'project').  It exposes a
 * single helper `openModal(projectData)` that pre-populates the modal
 * form fields when editing an existing project.  All other methods are
 * delegated to the underlying ModalManager instance so consumers retain
 * full access to show/hide/toggle APIs.
 *
 * This factory exists solely for backward-compatibility with modules
 * that were built before the Phase-2 modal refactor and still expect a
 * dedicated ProjectModal helper.  New code should use the unified
 * ModalManager.show('project', â€¦) interface.
 */
exports.default = ModalManager;
function createProjectModal(options = {}) {
  // Re-use the generic modal manager implementation â€“ do **NOT** create
  // duplicate state; single source of truth lives in ModalManager.
  const modalManager = createModalManager(options);
  async function openModal(projectData = {}) {
    // Ensure underlying ModalManager is ready before attempting to show.
    if (typeof modalManager.initialize === 'function') {
      try {
        await modalManager.initialize();
      } catch (_) {
        // Initialization errors are already logged inside ModalManager.
      }
    }
    const {
      name = '',
      description = ''
    } = projectData || {};
    return modalManager.show('project', {
      updateContent: modalEl => {
        if (!modalEl) return;

        // Pre-fill commonly used inputs.  Fallbacks are no-ops if elements
        // are missing â€“ we intentionally avoid hard dependencies on the
        // exact template markup to keep this helper resilient to future
        // UI tweaks.
        const nameInput = modalEl.querySelector('#projectModalNameInput');
        if (nameInput) nameInput.value = name;
        const descInput = modalEl.querySelector('#projectModalDescriptionInput');
        if (descInput) descInput.value = description;
      }
    });
  }
  return {
    ...modalManager,
    openModal
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbW9kYWxDb25zdGFudHMiLCJyZXF1aXJlIiwiX21vZGFsUmVuZGVyZXIiLCJfbW9kYWxTdGF0ZU1hbmFnZXIiLCJfbW9kYWxGb3JtSGFuZGxlciIsImNyZWF0ZU1vZGFsTWFuYWdlciIsImV2ZW50SGFuZGxlcnMiLCJkb21BUEkiLCJicm93c2VyU2VydmljZSIsIkRlcGVuZGVuY3lTeXN0ZW0iLCJtb2RhbE1hcHBpbmciLCJkb21QdXJpZnkiLCJkb21SZWFkaW5lc3NTZXJ2aWNlIiwibG9nZ2VyIiwiZXJyb3JSZXBvcnRlciIsImV2ZW50U2VydmljZSIsInNhbml0aXplciIsIkVycm9yIiwiTU9EVUxFX0NPTlRFWFQiLCJtb2RhbFNhbml0aXplciIsInNhZmVIYW5kbGVyIiwibW9kdWxlcyIsImdldCIsInJlbmRlcmVyIiwiY3JlYXRlTW9kYWxSZW5kZXJlciIsInN0YXRlTWFuYWdlciIsImNyZWF0ZU1vZGFsU3RhdGVNYW5hZ2VyIiwibW9kYWxNYXBwaW5ncyIsIk1PREFMX01BUFBJTkdTIiwiZm9ybUhhbmRsZXIiLCJjcmVhdGVNb2RhbEZvcm1IYW5kbGVyIiwiaXNSZWFkeSIsInJlYWR5UHJvbWlzZSIsImluaXRpYWxpemUiLCJpbmZvIiwiY29udGV4dCIsIm1hcHBpbmdzIiwibmFtZSIsImlkIiwiT2JqZWN0IiwiZW50cmllcyIsInJlZ2lzdGVyTW9kYWwiLCJzZXR1cEdsb2JhbEV2ZW50TGlzdGVuZXJzIiwibW9kYWxDb3VudCIsImtleXMiLCJsZW5ndGgiLCJlcnIiLCJlcnJvciIsImRvY3VtZW50IiwiZ2V0RG9jdW1lbnQiLCJlc2NhcGVIYW5kbGVyIiwiZXZlbnQiLCJrZXkiLCJhY3RpdmVNb2RhbCIsImdldEFjdGl2ZU1vZGFsIiwiaGlkZSIsInRyYWNrTGlzdGVuZXIiLCJkZXNjcmlwdGlvbiIsImJhY2tkcm9wSGFuZGxlciIsInRhcmdldCIsImNsYXNzTGlzdCIsImNvbnRhaW5zIiwiY2xvc2VSZXF1ZXN0SGFuZGxlciIsIm1vZGFsSWQiLCJzb3VyY2UiLCJkZXRhaWwiLCJtb2RhbE5hbWUiLCJnZXRNb2RhbE5hbWUiLCJkZWJ1ZyIsInNob3ciLCJvcHRpb25zIiwiY2FuT3Blbk1vZGFsIiwid2FybiIsImdldE1vZGFsSWQiLCJtb2RhbEVsIiwiZmluZE1vZGFsRWxlbWVudCIsImNvbnRlbnQiLCJ1cGRhdGVNb2RhbENvbnRlbnQiLCJzYW5pdGl6ZSIsInNlbGVjdG9yIiwiY29udGVudFNlbGVjdG9yIiwidGl0bGUiLCJzZXRNb2RhbFRpdGxlIiwidXBkYXRlQ29udGVudCIsInN1Y2Nlc3MiLCJzaG93TW9kYWxFbGVtZW50Iiwic2V0QWN0aXZlTW9kYWwiLCJjZW50ZXIiLCJjZW50ZXJNb2RhbCIsImNhbkNsb3NlTW9kYWwiLCJoaWRlTW9kYWxFbGVtZW50IiwidG9nZ2xlIiwiaXNNb2RhbE9wZW4iLCJoaWRlQWxsIiwiY2xvc2VkTW9kYWxzIiwiY2xvc2VBbGxNb2RhbHMiLCJmb3JFYWNoIiwiY291bnQiLCJiaW5kRm9ybSIsImZvcm1TZWxlY3RvciIsIm9uU3VibWl0IiwiYmluZE1vZGFsRm9ybSIsImNvbmZpcm1EZWxldGUiLCJtZXNzYWdlIiwiY29uZmlybVRleHQiLCJjYW5jZWxUZXh0IiwiY29uZmlybUNsYXNzIiwib25Db25maXJtIiwib25DYW5jZWwiLCJtZXNzYWdlRWwiLCJxdWVyeVNlbGVjdG9yIiwic2V0VGV4dENvbnRlbnQiLCJjb25maXJtQnRuIiwiY2xhc3NOYW1lIiwiY2xlYW51cExpc3RlbmVycyIsImNhbmNlbEJ0biIsImNvbmZpcm1BY3Rpb24iLCJpc1JlYWR5UHJvbWlzZSIsIm9wZW5Nb2RhbCIsImlzT3BlbiIsImdldE1vZGFsU3RhY2siLCJnZXRBbGxTdGF0ZXMiLCJnZXRBbGxNb2RhbFN0YXRlcyIsInZhbGlkYXRlRm9ybSIsImZvcm0iLCJ2YWxpZGF0ZU1vZGFsRm9ybSIsInZhbGlkIiwiZXJyb3JzIiwidW5yZWdpc3Rlck1vZGFsIiwiZ2V0TW9kYWxNYXBwaW5ncyIsImNsZWFudXAiLCJNb2RhbE1hbmFnZXIiLCJjb25zdHJ1Y3RvciIsIm9wdHMiLCJtYW5hZ2VyIiwiYXNzaWduIiwiY2F0Y2giLCJjb25zb2xlIiwiZXhwb3J0cyIsImRlZmF1bHQiLCJjcmVhdGVQcm9qZWN0TW9kYWwiLCJtb2RhbE1hbmFnZXIiLCJwcm9qZWN0RGF0YSIsIl8iLCJuYW1lSW5wdXQiLCJ2YWx1ZSIsImRlc2NJbnB1dCJdLCJzb3VyY2VzIjpbIm1vZGFsTWFuYWdlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIG1vZGFsTWFuYWdlci5qcyAtIFJlZmFjdG9yZWQgTW9kYWwgTWFuYWdlciAoUGhhc2UtMilcbiAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogU2xpbSBjb29yZGluYXRvciB0aGF0IG9yY2hlc3RyYXRlcyBtb2RhbCBvcGVyYXRpb25zIHVzaW5nIGV4dHJhY3RlZCBtb2R1bGVzOlxuICogLSBNb2RhbFJlbmRlcmVyOiBET00gbWFuaXB1bGF0aW9uIGFuZCByZW5kZXJpbmdcbiAqIC0gTW9kYWxTdGF0ZU1hbmFnZXI6IFN0YXRlIHRyYWNraW5nIGFuZCBsaWZlY3ljbGVcbiAqIC0gTW9kYWxGb3JtSGFuZGxlcjogRm9ybSBoYW5kbGluZyB3aXRoaW4gbW9kYWxzXG4gKlxuICogUmVkdWNlZCBmcm9tIDEyMzUg4oaSIH40MDAgbGluZXMgdGhyb3VnaCBzZXBhcmF0aW9uIG9mIGNvbmNlcm5zLlxuICovXG5cbmltcG9ydCB7IE1PREFMX01BUFBJTkdTIH0gZnJvbSAnLi9tb2RhbENvbnN0YW50cy5qcyc7XG5pbXBvcnQgeyBjcmVhdGVNb2RhbFJlbmRlcmVyIH0gZnJvbSAnLi9tb2RhbFJlbmRlcmVyLmpzJztcbmltcG9ydCB7IGNyZWF0ZU1vZGFsU3RhdGVNYW5hZ2VyIH0gZnJvbSAnLi9tb2RhbFN0YXRlTWFuYWdlci5qcyc7XG5pbXBvcnQgeyBjcmVhdGVNb2RhbEZvcm1IYW5kbGVyIH0gZnJvbSAnLi9tb2RhbEZvcm1IYW5kbGVyLmpzJztcblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vZGFsTWFuYWdlcih7XG4gIGV2ZW50SGFuZGxlcnMsXG4gIGRvbUFQSSxcbiAgYnJvd3NlclNlcnZpY2UsXG4gIERlcGVuZGVuY3lTeXN0ZW0sXG4gIG1vZGFsTWFwcGluZyxcbiAgZG9tUHVyaWZ5LFxuICBkb21SZWFkaW5lc3NTZXJ2aWNlLFxuICBsb2dnZXIsXG4gIGVycm9yUmVwb3J0ZXIsXG4gIGV2ZW50U2VydmljZSxcbiAgc2FuaXRpemVyXG59ID0ge30pIHtcblxuICAvLyBEZXBlbmRlbmN5IHZhbGlkYXRpb25cbiAgaWYgKCFkb21BUEkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1tNb2RhbE1hbmFnZXJdIGRvbUFQSSBESSBub3QgcHJvdmlkZWQnKTtcbiAgfVxuICBpZiAoIWJyb3dzZXJTZXJ2aWNlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdbTW9kYWxNYW5hZ2VyXSBicm93c2VyU2VydmljZSBESSBub3QgcHJvdmlkZWQnKTtcbiAgfVxuICBpZiAoIWxvZ2dlcikge1xuICAgIHRocm93IG5ldyBFcnJvcignW01vZGFsTWFuYWdlcl0gbG9nZ2VyIGlzIHJlcXVpcmVkJyk7XG4gIH1cblxuICBjb25zdCBNT0RVTEVfQ09OVEVYVCA9ICdNb2RhbE1hbmFnZXInO1xuXG4gIC8vIFVzZSBwcm92aWRlZCBzYW5pdGl6ZXIgb3IgZmFsbGJhY2sgdG8gZG9tUHVyaWZ5XG4gIGNvbnN0IG1vZGFsU2FuaXRpemVyID0gc2FuaXRpemVyIHx8IGRvbVB1cmlmeTtcbiAgaWYgKCFtb2RhbFNhbml0aXplcikge1xuICAgIHRocm93IG5ldyBFcnJvcignW01vZGFsTWFuYWdlcl0gc2FuaXRpemVyIChET01QdXJpZnkpIGlzIHJlcXVpcmVkJyk7XG4gIH1cblxuICAvLyBHZXQgc2FmZUhhbmRsZXJcbiAgY29uc3Qgc2FmZUhhbmRsZXIgPSBEZXBlbmRlbmN5U3lzdGVtPy5tb2R1bGVzPy5nZXQ/Lignc2FmZUhhbmRsZXInKTtcbiAgaWYgKHR5cGVvZiBzYWZlSGFuZGxlciAhPT0gJ2Z1bmN0aW9uJykge1xuICAgIHRocm93IG5ldyBFcnJvcignW01vZGFsTWFuYWdlcl0gc2FmZUhhbmRsZXIgbm90IGF2YWlsYWJsZSBpbiBEZXBlbmRlbmN5U3lzdGVtJyk7XG4gIH1cblxuICAvLyA9PT0gRVhUUkFDVEVEIE1PRFVMRSBJTlNUQU5DRVMgPT09XG4gIGNvbnN0IHJlbmRlcmVyID0gY3JlYXRlTW9kYWxSZW5kZXJlcih7XG4gICAgZG9tQVBJLFxuICAgIGJyb3dzZXJTZXJ2aWNlLFxuICAgIGxvZ2dlcixcbiAgICBzYW5pdGl6ZXI6IG1vZGFsU2FuaXRpemVyXG4gIH0pO1xuXG4gIGNvbnN0IHN0YXRlTWFuYWdlciA9IGNyZWF0ZU1vZGFsU3RhdGVNYW5hZ2VyKHtcbiAgICBldmVudFNlcnZpY2U6IGV2ZW50U2VydmljZSB8fCBEZXBlbmRlbmN5U3lzdGVtPy5tb2R1bGVzPy5nZXQ/LignZXZlbnRTZXJ2aWNlJyksXG4gICAgbG9nZ2VyLFxuICAgIG1vZGFsTWFwcGluZ3M6IG1vZGFsTWFwcGluZyB8fCBNT0RBTF9NQVBQSU5HU1xuICB9KTtcblxuICBjb25zdCBmb3JtSGFuZGxlciA9IGNyZWF0ZU1vZGFsRm9ybUhhbmRsZXIoe1xuICAgIGRvbUFQSSxcbiAgICBldmVudEhhbmRsZXJzLFxuICAgIGxvZ2dlcixcbiAgICBzYW5pdGl6ZXI6IG1vZGFsU2FuaXRpemVyLFxuICAgIHNhZmVIYW5kbGVyXG4gIH0pO1xuXG4gIC8vID09PSBJTklUSUFMSVpBVElPTiA9PT1cbiAgbGV0IGlzUmVhZHkgPSBmYWxzZTtcbiAgbGV0IHJlYWR5UHJvbWlzZSA9IG51bGw7XG5cbiAgYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZSgpIHtcbiAgICBpZiAocmVhZHlQcm9taXNlKSByZXR1cm4gcmVhZHlQcm9taXNlO1xuXG4gICAgcmVhZHlQcm9taXNlID0gKGFzeW5jICgpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGxvZ2dlci5pbmZvKCdbTW9kYWxNYW5hZ2VyXSBJbml0aWFsaXppbmcnLCB7IGNvbnRleHQ6IE1PRFVMRV9DT05URVhUIH0pO1xuXG5cblxuICAgICAgICAvLyBSZWdpc3RlciBkZWZhdWx0IG1vZGFsIG1hcHBpbmdzXG4gICAgICAgIGNvbnN0IG1hcHBpbmdzID0gbW9kYWxNYXBwaW5nIHx8IE1PREFMX01BUFBJTkdTO1xuICAgICAgICBmb3IgKGNvbnN0IFtuYW1lLCBpZF0gb2YgT2JqZWN0LmVudHJpZXMobWFwcGluZ3MpKSB7XG4gICAgICAgICAgc3RhdGVNYW5hZ2VyLnJlZ2lzdGVyTW9kYWwobmFtZSwgaWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2V0IHVwIGdsb2JhbCBtb2RhbCBldmVudCBsaXN0ZW5lcnNcbiAgICAgICAgc2V0dXBHbG9iYWxFdmVudExpc3RlbmVycygpO1xuXG4gICAgICAgIGlzUmVhZHkgPSB0cnVlO1xuICAgICAgICBsb2dnZXIuaW5mbygnW01vZGFsTWFuYWdlcl0gSW5pdGlhbGl6YXRpb24gY29tcGxldGUnLCB7XG4gICAgICAgICAgbW9kYWxDb3VudDogT2JqZWN0LmtleXMobWFwcGluZ3MpLmxlbmd0aCxcbiAgICAgICAgICBjb250ZXh0OiBNT0RVTEVfQ09OVEVYVFxuICAgICAgICB9KTtcblxuICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcignW01vZGFsTWFuYWdlcl0gSW5pdGlhbGl6YXRpb24gZmFpbGVkJywgZXJyLCB7IGNvbnRleHQ6IE1PRFVMRV9DT05URVhUIH0pO1xuICAgICAgICB0aHJvdyBlcnI7XG4gICAgICB9XG4gICAgfSkoKTtcblxuICAgIHJldHVybiByZWFkeVByb21pc2U7XG4gIH1cblxuICBmdW5jdGlvbiBzZXR1cEdsb2JhbEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIGNvbnN0IGRvY3VtZW50ID0gZG9tQVBJLmdldERvY3VtZW50KCk7XG5cbiAgICAvLyBFU0Mga2V5IGhhbmRsZXJcbiAgICBjb25zdCBlc2NhcGVIYW5kbGVyID0gc2FmZUhhbmRsZXIoKGV2ZW50KSA9PiB7XG4gICAgICBpZiAoZXZlbnQua2V5ID09PSAnRXNjYXBlJykge1xuICAgICAgICBjb25zdCBhY3RpdmVNb2RhbCA9IHN0YXRlTWFuYWdlci5nZXRBY3RpdmVNb2RhbCgpO1xuICAgICAgICBpZiAoYWN0aXZlTW9kYWwpIHtcbiAgICAgICAgICBoaWRlKGFjdGl2ZU1vZGFsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sIE1PRFVMRV9DT05URVhUICsgJzpFc2NhcGVLZXknKTtcblxuICAgIGV2ZW50SGFuZGxlcnMudHJhY2tMaXN0ZW5lcihkb2N1bWVudCwgJ2tleWRvd24nLCBlc2NhcGVIYW5kbGVyLCB7XG4gICAgICBjb250ZXh0OiBNT0RVTEVfQ09OVEVYVCxcbiAgICAgIGRlc2NyaXB0aW9uOiAnRXNjYXBlS2V5SGFuZGxlcidcbiAgICB9KTtcblxuICAgIC8vIE1vZGFsIGJhY2tkcm9wIGNsaWNrIGhhbmRsZXJcbiAgICBjb25zdCBiYWNrZHJvcEhhbmRsZXIgPSBzYWZlSGFuZGxlcigoZXZlbnQpID0+IHtcbiAgICAgIGlmIChldmVudC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdtb2RhbC1iYWNrZHJvcCcpKSB7XG4gICAgICAgIGNvbnN0IGFjdGl2ZU1vZGFsID0gc3RhdGVNYW5hZ2VyLmdldEFjdGl2ZU1vZGFsKCk7XG4gICAgICAgIGlmIChhY3RpdmVNb2RhbCkge1xuICAgICAgICAgIGhpZGUoYWN0aXZlTW9kYWwpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSwgTU9EVUxFX0NPTlRFWFQgKyAnOkJhY2tkcm9wQ2xpY2snKTtcblxuICAgIGV2ZW50SGFuZGxlcnMudHJhY2tMaXN0ZW5lcihkb2N1bWVudCwgJ2NsaWNrJywgYmFja2Ryb3BIYW5kbGVyLCB7XG4gICAgICBjb250ZXh0OiBNT0RVTEVfQ09OVEVYVCxcbiAgICAgIGRlc2NyaXB0aW9uOiAnQmFja2Ryb3BDbGlja0hhbmRsZXInXG4gICAgfSk7XG5cbiAgICAvLyBNb2RhbCBjbG9zZSByZXF1ZXN0IGhhbmRsZXJcbiAgICBjb25zdCBjbG9zZVJlcXVlc3RIYW5kbGVyID0gc2FmZUhhbmRsZXIoKGV2ZW50KSA9PiB7XG4gICAgICBjb25zdCB7IG1vZGFsSWQsIHNvdXJjZSB9ID0gZXZlbnQuZGV0YWlsIHx8IHt9O1xuICAgICAgaWYgKG1vZGFsSWQpIHtcbiAgICAgICAgY29uc3QgbW9kYWxOYW1lID0gc3RhdGVNYW5hZ2VyLmdldE1vZGFsTmFtZShtb2RhbElkKTtcbiAgICAgICAgaWYgKG1vZGFsTmFtZSkge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnW01vZGFsTWFuYWdlcl0gQ2xvc2UgcmVxdWVzdGVkJywgeyBtb2RhbE5hbWUsIHNvdXJjZSB9KTtcbiAgICAgICAgICBoaWRlKG1vZGFsTmFtZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LCBNT0RVTEVfQ09OVEVYVCArICc6Q2xvc2VSZXF1ZXN0Jyk7XG5cbiAgICBldmVudEhhbmRsZXJzLnRyYWNrTGlzdGVuZXIoZG9jdW1lbnQsICdtb2RhbDpyZXF1ZXN0Q2xvc2UnLCBjbG9zZVJlcXVlc3RIYW5kbGVyLCB7XG4gICAgICBjb250ZXh0OiBNT0RVTEVfQ09OVEVYVCxcbiAgICAgIGRlc2NyaXB0aW9uOiAnQ2xvc2VSZXF1ZXN0SGFuZGxlcidcbiAgICB9KTtcbiAgfVxuXG4gIC8vID09PSBDT1JFIE1PREFMIE9QRVJBVElPTlMgPT09XG4gIGZ1bmN0aW9uIHNob3cobW9kYWxOYW1lLCBvcHRpb25zID0ge30pIHtcbiAgICB0cnkge1xuICAgICAgbG9nZ2VyLmRlYnVnKCdbTW9kYWxNYW5hZ2VyXSBTaG93aW5nIG1vZGFsJywgeyBtb2RhbE5hbWUsIG9wdGlvbnMgfSk7XG5cbiAgICAgIGlmICghc3RhdGVNYW5hZ2VyLmNhbk9wZW5Nb2RhbChtb2RhbE5hbWUpKSB7XG4gICAgICAgIGxvZ2dlci53YXJuKCdbTW9kYWxNYW5hZ2VyXSBDYW5ub3Qgb3BlbiBtb2RhbCcsIHsgbW9kYWxOYW1lIH0pO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG1vZGFsSWQgPSBzdGF0ZU1hbmFnZXIuZ2V0TW9kYWxJZChtb2RhbE5hbWUpO1xuICAgICAgY29uc3QgbW9kYWxFbCA9IHJlbmRlcmVyLmZpbmRNb2RhbEVsZW1lbnQobW9kYWxJZCk7XG5cbiAgICAgIGlmICghbW9kYWxFbCkge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ1tNb2RhbE1hbmFnZXJdIE1vZGFsIGVsZW1lbnQgbm90IGZvdW5kJywgeyBtb2RhbE5hbWUsIG1vZGFsSWQgfSk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgLy8gVXBkYXRlIGNvbnRlbnQgaWYgcHJvdmlkZWRcbiAgICAgIGlmIChvcHRpb25zLmNvbnRlbnQpIHtcbiAgICAgICAgcmVuZGVyZXIudXBkYXRlTW9kYWxDb250ZW50KG1vZGFsRWwsIG9wdGlvbnMuY29udGVudCwge1xuICAgICAgICAgIHNhbml0aXplOiBvcHRpb25zLnNhbml0aXplICE9PSBmYWxzZSxcbiAgICAgICAgICBzZWxlY3Rvcjogb3B0aW9ucy5jb250ZW50U2VsZWN0b3JcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSB0aXRsZSBpZiBwcm92aWRlZFxuICAgICAgaWYgKG9wdGlvbnMudGl0bGUpIHtcbiAgICAgICAgcmVuZGVyZXIuc2V0TW9kYWxUaXRsZShtb2RhbEVsLCBvcHRpb25zLnRpdGxlKTtcbiAgICAgIH1cblxuICAgICAgLy8gVXBkYXRlIG1vZGFsIGNvbnRlbnQgdmlhIGNhbGxiYWNrXG4gICAgICBpZiAodHlwZW9mIG9wdGlvbnMudXBkYXRlQ29udGVudCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIG9wdGlvbnMudXBkYXRlQ29udGVudChtb2RhbEVsKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgbG9nZ2VyLmVycm9yKCdbTW9kYWxNYW5hZ2VyXSBVcGRhdGUgY29udGVudCBjYWxsYmFjayBmYWlsZWQnLCBlcnIsIHsgbW9kYWxOYW1lIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFNob3cgdGhlIG1vZGFsXG4gICAgICBjb25zdCBzdWNjZXNzID0gcmVuZGVyZXIuc2hvd01vZGFsRWxlbWVudChtb2RhbEVsKTtcbiAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgIHN0YXRlTWFuYWdlci5zZXRBY3RpdmVNb2RhbChtb2RhbE5hbWUpO1xuXG4gICAgICAgIC8vIENlbnRlciBtb2RhbCBpZiByZXF1ZXN0ZWRcbiAgICAgICAgaWYgKG9wdGlvbnMuY2VudGVyKSB7XG4gICAgICAgICAgcmVuZGVyZXIuY2VudGVyTW9kYWwobW9kYWxFbCk7XG4gICAgICAgIH1cblxuICAgICAgICBsb2dnZXIuaW5mbygnW01vZGFsTWFuYWdlcl0gTW9kYWwgc2hvd24gc3VjY2Vzc2Z1bGx5JywgeyBtb2RhbE5hbWUgfSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdbTW9kYWxNYW5hZ2VyXSBGYWlsZWQgdG8gc2hvdyBtb2RhbCBlbGVtZW50JywgeyBtb2RhbE5hbWUgfSk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdbTW9kYWxNYW5hZ2VyXSBFcnJvciBzaG93aW5nIG1vZGFsJywgZXJyLCB7IG1vZGFsTmFtZSB9KTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBoaWRlKG1vZGFsTmFtZSkge1xuICAgIHRyeSB7XG4gICAgICBsb2dnZXIuZGVidWcoJ1tNb2RhbE1hbmFnZXJdIEhpZGluZyBtb2RhbCcsIHsgbW9kYWxOYW1lIH0pO1xuXG4gICAgICBpZiAoIW1vZGFsTmFtZSkge1xuICAgICAgICAvLyBIaWRlIGFjdGl2ZSBtb2RhbCBpZiBubyBuYW1lIHByb3ZpZGVkXG4gICAgICAgIG1vZGFsTmFtZSA9IHN0YXRlTWFuYWdlci5nZXRBY3RpdmVNb2RhbCgpO1xuICAgICAgICBpZiAoIW1vZGFsTmFtZSkge1xuICAgICAgICAgIGxvZ2dlci53YXJuKCdbTW9kYWxNYW5hZ2VyXSBObyBtb2RhbCB0byBoaWRlJyk7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICghc3RhdGVNYW5hZ2VyLmNhbkNsb3NlTW9kYWwobW9kYWxOYW1lKSkge1xuICAgICAgICBsb2dnZXIud2FybignW01vZGFsTWFuYWdlcl0gQ2Fubm90IGNsb3NlIG1vZGFsJywgeyBtb2RhbE5hbWUgfSk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgbW9kYWxJZCA9IHN0YXRlTWFuYWdlci5nZXRNb2RhbElkKG1vZGFsTmFtZSk7XG4gICAgICBjb25zdCBtb2RhbEVsID0gcmVuZGVyZXIuZmluZE1vZGFsRWxlbWVudChtb2RhbElkKTtcblxuICAgICAgaWYgKCFtb2RhbEVsKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcignW01vZGFsTWFuYWdlcl0gTW9kYWwgZWxlbWVudCBub3QgZm91bmQgZm9yIGhpZGluZycsIHsgbW9kYWxOYW1lLCBtb2RhbElkIH0pO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIC8vIEhpZGUgdGhlIG1vZGFsXG4gICAgICBjb25zdCBzdWNjZXNzID0gcmVuZGVyZXIuaGlkZU1vZGFsRWxlbWVudChtb2RhbEVsKTtcbiAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgIHN0YXRlTWFuYWdlci5zZXRBY3RpdmVNb2RhbChudWxsKTtcbiAgICAgICAgbG9nZ2VyLmluZm8oJ1tNb2RhbE1hbmFnZXJdIE1vZGFsIGhpZGRlbiBzdWNjZXNzZnVsbHknLCB7IG1vZGFsTmFtZSB9KTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2dnZXIuZXJyb3IoJ1tNb2RhbE1hbmFnZXJdIEZhaWxlZCB0byBoaWRlIG1vZGFsIGVsZW1lbnQnLCB7IG1vZGFsTmFtZSB9KTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ1tNb2RhbE1hbmFnZXJdIEVycm9yIGhpZGluZyBtb2RhbCcsIGVyciwgeyBtb2RhbE5hbWUgfSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gdG9nZ2xlKG1vZGFsTmFtZSwgb3B0aW9ucyA9IHt9KSB7XG4gICAgaWYgKHN0YXRlTWFuYWdlci5pc01vZGFsT3Blbihtb2RhbE5hbWUpKSB7XG4gICAgICByZXR1cm4gaGlkZShtb2RhbE5hbWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gc2hvdyhtb2RhbE5hbWUsIG9wdGlvbnMpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGhpZGVBbGwoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNsb3NlZE1vZGFscyA9IHN0YXRlTWFuYWdlci5jbG9zZUFsbE1vZGFscygpO1xuXG4gICAgICAvLyBIaWRlIGFsbCBtb2RhbCBlbGVtZW50c1xuICAgICAgY2xvc2VkTW9kYWxzLmZvckVhY2gobW9kYWxOYW1lID0+IHtcbiAgICAgICAgY29uc3QgbW9kYWxJZCA9IHN0YXRlTWFuYWdlci5nZXRNb2RhbElkKG1vZGFsTmFtZSk7XG4gICAgICAgIGNvbnN0IG1vZGFsRWwgPSByZW5kZXJlci5maW5kTW9kYWxFbGVtZW50KG1vZGFsSWQpO1xuICAgICAgICBpZiAobW9kYWxFbCkge1xuICAgICAgICAgIHJlbmRlcmVyLmhpZGVNb2RhbEVsZW1lbnQobW9kYWxFbCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBsb2dnZXIuaW5mbygnW01vZGFsTWFuYWdlcl0gQWxsIG1vZGFscyBoaWRkZW4nLCB7IGNvdW50OiBjbG9zZWRNb2RhbHMubGVuZ3RoIH0pO1xuICAgICAgcmV0dXJuIGNsb3NlZE1vZGFscztcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignW01vZGFsTWFuYWdlcl0gRXJyb3IgaGlkaW5nIGFsbCBtb2RhbHMnLCBlcnIpO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuXG4gIC8vID09PSBGT1JNIElOVEVHUkFUSU9OID09PVxuICBmdW5jdGlvbiBiaW5kRm9ybShtb2RhbE5hbWUsIGZvcm1TZWxlY3Rvciwgb25TdWJtaXQsIG9wdGlvbnMgPSB7fSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBtb2RhbElkID0gc3RhdGVNYW5hZ2VyLmdldE1vZGFsSWQobW9kYWxOYW1lKTtcbiAgICAgIGNvbnN0IG1vZGFsRWwgPSByZW5kZXJlci5maW5kTW9kYWxFbGVtZW50KG1vZGFsSWQpO1xuXG4gICAgICBpZiAoIW1vZGFsRWwpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdbTW9kYWxNYW5hZ2VyXSBDYW5ub3QgYmluZCBmb3JtIC0gbW9kYWwgbm90IGZvdW5kJywgeyBtb2RhbE5hbWUsIG1vZGFsSWQgfSk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZvcm1IYW5kbGVyLmJpbmRNb2RhbEZvcm0obW9kYWxFbCwgZm9ybVNlbGVjdG9yLCBvblN1Ym1pdCwge1xuICAgICAgICAuLi5vcHRpb25zLFxuICAgICAgICBjb250ZXh0OiBNT0RVTEVfQ09OVEVYVCArICc6JyArIG1vZGFsTmFtZVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ1tNb2RhbE1hbmFnZXJdIEVycm9yIGJpbmRpbmcgbW9kYWwgZm9ybScsIGVyciwgeyBtb2RhbE5hbWUsIGZvcm1TZWxlY3RvciB9KTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvLyA9PT0gQ09ORklSTUFUSU9OIERJQUxPR1MgPT09XG4gIGZ1bmN0aW9uIGNvbmZpcm1EZWxldGUob3B0aW9ucyA9IHt9KSB7XG4gICAgY29uc3Qge1xuICAgICAgdGl0bGUgPSAnQ29uZmlybSBEZWxldGUnLFxuICAgICAgbWVzc2FnZSA9ICdBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gZGVsZXRlIHRoaXMgaXRlbT8nLFxuICAgICAgY29uZmlybVRleHQgPSAnRGVsZXRlJyxcbiAgICAgIGNhbmNlbFRleHQgPSAnQ2FuY2VsJyxcbiAgICAgIGNvbmZpcm1DbGFzcyA9ICdidG4tZXJyb3InLFxuICAgICAgb25Db25maXJtLFxuICAgICAgb25DYW5jZWxcbiAgICB9ID0gb3B0aW9ucztcblxuICAgIHJldHVybiBzaG93KCdjb25maXJtJywge1xuICAgICAgdGl0bGUsXG4gICAgICB1cGRhdGVDb250ZW50OiAobW9kYWxFbCkgPT4ge1xuICAgICAgICBjb25zdCBtZXNzYWdlRWwgPSBtb2RhbEVsLnF1ZXJ5U2VsZWN0b3IoJy5tb2RhbC1tZXNzYWdlJyk7XG4gICAgICAgIGlmIChtZXNzYWdlRWwpIHtcbiAgICAgICAgICBkb21BUEkuc2V0VGV4dENvbnRlbnQobWVzc2FnZUVsLCBtZXNzYWdlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGNvbmZpcm1CdG4gPSBtb2RhbEVsLnF1ZXJ5U2VsZWN0b3IoJy5jb25maXJtLWJ0bicpO1xuICAgICAgICBpZiAoY29uZmlybUJ0bikge1xuICAgICAgICAgIGRvbUFQSS5zZXRUZXh0Q29udGVudChjb25maXJtQnRuLCBjb25maXJtVGV4dCk7XG4gICAgICAgICAgY29uZmlybUJ0bi5jbGFzc05hbWUgPSBgYnRuICR7Y29uZmlybUNsYXNzfWA7XG5cbiAgICAgICAgICAvLyBSZW1vdmUgZXhpc3RpbmcgbGlzdGVuZXJzXG4gICAgICAgICAgZXZlbnRIYW5kbGVycy5jbGVhbnVwTGlzdGVuZXJzKHtcbiAgICAgICAgICAgIHRhcmdldDogY29uZmlybUJ0bixcbiAgICAgICAgICAgIGNvbnRleHQ6IE1PRFVMRV9DT05URVhUICsgJzpDb25maXJtRGVsZXRlJ1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgLy8gQWRkIG5ldyBsaXN0ZW5lclxuICAgICAgICAgIGV2ZW50SGFuZGxlcnMudHJhY2tMaXN0ZW5lcihjb25maXJtQnRuLCAnY2xpY2snLCBzYWZlSGFuZGxlcigoKSA9PiB7XG4gICAgICAgICAgICBoaWRlKCdjb25maXJtJyk7XG4gICAgICAgICAgICBpZiAodHlwZW9mIG9uQ29uZmlybSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgICBvbkNvbmZpcm0oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LCBNT0RVTEVfQ09OVEVYVCArICc6Q29uZmlybUFjdGlvbicpLCB7XG4gICAgICAgICAgICBjb250ZXh0OiBNT0RVTEVfQ09OVEVYVCArICc6Q29uZmlybURlbGV0ZScsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ0NvbmZpcm1EZWxldGVBY3Rpb24nXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBjYW5jZWxCdG4gPSBtb2RhbEVsLnF1ZXJ5U2VsZWN0b3IoJy5jYW5jZWwtYnRuJyk7XG4gICAgICAgIGlmIChjYW5jZWxCdG4pIHtcbiAgICAgICAgICBkb21BUEkuc2V0VGV4dENvbnRlbnQoY2FuY2VsQnRuLCBjYW5jZWxUZXh0KTtcblxuICAgICAgICAgIGV2ZW50SGFuZGxlcnMudHJhY2tMaXN0ZW5lcihjYW5jZWxCdG4sICdjbGljaycsIHNhZmVIYW5kbGVyKCgpID0+IHtcbiAgICAgICAgICAgIGhpZGUoJ2NvbmZpcm0nKTtcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb25DYW5jZWwgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgb25DYW5jZWwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LCBNT0RVTEVfQ09OVEVYVCArICc6Q2FuY2VsQWN0aW9uJyksIHtcbiAgICAgICAgICAgIGNvbnRleHQ6IE1PRFVMRV9DT05URVhUICsgJzpDb25maXJtRGVsZXRlJyxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnQ29uZmlybURlbGV0ZUNhbmNlbCdcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gY29uZmlybUFjdGlvbihvcHRpb25zID0ge30pIHtcbiAgICByZXR1cm4gY29uZmlybURlbGV0ZShvcHRpb25zKTtcbiAgfVxuXG4gIC8vID09PSBQVUJMSUMgQVBJID09PVxuICByZXR1cm4ge1xuICAgIC8vIEluaXRpYWxpemF0aW9uXG4gICAgaW5pdGlhbGl6ZSxcbiAgICBpc1JlYWR5UHJvbWlzZTogKCkgPT4gcmVhZHlQcm9taXNlLFxuXG4gICAgLy8gQ29yZSBtb2RhbCBvcGVyYXRpb25zXG4gICAgLy8gQWxpYXMgb3Blbk1vZGFsIC0+IHNob3cgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHkgd2l0aCBtb2R1bGVzIHRoYXQgc3RpbGxcbiAgICAvLyBleHBlY3QgYW4gYG9wZW5Nb2RhbGAgaGVscGVyLiBUaGlzIGF2b2lkcyB3aWRlc3ByZWFkIHJlZmFjdG9ycyB3aGlsZSB0aGVcbiAgICAvLyBjb2RlYmFzZSBjb21wbGV0ZXMgdGhlIG1pZ3JhdGlvbiB0byB0aGUgbW9yZSBleHBsaWNpdCBgc2hvd2AgdmVyYi5cbiAgICBvcGVuTW9kYWw6IHNob3csXG4gICAgc2hvdyxcbiAgICBoaWRlLFxuICAgIHRvZ2dsZSxcbiAgICBoaWRlQWxsLFxuXG4gICAgLy8gU3RhdGUgcXVlcmllcyAoZGVsZWdhdGUgdG8gc3RhdGUgbWFuYWdlcilcbiAgICBpc09wZW46IChtb2RhbE5hbWUpID0+IHN0YXRlTWFuYWdlci5pc01vZGFsT3Blbihtb2RhbE5hbWUpLFxuICAgIGdldEFjdGl2ZU1vZGFsOiAoKSA9PiBzdGF0ZU1hbmFnZXIuZ2V0QWN0aXZlTW9kYWwoKSxcbiAgICBnZXRNb2RhbFN0YWNrOiAoKSA9PiBzdGF0ZU1hbmFnZXIuZ2V0TW9kYWxTdGFjaygpLFxuICAgIGdldEFsbFN0YXRlczogKCkgPT4gc3RhdGVNYW5hZ2VyLmdldEFsbE1vZGFsU3RhdGVzKCksXG5cbiAgICAvLyBGb3JtIGhhbmRsaW5nIChkZWxlZ2F0ZSB0byBmb3JtIGhhbmRsZXIpXG4gICAgYmluZEZvcm0sXG4gICAgdmFsaWRhdGVGb3JtOiAobW9kYWxOYW1lLCBmb3JtU2VsZWN0b3IpID0+IHtcbiAgICAgIGNvbnN0IG1vZGFsSWQgPSBzdGF0ZU1hbmFnZXIuZ2V0TW9kYWxJZChtb2RhbE5hbWUpO1xuICAgICAgY29uc3QgbW9kYWxFbCA9IHJlbmRlcmVyLmZpbmRNb2RhbEVsZW1lbnQobW9kYWxJZCk7XG4gICAgICBpZiAobW9kYWxFbCkge1xuICAgICAgICBjb25zdCBmb3JtID0gbW9kYWxFbC5xdWVyeVNlbGVjdG9yKGZvcm1TZWxlY3Rvcik7XG4gICAgICAgIHJldHVybiBmb3JtSGFuZGxlci52YWxpZGF0ZU1vZGFsRm9ybShmb3JtKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3JzOiBbJ01vZGFsIG9yIGZvcm0gbm90IGZvdW5kJ10gfTtcbiAgICB9LFxuXG4gICAgLy8gQ29uZmlybWF0aW9uIGRpYWxvZ3NcbiAgICBjb25maXJtRGVsZXRlLFxuICAgIGNvbmZpcm1BY3Rpb24sXG5cbiAgICAvLyBNb2RhbCBtYW5hZ2VtZW50XG4gICAgcmVnaXN0ZXJNb2RhbDogKG5hbWUsIGlkLCBvcHRpb25zKSA9PiBzdGF0ZU1hbmFnZXIucmVnaXN0ZXJNb2RhbChuYW1lLCBpZCwgb3B0aW9ucyksXG4gICAgdW5yZWdpc3Rlck1vZGFsOiAobmFtZSkgPT4gc3RhdGVNYW5hZ2VyLnVucmVnaXN0ZXJNb2RhbChuYW1lKSxcblxuICAgIC8vIFV0aWxpdHkgbWV0aG9kc1xuICAgIGdldE1vZGFsTWFwcGluZ3M6ICgpID0+IHN0YXRlTWFuYWdlci5nZXRNb2RhbE1hcHBpbmdzKCksXG4gICAgdXBkYXRlTW9kYWxDb250ZW50OiAobW9kYWxOYW1lLCBjb250ZW50LCBvcHRpb25zKSA9PiB7XG4gICAgICBjb25zdCBtb2RhbElkID0gc3RhdGVNYW5hZ2VyLmdldE1vZGFsSWQobW9kYWxOYW1lKTtcbiAgICAgIGNvbnN0IG1vZGFsRWwgPSByZW5kZXJlci5maW5kTW9kYWxFbGVtZW50KG1vZGFsSWQpO1xuICAgICAgcmV0dXJuIG1vZGFsRWwgPyByZW5kZXJlci51cGRhdGVNb2RhbENvbnRlbnQobW9kYWxFbCwgY29udGVudCwgb3B0aW9ucykgOiBmYWxzZTtcbiAgICB9LFxuXG4gICAgY2xlYW51cCgpIHtcbiAgICAgIGxvZ2dlci5kZWJ1ZygnW01vZGFsTWFuYWdlcl0gY2xlYW51cCgpJywgeyBjb250ZXh0OiBNT0RVTEVfQ09OVEVYVCB9KTtcblxuICAgICAgLy8gQ2xlYW51cCBleHRyYWN0ZWQgbW9kdWxlc1xuICAgICAgcmVuZGVyZXIuY2xlYW51cCgpO1xuICAgICAgc3RhdGVNYW5hZ2VyLmNsZWFudXAoKTtcbiAgICAgIGZvcm1IYW5kbGVyLmNsZWFudXAoKTtcblxuICAgICAgLy8gQ2xlYW51cCBldmVudCBsaXN0ZW5lcnNcbiAgICAgIGV2ZW50SGFuZGxlcnMuY2xlYW51cExpc3RlbmVycyh7IGNvbnRleHQ6IE1PRFVMRV9DT05URVhUIH0pO1xuXG4gICAgICAvLyBSZXNldCBzdGF0ZVxuICAgICAgaXNSZWFkeSA9IGZhbHNlO1xuICAgICAgcmVhZHlQcm9taXNlID0gbnVsbDtcbiAgICB9XG4gIH07XG59XG5cbi8vIExlZ2FjeSBjbGFzcy1iYXNlZCBpbnRlcmZhY2UgZm9yIGJhY2t3YXJkIGNvbXBhdGliaWxpdHlcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIE1vZGFsTWFuYWdlciB7XG4gIGNvbnN0cnVjdG9yKG9wdHMpIHtcbiAgICBjb25zdCBtYW5hZ2VyID0gY3JlYXRlTW9kYWxNYW5hZ2VyKG9wdHMpO1xuXG4gICAgLy8gRGVsZWdhdGUgYWxsIG1ldGhvZHMgdG8gdGhlIGZ1bmN0aW9uYWwgaW1wbGVtZW50YXRpb25cbiAgICBPYmplY3QuYXNzaWduKHRoaXMsIG1hbmFnZXIpO1xuXG4gICAgLy8gQXV0by1pbml0aWFsaXplXG4gICAgdGhpcy5pbml0aWFsaXplKCkuY2F0Y2goZXJyID0+IHtcbiAgICAgIGlmIChvcHRzPy5sb2dnZXIpIHtcbiAgICAgICAgb3B0cy5sb2dnZXIuZXJyb3IoJ1tNb2RhbE1hbmFnZXJdIEF1dG8taW5pdGlhbGl6YXRpb24gZmFpbGVkOicsIGVyciwgeyBjb250ZXh0OiAnTW9kYWxNYW5hZ2VyJyB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1tNb2RhbE1hbmFnZXJdIEF1dG8taW5pdGlhbGl6YXRpb24gZmFpbGVkOicsIGVycik7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cblxuLyoqXG4gKiBjcmVhdGVQcm9qZWN0TW9kYWwg4oCTIHRoaW4gY29udmVuaWVuY2Ugd3JhcHBlciBhcm91bmQgdGhlIGdlbmVyaWNcbiAqIGNyZWF0ZU1vZGFsTWFuYWdlciBzcGVjaWZpY2FsbHkgY29uZmlndXJlZCBmb3IgdGhlIFwicHJvamVjdFwiIG1vZGFsXG4gKiBkZWZpbmVkIGluIE1PREFMX01BUFBJTkdTIChsb2dpY2FsIGtleTogJ3Byb2plY3QnKS4gIEl0IGV4cG9zZXMgYVxuICogc2luZ2xlIGhlbHBlciBgb3Blbk1vZGFsKHByb2plY3REYXRhKWAgdGhhdCBwcmUtcG9wdWxhdGVzIHRoZSBtb2RhbFxuICogZm9ybSBmaWVsZHMgd2hlbiBlZGl0aW5nIGFuIGV4aXN0aW5nIHByb2plY3QuICBBbGwgb3RoZXIgbWV0aG9kcyBhcmVcbiAqIGRlbGVnYXRlZCB0byB0aGUgdW5kZXJseWluZyBNb2RhbE1hbmFnZXIgaW5zdGFuY2Ugc28gY29uc3VtZXJzIHJldGFpblxuICogZnVsbCBhY2Nlc3MgdG8gc2hvdy9oaWRlL3RvZ2dsZSBBUElzLlxuICpcbiAqIFRoaXMgZmFjdG9yeSBleGlzdHMgc29sZWx5IGZvciBiYWNrd2FyZC1jb21wYXRpYmlsaXR5IHdpdGggbW9kdWxlc1xuICogdGhhdCB3ZXJlIGJ1aWx0IGJlZm9yZSB0aGUgUGhhc2UtMiBtb2RhbCByZWZhY3RvciBhbmQgc3RpbGwgZXhwZWN0IGFcbiAqIGRlZGljYXRlZCBQcm9qZWN0TW9kYWwgaGVscGVyLiAgTmV3IGNvZGUgc2hvdWxkIHVzZSB0aGUgdW5pZmllZFxuICogTW9kYWxNYW5hZ2VyLnNob3coJ3Byb2plY3QnLCDigKYpIGludGVyZmFjZS5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVByb2plY3RNb2RhbChvcHRpb25zID0ge30pIHtcbiAgLy8gUmUtdXNlIHRoZSBnZW5lcmljIG1vZGFsIG1hbmFnZXIgaW1wbGVtZW50YXRpb24g4oCTIGRvICoqTk9UKiogY3JlYXRlXG4gIC8vIGR1cGxpY2F0ZSBzdGF0ZTsgc2luZ2xlIHNvdXJjZSBvZiB0cnV0aCBsaXZlcyBpbiBNb2RhbE1hbmFnZXIuXG4gIGNvbnN0IG1vZGFsTWFuYWdlciA9IGNyZWF0ZU1vZGFsTWFuYWdlcihvcHRpb25zKTtcblxuICBhc3luYyBmdW5jdGlvbiBvcGVuTW9kYWwocHJvamVjdERhdGEgPSB7fSkge1xuICAgIC8vIEVuc3VyZSB1bmRlcmx5aW5nIE1vZGFsTWFuYWdlciBpcyByZWFkeSBiZWZvcmUgYXR0ZW1wdGluZyB0byBzaG93LlxuICAgIGlmICh0eXBlb2YgbW9kYWxNYW5hZ2VyLmluaXRpYWxpemUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IG1vZGFsTWFuYWdlci5pbml0aWFsaXplKCk7XG4gICAgICB9IGNhdGNoIChfKSB7XG4gICAgICAgIC8vIEluaXRpYWxpemF0aW9uIGVycm9ycyBhcmUgYWxyZWFkeSBsb2dnZWQgaW5zaWRlIE1vZGFsTWFuYWdlci5cbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCB7IG5hbWUgPSAnJywgZGVzY3JpcHRpb24gPSAnJyB9ID0gcHJvamVjdERhdGEgfHwge307XG5cbiAgICByZXR1cm4gbW9kYWxNYW5hZ2VyLnNob3coJ3Byb2plY3QnLCB7XG4gICAgICB1cGRhdGVDb250ZW50OiAobW9kYWxFbCkgPT4ge1xuICAgICAgICBpZiAoIW1vZGFsRWwpIHJldHVybjtcblxuICAgICAgICAvLyBQcmUtZmlsbCBjb21tb25seSB1c2VkIGlucHV0cy4gIEZhbGxiYWNrcyBhcmUgbm8tb3BzIGlmIGVsZW1lbnRzXG4gICAgICAgIC8vIGFyZSBtaXNzaW5nIOKAkyB3ZSBpbnRlbnRpb25hbGx5IGF2b2lkIGhhcmQgZGVwZW5kZW5jaWVzIG9uIHRoZVxuICAgICAgICAvLyBleGFjdCB0ZW1wbGF0ZSBtYXJrdXAgdG8ga2VlcCB0aGlzIGhlbHBlciByZXNpbGllbnQgdG8gZnV0dXJlXG4gICAgICAgIC8vIFVJIHR3ZWFrcy5cbiAgICAgICAgY29uc3QgbmFtZUlucHV0ID0gbW9kYWxFbC5xdWVyeVNlbGVjdG9yKCcjcHJvamVjdE1vZGFsTmFtZUlucHV0Jyk7XG4gICAgICAgIGlmIChuYW1lSW5wdXQpIG5hbWVJbnB1dC52YWx1ZSA9IG5hbWU7XG5cbiAgICAgICAgY29uc3QgZGVzY0lucHV0ID0gbW9kYWxFbC5xdWVyeVNlbGVjdG9yKCcjcHJvamVjdE1vZGFsRGVzY3JpcHRpb25JbnB1dCcpO1xuICAgICAgICBpZiAoZGVzY0lucHV0KSBkZXNjSW5wdXQudmFsdWUgPSBkZXNjcmlwdGlvbjtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgLi4ubW9kYWxNYW5hZ2VyLFxuICAgIG9wZW5Nb2RhbFxuICB9O1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQVdBLElBQUFBLGVBQUEsR0FBQUMsT0FBQTtBQUNBLElBQUFDLGNBQUEsR0FBQUQsT0FBQTtBQUNBLElBQUFFLGtCQUFBLEdBQUFGLE9BQUE7QUFDQSxJQUFBRyxpQkFBQSxHQUFBSCxPQUFBO0FBZEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBT08sU0FBU0ksa0JBQWtCQSxDQUFDO0VBQ2pDQyxhQUFhO0VBQ2JD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QU8sRUFBRTtRQUFlLENBQUMsQ0FBQztNQUNuRyxDQUFDLE1BQU07UUFDTHNHLE9BQU8sQ0FBQzFGLEtBQUssQ0FBQyw0Q0FBNEMsRUFBRUQsR0FBRyxDQUFDO01BQ2xFO0lBQ0YsQ0FBQyxDQUFDO0VBQ0o7QUFDRjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBYkE0RixPQUFBLENBQUFDLE9BQUEsR0FBQVIsWUFBQTtBQWNPLFNBQVNTLGtCQUFrQkEsQ0FBQ3RFLE9BQU8sR0FBRyxDQUFDLENBQUMsRUFBRTtFQUMvQztFQUNBO0VBQ0EsTUFBTXVFLFlBQVksR0FBR3hJLGtCQUFrQixDQUFDaUUsT0FBTyxDQUFDO0VBRWhELGVBQWVnRCxTQUFTQSxDQUFDd0IsV0FBVyxHQUFHLENBQUMsQ0FBQyxFQUFFO0lBQ3pDO0lBQ0EsSUFBSSxPQUFPRCxZQUFZLENBQUM1RyxVQUFVLEtBQUssVUFBVSxFQUFFO01BQ2pELElBQUk7UUFDRixNQUFNNEcsWUFBWSxDQUFDNUcsVUFBVSxDQUFDLENBQUM7TUFDakMsQ0FBQyxDQUFDLE9BQU84RyxDQUFDLEVBQUU7UUFDVjtNQUFBO0lBRUo7SUFFQSxNQUFNO01BQUUxRyxJQUFJLEdBQUcsRUFBRTtNQUFFb0IsV0FBVyxHQUFHO0lBQUcsQ0FBQyxHQUFHcUYsV0FBVyxJQUFJLENBQUMsQ0FBQztJQUV6RCxPQUFPRCxZQUFZLENBQUN4RSxJQUFJLENBQUMsU0FBUyxFQUFFO01BQ2xDYyxhQUFhLEVBQUdULE9BQU8sSUFBSztRQUMxQixJQUFJLENBQUNBLE9BQU8sRUFBRTs7UUFFZDtRQUNBO1FBQ0E7UUFDQTtRQUNBLE1BQU1zRSxTQUFTLEdBQUd0RSxPQUFPLENBQUNvQyxhQUFhLENBQUMsd0JBQXdCLENBQUM7UUFDakUsSUFBSWtDLFNBQVMsRUFBRUEsU0FBUyxDQUFDQyxLQUFLLEdBQUc1RyxJQUFJO1FBRXJDLE1BQU02RyxTQUFTLEdBQUd4RSxPQUFPLENBQUNvQyxhQUFhLENBQUMsK0JBQStCLENBQUM7UUFDeEUsSUFBSW9DLFNBQVMsRUFBRUEsU0FBUyxDQUFDRCxLQUFLLEdBQUd4RixXQUFXO01BQzlDO0lBQ0YsQ0FBQyxDQUFDO0VBQ0o7RUFFQSxPQUFPO0lBQ0wsR0FBR29GLFlBQVk7SUFDZnZCO0VBQ0YsQ0FBQztBQUNIIiwiaWdub3JlTGlzdCI6W119