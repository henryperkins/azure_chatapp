bcaaccfe64d8da06f76e5ef82891d351
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createServiceInit = createServiceInit;
// ========================================
// FILE: /initialization/phases/serviceInit.js
// ========================================
/**
 * Service Registration and Initialization
 * Registers basic and advanced services in the DI container
 * ~150 lines
 */

function createServiceInit(deps) {
  const {
    DependencySystem,
    domAPI,
    browserService,
    eventHandlers,
    domReadinessService,
    sanitizer,
    APP_CONFIG,
    getSessionId,
    uiUtils,
    globalUtils,
    createFileUploadComponent,
    createApiEndpoints,
    createApiClient,
    createAccessibilityEnhancements,
    createNavigationService,
    createHtmlTemplateLoader,
    createUiRenderer
  } = deps;
  let logger = DependencySystem?.modules?.get('logger');
  if (!DependencySystem || !domAPI || !browserService || !eventHandlers || !domReadinessService || !sanitizer || !APP_CONFIG || !getSessionId) {
    throw new Error('[serviceInit] Missing required dependencies for service initialization.');
  }
  if (!logger) {
    throw new Error('[serviceInit] Logger instance is required; fallback removed.');
  }
  function safeRegister(name, value) {
    if (!DependencySystem.modules.has(name)) {
      DependencySystem.register(name, value);
      logger.debug(`[serviceInit] Registered "${name}"`, {
        context: 'serviceInit:safeRegister'
      });
    } else {
      logger.debug(`[serviceInit] "${name}" already registered â€“ skipping.`, {
        context: 'serviceInit:safeRegister'
      });
    }
  }
  function registerBasicServices() {
    logger.info('[serviceInit] Starting registration of basic services...', {
      context: 'serviceInit:registerBasicServices'
    });
    safeRegister('logger', logger);
    safeRegister('domAPI', domAPI);
    safeRegister('browserAPI', browserService);
    safeRegister('browserService', browserService);
    safeRegister('viewportAPI', browserService);
    safeRegister('storage', browserService);
    safeRegister('eventHandlers', eventHandlers);
    safeRegister('domReadinessService', domReadinessService);
    const existingErrorReporter = DependencySystem.modules.get('errorReporter');
    if (!existingErrorReporter) {
      throw new Error('[serviceInit] errorReporter module must be registered before ServiceInit runs.');
    }
    safeRegister('errorReporter', existingErrorReporter);
    if (uiUtils) safeRegister('uiUtils', uiUtils);
    if (globalUtils) safeRegister('globalUtils', globalUtils);
    safeRegister('sanitizer', sanitizer);
    safeRegister('domPurify', sanitizer);
    if (createFileUploadComponent) {
      safeRegister('FileUploadComponent', createFileUploadComponent);
    }

    // No need to register tokenStatsManager placeholder here. bootstrapCore
    // already exposes tokenStatsManagerProxy under both
    // 'tokenStatsManagerProxy' *and* the canonical 'tokenStatsManager'
    // module names.

    // Register API endpoints
    if (typeof createApiEndpoints !== 'function') {
      throw new Error('[serviceInit] createApiEndpoints factory missing.');
    }
    const apiEndpointsInstance = createApiEndpoints({
      logger,
      DependencySystem,
      config: APP_CONFIG
    });
    const resolvedEndpoints = DependencySystem.modules.get('apiEndpoints') || apiEndpointsInstance.endpoints;
    safeRegister('apiEndpoints', resolvedEndpoints);
    logger.debug('[serviceInit] API endpoints registered.', {
      endpointCount: Object.keys(resolvedEndpoints).length,
      context: 'serviceInit:registerBasicServices'
    });
    logger.info('[serviceInit] Basic services registration completed.', {
      context: 'serviceInit:registerBasicServices'
    });
  }
  function registerAdvancedServices() {
    logger.info('[serviceInit] Starting registration of advanced services...', {
      context: 'serviceInit:registerAdvancedServices'
    });

    // API Client creation and registration
    let apiClientInstance = null;
    if (createApiClient && globalUtils) {
      logger.debug('[serviceInit] Creating API client...', {
        context: 'serviceInit:registerAdvancedServices'
      });
      apiClientInstance = createApiClient({
        APP_CONFIG,
        globalUtils: {
          shouldSkipDedup: globalUtils.shouldSkipDedup,
          stableStringify: globalUtils.stableStringify,
          normaliseUrl: globalUtils.normaliseUrl,
          isAbsoluteUrl: globalUtils.isAbsoluteUrl
        },
        getAuthModule: () => DependencySystem.modules.get('auth'),
        browserService,
        eventHandlers,
        logger
      });

      // Register API client
      if (DependencySystem.modules.has('apiRequest')) {
        DependencySystem.modules.set('apiRequest', apiClientInstance.fetch);
      } else {
        safeRegister('apiRequest', apiClientInstance.fetch);
      }
      safeRegister('apiClient', apiClientInstance.fetch);
      safeRegister('apiClientObject', apiClientInstance);
      logger.debug('[serviceInit] API client created and registered.', {
        context: 'serviceInit:registerAdvancedServices'
      });
    }

    // Register other advanced services
    if (createAccessibilityEnhancements) {
      const accessibilityUtilsInstance = createAccessibilityEnhancements({
        domAPI,
        eventHandlers,
        logger,
        domReadinessService,
        DependencySystem,
        safeHandler: DependencySystem.modules.get('safeHandler'),
        htmlTemplateLoader: DependencySystem.modules.get('htmlTemplateLoader')
      });
      safeRegister('accessibilityUtils', accessibilityUtilsInstance);
    }
    if (createNavigationService) {
      const navInstance = createNavigationService({
        domAPI,
        browserService,
        DependencySystem,
        eventHandlers,
        logger
      });
      navInstance.init();
      safeRegister('navigationService', navInstance);
    }
    if (createHtmlTemplateLoader) {
      const htmlLoaderInstance = createHtmlTemplateLoader({
        DependencySystem,
        domAPI,
        sanitizer,
        eventHandlers,
        apiClient: apiClientInstance,
        timerAPI: browserService,
        domReadinessService,
        logger
      });
      safeRegister('htmlTemplateLoader', htmlLoaderInstance);
    }
    if (createUiRenderer && apiClientInstance) {
      const curEndpoints = DependencySystem.modules.get('apiEndpoints');
      if (curEndpoints) {
        const uiRendererInstance = createUiRenderer({
          domAPI,
          eventHandlers,
          apiRequest: apiClientInstance.fetch,
          apiEndpoints: curEndpoints,
          domReadinessService,
          logger,
          DependencySystem,
          onConversationSelect: conversationId => {
            const doc = domAPI.getDocument();
            if (doc && eventHandlers.createCustomEvent) {
              domAPI.dispatchEvent(doc, eventHandlers.createCustomEvent('uiRenderer:conversationSelected', {
                detail: {
                  conversationId
                }
              }));
            }
          },
          onProjectSelect: projectId => {
            const doc = domAPI.getDocument();
            if (doc && eventHandlers.createCustomEvent) {
              domAPI.dispatchEvent(doc, eventHandlers.createCustomEvent('uiRenderer:projectSelected', {
                detail: {
                  projectId
                }
              }));
            }
          }
        });
        safeRegister('uiRenderer', uiRendererInstance);
      }
    }
    logger.info('[serviceInit] Advanced services registration completed.', {
      context: 'serviceInit:registerAdvancedServices'
    });
  }
  function setLogger(newLogger) {
    if (!newLogger) return;
    logger = newLogger;
    safeRegister('logger', newLogger);
  }
  function cleanup() {
    eventHandlers.cleanupListeners({
      context: 'serviceInit'
    });
    const log = DependencySystem.modules.get('logger');
    log.debug('[serviceInit] Cleanup completed', {
      context: 'serviceInit:cleanup'
    });
  }
  return {
    registerBasicServices,
    registerAdvancedServices,
    setLogger,
    cleanup
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVTZXJ2aWNlSW5pdCIsImRlcHMiLCJEZXBlbmRlbmN5U3lzdGVtIiwiZG9tQVBJIiwiYnJvd3NlclNlcnZpY2UiLCJldmVudEhhbmRsZXJzIiwiZG9tUmVhZGluZXNzU2VydmljZSIsInNhbml0aXplciIsIkFQUF9DT05GSUciLCJnZXRTZXNzaW9uSWQiLCJ1aVV0aWxzIiwiZ2xvYmFsVXRpbHMiLCJjcmVhdGVGaWxlVXBsb2FkQ29tcG9uZW50IiwiY3JlYXRlQXBpRW5kcG9pbnRzIiwiY3JlYXRlQXBpQ2xpZW50IiwiY3JlYXRlQWNjZXNzaWJpbGl0eUVuaGFuY2VtZW50cyIsImNyZWF0ZU5hdmlnYXRpb25TZXJ2aWNlIiwiY3JlYXRlSHRtbFRlbXBsYXRlTG9hZGVyIiwiY3JlYXRlVWlSZW5kZXJlciIsImxvZ2dlciIsIm1vZHVsZXMiLCJnZXQiLCJFcnJvciIsInNhZmVSZWdpc3RlciIsIm5hbWUiLCJ2YWx1ZSIsImhhcyIsInJlZ2lzdGVyIiwiZGVidWciLCJjb250ZXh0IiwicmVnaXN0ZXJCYXNpY1NlcnZpY2VzIiwiaW5mbyIsImV4aXN0aW5nRXJyb3JSZXBvcnRlciIsImFwaUVuZHBvaW50c0luc3RhbmNlIiwiY29uZmlnIiwicmVzb2x2ZWRFbmRwb2ludHMiLCJlbmRwb2ludHMiLCJlbmRwb2ludENvdW50IiwiT2JqZWN0Iiwia2V5cyIsImxlbmd0aCIsInJlZ2lzdGVyQWR2YW5jZWRTZXJ2aWNlcyIsImFwaUNsaWVudEluc3RhbmNlIiwic2hvdWxkU2tpcERlZHVwIiwic3RhYmxlU3RyaW5naWZ5Iiwibm9ybWFsaXNlVXJsIiwiaXNBYnNvbHV0ZVVybCIsImdldEF1dGhNb2R1bGUiLCJzZXQiLCJmZXRjaCIsImFjY2Vzc2liaWxpdHlVdGlsc0luc3RhbmNlIiwic2FmZUhhbmRsZXIiLCJodG1sVGVtcGxhdGVMb2FkZXIiLCJuYXZJbnN0YW5jZSIsImluaXQiLCJodG1sTG9hZGVySW5zdGFuY2UiLCJhcGlDbGllbnQiLCJ0aW1lckFQSSIsImN1ckVuZHBvaW50cyIsInVpUmVuZGVyZXJJbnN0YW5jZSIsImFwaVJlcXVlc3QiLCJhcGlFbmRwb2ludHMiLCJvbkNvbnZlcnNhdGlvblNlbGVjdCIsImNvbnZlcnNhdGlvbklkIiwiZG9jIiwiZ2V0RG9jdW1lbnQiLCJjcmVhdGVDdXN0b21FdmVudCIsImRpc3BhdGNoRXZlbnQiLCJkZXRhaWwiLCJvblByb2plY3RTZWxlY3QiLCJwcm9qZWN0SWQiLCJzZXRMb2dnZXIiLCJuZXdMb2dnZXIiLCJjbGVhbnVwIiwiY2xlYW51cExpc3RlbmVycyIsImxvZyJdLCJzb3VyY2VzIjpbInNlcnZpY2VJbml0LmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEZJTEU6IC9pbml0aWFsaXphdGlvbi9waGFzZXMvc2VydmljZUluaXQuanNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8qKlxuICogU2VydmljZSBSZWdpc3RyYXRpb24gYW5kIEluaXRpYWxpemF0aW9uXG4gKiBSZWdpc3RlcnMgYmFzaWMgYW5kIGFkdmFuY2VkIHNlcnZpY2VzIGluIHRoZSBESSBjb250YWluZXJcbiAqIH4xNTAgbGluZXNcbiAqL1xuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlU2VydmljZUluaXQoZGVwcykge1xuICAgIGNvbnN0IHtcbiAgICAgICAgRGVwZW5kZW5jeVN5c3RlbSwgZG9tQVBJLCBicm93c2VyU2VydmljZSwgZXZlbnRIYW5kbGVycyxcbiAgICAgICAgZG9tUmVhZGluZXNzU2VydmljZSwgc2FuaXRpemVyLCBBUFBfQ09ORklHLCBnZXRTZXNzaW9uSWQsXG4gICAgICAgIHVpVXRpbHMsIGdsb2JhbFV0aWxzLCBjcmVhdGVGaWxlVXBsb2FkQ29tcG9uZW50LFxuICAgICAgICBjcmVhdGVBcGlFbmRwb2ludHMsIGNyZWF0ZUFwaUNsaWVudCwgY3JlYXRlQWNjZXNzaWJpbGl0eUVuaGFuY2VtZW50cyxcbiAgICAgICAgY3JlYXRlTmF2aWdhdGlvblNlcnZpY2UsIGNyZWF0ZUh0bWxUZW1wbGF0ZUxvYWRlciwgY3JlYXRlVWlSZW5kZXJlclxuICAgIH0gPSBkZXBzO1xuXG4gICAgbGV0IGxvZ2dlciA9IERlcGVuZGVuY3lTeXN0ZW0/Lm1vZHVsZXM/LmdldCgnbG9nZ2VyJyk7XG5cbiAgICBpZiAoIURlcGVuZGVuY3lTeXN0ZW0gfHwgIWRvbUFQSSB8fCAhYnJvd3NlclNlcnZpY2UgfHwgIWV2ZW50SGFuZGxlcnMgfHxcbiAgICAgICAgIWRvbVJlYWRpbmVzc1NlcnZpY2UgfHwgIXNhbml0aXplciB8fCAhQVBQX0NPTkZJRyB8fCAhZ2V0U2Vzc2lvbklkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignW3NlcnZpY2VJbml0XSBNaXNzaW5nIHJlcXVpcmVkIGRlcGVuZGVuY2llcyBmb3Igc2VydmljZSBpbml0aWFsaXphdGlvbi4nKTtcbiAgICB9XG5cbiAgICBpZiAoIWxvZ2dlcikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1tzZXJ2aWNlSW5pdF0gTG9nZ2VyIGluc3RhbmNlIGlzIHJlcXVpcmVkOyBmYWxsYmFjayByZW1vdmVkLicpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHNhZmVSZWdpc3RlcihuYW1lLCB2YWx1ZSkge1xuICAgICAgICBpZiAoIURlcGVuZGVuY3lTeXN0ZW0ubW9kdWxlcy5oYXMobmFtZSkpIHtcbiAgICAgICAgICAgIERlcGVuZGVuY3lTeXN0ZW0ucmVnaXN0ZXIobmFtZSwgdmFsdWUpO1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGBbc2VydmljZUluaXRdIFJlZ2lzdGVyZWQgXCIke25hbWV9XCJgLCB7IGNvbnRleHQ6ICdzZXJ2aWNlSW5pdDpzYWZlUmVnaXN0ZXInIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGBbc2VydmljZUluaXRdIFwiJHtuYW1lfVwiIGFscmVhZHkgcmVnaXN0ZXJlZCDigJMgc2tpcHBpbmcuYCwgeyBjb250ZXh0OiAnc2VydmljZUluaXQ6c2FmZVJlZ2lzdGVyJyB9KTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlZ2lzdGVyQmFzaWNTZXJ2aWNlcygpIHtcbiAgICAgICAgbG9nZ2VyLmluZm8oJ1tzZXJ2aWNlSW5pdF0gU3RhcnRpbmcgcmVnaXN0cmF0aW9uIG9mIGJhc2ljIHNlcnZpY2VzLi4uJywgeyBjb250ZXh0OiAnc2VydmljZUluaXQ6cmVnaXN0ZXJCYXNpY1NlcnZpY2VzJyB9KTtcblxuICAgICAgICBzYWZlUmVnaXN0ZXIoJ2xvZ2dlcicsIGxvZ2dlcik7XG4gICAgICAgIHNhZmVSZWdpc3RlcignZG9tQVBJJywgZG9tQVBJKTtcbiAgICAgICAgc2FmZVJlZ2lzdGVyKCdicm93c2VyQVBJJywgYnJvd3NlclNlcnZpY2UpO1xuICAgICAgICBzYWZlUmVnaXN0ZXIoJ2Jyb3dzZXJTZXJ2aWNlJywgYnJvd3NlclNlcnZpY2UpO1xuICAgICAgICBzYWZlUmVnaXN0ZXIoJ3ZpZXdwb3J0QVBJJywgYnJvd3NlclNlcnZpY2UpO1xuICAgICAgICBzYWZlUmVnaXN0ZXIoJ3N0b3JhZ2UnLCBicm93c2VyU2VydmljZSk7XG4gICAgICAgIHNhZmVSZWdpc3RlcignZXZlbnRIYW5kbGVycycsIGV2ZW50SGFuZGxlcnMpO1xuICAgICAgICBzYWZlUmVnaXN0ZXIoJ2RvbVJlYWRpbmVzc1NlcnZpY2UnLCBkb21SZWFkaW5lc3NTZXJ2aWNlKTtcblxuICAgICAgICBjb25zdCBleGlzdGluZ0Vycm9yUmVwb3J0ZXIgPSBEZXBlbmRlbmN5U3lzdGVtLm1vZHVsZXMuZ2V0KCdlcnJvclJlcG9ydGVyJyk7XG4gICAgICAgIGlmICghZXhpc3RpbmdFcnJvclJlcG9ydGVyKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1tzZXJ2aWNlSW5pdF0gZXJyb3JSZXBvcnRlciBtb2R1bGUgbXVzdCBiZSByZWdpc3RlcmVkIGJlZm9yZSBTZXJ2aWNlSW5pdCBydW5zLicpO1xuICAgICAgICB9XG4gICAgICAgIHNhZmVSZWdpc3RlcignZXJyb3JSZXBvcnRlcicsIGV4aXN0aW5nRXJyb3JSZXBvcnRlcik7XG5cbiAgICAgICAgaWYgKHVpVXRpbHMpIHNhZmVSZWdpc3RlcigndWlVdGlscycsIHVpVXRpbHMpO1xuICAgICAgICBpZiAoZ2xvYmFsVXRpbHMpIHNhZmVSZWdpc3RlcignZ2xvYmFsVXRpbHMnLCBnbG9iYWxVdGlscyk7XG4gICAgICAgIHNhZmVSZWdpc3Rlcignc2FuaXRpemVyJywgc2FuaXRpemVyKTtcbiAgICAgICAgc2FmZVJlZ2lzdGVyKCdkb21QdXJpZnknLCBzYW5pdGl6ZXIpO1xuXG4gICAgICAgIGlmIChjcmVhdGVGaWxlVXBsb2FkQ29tcG9uZW50KSB7XG4gICAgICAgICAgICBzYWZlUmVnaXN0ZXIoJ0ZpbGVVcGxvYWRDb21wb25lbnQnLCBjcmVhdGVGaWxlVXBsb2FkQ29tcG9uZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE5vIG5lZWQgdG8gcmVnaXN0ZXIgdG9rZW5TdGF0c01hbmFnZXIgcGxhY2Vob2xkZXIgaGVyZS4gYm9vdHN0cmFwQ29yZVxuICAgICAgICAvLyBhbHJlYWR5IGV4cG9zZXMgdG9rZW5TdGF0c01hbmFnZXJQcm94eSB1bmRlciBib3RoXG4gICAgICAgIC8vICd0b2tlblN0YXRzTWFuYWdlclByb3h5JyAqYW5kKiB0aGUgY2Fub25pY2FsICd0b2tlblN0YXRzTWFuYWdlcidcbiAgICAgICAgLy8gbW9kdWxlIG5hbWVzLlxuXG4gICAgICAgIC8vIFJlZ2lzdGVyIEFQSSBlbmRwb2ludHNcbiAgICAgICAgaWYgKHR5cGVvZiBjcmVhdGVBcGlFbmRwb2ludHMgIT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignW3NlcnZpY2VJbml0XSBjcmVhdGVBcGlFbmRwb2ludHMgZmFjdG9yeSBtaXNzaW5nLicpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFwaUVuZHBvaW50c0luc3RhbmNlID0gY3JlYXRlQXBpRW5kcG9pbnRzKHsgbG9nZ2VyLCBEZXBlbmRlbmN5U3lzdGVtLCBjb25maWc6IEFQUF9DT05GSUcgfSk7XG4gICAgICAgIGNvbnN0IHJlc29sdmVkRW5kcG9pbnRzID0gRGVwZW5kZW5jeVN5c3RlbS5tb2R1bGVzLmdldCgnYXBpRW5kcG9pbnRzJykgfHwgYXBpRW5kcG9pbnRzSW5zdGFuY2UuZW5kcG9pbnRzO1xuICAgICAgICBzYWZlUmVnaXN0ZXIoJ2FwaUVuZHBvaW50cycsIHJlc29sdmVkRW5kcG9pbnRzKTtcblxuICAgICAgICBsb2dnZXIuZGVidWcoJ1tzZXJ2aWNlSW5pdF0gQVBJIGVuZHBvaW50cyByZWdpc3RlcmVkLicsIHtcbiAgICAgICAgICAgIGVuZHBvaW50Q291bnQ6IE9iamVjdC5rZXlzKHJlc29sdmVkRW5kcG9pbnRzKS5sZW5ndGgsXG4gICAgICAgICAgICBjb250ZXh0OiAnc2VydmljZUluaXQ6cmVnaXN0ZXJCYXNpY1NlcnZpY2VzJ1xuICAgICAgICB9KTtcblxuICAgICAgICBsb2dnZXIuaW5mbygnW3NlcnZpY2VJbml0XSBCYXNpYyBzZXJ2aWNlcyByZWdpc3RyYXRpb24gY29tcGxldGVkLicsIHtcbiAgICAgICAgICAgIGNvbnRleHQ6ICdzZXJ2aWNlSW5pdDpyZWdpc3RlckJhc2ljU2VydmljZXMnXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHJlZ2lzdGVyQWR2YW5jZWRTZXJ2aWNlcygpIHtcbiAgICAgICAgbG9nZ2VyLmluZm8oJ1tzZXJ2aWNlSW5pdF0gU3RhcnRpbmcgcmVnaXN0cmF0aW9uIG9mIGFkdmFuY2VkIHNlcnZpY2VzLi4uJywge1xuICAgICAgICAgICAgY29udGV4dDogJ3NlcnZpY2VJbml0OnJlZ2lzdGVyQWR2YW5jZWRTZXJ2aWNlcydcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQVBJIENsaWVudCBjcmVhdGlvbiBhbmQgcmVnaXN0cmF0aW9uXG4gICAgICAgIGxldCBhcGlDbGllbnRJbnN0YW5jZSA9IG51bGw7XG4gICAgICAgIGlmIChjcmVhdGVBcGlDbGllbnQgJiYgZ2xvYmFsVXRpbHMpIHtcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnW3NlcnZpY2VJbml0XSBDcmVhdGluZyBBUEkgY2xpZW50Li4uJywge1xuICAgICAgICAgICAgICAgIGNvbnRleHQ6ICdzZXJ2aWNlSW5pdDpyZWdpc3RlckFkdmFuY2VkU2VydmljZXMnXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYXBpQ2xpZW50SW5zdGFuY2UgPSBjcmVhdGVBcGlDbGllbnQoe1xuICAgICAgICAgICAgICAgIEFQUF9DT05GSUcsXG4gICAgICAgICAgICAgICAgZ2xvYmFsVXRpbHM6IHtcbiAgICAgICAgICAgICAgICAgICAgc2hvdWxkU2tpcERlZHVwOiBnbG9iYWxVdGlscy5zaG91bGRTa2lwRGVkdXAsXG4gICAgICAgICAgICAgICAgICAgIHN0YWJsZVN0cmluZ2lmeTogZ2xvYmFsVXRpbHMuc3RhYmxlU3RyaW5naWZ5LFxuICAgICAgICAgICAgICAgICAgICBub3JtYWxpc2VVcmw6IGdsb2JhbFV0aWxzLm5vcm1hbGlzZVVybCxcbiAgICAgICAgICAgICAgICAgICAgaXNBYnNvbHV0ZVVybDogZ2xvYmFsVXRpbHMuaXNBYnNvbHV0ZVVybFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZ2V0QXV0aE1vZHVsZTogKCkgPT4gRGVwZW5kZW5jeVN5c3RlbS5tb2R1bGVzLmdldCgnYXV0aCcpLFxuICAgICAgICAgICAgICAgIGJyb3dzZXJTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIGV2ZW50SGFuZGxlcnMsXG4gICAgICAgICAgICAgICAgbG9nZ2VyXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gUmVnaXN0ZXIgQVBJIGNsaWVudFxuICAgICAgICAgICAgaWYgKERlcGVuZGVuY3lTeXN0ZW0ubW9kdWxlcy5oYXMoJ2FwaVJlcXVlc3QnKSkge1xuICAgICAgICAgICAgICAgIERlcGVuZGVuY3lTeXN0ZW0ubW9kdWxlcy5zZXQoJ2FwaVJlcXVlc3QnLCBhcGlDbGllbnRJbnN0YW5jZS5mZXRjaCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHNhZmVSZWdpc3RlcignYXBpUmVxdWVzdCcsIGFwaUNsaWVudEluc3RhbmNlLmZldGNoKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2FmZVJlZ2lzdGVyKCdhcGlDbGllbnQnLCBhcGlDbGllbnRJbnN0YW5jZS5mZXRjaCk7XG4gICAgICAgICAgICBzYWZlUmVnaXN0ZXIoJ2FwaUNsaWVudE9iamVjdCcsIGFwaUNsaWVudEluc3RhbmNlKTtcblxuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCdbc2VydmljZUluaXRdIEFQSSBjbGllbnQgY3JlYXRlZCBhbmQgcmVnaXN0ZXJlZC4nLCB7XG4gICAgICAgICAgICAgICAgY29udGV4dDogJ3NlcnZpY2VJbml0OnJlZ2lzdGVyQWR2YW5jZWRTZXJ2aWNlcydcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUmVnaXN0ZXIgb3RoZXIgYWR2YW5jZWQgc2VydmljZXNcbiAgICAgICAgaWYgKGNyZWF0ZUFjY2Vzc2liaWxpdHlFbmhhbmNlbWVudHMpIHtcbiAgICAgICAgICAgIGNvbnN0IGFjY2Vzc2liaWxpdHlVdGlsc0luc3RhbmNlID0gY3JlYXRlQWNjZXNzaWJpbGl0eUVuaGFuY2VtZW50cyh7XG4gICAgICAgICAgICAgICAgZG9tQVBJLFxuICAgICAgICAgICAgICAgIGV2ZW50SGFuZGxlcnMsXG4gICAgICAgICAgICAgICAgbG9nZ2VyLFxuICAgICAgICAgICAgICAgIGRvbVJlYWRpbmVzc1NlcnZpY2UsXG4gICAgICAgICAgICAgICAgRGVwZW5kZW5jeVN5c3RlbSxcbiAgICAgICAgICAgICAgICBzYWZlSGFuZGxlcjogRGVwZW5kZW5jeVN5c3RlbS5tb2R1bGVzLmdldCgnc2FmZUhhbmRsZXInKSxcbiAgICAgICAgICAgICAgICBodG1sVGVtcGxhdGVMb2FkZXI6IERlcGVuZGVuY3lTeXN0ZW0ubW9kdWxlcy5nZXQoJ2h0bWxUZW1wbGF0ZUxvYWRlcicpXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNhZmVSZWdpc3RlcignYWNjZXNzaWJpbGl0eVV0aWxzJywgYWNjZXNzaWJpbGl0eVV0aWxzSW5zdGFuY2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNyZWF0ZU5hdmlnYXRpb25TZXJ2aWNlKSB7XG4gICAgICAgICAgICBjb25zdCBuYXZJbnN0YW5jZSA9IGNyZWF0ZU5hdmlnYXRpb25TZXJ2aWNlKHtcbiAgICAgICAgICAgICAgICBkb21BUEksXG4gICAgICAgICAgICAgICAgYnJvd3NlclNlcnZpY2UsXG4gICAgICAgICAgICAgICAgRGVwZW5kZW5jeVN5c3RlbSxcbiAgICAgICAgICAgICAgICBldmVudEhhbmRsZXJzLFxuICAgICAgICAgICAgICAgIGxvZ2dlclxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBuYXZJbnN0YW5jZS5pbml0KCk7XG4gICAgICAgICAgICBzYWZlUmVnaXN0ZXIoJ25hdmlnYXRpb25TZXJ2aWNlJywgbmF2SW5zdGFuY2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNyZWF0ZUh0bWxUZW1wbGF0ZUxvYWRlcikge1xuICAgICAgICAgICAgY29uc3QgaHRtbExvYWRlckluc3RhbmNlID0gY3JlYXRlSHRtbFRlbXBsYXRlTG9hZGVyKHtcbiAgICAgICAgICAgICAgICBEZXBlbmRlbmN5U3lzdGVtLFxuICAgICAgICAgICAgICAgIGRvbUFQSSxcbiAgICAgICAgICAgICAgICBzYW5pdGl6ZXIsXG4gICAgICAgICAgICAgICAgZXZlbnRIYW5kbGVycyxcbiAgICAgICAgICAgICAgICBhcGlDbGllbnQ6IGFwaUNsaWVudEluc3RhbmNlLFxuICAgICAgICAgICAgICAgIHRpbWVyQVBJOiBicm93c2VyU2VydmljZSxcbiAgICAgICAgICAgICAgICBkb21SZWFkaW5lc3NTZXJ2aWNlLFxuICAgICAgICAgICAgICAgIGxvZ2dlclxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzYWZlUmVnaXN0ZXIoJ2h0bWxUZW1wbGF0ZUxvYWRlcicsIGh0bWxMb2FkZXJJbnN0YW5jZSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY3JlYXRlVWlSZW5kZXJlciAmJiBhcGlDbGllbnRJbnN0YW5jZSkge1xuICAgICAgICAgICAgY29uc3QgY3VyRW5kcG9pbnRzID0gRGVwZW5kZW5jeVN5c3RlbS5tb2R1bGVzLmdldCgnYXBpRW5kcG9pbnRzJyk7XG4gICAgICAgICAgICBpZiAoY3VyRW5kcG9pbnRzKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdWlSZW5kZXJlckluc3RhbmNlID0gY3JlYXRlVWlSZW5kZXJlcih7XG4gICAgICAgICAgICAgICAgICAgIGRvbUFQSSxcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRIYW5kbGVycyxcbiAgICAgICAgICAgICAgICAgICAgYXBpUmVxdWVzdDogYXBpQ2xpZW50SW5zdGFuY2UuZmV0Y2gsXG4gICAgICAgICAgICAgICAgICAgIGFwaUVuZHBvaW50czogY3VyRW5kcG9pbnRzLFxuICAgICAgICAgICAgICAgICAgICBkb21SZWFkaW5lc3NTZXJ2aWNlLFxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIsXG4gICAgICAgICAgICAgICAgICAgIERlcGVuZGVuY3lTeXN0ZW0sXG4gICAgICAgICAgICAgICAgICAgIG9uQ29udmVyc2F0aW9uU2VsZWN0OiAoY29udmVyc2F0aW9uSWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRvYyA9IGRvbUFQSS5nZXREb2N1bWVudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRvYyAmJiBldmVudEhhbmRsZXJzLmNyZWF0ZUN1c3RvbUV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9tQVBJLmRpc3BhdGNoRXZlbnQoZG9jLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudEhhbmRsZXJzLmNyZWF0ZUN1c3RvbUV2ZW50KCd1aVJlbmRlcmVyOmNvbnZlcnNhdGlvblNlbGVjdGVkJywge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWlsOiB7IGNvbnZlcnNhdGlvbklkIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBvblByb2plY3RTZWxlY3Q6IChwcm9qZWN0SWQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRvYyA9IGRvbUFQSS5nZXREb2N1bWVudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRvYyAmJiBldmVudEhhbmRsZXJzLmNyZWF0ZUN1c3RvbUV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9tQVBJLmRpc3BhdGNoRXZlbnQoZG9jLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudEhhbmRsZXJzLmNyZWF0ZUN1c3RvbUV2ZW50KCd1aVJlbmRlcmVyOnByb2plY3RTZWxlY3RlZCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbDogeyBwcm9qZWN0SWQgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBzYWZlUmVnaXN0ZXIoJ3VpUmVuZGVyZXInLCB1aVJlbmRlcmVySW5zdGFuY2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgbG9nZ2VyLmluZm8oJ1tzZXJ2aWNlSW5pdF0gQWR2YW5jZWQgc2VydmljZXMgcmVnaXN0cmF0aW9uIGNvbXBsZXRlZC4nLCB7XG4gICAgICAgICAgICBjb250ZXh0OiAnc2VydmljZUluaXQ6cmVnaXN0ZXJBZHZhbmNlZFNlcnZpY2VzJ1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZXRMb2dnZXIobmV3TG9nZ2VyKSB7XG4gICAgICAgIGlmICghbmV3TG9nZ2VyKSByZXR1cm47XG4gICAgICAgIGxvZ2dlciA9IG5ld0xvZ2dlcjtcbiAgICAgICAgc2FmZVJlZ2lzdGVyKCdsb2dnZXInLCBuZXdMb2dnZXIpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNsZWFudXAoKSB7XG4gICAgICAgIGV2ZW50SGFuZGxlcnMuY2xlYW51cExpc3RlbmVycyh7IGNvbnRleHQ6ICdzZXJ2aWNlSW5pdCcgfSk7XG4gICAgICAgIGNvbnN0IGxvZyA9IERlcGVuZGVuY3lTeXN0ZW0ubW9kdWxlcy5nZXQoJ2xvZ2dlcicpO1xuICAgICAgICBsb2cuZGVidWcoJ1tzZXJ2aWNlSW5pdF0gQ2xlYW51cCBjb21wbGV0ZWQnLCB7IGNvbnRleHQ6ICdzZXJ2aWNlSW5pdDpjbGVhbnVwJyB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICByZWdpc3RlckJhc2ljU2VydmljZXMsXG4gICAgICAgIHJlZ2lzdGVyQWR2YW5jZWRTZXJ2aWNlcyxcbiAgICAgICAgc2V0TG9nZ2VyLFxuICAgICAgICBjbGVhbnVwXG4gICAgfTtcbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFTyxTQUFTQSxpQkFBaUJBLENBQUNDLElBQUksRUFBRTtFQUNwQyxNQUFNO0lBQ0ZDLGdCQUFnQjtJQUFFQyxNQUFNO0lBQUVDLGNBQWM7SUFBRUMsYUFBYTtJQUN2REMsbUJBQW1CO0lBQUVDLFNBQVM7SUFBRUMsVUFBVTtJQUFF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