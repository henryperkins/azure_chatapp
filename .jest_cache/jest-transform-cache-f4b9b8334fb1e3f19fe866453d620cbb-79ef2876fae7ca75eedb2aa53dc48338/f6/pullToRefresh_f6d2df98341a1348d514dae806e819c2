fb1c4aebbb951816017e4bd0f5c1c8a7
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createPullToRefresh = createPullToRefresh;
function createPullToRefresh({
  element,
  onRefresh,
  eventHandlers,
  domAPI,
  browserService,
  threshold = 70,
  ctx = 'pull-to-refresh'
}) {
  if (!element || element.dataset.ptrBound === '1') return;
  element.dataset.ptrBound = '1';
  let startY = 0;
  let currentY = 0;
  let isPulling = false;
  let refreshTriggered = false;

  // Create pull indicator element if not present
  let pullIndicator = domAPI.getElementById?.('pullToRefreshIndicator_' + (element.id || ''));
  if (!pullIndicator) {
    pullIndicator = domAPI.createElement('div');
    pullIndicator.id = 'pullToRefreshIndicator_' + (element.id || Math.random().toString(36).slice(2));
    pullIndicator.className = 'pull-indicator';
    domAPI.setInnerHTML(pullIndicator, `
      <div class="mobile-loading-indicator"></div>
      <span class="ml-2">Pull to refresh</span>
    `);
    if (element.parentElement) {
      domAPI.insertBefore(element.parentElement, pullIndicator, element.parentElement.firstChild);
    } else {
      domAPI.appendChild(element, pullIndicator);
    }
  }
  function reset() {
    domAPI.setStyle(pullIndicator, 'transform', 'translateY(-50px)');
    domAPI.removeClass(pullIndicator, 'visible');
    isPulling = false;
    refreshTriggered = false;
  }

  // Touch start handler
  const handleTouchStart = e => {
    if (element.scrollTop <= 0) {
      startY = e.touches[0].clientY;
      isPulling = true;
    }
  };

  // Touch move handler
  const handleTouchMove = e => {
    if (!isPulling) return;
    currentY = e.touches[0].clientY;
    const pullDistance = currentY - startY;
    if (pullDistance > 0) {
      const pullPercent = Math.min(pullDistance / 100, 1);
      domAPI.setStyle(pullIndicator, 'transform', `translateY(${pullDistance / 2}px)`);
      if (pullDistance > 20) {
        domAPI.addClass(pullIndicator, 'visible');
      }
      if (pullDistance > threshold && !refreshTriggered) {
        domAPI.setInnerHTML(pullIndicator, `
          <div class="mobile-loading-indicator"></div>
          <span class="ml-2">Release to refresh</span>
        `);
      }
      e.preventDefault();
    }
  };

  // Touch end handler
  const handleTouchEnd = e => {
    if (!isPulling) return;
    const pullDistance = currentY - startY;
    if (pullDistance > threshold) {
      refreshTriggered = true;
      domAPI.setInnerHTML(pullIndicator, `
        <div class="mobile-loading-indicator animate-spin"></div>
        <span class="ml-2">Refreshing...</span>
      `);
      Promise.resolve(onRefresh?.()).finally(() => {
        browserService.setTimeout(reset, 1000);
      });
    } else {
      reset();
    }
  };
  eventHandlers.trackListener(element, 'touchstart', handleTouchStart, {
    context: ctx
  });
  eventHandlers.trackListener(element, 'touchmove', handleTouchMove, {
    context: ctx
  });
  eventHandlers.trackListener(element, 'touchend', handleTouchEnd, {
    context: ctx
  });
  return {
    cleanup() {
      eventHandlers.cleanupListeners({
        context: ctx
      });
      element.dataset.ptrBound = '';
    }
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVQdWxsVG9SZWZyZXNoIiwiZWxlbWVudCIsIm9uUmVmcmVzaCIsImV2ZW50SGFuZGxlcnMiLCJkb21BUEkiLCJicm93c2VyU2VydmljZSIsInRocmVzaG9sZCIsImN0eCIsImRhdGFzZXQiLCJwdHJCb3VuZCIsInN0YXJ0WSIsImN1cnJlbnRZIiwiaXNQdWxsaW5nIiwicmVmcmVzaFRyaWdnZXJlZCIsInB1bGxJbmRpY2F0b3IiLCJnZXRFbGVtZW50QnlJZCIsImlkIiwiY3JlYXRlRWxlbWVudCIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInNsaWNlIiwiY2xhc3NOYW1lIiwic2V0SW5uZXJIVE1MIiwicGFyZW50RWxlbWVudCIsImluc2VydEJlZm9yZSIsImZpcnN0Q2hpbGQiLCJhcHBlbmRDaGlsZCIsInJlc2V0Iiwic2V0U3R5bGUiLCJyZW1vdmVDbGFzcyIsImhhbmRsZVRvdWNoU3RhcnQiLCJlIiwic2Nyb2xsVG9wIiwidG91Y2hlcyIsImNsaWVudFkiLCJoYW5kbGVUb3VjaE1vdmUiLCJwdWxsRGlzdGFuY2UiLCJwdWxsUGVyY2VudCIsIm1pbiIsImFkZENsYXNzIiwicHJldmVudERlZmF1bHQiLCJoYW5kbGVUb3VjaEVuZCIsIlByb21pc2UiLCJyZXNvbHZlIiwiZmluYWxseSIsInNldFRpbWVvdXQiLCJ0cmFja0xpc3RlbmVyIiwiY29udGV4dCIsImNsZWFudXAiLCJjbGVhbnVwTGlzdGVuZXJzIl0sInNvdXJjZXMiOlsicHVsbFRvUmVmcmVzaC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZnVuY3Rpb24gY3JlYXRlUHVsbFRvUmVmcmVzaCh7XG4gIGVsZW1lbnQsIG9uUmVmcmVzaCxcbiAgZXZlbnRIYW5kbGVycywgZG9tQVBJLCBicm93c2VyU2VydmljZSxcbiAgdGhyZXNob2xkID0gNzAsIGN0eCA9ICdwdWxsLXRvLXJlZnJlc2gnXG59KSB7XG4gIGlmICghZWxlbWVudCB8fCBlbGVtZW50LmRhdGFzZXQucHRyQm91bmQgPT09ICcxJykgcmV0dXJuO1xuICBlbGVtZW50LmRhdGFzZXQucHRyQm91bmQgPSAnMSc7XG5cbiAgbGV0IHN0YXJ0WSA9IDA7XG4gIGxldCBjdXJyZW50WSA9IDA7XG4gIGxldCBpc1B1bGxpbmcgPSBmYWxzZTtcbiAgbGV0IHJlZnJlc2hUcmlnZ2VyZWQgPSBmYWxzZTtcblxuICAvLyBDcmVhdGUgcHVsbCBpbmRpY2F0b3IgZWxlbWVudCBpZiBub3QgcHJlc2VudFxuICBsZXQgcHVsbEluZGljYXRvciA9IGRvbUFQSS5nZXRFbGVtZW50QnlJZD8uKCdwdWxsVG9SZWZyZXNoSW5kaWNhdG9yXycgKyAoZWxlbWVudC5pZCB8fCAnJykpO1xuICBpZiAoIXB1bGxJbmRpY2F0b3IpIHtcbiAgICBwdWxsSW5kaWNhdG9yID0gZG9tQVBJLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIHB1bGxJbmRpY2F0b3IuaWQgPSAncHVsbFRvUmVmcmVzaEluZGljYXRvcl8nICsgKGVsZW1lbnQuaWQgfHwgTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMikpO1xuICAgIHB1bGxJbmRpY2F0b3IuY2xhc3NOYW1lID0gJ3B1bGwtaW5kaWNhdG9yJztcbiAgICBkb21BUEkuc2V0SW5uZXJIVE1MKHB1bGxJbmRpY2F0b3IsIGBcbiAgICAgIDxkaXYgY2xhc3M9XCJtb2JpbGUtbG9hZGluZy1pbmRpY2F0b3JcIj48L2Rpdj5cbiAgICAgIDxzcGFuIGNsYXNzPVwibWwtMlwiPlB1bGwgdG8gcmVmcmVzaDwvc3Bhbj5cbiAgICBgKTtcbiAgICBpZiAoZWxlbWVudC5wYXJlbnRFbGVtZW50KSB7XG4gICAgICBkb21BUEkuaW5zZXJ0QmVmb3JlKGVsZW1lbnQucGFyZW50RWxlbWVudCwgcHVsbEluZGljYXRvciwgZWxlbWVudC5wYXJlbnRFbGVtZW50LmZpcnN0Q2hpbGQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkb21BUEkuYXBwZW5kQ2hpbGQoZWxlbWVudCwgcHVsbEluZGljYXRvcik7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgZG9tQVBJLnNldFN0eWxlKHB1bGxJbmRpY2F0b3IsICd0cmFuc2Zvcm0nLCAndHJhbnNsYXRlWSgtNTBweCknKTtcbiAgICBkb21BUEkucmVtb3ZlQ2xhc3MocHVsbEluZGljYXRvciwgJ3Zpc2libGUnKTtcbiAgICBpc1B1bGxpbmcgPSBmYWxzZTtcbiAgICByZWZyZXNoVHJpZ2dlcmVkID0gZmFsc2U7XG4gIH1cblxuICAvLyBUb3VjaCBzdGFydCBoYW5kbGVyXG4gIGNvbnN0IGhhbmRsZVRvdWNoU3RhcnQgPSAoZSkgPT4ge1xuICAgIGlmIChlbGVtZW50LnNjcm9sbFRvcCA8PSAwKSB7XG4gICAgICBzdGFydFkgPSBlLnRvdWNoZXNbMF0uY2xpZW50WTtcbiAgICAgIGlzUHVsbGluZyA9IHRydWU7XG4gICAgfVxuICB9O1xuXG4gIC8vIFRvdWNoIG1vdmUgaGFuZGxlclxuICBjb25zdCBoYW5kbGVUb3VjaE1vdmUgPSAoZSkgPT4ge1xuICAgIGlmICghaXNQdWxsaW5nKSByZXR1cm47XG5cbiAgICBjdXJyZW50WSA9IGUudG91Y2hlc1swXS5jbGllbnRZO1xuICAgIGNvbnN0IHB1bGxEaXN0YW5jZSA9IGN1cnJlbnRZIC0gc3RhcnRZO1xuXG4gICAgaWYgKHB1bGxEaXN0YW5jZSA+IDApIHtcbiAgICAgIGNvbnN0IHB1bGxQZXJjZW50ID0gTWF0aC5taW4ocHVsbERpc3RhbmNlIC8gMTAwLCAxKTtcbiAgICAgIGRvbUFQSS5zZXRTdHlsZShwdWxsSW5kaWNhdG9yLCAndHJhbnNmb3JtJywgYHRyYW5zbGF0ZVkoJHtwdWxsRGlzdGFuY2UgLyAyfXB4KWApO1xuICAgICAgaWYgKHB1bGxEaXN0YW5jZSA+IDIwKSB7XG4gICAgICAgIGRvbUFQSS5hZGRDbGFzcyhwdWxsSW5kaWNhdG9yLCAndmlzaWJsZScpO1xuICAgICAgfVxuICAgICAgaWYgKHB1bGxEaXN0YW5jZSA+IHRocmVzaG9sZCAmJiAhcmVmcmVzaFRyaWdnZXJlZCkge1xuICAgICAgICBkb21BUEkuc2V0SW5uZXJIVE1MKHB1bGxJbmRpY2F0b3IsIGBcbiAgICAgICAgICA8ZGl2IGNsYXNzPVwibW9iaWxlLWxvYWRpbmctaW5kaWNhdG9yXCI+PC9kaXY+XG4gICAgICAgICAgPHNwYW4gY2xhc3M9XCJtbC0yXCI+UmVsZWFzZSB0byByZWZyZXNoPC9zcGFuPlxuICAgICAgICBgKTtcbiAgICAgIH1cbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9XG4gIH07XG5cbiAgLy8gVG91Y2ggZW5kIGhhbmRsZXJcbiAgY29uc3QgaGFuZGxlVG91Y2hFbmQgPSAoZSkgPT4ge1xuICAgIGlmICghaXNQdWxsaW5nKSByZXR1cm47XG5cbiAgICBjb25zdCBwdWxsRGlzdGFuY2UgPSBjdXJyZW50WSAtIHN0YXJ0WTtcblxuICAgIGlmIChwdWxsRGlzdGFuY2UgPiB0aHJlc2hvbGQpIHtcbiAgICAgIHJlZnJlc2hUcmlnZ2VyZWQgPSB0cnVlO1xuICAgICAgZG9tQVBJLnNldElubmVySFRNTChwdWxsSW5kaWNhdG9yLCBgXG4gICAgICAgIDxkaXYgY2xhc3M9XCJtb2JpbGUtbG9hZGluZy1pbmRpY2F0b3IgYW5pbWF0ZS1zcGluXCI+PC9kaXY+XG4gICAgICAgIDxzcGFuIGNsYXNzPVwibWwtMlwiPlJlZnJlc2hpbmcuLi48L3NwYW4+XG4gICAgICBgKTtcbiAgICAgIFByb21pc2UucmVzb2x2ZShvblJlZnJlc2g/LigpKS5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgYnJvd3NlclNlcnZpY2Uuc2V0VGltZW91dChyZXNldCwgMTAwMCk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzZXQoKTtcbiAgICB9XG4gIH07XG5cbiAgZXZlbnRIYW5kbGVycy50cmFja0xpc3RlbmVyKFxuICAgIGVsZW1lbnQsXG4gICAgJ3RvdWNoc3RhcnQnLFxuICAgIGhhbmRsZVRvdWNoU3RhcnQsXG4gICAgeyBjb250ZXh0OiBjdHggfVxuICApO1xuICBldmVudEhhbmRsZXJzLnRyYWNrTGlzdGVuZXIoXG4gICAgZWxlbWVudCxcbiAgICAndG91Y2htb3ZlJyxcbiAgICBoYW5kbGVUb3VjaE1vdmUsXG4gICAgeyBjb250ZXh0OiBjdHggfVxuICApO1xuICBldmVudEhhbmRsZXJzLnRyYWNrTGlzdGVuZXIoXG4gICAgZWxlbWVudCxcbiAgICAndG91Y2hlbmQnLFxuICAgIGhhbmRsZVRvdWNoRW5kLFxuICAgIHsgY29udGV4dDogY3R4IH1cbiAgKTtcblxuICByZXR1cm4ge1xuICAgIGNsZWFudXAoKSB7XG4gICAgICBldmVudEhhbmRsZXJzLmNsZWFudXBMaXN0ZW5lcnMoeyBjb250ZXh0OiBjdHggfSk7XG4gICAgICBlbGVtZW50LmRhdGFzZXQucHRyQm91bmQgPSAnJztcbiAgICB9XG4gIH07XG59XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFPLFNBQVNBLG1CQUFtQkEsQ0FBQztFQUNsQ0MsT0FBTztFQUFFQyxTQUFTO0VBQ2xCQyxhQUFhO0VBQUVDLE1BQU07RUFBRUMsY0FBYztFQUNyQ0MsU0FBUyxHQUFHLEVBQUU7RUFBRUMsR0FBRyxHQUFHO0FBQ3hCLENBQUMsRUFBRTtFQUNELElBQUksQ0FBQ04sT0FBTyxJQUFJQSxPQUFPLENBQUNPLE9BQU8sQ0FBQ0MsUUFBUSxLQUFLLEdBQUcsRUFBRTtFQUNsRFIsT0FBTyxDQUFDTyxPQUFPLENBQUNDLFFBQVEsR0FBRyxHQUFHO0VBRTlCLElBQUlDLE1BQU0sR0FBRyxDQUFDO0VBQ2QsSUFBSUMsUUFBUSxHQUFHLENBQUM7RUFDaEIsSUFBSUMsU0FBUyxHQUFHLEtBQUs7RUFDckIsSUFBSUMsZ0JBQWdCLEdBQUcsS0FBSzs7RUFFNUI7RUFDQSxJQUFJQyxhQUFhLEdBQUdWLE1BQU0sQ0FBQ1csY0FBYyxHQUFHLHlCQUF5QixJQUFJZCxPQUFPLENBQUNlLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztFQUMzRixJQUFJLENBQUNGLGFBQWEsRUFBRTtJQUNsQkEsYUFBYSxHQUFHVixNQUFNLENBQUNhLGFBQWEsQ0FBQyxLQUFLLENBQUM7SUFD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