4970458c35c6c6204cd8d9d5240bdbcd
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createAuthApiService = createAuthApiService;
exports.default = void 0;
/**
 * AuthApiService - extracted API and CSRF management (Phase-2)
 * -----------------------------------------------------------
 * Handles all authentication API calls, CSRF token management,
 * and network-related authentication logic. Extracted from oversized auth.js.
 */

function createAuthApiService({
  apiClient,
  apiEndpoints,
  logger,
  browserService
} = {}) {
  const MODULE = 'AuthApiService';
  if (!apiClient || !apiEndpoints || !logger || !browserService) {
    throw new Error(`[${MODULE}] Required dependencies missing: apiClient, apiEndpoints, logger, browserService`);
  }

  // Validate required endpoints
  const requiredEndpoints = ['AUTH_CSRF', 'AUTH_LOGIN', 'AUTH_LOGOUT', 'AUTH_REGISTER', 'AUTH_VERIFY', 'AUTH_REFRESH'];
  const missingEndpoints = requiredEndpoints.filter(key => !apiEndpoints[key]);
  if (missingEndpoints.length > 0) {
    throw new Error(`[${MODULE}] Missing required auth endpoints: ${missingEndpoints.join(', ')}`);
  }
  const _log = (msg, extra = {}) => logger?.debug?.(`[${MODULE}] ${msg}`, {
    context: MODULE,
    ...extra
  });
  const _logError = (msg, err, extra = {}) => {
    logger?.error?.(`[${MODULE}] ${msg}`, err?.stack || err, {
      context: MODULE,
      ...extra
    });
  };

  // CSRF token cache
  let csrfTokenCache = null;
  let csrfTokenExpiry = null;
  function getCSRFToken() {
    if (!csrfTokenCache || csrfTokenExpiry && Date.now() > csrfTokenExpiry) {
      return null;
    }
    return csrfTokenCache;
  }
  async function fetchCSRFToken() {
    try {
      _log('Fetching CSRF token from server');
      const response = await apiClient(apiEndpoints.AUTH_CSRF, {
        method: 'GET',
        headers: {
          'Accept': 'application/json'
        }
      });
      if (!response.ok) {
        throw new Error(`CSRF fetch failed: ${response.status} ${response.statusText}`);
      }
      const data = await response.json();
      if (!data.csrf_token) {
        throw new Error('CSRF token missing from server response');
      }
      csrfTokenCache = data.csrf_token;
      // Set expiry to 55 minutes (assuming 1-hour server expiry)
      csrfTokenExpiry = Date.now() + 55 * 60 * 1000;
      _log('CSRF token fetched successfully');
      return csrfTokenCache;
    } catch (err) {
      logger.error('[AuthApiService] Failed to fetch CSRF token', err, {
        context: MODULE
      });
      csrfTokenCache = null;
      csrfTokenExpiry = null;
      throw err;
    }
  }
  async function getCSRFTokenAsync(forceFetch = false) {
    if (!forceFetch) {
      const cached = getCSRFToken();
      if (cached) {
        return cached;
      }
    }
    return await fetchCSRFToken();
  }
  function extendErrorWithStatus(error, message) {
    const extendedError = new Error(message);
    extendedError.originalError = error;
    extendedError.status = error.status || 'unknown';
    extendedError.statusText = error.statusText || 'Unknown error';
    return extendedError;
  }
  async function authRequest(endpoint, method, body = null) {
    try {
      _log('Making auth request', {
        endpoint,
        method,
        hasBody: !!body
      });

      // Get CSRF token for non-GET requests
      let headers = {
        'Accept': 'application/json'
      };
      if (method !== 'GET') {
        const csrfToken = await getCSRFTokenAsync();
        headers['X-CSRFToken'] = csrfToken;
        headers['Content-Type'] = 'application/json';
      }
      const config = {
        method,
        headers
      };
      if (body && method !== 'GET') {
        config.body = JSON.stringify(body);
      }
      const response = await apiClient(endpoint, config);
      if (!response.ok) {
        let errorMessage = `Request failed: ${response.status} ${response.statusText}`;
        try {
          const errorData = await response.json();
          if (errorData.detail) {
            errorMessage = errorData.detail;
          } else if (errorData.message) {
            errorMessage = errorData.message;
          } else if (errorData.error) {
            errorMessage = errorData.error;
          }
        } catch (err) {
          logger.warn(`[${MODULE}] Failed to parse error response JSON`, err, {
            context: MODULE,
            endpoint
          });
        }
        const error = new Error(errorMessage);
        error.status = response.status;
        error.statusText = response.statusText;
        throw error;
      }
      const data = await response.json();
      _log('Auth request successful', {
        endpoint,
        method,
        status: response.status
      });
      return data;
    } catch (err) {
      logger.error('[AuthApiService] Auth request failed', err, {
        context: MODULE,
        endpoint,
        method
      });
      throw extendErrorWithStatus(err, err.message || 'Authentication request failed');
    }
  }
  async function login(username, password) {
    _log('Attempting login', {
      username
    });
    try {
      const response = await authRequest(apiEndpoints.AUTH_LOGIN, 'POST', {
        username: username.trim(),
        password
      });
      if (response.success && response.user) {
        _log('Login successful', {
          userId: response.user.id,
          username: response.user.username
        });
        return response;
      } else {
        throw new Error(response.message || 'Login failed - invalid response format');
      }
    } catch (err) {
      logger.error('[AuthApiService] Login failed', err, {
        context: MODULE,
        username
      });
      throw err;
    }
  }
  async function logout() {
    _log('Attempting logout');
    try {
      const response = await authRequest(apiEndpoints.AUTH_LOGOUT, 'POST');

      // Clear CSRF token on logout
      csrfTokenCache = null;
      csrfTokenExpiry = null;
      _log('Logout successful');
      return response;
    } catch (err) {
      logger.error('[AuthApiService] Logout failed', err, {
        context: MODULE
      });
      // Clear tokens even if logout request failed
      csrfTokenCache = null;
      csrfTokenExpiry = null;
      throw err;
    }
  }
  async function register(username, email, password) {
    _log('Attempting registration', {
      username,
      email
    });
    try {
      const response = await authRequest(apiEndpoints.AUTH_REGISTER, 'POST', {
        username: username.trim(),
        email: email.trim(),
        password
      });
      if (response.success) {
        _log('Registration successful', {
          username,
          email
        });
        return response;
      } else {
        throw new Error(response.message || 'Registration failed - invalid response format');
      }
    } catch (err) {
      logger.error('[AuthApiService] Registration failed', err, {
        context: MODULE,
        username,
        email
      });
      throw err;
    }
  }
  async function verifySession() {
    _log('Verifying session');
    try {
      const response = await authRequest(apiEndpoints.AUTH_VERIFY, 'GET');
      if (response.authenticated && response.user) {
        _log('Session verification successful', {
          userId: response.user.id,
          username: response.user.username
        });
        return response;
      } else {
        _log('Session verification failed - not authenticated');
        return {
          authenticated: false,
          user: null
        };
      }
    } catch (err) {
      logger.error('[AuthApiService] Session verification failed', err, {
        context: MODULE
      });
      // Don't throw on verification failure - just return unauthenticated state
      return {
        authenticated: false,
        user: null
      };
    }
  }
  async function refreshSession() {
    _log('Attempting session refresh');
    try {
      const response = await authRequest(apiEndpoints.AUTH_REFRESH, 'POST');
      if (response.success && response.user) {
        _log('Session refresh successful', {
          userId: response.user.id,
          username: response.user.username
        });
        return response;
      } else {
        throw new Error(response.message || 'Session refresh failed');
      }
    } catch (err) {
      logger.error('[AuthApiService] Session refresh failed', err, {
        context: MODULE
      });
      throw err;
    }
  }
  function clearTokenCache() {
    _log('Clearing token cache');
    csrfTokenCache = null;
    csrfTokenExpiry = null;
  }
  return {
    // CSRF management
    getCSRFToken,
    getCSRFTokenAsync,
    fetchCSRFToken,
    // Authentication operations
    login,
    logout,
    register,
    verifySession,
    refreshSession,
    // Generic auth request helper
    authRequest,
    // Cache management
    clearTokenCache,
    cleanup() {
      _log('cleanup()');
      clearTokenCache();
    }
  };
}
var _default = exports.default = createAuthApiService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVBdXRoQXBpU2VydmljZSIsImFwaUNsaWVudCIsImFwaUVuZHBvaW50cyIsImxvZ2dlciIsImJyb3dzZXJTZXJ2aWNlIiwiTU9EVUxFIiwiRXJyb3IiLCJyZXF1aXJlZEVuZHBvaW50cyIsIm1pc3NpbmdFbmRwb2ludHMiLCJmaWx0ZXIiLCJrZXkiLCJsZW5ndGgiLCJqb2luIiwiX2xvZyIsIm1zZyIsImV4dHJhIiwiZGVidWciLCJjb250ZXh0IiwiX2xvZ0Vycm9yIiwiZXJyIiwiZXJyb3IiLCJzdGFjayIsImNzcmZUb2tlbkNhY2hlIiwiY3NyZlRva2VuRXhwaXJ5IiwiZ2V0Q1NSRlRva2VuIiwiRGF0ZSIsIm5vdyIsImZldGNoQ1NSRlRva2VuIiwicmVzcG9uc2UiLCJBVVRIX0NTUkYiLCJtZXRob2QiLCJoZWFkZXJzIiwib2siLCJzdGF0dXMiLCJzdGF0dXNUZXh0IiwiZGF0YSIsImpzb24iLCJjc3JmX3Rva2VuIiwiZ2V0Q1NSRlRva2VuQXN5bmMiLCJmb3JjZUZldGNoIiwiY2FjaGVkIiwiZXh0ZW5kRXJyb3JXaXRoU3RhdHVzIiwibWVzc2FnZSIsImV4dGVuZGVkRXJyb3IiLCJvcmlnaW5hbEVycm9yIiwiYXV0aFJlcXVlc3QiLCJlbmRwb2ludCIsImJvZHkiLCJoYXNCb2R5IiwiY3NyZlRva2VuIiwiY29uZmlnIiwiSlNPTiIsInN0cmluZ2lmeSIsImVycm9yTWVzc2FnZSIsImVycm9yRGF0YSIsImRldGFpbCIsIndhcm4iLCJsb2dpbiIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJBVVRIX0xPR0lOIiwidHJpbSIsInN1Y2Nlc3MiLCJ1c2VyIiwidXNlcklkIiwiaWQiLCJsb2dvdXQiLCJBVVRIX0xPR09VVCIsInJlZ2lzdGVyIiwiZW1haWwiLCJBVVRIX1JFR0lTVEVSIiwidmVyaWZ5U2Vzc2lvbiIsIkFVVEhfVkVSSUZZIiwiYXV0aGVudGljYXRlZCIsInJlZnJlc2hTZXNzaW9uIiwiQVVUSF9SRUZSRVNIIiwiY2xlYXJUb2tlbkNhY2hlIiwiY2xlYW51cCIsIl9kZWZhdWx0IiwiZXhwb3J0cyIsImRlZmF1bHQiXSwic291cmNlcyI6WyJhdXRoQXBpU2VydmljZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEF1dGhBcGlTZXJ2aWNlIC0gZXh0cmFjdGVkIEFQSSBhbmQgQ1NSRiBtYW5hZ2VtZW50IChQaGFzZS0yKVxuICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAqIEhhbmRsZXMgYWxsIGF1dGhlbnRpY2F0aW9uIEFQSSBjYWxscywgQ1NSRiB0b2tlbiBtYW5hZ2VtZW50LFxuICogYW5kIG5ldHdvcmstcmVsYXRlZCBhdXRoZW50aWNhdGlvbiBsb2dpYy4gRXh0cmFjdGVkIGZyb20gb3ZlcnNpemVkIGF1dGguanMuXG4gKi9cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUF1dGhBcGlTZXJ2aWNlKHtcbiAgYXBpQ2xpZW50LFxuICBhcGlFbmRwb2ludHMsXG4gIGxvZ2dlcixcbiAgYnJvd3NlclNlcnZpY2Vcbn0gPSB7fSkge1xuICBjb25zdCBNT0RVTEUgPSAnQXV0aEFwaVNlcnZpY2UnO1xuXG4gIGlmICghYXBpQ2xpZW50IHx8ICFhcGlFbmRwb2ludHMgfHwgIWxvZ2dlciB8fCAhYnJvd3NlclNlcnZpY2UpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFske01PRFVMRX1dIFJlcXVpcmVkIGRlcGVuZGVuY2llcyBtaXNzaW5nOiBhcGlDbGllbnQsIGFwaUVuZHBvaW50cywgbG9nZ2VyLCBicm93c2VyU2VydmljZWApO1xuICB9XG5cbiAgLy8gVmFsaWRhdGUgcmVxdWlyZWQgZW5kcG9pbnRzXG4gIGNvbnN0IHJlcXVpcmVkRW5kcG9pbnRzID0gWydBVVRIX0NTUkYnLCAnQVVUSF9MT0dJTicsICdBVVRIX0xPR09VVCcsICdBVVRIX1JFR0lTVEVSJywgJ0FVVEhfVkVSSUZZJywgJ0FVVEhfUkVGUkVTSCddO1xuICBjb25zdCBtaXNzaW5nRW5kcG9pbnRzID0gcmVxdWlyZWRFbmRwb2ludHMuZmlsdGVyKGtleSA9PiAhYXBpRW5kcG9pbnRzW2tleV0pO1xuICBpZiAobWlzc2luZ0VuZHBvaW50cy5sZW5ndGggPiAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBbJHtNT0RVTEV9XSBNaXNzaW5nIHJlcXVpcmVkIGF1dGggZW5kcG9pbnRzOiAke21pc3NpbmdFbmRwb2ludHMuam9pbignLCAnKX1gKTtcbiAgfVxuXG4gIGNvbnN0IF9sb2cgPSAobXNnLCBleHRyYSA9IHt9KSA9PiBsb2dnZXI/LmRlYnVnPy4oYFske01PRFVMRX1dICR7bXNnfWAsIHtcbiAgICBjb250ZXh0OiBNT0RVTEUsXG4gICAgLi4uZXh0cmFcbiAgfSk7XG5cbiAgY29uc3QgX2xvZ0Vycm9yID0gKG1zZywgZXJyLCBleHRyYSA9IHt9KSA9PiB7XG4gICAgbG9nZ2VyPy5lcnJvcj8uKGBbJHtNT0RVTEV9XSAke21zZ31gLCBlcnI/LnN0YWNrIHx8IGVyciwge1xuICAgICAgY29udGV4dDogTU9EVUxFLFxuICAgICAgLi4uZXh0cmFcbiAgICB9KTtcbiAgfTtcblxuICAvLyBDU1JGIHRva2VuIGNhY2hlXG4gIGxldCBjc3JmVG9rZW5DYWNoZSA9IG51bGw7XG4gIGxldCBjc3JmVG9rZW5FeHBpcnkgPSBudWxsO1xuXG4gIGZ1bmN0aW9uIGdldENTUkZUb2tlbigpIHtcbiAgICBpZiAoIWNzcmZUb2tlbkNhY2hlIHx8IChjc3JmVG9rZW5FeHBpcnkgJiYgRGF0ZS5ub3coKSA+IGNzcmZUb2tlbkV4cGlyeSkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gY3NyZlRva2VuQ2FjaGU7XG4gIH1cblxuICBhc3luYyBmdW5jdGlvbiBmZXRjaENTUkZUb2tlbigpIHtcbiAgICB0cnkge1xuICAgICAgX2xvZygnRmV0Y2hpbmcgQ1NSRiB0b2tlbiBmcm9tIHNlcnZlcicpO1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhcGlDbGllbnQoYXBpRW5kcG9pbnRzLkFVVEhfQ1NSRiwge1xuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICBoZWFkZXJzOiB7ICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbicgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDU1JGIGZldGNoIGZhaWxlZDogJHtyZXNwb25zZS5zdGF0dXN9ICR7cmVzcG9uc2Uuc3RhdHVzVGV4dH1gKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIGlmICghZGF0YS5jc3JmX3Rva2VuKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ1NSRiB0b2tlbiBtaXNzaW5nIGZyb20gc2VydmVyIHJlc3BvbnNlJyk7XG4gICAgICB9XG5cbiAgICAgIGNzcmZUb2tlbkNhY2hlID0gZGF0YS5jc3JmX3Rva2VuO1xuICAgICAgLy8gU2V0IGV4cGlyeSB0byA1NSBtaW51dGVzIChhc3N1bWluZyAxLWhvdXIgc2VydmVyIGV4cGlyeSlcbiAgICAgIGNzcmZUb2tlbkV4cGlyeSA9IERhdGUubm93KCkgKyAoNTUgKiA2MCAqIDEwMDApO1xuXG4gICAgICBfbG9nKCdDU1JGIHRva2VuIGZldGNoZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgICByZXR1cm4gY3NyZlRva2VuQ2FjaGU7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ1tBdXRoQXBpU2VydmljZV0gRmFpbGVkIHRvIGZldGNoIENTUkYgdG9rZW4nLCBlcnIsIHsgY29udGV4dDogTU9EVUxFIH0pO1xuICAgICAgY3NyZlRva2VuQ2FjaGUgPSBudWxsO1xuICAgICAgY3NyZlRva2VuRXhwaXJ5ID0gbnVsbDtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gIH1cblxuICBhc3luYyBmdW5jdGlvbiBnZXRDU1JGVG9rZW5Bc3luYyhmb3JjZUZldGNoID0gZmFsc2UpIHtcbiAgICBpZiAoIWZvcmNlRmV0Y2gpIHtcbiAgICAgIGNvbnN0IGNhY2hlZCA9IGdldENTUkZUb2tlbigpO1xuICAgICAgaWYgKGNhY2hlZCkge1xuICAgICAgICByZXR1cm4gY2FjaGVkO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgZmV0Y2hDU1JGVG9rZW4oKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGV4dGVuZEVycm9yV2l0aFN0YXR1cyhlcnJvciwgbWVzc2FnZSkge1xuICAgIGNvbnN0IGV4dGVuZGVkRXJyb3IgPSBuZXcgRXJyb3IobWVzc2FnZSk7XG4gICAgZXh0ZW5kZWRFcnJvci5vcmlnaW5hbEVycm9yID0gZXJyb3I7XG4gICAgZXh0ZW5kZWRFcnJvci5zdGF0dXMgPSBlcnJvci5zdGF0dXMgfHwgJ3Vua25vd24nO1xuICAgIGV4dGVuZGVkRXJyb3Iuc3RhdHVzVGV4dCA9IGVycm9yLnN0YXR1c1RleHQgfHwgJ1Vua25vd24gZXJyb3InO1xuICAgIHJldHVybiBleHRlbmRlZEVycm9yO1xuICB9XG5cbiAgYXN5bmMgZnVuY3Rpb24gYXV0aFJlcXVlc3QoZW5kcG9pbnQsIG1ldGhvZCwgYm9keSA9IG51bGwpIHtcbiAgICB0cnkge1xuICAgICAgX2xvZygnTWFraW5nIGF1dGggcmVxdWVzdCcsIHsgZW5kcG9pbnQsIG1ldGhvZCwgaGFzQm9keTogISFib2R5IH0pO1xuXG4gICAgICAvLyBHZXQgQ1NSRiB0b2tlbiBmb3Igbm9uLUdFVCByZXF1ZXN0c1xuICAgICAgbGV0IGhlYWRlcnMgPSB7ICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbicgfTtcbiAgICAgIGlmIChtZXRob2QgIT09ICdHRVQnKSB7XG4gICAgICAgIGNvbnN0IGNzcmZUb2tlbiA9IGF3YWl0IGdldENTUkZUb2tlbkFzeW5jKCk7XG4gICAgICAgIGhlYWRlcnNbJ1gtQ1NSRlRva2VuJ10gPSBjc3JmVG9rZW47XG4gICAgICAgIGhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL2pzb24nO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBjb25maWcgPSB7IG1ldGhvZCwgaGVhZGVycyB9O1xuICAgICAgaWYgKGJvZHkgJiYgbWV0aG9kICE9PSAnR0VUJykge1xuICAgICAgICBjb25maWcuYm9keSA9IEpTT04uc3RyaW5naWZ5KGJvZHkpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGFwaUNsaWVudChlbmRwb2ludCwgY29uZmlnKTtcbiAgICAgIFxuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICBsZXQgZXJyb3JNZXNzYWdlID0gYFJlcXVlc3QgZmFpbGVkOiAke3Jlc3BvbnNlLnN0YXR1c30gJHtyZXNwb25zZS5zdGF0dXNUZXh0fWA7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgZXJyb3JEYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgIGlmIChlcnJvckRhdGEuZGV0YWlsKSB7XG4gICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSBlcnJvckRhdGEuZGV0YWlsO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JEYXRhLm1lc3NhZ2UpIHtcbiAgICAgICAgICAgIGVycm9yTWVzc2FnZSA9IGVycm9yRGF0YS5tZXNzYWdlO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JEYXRhLmVycm9yKSB7XG4gICAgICAgICAgICBlcnJvck1lc3NhZ2UgPSBlcnJvckRhdGEuZXJyb3I7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBsb2dnZXIud2FybihgWyR7TU9EVUxFfV0gRmFpbGVkIHRvIHBhcnNlIGVycm9yIHJlc3BvbnNlIEpTT05gLCBlcnIsIHsgY29udGV4dDogTU9EVUxFLCBlbmRwb2ludCB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoZXJyb3JNZXNzYWdlKTtcbiAgICAgICAgZXJyb3Iuc3RhdHVzID0gcmVzcG9uc2Uuc3RhdHVzO1xuICAgICAgICBlcnJvci5zdGF0dXNUZXh0ID0gcmVzcG9uc2Uuc3RhdHVzVGV4dDtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICBfbG9nKCdBdXRoIHJlcXVlc3Qgc3VjY2Vzc2Z1bCcsIHsgZW5kcG9pbnQsIG1ldGhvZCwgc3RhdHVzOiByZXNwb25zZS5zdGF0dXMgfSk7XG4gICAgICByZXR1cm4gZGF0YTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignW0F1dGhBcGlTZXJ2aWNlXSBBdXRoIHJlcXVlc3QgZmFpbGVkJywgZXJyLCB7IGNvbnRleHQ6IE1PRFVMRSwgZW5kcG9pbnQsIG1ldGhvZCB9KTtcbiAgICAgIHRocm93IGV4dGVuZEVycm9yV2l0aFN0YXR1cyhlcnIsIGVyci5tZXNzYWdlIHx8ICdBdXRoZW50aWNhdGlvbiByZXF1ZXN0IGZhaWxlZCcpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGZ1bmN0aW9uIGxvZ2luKHVzZXJuYW1lLCBwYXNzd29yZCkge1xuICAgIF9sb2coJ0F0dGVtcHRpbmcgbG9naW4nLCB7IHVzZXJuYW1lIH0pO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF1dGhSZXF1ZXN0KGFwaUVuZHBvaW50cy5BVVRIX0xPR0lOLCAnUE9TVCcsIHtcbiAgICAgICAgdXNlcm5hbWU6IHVzZXJuYW1lLnRyaW0oKSxcbiAgICAgICAgcGFzc3dvcmRcbiAgICAgIH0pO1xuXG4gICAgICBpZiAocmVzcG9uc2Uuc3VjY2VzcyAmJiByZXNwb25zZS51c2VyKSB7XG4gICAgICAgIF9sb2coJ0xvZ2luIHN1Y2Nlc3NmdWwnLCB7IHVzZXJJZDogcmVzcG9uc2UudXNlci5pZCwgdXNlcm5hbWU6IHJlc3BvbnNlLnVzZXIudXNlcm5hbWUgfSk7XG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihyZXNwb25zZS5tZXNzYWdlIHx8ICdMb2dpbiBmYWlsZWQgLSBpbnZhbGlkIHJlc3BvbnNlIGZvcm1hdCcpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdbQXV0aEFwaVNlcnZpY2VdIExvZ2luIGZhaWxlZCcsIGVyciwgeyBjb250ZXh0OiBNT0RVTEUsIHVzZXJuYW1lIH0pO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGZ1bmN0aW9uIGxvZ291dCgpIHtcbiAgICBfbG9nKCdBdHRlbXB0aW5nIGxvZ291dCcpO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF1dGhSZXF1ZXN0KGFwaUVuZHBvaW50cy5BVVRIX0xPR09VVCwgJ1BPU1QnKTtcbiAgICAgIFxuICAgICAgLy8gQ2xlYXIgQ1NSRiB0b2tlbiBvbiBsb2dvdXRcbiAgICAgIGNzcmZUb2tlbkNhY2hlID0gbnVsbDtcbiAgICAgIGNzcmZUb2tlbkV4cGlyeSA9IG51bGw7XG4gICAgICBcbiAgICAgIF9sb2coJ0xvZ291dCBzdWNjZXNzZnVsJyk7XG4gICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ1tBdXRoQXBpU2VydmljZV0gTG9nb3V0IGZhaWxlZCcsIGVyciwgeyBjb250ZXh0OiBNT0RVTEUgfSk7XG4gICAgICAvLyBDbGVhciB0b2tlbnMgZXZlbiBpZiBsb2dvdXQgcmVxdWVzdCBmYWlsZWRcbiAgICAgIGNzcmZUb2tlbkNhY2hlID0gbnVsbDtcbiAgICAgIGNzcmZUb2tlbkV4cGlyeSA9IG51bGw7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZnVuY3Rpb24gcmVnaXN0ZXIodXNlcm5hbWUsIGVtYWlsLCBwYXNzd29yZCkge1xuICAgIF9sb2coJ0F0dGVtcHRpbmcgcmVnaXN0cmF0aW9uJywgeyB1c2VybmFtZSwgZW1haWwgfSk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXV0aFJlcXVlc3QoYXBpRW5kcG9pbnRzLkFVVEhfUkVHSVNURVIsICdQT1NUJywge1xuICAgICAgICB1c2VybmFtZTogdXNlcm5hbWUudHJpbSgpLFxuICAgICAgICBlbWFpbDogZW1haWwudHJpbSgpLFxuICAgICAgICBwYXNzd29yZFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgIF9sb2coJ1JlZ2lzdHJhdGlvbiBzdWNjZXNzZnVsJywgeyB1c2VybmFtZSwgZW1haWwgfSk7XG4gICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihyZXNwb25zZS5tZXNzYWdlIHx8ICdSZWdpc3RyYXRpb24gZmFpbGVkIC0gaW52YWxpZCByZXNwb25zZSBmb3JtYXQnKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignW0F1dGhBcGlTZXJ2aWNlXSBSZWdpc3RyYXRpb24gZmFpbGVkJywgZXJyLCB7IGNvbnRleHQ6IE1PRFVMRSwgdXNlcm5hbWUsIGVtYWlsIH0pO1xuICAgICAgdGhyb3cgZXJyO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGZ1bmN0aW9uIHZlcmlmeVNlc3Npb24oKSB7XG4gICAgX2xvZygnVmVyaWZ5aW5nIHNlc3Npb24nKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhdXRoUmVxdWVzdChhcGlFbmRwb2ludHMuQVVUSF9WRVJJRlksICdHRVQnKTtcbiAgICAgIFxuICAgICAgaWYgKHJlc3BvbnNlLmF1dGhlbnRpY2F0ZWQgJiYgcmVzcG9uc2UudXNlcikge1xuICAgICAgICBfbG9nKCdTZXNzaW9uIHZlcmlmaWNhdGlvbiBzdWNjZXNzZnVsJywgeyBcbiAgICAgICAgICB1c2VySWQ6IHJlc3BvbnNlLnVzZXIuaWQsIFxuICAgICAgICAgIHVzZXJuYW1lOiByZXNwb25zZS51c2VyLnVzZXJuYW1lIFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX2xvZygnU2Vzc2lvbiB2ZXJpZmljYXRpb24gZmFpbGVkIC0gbm90IGF1dGhlbnRpY2F0ZWQnKTtcbiAgICAgICAgcmV0dXJuIHsgYXV0aGVudGljYXRlZDogZmFsc2UsIHVzZXI6IG51bGwgfTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignW0F1dGhBcGlTZXJ2aWNlXSBTZXNzaW9uIHZlcmlmaWNhdGlvbiBmYWlsZWQnLCBlcnIsIHsgY29udGV4dDogTU9EVUxFIH0pO1xuICAgICAgLy8gRG9uJ3QgdGhyb3cgb24gdmVyaWZpY2F0aW9uIGZhaWx1cmUgLSBqdXN0IHJldHVybiB1bmF1dGhlbnRpY2F0ZWQgc3RhdGVcbiAgICAgIHJldHVybiB7IGF1dGhlbnRpY2F0ZWQ6IGZhbHNlLCB1c2VyOiBudWxsIH07XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZnVuY3Rpb24gcmVmcmVzaFNlc3Npb24oKSB7XG4gICAgX2xvZygnQXR0ZW1wdGluZyBzZXNzaW9uIHJlZnJlc2gnKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhdXRoUmVxdWVzdChhcGlFbmRwb2ludHMuQVVUSF9SRUZSRVNILCAnUE9TVCcpO1xuICAgICAgXG4gICAgICBpZiAocmVzcG9uc2Uuc3VjY2VzcyAmJiByZXNwb25zZS51c2VyKSB7XG4gICAgICAgIF9sb2coJ1Nlc3Npb24gcmVmcmVzaCBzdWNjZXNzZnVsJywgeyBcbiAgICAgICAgICB1c2VySWQ6IHJlc3BvbnNlLnVzZXIuaWQsIFxuICAgICAgICAgIHVzZXJuYW1lOiByZXNwb25zZS51c2VyLnVzZXJuYW1lIFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlc3BvbnNlLm1lc3NhZ2UgfHwgJ1Nlc3Npb24gcmVmcmVzaCBmYWlsZWQnKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignW0F1dGhBcGlTZXJ2aWNlXSBTZXNzaW9uIHJlZnJlc2ggZmFpbGVkJywgZXJyLCB7IGNvbnRleHQ6IE1PRFVMRSB9KTtcbiAgICAgIHRocm93IGVycjtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBjbGVhclRva2VuQ2FjaGUoKSB7XG4gICAgX2xvZygnQ2xlYXJpbmcgdG9rZW4gY2FjaGUnKTtcbiAgICBjc3JmVG9rZW5DYWNoZSA9IG51bGw7XG4gICAgY3NyZlRva2VuRXhwaXJ5ID0gbnVsbDtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgLy8gQ1NSRiBtYW5hZ2VtZW50XG4gICAgZ2V0Q1NSRlRva2VuLFxuICAgIGdldENTUkZUb2tlbkFzeW5jLFxuICAgIGZldGNoQ1NSRlRva2VuLFxuXG4gICAgLy8gQXV0aGVudGljYXRpb24gb3BlcmF0aW9uc1xuICAgIGxvZ2luLFxuICAgIGxvZ291dCxcbiAgICByZWdpc3RlcixcbiAgICB2ZXJpZnlTZXNzaW9uLFxuICAgIHJlZnJlc2hTZXNzaW9uLFxuXG4gICAgLy8gR2VuZXJpYyBhdXRoIHJlcXVlc3QgaGVscGVyXG4gICAgYXV0aFJlcXVlc3QsXG5cbiAgICAvLyBDYWNoZSBtYW5hZ2VtZW50XG4gICAgY2xlYXJUb2tlbkNhY2hlLFxuXG4gICAgY2xlYW51cCgpIHtcbiAgICAgIF9sb2coJ2NsZWFudXAoKScpO1xuICAgICAgY2xlYXJUb2tlbkNhY2hlKCk7XG4gICAgfVxuICB9O1xufVxuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVBdXRoQXBpU2VydmljZTsiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRU8sU0FBU0Esb0JBQW9CQSxDQUFDO0VBQ25DQyxTQUFTO0VBQ1RDLFlBQVk7RUFDWkMsTUFBTTtFQUNOQztBQUNGLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRTtFQUNOLE1BQU1DLE1BQU0sR0FBRyxnQkFBZ0I7RUFFL0IsSUFBSSxDQUFDSixTQUFTLElBQUksQ0FBQ0MsWUFBWSxJQUFJLENBQUNDLE1BQU0sSUFBSSxDQUFDQyxjQUFjLEVBQUU7SUFDN0QsTUFBTSxJQUFJRSxLQUFLLENBQUMsSUFBSUQsTUFBTSxrRkFBa0YsQ0FBQztFQUMvRzs7RUFFQTtFQUNBLE1BQU1FLGlCQUFpQixHQUFHLENBQUMsV0FBVyxFQUFFLFlBQVksRUFBRSxhQUFhLEVBQUUsZUFBZSxFQUFFLGFBQWEsRUFBRSxjQUFjLENBQUM7RUFDcEgsTUFBTUMsZ0JBQWdCLEdBQUdELGlCQUFpQixDQUFDRSxNQUFNLENBQUNDLEdBQUcsSUFBSSxDQUFDUixZQUFZLENBQUNRLEdBQUcsQ0FBQyxDQUFDO0VBQzVFLElBQUlGLGdCQUFnQixDQUFDRyxNQUFNLEdBQUcsQ0FBQyxFQUFFO0lBQy9CLE1BQU0sSUFBSUwsS0FBSyxDQUFDLElBQUlELE1BQU0sc0NBQXNDRyxnQkFBZ0IsQ0FBQ0ksSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7RUFDaEc7RUFFQSxNQUFNQyxJQUFJLEdBQUdBLENBQUNDLEdBQUcsRUFBRUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxLQUFLWixNQUFNLEVBQUVhLEtBQUssR0FBRyxJQUFJWCxNQUFNLEtBQUtTLEdBQUcsRUFBRSxFQUFFO0lBQ3RFRyxPQUFPLEVBQUVaLE1BQU07SUFDZixHQUFHVTtFQUNMLENBQUMsQ0FBQztFQUVGLE1BQU1HLFNBQVMsR0FBR0EsQ0FBQ0osR0FBRyxFQUFFSyxHQUFHLEVBQUVKLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSztJQUMxQ1osTUFBTSxFQUFFaUIsS0FBSyxHQUFHLElBQUlmLE1BQU0sS0FBS1MsR0FBRyxFQUFFLEVBQUVLLEdBQUcsRUFBRUUsS0FBSyxJQUFJRixHQUFHLEVBQUU7TUFDdkRGLE9BQU8sRUFBRVosTUFBTTtNQUNmLEdBQUdVO0lBQ0wsQ0FBQyxDQUFDO0VBQ0osQ0FBQzs7RUFFRDtFQUNBLElBQUlPLGNBQWMsR0FBRyxJQUFJO0VBQ3pCLElBQUlDLGVBQWUsR0FBRyxJQUFJO0VBRTFCLFNBQVNDLFlBQVlBLENBQUEsRUFBRztJQUN0QixJQUFJLENBQUNGLGNBQWMsSUFBS0MsZUFBZSxJQUFJRSxJQUFJLENBQUNDLEdBQUcsQ0FBQyxDQUFDLEdBQUdILGVBQWdCLEVBQUU7TUFDeEUsT0FBTyxJQUFJO0lBQ2I7SUFDQSxPQUFPRCxjQUFjO0VBQ3ZCO0VBRUEsZUFBZUssY0FBY0EsQ0FBQSxFQUFHO0lBQzlCLElBQUk7TUFDRmQsSUFBSSxDQUFDLGlDQUFpQyxDQUFDO01BQ3ZDLE1BQU1lLFFBQVEsR0FBRyxNQUFNM0IsU0FBUyxDQUFDQyxZQUFZLENBQUMyQixTQUFTLEVBQUU7UUFDdkRDLE1BQU0sRUFBRSxLQUFLO1FBQ2JDLE9BQU8sRUFBRTtVQUFFLFFBQVEsRUFBRTtRQUFtQjtNQUMxQyxDQUFDLENBQUM7TUFFRixJQUFJLENBQUNILFFBQVEsQ0FBQ0ksRUFBRSxFQUFFO1FBQ2hCLE1BQU0sSUFBSTFCLEtBQUssQ0FBQyxzQkFBc0JzQixRQUFRLENBQUNLLE1BQU0sSUFBSUwsUUFBUSxDQUFDTSxVQUFVLEVBQUUsQ0FBQztNQUNqRjtNQUVBLE1BQU1DLElBQUksR0FBRyxNQUFNUCxRQUFRLENBQUNRLElBQUksQ0FBQyxDQUFDO01BQ2xDLElBQUksQ0FBQ0QsSUFBSSxDQUFDRSxVQUFVLEVBQUU7UUFDcEIsTUFBTSxJQUFJL0IsS0FBSyxDQUFDLHlDQUF5QyxDQUFDO01BQzVEO01BRUFnQixjQUFjLEdBQUdhLElBQUksQ0FBQ0UsVUFBVTtNQUNoQztNQUNBZCxlQUFlLEdBQUdFLElBQUksQ0FBQ0MsR0FBRyxDQUFDLENBQUMsR0FBSSxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUs7TUFFL0NiLElBQUksQ0FBQyxpQ0FBaUMsQ0FBQztNQUN2QyxPQUFPUyxjQUFjO0lBQ3ZCLENBQUMsQ0FBQyxPQUFPSCxHQUFHLEVBQUU7TUFDWmhCLE1BQU0sQ0FBQ2lCLEtBQUssQ0FBQyw2Q0FBNkMsRUFBRUQsR0FBRyxFQUFFO1FBQUVGLE9BQU8sRUFBRVo7TUFBTyxDQUFDLENBQUM7TUFDckZpQixjQUFjLEdBQUcsSUFBSTtNQUNyQkMsZUFBZSxHQUFHLElBQUk7TUFDdEIsTUFBTUosR0FBRztJQUNYO0VBQ0Y7RUFFQSxlQUFlbUIsaUJBQWlCQSxDQUFDQyxVQUFVLEdBQUcsS0FBSyxFQUFFO0lBQ25ELElBQUksQ0FBQ0EsVUFBVSxFQUFFO01BQ2YsTUFBTUMsTUFBTSxHQUFHaEIsWUFBWSxDQUFDLENBQUM7TUFDN0IsSUFBSWdCLE1BQU0sRUFBRTtRQUNWLE9BQU9BLE1BQU07TUFDZjtJQUNGO0lBQ0EsT0FBTyxNQUFNYixjQUFjLENBQUMsQ0FBQztFQUMvQjtFQUVBLFNBQVNjLHFCQUFxQkEsQ0FBQ3JCLEtBQUssRUFBRXNCLE9BQU8sRUFBRTtJQUM3QyxNQUFNQyxhQUFhLEdBQUcsSUFBSXJDLEtBQUssQ0FBQ29DLE9BQU8sQ0FBQztJQUN4Q0MsYUFBYSxDQUFDQyxhQUFhLEdBQUd4QixLQUFLO0lBQ25DdUIsYUFBYSxDQUFDVixNQUFNLEdBQUdiLEtBQUssQ0FBQ2EsTUFBTSxJQUFJLFNBQVM7SUFDaERVLGFBQWEsQ0FBQ1QsVUFBVSxHQUFHZCxLQUFLLENBQUNjLFVBQVUsSUFBSSxlQUFlO0lBQzlELE9BQU9TLGFBQWE7RUFDdEI7RUFFQSxlQUFlRSxXQUFXQSxDQUFDQyxRQUFRLEVBQUVoQixNQUFNLEVBQUVpQixJQUFJLEdBQUcsSUFBSSxFQUFFO0lBQ3hELElBQUk7TUFDRmxDLElBQUksQ0FBQyxxQkFBcUIsRUFBRTtRQUFFaUMsUUFBUTtRQUFFaEIsTUFBTTtRQUFFa0IsT0FBTyxFQUFFLENBQUMsQ0FBQ0Q7TUFBSyxDQUFDLENBQUM7O01BRWxFO01BQ0EsSUFBSWhCLE9BQU8sR0FBRztRQUFFLFFBQVEsRUFBRTtNQUFtQixDQUFDO01BQzlDLElBQUlELE1BQU0sS0FBSyxLQUFLLEVBQUU7UUFDcEIsTUFBTW1CLFNBQVMsR0FBRyxNQUFNWCxpQkFBaUIsQ0FBQyxDQUFDO1FBQzNDUCxPQUFPLENBQUMsYUFBYSxDQUFDLEdBQUdrQixTQUFTO1FBQ2xDbEIsT0FBTyxDQUFDLGNBQWMsQ0FBQyxHQUFHLGtCQUFrQjtNQUM5QztNQUVBLE1BQU1tQixNQUFNLEdBQUc7UUFBRXBCLE1BQU07UUFBRUM7TUFBUSxDQUFDO01BQ2xDLElBQUlnQixJQUFJLElBQUlqQixNQUFNLEtBQUssS0FBSyxFQUFFO1FBQzVCb0IsTUFBTSxDQUFDSCxJQUFJLEdBQUdJLElBQUksQ0FBQ0MsU0FBUyxDQUFDTCxJQUFJLENBQUM7TUFDcEM7TUFFQSxNQUFNbkIsUUFBUSxHQUFHLE1BQU0zQixTQUFTLENBQUM2QyxRQUFRLEVBQUVJLE1BQU0sQ0FBQztNQUVsRCxJQUFJLENBQUN0QixRQUFRLENBQUNJLEVBQUUsRUFBRTtRQUNoQixJQUFJcUIsWUFBWSxHQUFHLG1CQUFtQnpCLFFBQVEsQ0FBQ0ssTUFBTSxJQUFJTCxRQUFRLENBQUNNLFVBQVUsRUFBRTtRQUM5RSxJQUFJO1VBQ0YsTUFBTW9CLFNBQVMsR0FBRyxNQUFNMUIsUUFBUSxDQUFDUSxJQUFJLENBQUMsQ0FBQztVQUN2QyxJQUFJa0IsU0FBUyxDQUFDQyxNQUFNLEVBQUU7WUFDcEJGLFlBQVksR0FBR0MsU0FBUyxDQUFDQyxNQUFNO1VBQ2pDLENBQUMsTUFBTSxJQUFJRCxTQUFTLENBQUNaLE9BQU8sRUFBRTtZQUM1QlcsWUFBWSxHQUFHQyxTQUFTLENBQUNaLE9BQU87VUFDbEMsQ0FBQyxNQUFNLElBQUlZLFNBQVMsQ0FBQ2xDLEtBQUssRUFBRTtZQUMxQmlDLFlBQVksR0FBR0MsU0FBUyxDQUFDbEMsS0FBSztVQUNoQztRQUNGLENBQUMsQ0FBQyxPQUFPRCxHQUFHLEVBQUU7VUFDWmhCLE1BQU0sQ0FBQ3FELElBQUksQ0FBQyxJQUFJbkQsTUFBTSx1Q0FBdUMsRUFBRWMsR0FBRyxFQUFFO1lBQUVGLE9BQU8sRUFBRVosTUFBTTtZQUFFeUM7VUFBUyxDQUFDLENBQUM7UUFDcEc7UUFFQSxNQUFNMUIsS0FBSyxHQUFHLElBQUlkLEtBQUssQ0FBQytDLFlBQVksQ0FBQztRQUNyQ2pDLEtBQUssQ0FBQ2EsTUFBTSxHQUFHTCxRQUFRLENBQUNLLE1BQU07UUFDOUJiLEtBQUssQ0FBQ2MsVUFBVSxHQUFHTixRQUFRLENBQUNNLFVBQVU7UUFDdEMsTUFBTWQsS0FBSztNQUNiO01BRUEsTUFBTWUsSUFBSSxHQUFHLE1BQU1QLFFBQVEsQ0FBQ1EsSUFBSSxDQUFDLENBQUM7TUFDbEN2QixJQUFJLENBQUMseUJBQXlCLEVBQUU7UUFBRWlDLFFBQVE7UUFBRWhCLE1BQU07UUFBRUcsTUFBTSxFQUFFTCxRQUFRLENBQUNLO01BQU8sQ0FBQyxDQUFDO01BQzlFLE9BQU9FLElBQUk7SUFDYixDQUFDLENBQUMsT0FBT2hCLEdBQUcsRUFBRTtNQUNaaEIsTUFBTSxDQUFDaUIsS0FBSyxDQUFDLHNDQUFzQyxFQUFFRCxHQUFHLEVBQUU7UUFBRUYsT0FBTyxFQUFFWixNQUFNO1FBQUV5QyxRQUFRO1FBQUVoQjtNQUFPLENBQUMsQ0FBQztNQUNoRyxNQUFNVyxxQkFBcUIsQ0FBQ3RCLEdBQUcsRUFBRUEsR0FBRyxDQUFDdUIsT0FBTyxJQUFJLCtCQUErQixDQUFDO0lBQ2xGO0VBQ0Y7RUFFQSxlQUFlZSxLQUFLQSxDQUFDQyxRQUFRLEVBQUVDLFFBQVEsRUFBRTtJQUN2QzlDLElBQUksQ0FBQyxrQkFBa0IsRUFBRTtNQUFFNkM7SUFBUyxDQUFDLENBQUM7SUFFdEMsSUFBSTtNQUNGLE1BQU05QixRQUFRLEdBQUcsTUFBTWlCLFdBQVcsQ0FBQzNDLFlBQVksQ0FBQzBELFVBQVUsRUFBRSxNQUFNLEVBQUU7UUFDbEVGLFFBQVEsRUFBRUEsUUFBUSxDQUFDRyxJQUFJLENBQUMsQ0FBQztRQUN6QkY7TUFDRixDQUFDLENBQUM7TUFFRixJQUFJL0IsUUFBUSxDQUFDa0MsT0FBTyxJQUFJbEMsUUFBUSxDQUFDbUMsSUFBSSxFQUFFO1FBQ3JDbEQsSUFBSSxDQUFDLGtCQUFrQixFQUFFO1VBQUVtRCxNQUFNLEVBQUVwQyxRQUFRLENBQUNtQyxJQUFJLENBQUNFLEVBQUU7VUFBRVAsUUFBUSxFQUFFOUIsUUFBUSxDQUFDbUMsSUFBSSxDQUFDTDtRQUFTLENBQUMsQ0FBQztRQUN4RixPQUFPOUIsUUFBUTtNQUNqQixDQUFDLE1BQU07UUFDTCxNQUFNLElBQUl0QixLQUFLLENBQUNzQixRQUFRLENBQUNjLE9BQU8sSUFBSSx3Q0FBd0MsQ0FBQztNQUMvRTtJQUNGLENBQUMsQ0FBQyxPQUFPdkIsR0FBRyxFQUFFO01BQ1poQixNQUFNLENBQUNpQixLQUFLLENBQUMsK0JBQStCLEVBQUVELEdBQUcsRUFBRTtRQUFFRixPQUFPLEVBQUVaLE1BQU07UUFBRXFEO01BQVMsQ0FBQyxDQUFDO01BQ2pGLE1BQU12QyxHQUFHO0lBQ1g7RUFDRjtFQUVBLGVBQWUrQyxNQUFNQSxDQUFBLEVBQUc7SUFDdEJyRCxJQUFJLENBQUMsbUJBQW1CLENBQUM7SUFFekIsSUFBSTtNQUNGLE1BQU1lLFFBQVEsR0FBRyxNQUFNaUIsV0FBVyxDQUFDM0MsWUFBWSxDQUFDaUUsV0FBVyxFQUFFLE1BQU0sQ0FBQzs7TUFFcEU7TUFDQTdDLGNBQWMsR0FBRyxJQUFJO01BQ3JCQyxlQUFlLEdBQUcsSUFBSTtNQUV0QlYsSUFBSSxDQUFDLG1CQUFtQixDQUFDO01BQ3pCLE9BQU9lLFFBQVE7SUFDakIsQ0FBQyxDQUFDLE9BQU9ULEdBQUcsRUFBRTtNQUNaaEIsTUFBTSxDQUFDaUIsS0FBSyxDQUFDLGdDQUFnQyxFQUFFRCxHQUFHLEVBQUU7UUFBRUYsT0FBTyxFQUFFWjtNQUFPLENBQUMsQ0FBQztNQUN4RTtNQUNBaUIsY0FBYyxHQUFHLElBQUk7TUFDckJDLGVBQWUsR0FBRyxJQUFJO01BQ3RCLE1BQU1KLEdBQUc7SUFDWDtFQUNGO0VBRUEsZUFBZWlELFFBQVFBLENBQUNWLFFBQVEsRUFBRVcsS0FBSyxFQUFFVixRQUFRLEVBQUU7SUFDakQ5QyxJQUFJLENBQUMseUJBQXlCLEVBQUU7TUFBRTZDLFFBQVE7TUFBRVc7SUFBTSxDQUFDLENBQUM7SUFFcEQsSUFBSTtNQUNGLE1BQU16QyxRQUFRLEdBQUcsTUFBTWlCLFdBQVcsQ0FBQzNDLFlBQVksQ0FBQ29FLGFBQWEsRUFBRSxNQUFNLEVBQUU7UUFDckVaLFFBQVEsRUFBRUEsUUFBUSxDQUFDRyxJQUFJLENBQUMsQ0FBQztRQUN6QlEsS0FBSyxFQUFFQSxLQUFLLENBQUNSLElBQUksQ0FBQyxDQUFDO1FBQ25CRjtNQUNGLENBQUMsQ0FBQztNQUVGLElBQUkvQixRQUFRLENBQUNrQyxPQUFPLEVBQUU7UUFDcEJqRCxJQUFJLENBQUMseUJBQXlCLEVBQUU7VUFBRTZDLFFBQVE7VUFBRVc7UUFBTSxDQUFDLENBQUM7UUFDcEQsT0FBT3pDLFFBQVE7TUFDakIsQ0FBQyxNQUFNO1FBQ0wsTUFBTSxJQUFJdEIsS0FBSyxDQUFDc0IsUUFBUSxDQUFDYyxPQUFPLElBQUksK0NBQStDLENBQUM7TUFDdEY7SUFDRixDQUFDLENBQUMsT0FBT3ZCLEdBQUcsRUFBRTtNQUNaaEIsTUFBTSxDQUFDaUIsS0FBSyxDQUFDLHNDQUFzQyxFQUFFRCxHQUFHLEVBQUU7UUFBRUYsT0FBTyxFQUFFWixNQUFNO1FBQUVxRCxRQUFRO1FBQUVXO01BQU0sQ0FBQyxDQUFDO01BQy9GLE1BQU1sRCxHQUFHO0lBQ1g7RUFDRjtFQUVBLGVBQWVvRCxhQUFhQSxDQUFBLEVBQUc7SUFDN0IxRCxJQUFJLENBQUMsbUJBQW1CLENBQUM7SUFFekIsSUFBSTtNQUNGLE1BQU1lLFFBQVEsR0FBRyxNQUFNaUIsV0FBVyxDQUFDM0MsWUFBWSxDQUFDc0UsV0FBVyxFQUFFLEtBQUssQ0FBQztNQUVuRSxJQUFJNUMsUUFBUSxDQUFDNkMsYUFBYSxJQUFJN0MsUUFBUSxDQUFDbUMsSUFBSSxFQUFFO1FBQzNDbEQsSUFBSSxDQUFDLGlDQUFpQyxFQUFFO1VBQ3RDbUQsTUFBTSxFQUFFcEMsUUFBUSxDQUFDbUMsSUFBSSxDQUFDRSxFQUFFO1VBQ3hCUCxRQUFRLEVBQUU5QixRQUFRLENBQUNtQyxJQUFJLENBQUNMO1FBQzFCLENBQUMsQ0FBQztRQUNGLE9BQU85QixRQUFRO01BQ2pCLENBQUMsTUFBTTtRQUNMZixJQUFJLENBQUMsaURBQWlELENBQUM7UUFDdkQsT0FBTztVQUFFNEQsYUFBYSxFQUFFLEtBQUs7VUFBRVYsSUFBSSxFQUFFO1FBQUssQ0FBQztNQUM3QztJQUNGLENBQUMsQ0FBQyxPQUFPNUMsR0FBRyxFQUFFO01BQ1poQixNQUFNLENBQUNpQixLQUFLLENBQUMsOENBQThDLEVBQUVELEdBQUcsRUFBRTtRQUFFRixPQUFPLEVBQUVaO01BQU8sQ0FBQyxDQUFDO01BQ3RGO01BQ0EsT0FBTztRQUFFb0UsYUFBYSxFQUFFLEtBQUs7UUFBRVYsSUFBSSxFQUFFO01BQUssQ0FBQztJQUM3QztFQUNGO0VBRUEsZUFBZVcsY0FBY0EsQ0FBQSxFQUFHO0lBQzlCN0QsSUFBSSxDQUFDLDRCQUE0QixDQUFDO0lBRWxDLElBQUk7TUFDRixNQUFNZSxRQUFRLEdBQUcsTUFBTWlCLFdBQVcsQ0FBQzNDLFlBQVksQ0FBQ3lFLFlBQVksRUFBRSxNQUFNLENBQUM7TUFFckUsSUFBSS9DLFFBQVEsQ0FBQ2tDLE9BQU8sSUFBSWxDLFFBQVEsQ0FBQ21DLElBQUksRUFBRTtRQUNyQ2xELElBQUksQ0FBQyw0QkFBNEIsRUFBRTtVQUNqQ21ELE1BQU0sRUFBRXBDLFFBQVEsQ0FBQ21DLElBQUksQ0FBQ0UsRUFBRTtVQUN4QlAsUUFBUSxFQUFFOUIsUUFBUSxDQUFDbUMsSUFBSSxDQUFDTDtRQUMxQixDQUFDLENBQUM7UUFDRixPQUFPOUIsUUFBUTtNQUNqQixDQUFDLE1BQU07UUFDTCxNQUFNLElBQUl0QixLQUFLLENBQUNzQixRQUFRLENBQUNjLE9BQU8sSUFBSSx3QkFBd0IsQ0FBQztNQUMvRDtJQUNGLENBQUMsQ0FBQyxPQUFPdkIsR0FBRyxFQUFFO01BQ1poQixNQUFNLENBQUNpQixLQUFLLENBQUMseUNBQXlDLEVBQUVELEdBQUcsRUFBRTtRQUFFRixPQUFPLEVBQUVaO01BQU8sQ0FBQyxDQUFDO01BQ2pGLE1BQU1jLEdBQUc7SUFDWDtFQUNGO0VBRUEsU0FBU3lELGVBQWVBLENBQUEsRUFBRztJQUN6Qi9ELElBQUksQ0FBQyxzQkFBc0IsQ0FBQztJQUM1QlMsY0FBYyxHQUFHLElBQUk7SUFDckJDLGVBQWUsR0FBRyxJQUFJO0VBQ3hCO0VBRUEsT0FBTztJQUNMO0lBQ0FDLFlBQVk7SUFDWmMsaUJBQWlCO0lBQ2pCWCxjQUFjO0lBRWQ7SUFDQThCLEtBQUs7SUFDTFMsTUFBTTtJQUNORSxRQUFRO0lBQ1JHLGFBQWE7SUFDYkcsY0FBYztJQUVkO0lBQ0E3QixXQUFXO0lBRVg7SUFDQStCLGVBQWU7SUFFZkMsT0FBT0EsQ0FBQSxFQUFHO01BQ1JoRSxJQUFJLENBQUMsV0FBVyxDQUFDO01BQ2pCK0QsZUFBZSxDQUFDLENBQUM7SUFDbkI7RUFDRixDQUFDO0FBQ0g7QUFBQyxJQUFBRSxRQUFBLEdBQUFDLE9BQUEsQ0FBQUMsT0FBQSxHQUVjaEYsb0JBQW9CIiwiaWdub3JlTGlzdCI6W119