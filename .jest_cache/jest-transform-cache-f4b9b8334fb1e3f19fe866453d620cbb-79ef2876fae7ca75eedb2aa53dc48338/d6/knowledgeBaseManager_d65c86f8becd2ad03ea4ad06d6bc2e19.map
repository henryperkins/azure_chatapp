{"version":3,"names":["MODULE","createKnowledgeBaseManager","ctx","REQUIRED_DEPS","dep","fallbackApiRequest","app","apiRequest","getDep","Error","_DependencySystem","logger","domReadinessService","browserService","activeIntervals","_appReadyPromise","waitForAppReady","dependenciesAndElements","deps","Promise","resolve","toggleKnowledgeBase","enabled","info","context","debug","pid","_getCurrentProjectId","warn","resp","method","body","enable","response","status","state","knowledgeBase","kbId","data","knowledge_base_id","id","project_id","is_active","_updateStatusIndicator","storage","setItem","String","projectManager","loadProjectDetails","project","renderKnowledgeBaseInfo","knowledge_base","error","responseMessage","message","err","elements","kbToggle","checked","reprocessFiles","projectId","validateUUID","btn","reprocessButton","_setButtonLoading","force","all","loadProjectStats","loadKnowledgeBaseHealth","loadKnowledgeBaseFiles","handleKnowledgeBaseFormSubmit","e","preventDefault","form","target","dataset","FormData","payload","name","get","description","embedding_model","process_existing_files","trim","querySelector","_submitKnowledgeBaseForm","finally","isUpdating","url","responseData","hideKnowledgeBaseModal","refreshError","_showStatusAlert","handleDeleteKnowledgeBase","confirmed","modalManager","confirmAction","title","confirmText","confirmClass","deleteButton","deleteKnowledgeBaseBtn","deleted_id","_showInactiveState","showKnowledgeBaseModal","settingsModal","domAPI","getElementById","modal","projectDetails","settingsForm","reset","kbIdInput","value","_updateModelSelection","deleteBtn","kbGitHubAttachedRepoInfo","kbAttachedRepoUrlDisplay","kbAttachedRepoBranchDisplay","kbGitHubAttachForm","kbGitHubRepoUrlInput","kbGitHubBranchInput","kbGitHubFilePathsTextarea","kb","processAllFilesCheckbox","autoEnableCheckbox","classList","remove","repo_url","textContent","branch","add","show","showModal","removeClass","validateSelectedModelDimensions","hide","close","addClass","healthResp","kbHealthData","Array","isArray","find","Object","keys","length","kbNameDisplay","kbModelDisplay","knowledgeFileCount","knowledgeChunkCount","knowledgeFileSize","files","total_files","undefined","vector_stats","total_vectors","totalSize","files_details","forEach","file","file_size","stats","total_size_bytes","uiUtils","formatBytes","file_count","unprocessed_files","pending_files","chunk_count","_updateStatusAlerts","_renderKnowledgeBaseFiles","pagination","total","knowledgeBaseFilesSection","toggle","filesData","container","knowledgeBaseFilesListContainer","_safeSetInnerHTML","ul","createElement","className","li","processingStatus","config","search_processing","statusBadgeClass","fileIcon","file_type","filename","eventHandlers","trackListener","stopPropagation","fileId","_handleDeleteKnowledgeBaseFile","appendChild","handleAttachGitHubRepo","repoUrl","filePathsRaw","filePaths","split","map","p","filter","URL","_err","attachButton","kbAttachRepoBtn","file_paths","success","handleDetachGitHubRepo","detachButton","kbDetachRepoBtn","sel","modelSelect","parent","closest","warning","opt","options","selectedIndex","disabled","labelDiv","previousElementSibling","insertAdjacentElement","currentModel","selectEl","modelFound","i","newOption","Option","cleanup","cleanupListeners","clearInterval","closeModal"],"sources":["knowledgeBaseManager.js"],"sourcesContent":["/*\n// VENDOR-EXEMPT-SIZE: Core module pending refactor in Q3-25\n*/\n/**\n * @module knowledgeBaseManager\n * @description Manages Knowledge Base settings, lifecycle, files, and GitHub integration.\n */\nconst MODULE = \"KnowledgeBaseManager\";\n\n/**\n * Creates a manager for handling Knowledge Base (KB) lifecycle, settings, files, and GitHub integration within a project context.\n *\n * The returned manager provides methods for toggling KB activation, reprocessing files, handling KB settings forms, deleting KBs, managing KB modals, loading KB health and files, attaching/detaching GitHub repositories, validating model compatibility, updating model selection, and cleaning up event listeners.\n *\n * @param {Object} ctx - Context object containing dependencies, state, DOM elements, utilities, and callbacks required for KB management.\n * @returns {Object} An object exposing public methods for managing the Knowledge Base feature within a project.\n *\n * @throws {Error} If required dependencies (`apiRequest`, `eventHandlers`, `domAPI`, or logger) are missing from the context.\n */\nexport function createKnowledgeBaseManager(ctx) {\n  /* ------------------------------------------------------------------\n   * Guardrail #1 – Factory Function Export - Validate dependencies\n   * ------------------------------------------------------------------ */\n  const REQUIRED_DEPS = [\"apiRequest\", \"eventHandlers\", \"domAPI\"];\n  for (const dep of REQUIRED_DEPS) {\n    if (!ctx?.[dep]) {\n      // ------------------------------------------------------------------\n      // apiRequest may be provided via the app module; resolve eagerly.\n      // ------------------------------------------------------------------\n      if (dep === \"apiRequest\") {\n        const fallbackApiRequest =\n          ctx.app?.apiRequest ||                // direct app reference\n          ctx.getDep?.(\"app\")?.apiRequest;      // via DependencySystem\n\n        if (typeof fallbackApiRequest === \"function\") {\n          ctx.apiRequest = fallbackApiRequest;\n        } else {\n          /*\n           * Fail-fast:  The KnowledgeBaseManager cannot function without a\n           * concrete apiRequest implementation.  Throw immediately so that\n           * missing DI wiring is discovered during bootstrap and CI rather\n           * than at first runtime invocation weeks later.\n           */\n          throw new Error(`[${MODULE}] Missing required dependency 'apiRequest'`);\n        }\n\n        continue;\n      }\n\n      // For all other dependencies we must fail fast.\n      throw new Error(`[${MODULE}] Missing required dependency '${dep}'`);\n    }\n  }\n\n  const _DependencySystem = ctx.getDep ? ctx.getDep(\"DependencySystem\") : null;\n  const logger = ctx.logger || ctx.getDep(\"logger\"); // Ensure logger is available\n  if (!logger) {\n    throw new Error(`[${MODULE}] Logger dependency is missing from context.`);\n  }\n\n  const domReadinessService = ctx.domReadinessService\n    || ctx.getDep?.('domReadinessService');\n  ctx.browserService = ctx.browserService || ctx.getDep?.('browserService');\n\n  // Track intervals for deterministic cleanup\n  const activeIntervals = [];\n  // Eager appReadyPromise removed; replaced with lazy getter below.\n  let _appReadyPromise = null;\n  async function waitForAppReady() {\n    if (_appReadyPromise) return _appReadyPromise;          // cache\n    _appReadyPromise = domReadinessService\n      ? domReadinessService.dependenciesAndElements({ deps: ['app'] })\n      : Promise.resolve();\n    return _appReadyPromise;\n  }\n\n  /**\n   * Enables or disables the knowledge base for the current project.\n   *\n   * Updates the activation state both on the server and in the UI, synchronizes local storage, and refreshes project details or knowledge base info as needed.\n   *\n   * @param {boolean} enabled - Whether to activate (`true`) or deactivate (`false`) the knowledge base.\n   * @returns {Promise<void>}\n   *\n   * @throws {Error} If the API request to toggle the knowledge base fails.\n   */\n  async function toggleKnowledgeBase(enabled) {\n    logger.info(`[${MODULE}][toggleKnowledgeBase] Called with enabled: ${enabled}`, { context: MODULE });\n    await waitForAppReady();\n    logger.debug(`[${MODULE}][toggleKnowledgeBase] App is ready. Proceeding.`, { context: MODULE });\n\n    const pid = ctx._getCurrentProjectId();\n    if (!pid) {\n      logger.warn(`[${MODULE}][toggleKnowledgeBase] No project ID found. Aborting.`, { context: MODULE });\n      return;\n    }\n    logger.debug(`[${MODULE}][toggleKnowledgeBase] Project ID: ${pid}`, { context: MODULE });\n\n    try {\n      const resp = await ctx.apiRequest(\n        `/api/projects/${pid}/knowledge-bases/toggle`,\n        { method: \"POST\", body: { enable: enabled } },\n      );\n      logger.debug(`[${MODULE}][toggleKnowledgeBase] API response:`, { response: resp, context: MODULE });\n\n      if (resp.status === \"success\") {\n        logger.info(`[${MODULE}][toggleKnowledgeBase] Successfully toggled KB to ${enabled} for project ${pid}.`, { context: MODULE });\n        // Ensure local KB state object exists and reflects the new status\n        if (!ctx.state.knowledgeBase) {\n          /*\n           * When the user toggles the switch while the component is in the\n           * inactive placeholder view, `ctx.state.knowledgeBase` may have been\n           * cleared by `_showInactiveState()`.  In that scenario we still need\n           * a minimal local KB object so that downstream render helpers know\n           * there *is* a KB attached and that it is now active.  We construct\n           * a stub from the information returned by the toggle endpoint and\n           * merge it later with the full project details once they are\n           * re-fetched.\n           */\n          const kbId = (resp?.data && resp.data.knowledge_base_id) ?? resp.knowledge_base_id;\n          ctx.state.knowledgeBase = {\n            id: kbId,\n            project_id: pid,\n            is_active: enabled,\n          };\n        } else {\n          ctx.state.knowledgeBase.is_active = enabled;\n        }\n        ctx._updateStatusIndicator(enabled); // UI update\n        const storage = ctx.getDep(\"storage\");\n        if (storage && typeof storage.setItem === \"function\") {\n          storage.setItem(`kb_enabled_${pid}`, String(enabled));\n        }\n\n        if (ctx.projectManager.loadProjectDetails) {\n          logger.debug(`[${MODULE}][toggleKnowledgeBase] Reloading project details for ${pid}.`, { context: MODULE });\n          const project = await ctx.projectManager.loadProjectDetails(pid);\n          ctx.renderKnowledgeBaseInfo(project?.knowledge_base, pid); // UI update\n        } else {\n          logger.debug(`[${MODULE}][toggleKnowledgeBase] projectManager.loadProjectDetails not available. Rendering with current KB state.`, { context: MODULE });\n          ctx.renderKnowledgeBaseInfo(ctx.state.knowledgeBase, pid); // UI update\n        }\n      } else {\n        logger.error(`[${MODULE}][toggleKnowledgeBase] API reported failure.`, { responseMessage: resp.message, context: MODULE });\n        throw new Error(resp.message || \"Failed to toggle knowledge base status.\");\n      }\n    } catch (err) {\n      logger.error(\n        `[${MODULE}][toggleKnowledgeBase] Error toggling knowledge base for project ${pid}. Reverting UI.`,\n        { status: err?.status ?? 500, data: err, message: err?.message ?? String(err) },\n        { context: MODULE }\n      );\n      if (ctx.elements.kbToggle) ctx.elements.kbToggle.checked = !enabled; // Revert UI\n      ctx._updateStatusIndicator(!enabled); // Revert UI\n      // Optionally, show an error to the user via ctx._showStatusAlert or similar\n    }\n  }\n\n  /**\n   * Initiates reprocessing of all knowledge base files for the specified project.\n   *\n   * Triggers a server-side reindexing of all files in the project's knowledge base. Updates UI state and reloads project or knowledge base details upon completion.\n   *\n   * @param {string} projectId - The unique identifier of the project whose knowledge base files will be reprocessed.\n   * @returns {Promise<void>}\n   *\n   * @throws {Error} If the API request to reprocess files fails.\n   */\n  async function reprocessFiles(projectId) {\n    logger.info(`[${MODULE}][reprocessFiles] Called for project ID: ${projectId}`, { context: MODULE });\n    await waitForAppReady();\n    logger.debug(`[${MODULE}][reprocessFiles] App is ready. Proceeding.`, { context: MODULE });\n\n    if (!ctx.validateUUID(projectId)) {\n      logger.warn(`[${MODULE}][reprocessFiles] Invalid project ID: ${projectId}. Aborting.`, { context: MODULE });\n      return;\n    }\n    const btn = ctx.elements.reprocessButton;\n    ctx._setButtonLoading(btn, true, \"Processing...\");\n    logger.debug(`[${MODULE}][reprocessFiles] Reprocess button loading state set.`, { context: MODULE });\n\n    try {\n      const resp = await ctx.apiRequest(\n        `/api/projects/${projectId}/knowledge-base/reindex`,\n        { method: \"POST\", body: { force: true } },\n      );\n      logger.debug(`[${MODULE}][reprocessFiles] API response:`, { response: resp, context: MODULE });\n\n      if (resp.status === \"success\") {\n        logger.info(`[${MODULE}][reprocessFiles] Successfully initiated reprocessing for project ${projectId}.`, { context: MODULE });\n        if (ctx.projectManager.loadProjectDetails) {\n          logger.debug(`[${MODULE}][reprocessFiles] Reloading project details and stats for ${projectId}.`, { context: MODULE });\n          const [project] = await Promise.all([\n            ctx.projectManager.loadProjectDetails(projectId),\n            ctx.projectManager.loadProjectStats?.(projectId), // Optional chaining for loadProjectStats\n          ]);\n          ctx.renderKnowledgeBaseInfo(project?.knowledge_base, projectId); // UI update\n        } else if (ctx.state.knowledgeBase?.id) {\n          logger.debug(`[${MODULE}][reprocessFiles] projectManager.loadProjectDetails not available. Reloading KB health and files directly.`, { kbId: ctx.state.knowledgeBase.id, context: MODULE });\n          await loadKnowledgeBaseHealth(ctx.state.knowledgeBase.id); // Refresh health\n          await loadKnowledgeBaseFiles(projectId, ctx.state.knowledgeBase.id); // Refresh files\n        }\n      } else {\n        logger.error(`[${MODULE}][reprocessFiles] API reported failure.`, { responseMessage: resp.message, context: MODULE });\n        throw new Error(resp.message || \"Reprocessing request failed.\");\n      }\n    } catch (err) {\n      logger.error(\n        `[${MODULE}][reprocessFiles] Error during reprocessing for project ${projectId}.`,\n        { status: err?.status ?? 500, data: err, message: err?.message ?? String(err) },\n        { context: MODULE }\n      );\n      // Optionally, show an error to the user\n    } finally {\n      ctx._setButtonLoading(btn, false);\n      logger.debug(`[${MODULE}][reprocessFiles] Reprocess button loading state reset.`, { context: MODULE });\n    }\n  }\n\n  /**\n   * Handles submission of the Knowledge Base settings form, validating input and initiating creation or update of the Knowledge Base.\n   *\n   * Prevents default form submission, validates required fields, constructs the payload, and triggers the submission process. If creating a new Knowledge Base, includes the option to process existing files.\n   *\n   * @param {Event} e - The form submit event.\n   */\n  function handleKnowledgeBaseFormSubmit(e) {\n    e.preventDefault();\n    logger.info(`[${MODULE}][handleKnowledgeBaseFormSubmit] Form submitted.`, { context: MODULE });\n    const form = e.target;\n    const projectId = form.dataset.projectId || ctx._getCurrentProjectId();\n\n    if (!ctx.validateUUID(projectId)) {\n      logger.warn(`[${MODULE}][handleKnowledgeBaseFormSubmit] Invalid project ID: ${projectId}. Aborting.`, { context: MODULE });\n      return;\n    }\n    logger.debug(`[${MODULE}][handleKnowledgeBaseFormSubmit] Project ID: ${projectId}`, { context: MODULE });\n\n    const data = new FormData(form);\n    const payload = {\n      name: data.get(\"name\"),\n      description: data.get(\"description\") || null,\n      embedding_model: data.get(\"embedding_model\"),\n    };\n    logger.debug(`[${MODULE}][handleKnowledgeBaseFormSubmit] Payload created:`, { payload, context: MODULE });\n\n    if (!ctx.state.knowledgeBase?.id) { // Creating new KB\n      payload.process_existing_files = form.elements[\"process_all_files\"]?.checked || false;\n      logger.debug(`[${MODULE}][handleKnowledgeBaseFormSubmit] New KB. process_existing_files: ${payload.process_existing_files}`, { context: MODULE });\n    }\n\n    if (!payload.name?.trim()) {\n      logger.warn(`[${MODULE}][handleKnowledgeBaseFormSubmit] Name is empty. Aborting.`, { context: MODULE });\n      // TODO: Show validation error to user\n      return;\n    }\n    if (!payload.embedding_model) {\n      logger.warn(`[${MODULE}][handleKnowledgeBaseFormSubmit] Embedding model not selected. Aborting.`, { context: MODULE });\n      // TODO: Show validation error to user\n      return;\n    }\n\n    const btn = form.querySelector('button[type=\"submit\"]');\n    ctx._setButtonLoading(btn, true);\n    logger.debug(`[${MODULE}][handleKnowledgeBaseFormSubmit] Submit button loading state set.`, { context: MODULE });\n\n    _submitKnowledgeBaseForm(projectId, payload).finally(() => {\n      ctx._setButtonLoading(btn, false);\n      logger.debug(`[${MODULE}][handleKnowledgeBaseFormSubmit] Submit button loading state reset.`, { context: MODULE });\n    });\n  }\n\n  /**\n   * Submits knowledge base settings to the server for creation or update.\n   *\n   * Determines whether to create a new knowledge base or update an existing one based on the current state, sends the appropriate API request, and updates the UI accordingly. Handles conflict errors by attempting to refresh project details and update the UI.\n   *\n   * @param {string} projectId - The ID of the project to which the knowledge base belongs.\n   * @param {Object} payload - The settings data to submit for the knowledge base.\n   *\n   * @returns {Promise<void>}\n   *\n   * @throws {Error} If the server response indicates failure or returns invalid data.\n   */\n  async function _submitKnowledgeBaseForm(projectId, payload) {\n    logger.info(`[${MODULE}][_submitKnowledgeBaseForm] Submitting for project ID: ${projectId}`, { payload, context: MODULE });\n    await waitForAppReady();\n    logger.debug(`[${MODULE}][_submitKnowledgeBaseForm] App is ready. Proceeding.`, { context: MODULE });\n\n    try {\n      const kbId = ctx.state.knowledgeBase?.id;\n      const isUpdating = !!kbId;\n      logger.debug(`[${MODULE}][_submitKnowledgeBaseForm] KB ID: ${kbId}, Is updating: ${isUpdating}`, { context: MODULE });\n\n      const method = isUpdating ? \"PATCH\" : \"POST\";\n      const url = isUpdating\n        ? `/api/projects/${projectId}/knowledge-bases/${kbId}`\n        : `/api/projects/${projectId}/knowledge-bases`;\n      logger.debug(`[${MODULE}][_submitKnowledgeBaseForm] API URL: ${url}, Method: ${method}`, { context: MODULE });\n\n      const resp = await ctx.apiRequest(url, { method, body: payload });\n      logger.debug(`[${MODULE}][_submitKnowledgeBaseForm] API response:`, { response: resp, context: MODULE });\n\n      const responseData = isUpdating ? resp.data : (resp.data?.knowledge_base || resp.data);\n\n      if (responseData?.id || resp.status === \"success\") {\n        logger.info(`[${MODULE}][_submitKnowledgeBaseForm] Form submission successful for project ${projectId}. KB ID: ${responseData?.id}`, { context: MODULE });\n        hideKnowledgeBaseModal();\n\n        if (ctx.projectManager.loadProjectDetails) {\n          logger.debug(`[${MODULE}][_submitKnowledgeBaseForm] Reloading project details for ${projectId}.`, { context: MODULE });\n          const project = await ctx.projectManager.loadProjectDetails(projectId);\n          ctx.renderKnowledgeBaseInfo(project?.knowledge_base, projectId); // UI update\n        } else {\n          logger.debug(`[${MODULE}][_submitKnowledgeBaseForm] projectManager.loadProjectDetails not available. Rendering with combined KB state.`, { context: MODULE });\n          ctx.renderKnowledgeBaseInfo({\n            ...ctx.state.knowledgeBase,\n            ...responseData,\n          }, projectId); // UI update\n        }\n      } else {\n        logger.error(`[${MODULE}][_submitKnowledgeBaseForm] API reported failure or invalid data.`, { responseMessage: resp.message, responseData, context: MODULE });\n        throw new Error(resp.message || \"Invalid response from server\");\n      }\n    } catch (err) {\n      logger.error(\n        `[${MODULE}][_submitKnowledgeBaseForm] Error submitting form for project ${projectId}.`,\n        { status: err?.status ?? 500, data: err, message: err?.message ?? String(err) },\n        { context: MODULE }\n      );\n      if (err.status === 409) {\n        logger.warn(\n          `[${MODULE}][_submitKnowledgeBaseForm] Conflict (409) detected. Attempting to refresh project details.`,\n          { status: err?.status ?? 400, data: err, message: err?.message ?? String(err) },\n          { context: MODULE }\n        );\n        if (ctx.projectManager.loadProjectDetails) {\n          try {\n            const project = await ctx.projectManager.loadProjectDetails(projectId);\n            ctx.renderKnowledgeBaseInfo(project?.knowledge_base, projectId); // Refresh UI\n            hideKnowledgeBaseModal();\n          } catch (refreshError) {\n            logger.error(\n              `[${MODULE}][_submitKnowledgeBaseForm] Error refreshing project details after 409.`,\n              { status: refreshError?.status ?? 500, data: refreshError, message: refreshError?.message ?? String(refreshError) },\n              { context: MODULE }\n            );\n          }\n        }\n      } else {\n        // Handle other errors, potentially show user message via ctx._showStatusAlert\n        ctx._showStatusAlert(`Error saving settings: ${err.message || 'Unknown server error'}`, \"error\");\n      }\n    }\n  }\n\n  /**\n   * Deletes the current knowledge base after user confirmation.\n   *\n   * Prompts the user to confirm deletion, then sends a request to remove the knowledge base for the current project. On success, closes the modal, updates the UI to reflect the inactive state, and reloads project details. If deletion fails, displays an error alert.\n   *\n   * @remark If the project ID or knowledge base ID is missing, the function aborts without performing any action.\n   */\n  async function handleDeleteKnowledgeBase() {\n    logger.info(`[${MODULE}][handleDeleteKnowledgeBase] Initiating delete.`, { context: MODULE });\n    await waitForAppReady();\n    logger.debug(`[${MODULE}][handleDeleteKnowledgeBase] App is ready. Proceeding.`, { context: MODULE });\n\n    const projectId = ctx._getCurrentProjectId();\n    const kbId = ctx.state.knowledgeBase?.id;\n\n    if (!projectId || !kbId) {\n      logger.warn(`[${MODULE}][handleDeleteKnowledgeBase] Project ID or KB ID missing. Aborting.`, { projectId, kbId, context: MODULE });\n      return;\n    }\n    logger.debug(`[${MODULE}][handleDeleteKnowledgeBase] Project ID: ${projectId}, KB ID: ${kbId}`, { context: MODULE });\n\n    const confirmed = await ctx.modalManager.confirmAction({ // Pass as object\n      title: \"Delete Knowledge Base?\",\n      message: \"Are you sure you want to permanently delete this knowledge base? This action cannot be undone.\",\n      confirmText: \"Delete\",\n      confirmClass: \"btn-error\"\n    });\n\n\n    if (!confirmed) {\n      logger.info(`[${MODULE}][handleDeleteKnowledgeBase] Deletion cancelled by user.`, { context: MODULE });\n      return;\n    }\n\n    const deleteButton = ctx.elements.deleteKnowledgeBaseBtn;\n    ctx._setButtonLoading(deleteButton, true, \"Deleting...\");\n    logger.debug(`[${MODULE}][handleDeleteKnowledgeBase] Delete button loading state set.`, { context: MODULE });\n\n    try {\n      const resp = await ctx.apiRequest(\n        `/api/projects/${projectId}/knowledge-bases/${kbId}`,\n        { method: \"DELETE\" }\n      );\n      logger.debug(`[${MODULE}][handleDeleteKnowledgeBase] API response:`, { response: resp, context: MODULE });\n\n      if (resp.status === \"success\" || resp.data?.deleted_id) {\n        logger.info(`[${MODULE}][handleDeleteKnowledgeBase] Successfully deleted KB ${kbId} for project ${projectId}.`, { context: MODULE });\n        hideKnowledgeBaseModal();\n        ctx._showInactiveState();\n        if (ctx.projectManager.loadProjectDetails) {\n          logger.debug(`[${MODULE}][handleDeleteKnowledgeBase] Reloading project details for ${projectId}.`, { context: MODULE });\n          await ctx.projectManager.loadProjectDetails(projectId);\n        }\n      } else {\n        logger.error(`[${MODULE}][handleDeleteKnowledgeBase] API reported failure.`, { responseMessage: resp.message, context: MODULE });\n        throw new Error(resp.message || \"Failed to delete knowledge base.\");\n      }\n    } catch (err) {\n      logger.error(\n        `[${MODULE}][handleDeleteKnowledgeBase] Error deleting KB ${kbId} for project ${projectId}.`,\n        { status: err?.status ?? 500, data: err, message: err?.message ?? String(err) },\n        { context: MODULE }\n      );\n      ctx._showStatusAlert(`Error deleting Knowledge Base: ${err.message || 'Unknown server error'}`, \"error\");\n    } finally {\n      ctx._setButtonLoading(deleteButton, false);\n      logger.debug(`[${MODULE}][handleDeleteKnowledgeBase] Delete button loading state reset.`, { context: MODULE });\n    }\n  }\n\n  /**\n   * Displays the Knowledge Base settings modal dialog, populating the form with current or default KB data and updating related UI elements.\n   *\n   * If a Knowledge Base exists for the current project, its details are loaded and shown in the form; otherwise, the form is prepared for creating a new KB. The modal also manages the visibility and content of GitHub repository attachment fields based on KB state, and validates model selection compatibility.\n   */\n  async function showKnowledgeBaseModal() {\n    logger.info(`[${MODULE}][showKnowledgeBaseModal] Showing KB settings modal.`, { context: MODULE });\n    await waitForAppReady();\n    logger.debug(`[${MODULE}][showKnowledgeBaseModal] App is ready. Proceeding.`, { context: MODULE });\n\n    if (!ctx.elements.settingsModal) {\n      ctx.elements.settingsModal =\n        ctx.domAPI.getElementById?.('knowledgeBaseSettingsModal');\n    }\n    let modal = ctx.elements.settingsModal;\n    if (!modal) {\n      logger.error(`[${MODULE}][showKnowledgeBaseModal] #knowledgeBaseSettingsModal element not found – cannot open modal`, { context: MODULE });\n      return;\n    }\n\n    const projectId = ctx._getCurrentProjectId();\n    if (!projectId) {\n      logger.warn(`[${MODULE}][showKnowledgeBaseModal] No project ID found. Aborting modal show.`, { context: MODULE });\n      return;\n    }\n    logger.debug(`[${MODULE}][showKnowledgeBaseModal] Project ID: ${projectId}`, { context: MODULE });\n\n    // Refresh KB state before populating the form\n    try {\n      if (ctx.projectManager.loadProjectDetails) {\n        logger.debug(`[${MODULE}][showKnowledgeBaseModal] Refreshing project details for ${projectId} to get latest KB state.`, { context: MODULE });\n        const projectDetails = await ctx.projectManager.loadProjectDetails(projectId);\n        if (projectDetails && typeof projectDetails.knowledge_base !== 'undefined') {\n          ctx.state.knowledgeBase = projectDetails.knowledge_base;\n          logger.debug(`[${MODULE}][showKnowledgeBaseModal] KB state updated from project details. KB ID: ${ctx.state.knowledgeBase?.id}`, { context: MODULE });\n        } else if (projectDetails === null) {\n          logger.warn(`[${MODULE}][showKnowledgeBaseModal] Project details load failed for ${projectId}. Modal might show stale KB data.`, { context: MODULE });\n        } else {\n          logger.debug(`[${MODULE}][showKnowledgeBaseModal] Project details loaded but no 'knowledge_base' field found.`, { projectDetails, context: MODULE });\n        }\n      }\n    } catch (err) {\n      logger.error(\n        `[${MODULE}][showKnowledgeBaseModal] Error refreshing project details. Modal might show stale KB data.`,\n        { status: err?.status ?? 500, data: err, message: err?.message ?? String(err) },\n        { context: MODULE }\n      );\n    }\n\n    const form = ctx.elements.settingsForm;\n    if (form) {\n      form.reset();\n      logger.debug(`[${MODULE}][showKnowledgeBaseModal] Settings form reset.`, { context: MODULE });\n      const kbIdInput = form.elements[\"knowledge_base_id\"];\n      if (kbIdInput) {\n        kbIdInput.value = ctx.state.knowledgeBase?.id || \"\";\n      }\n    }\n\n    _updateModelSelection(ctx.state.knowledgeBase?.embedding_model || null);\n    logger.debug(`[${MODULE}][showKnowledgeBaseModal] Model selection updated. Current model: ${ctx.state.knowledgeBase?.embedding_model}`, { context: MODULE });\n\n    const deleteBtn = ctx.elements.deleteKnowledgeBaseBtn;\n    const { kbGitHubAttachedRepoInfo, kbAttachedRepoUrlDisplay, kbAttachedRepoBranchDisplay, kbGitHubAttachForm, kbGitHubRepoUrlInput, kbGitHubBranchInput, kbGitHubFilePathsTextarea } = ctx.elements;\n\n    if (ctx.state.knowledgeBase && ctx.state.knowledgeBase.id) {\n      logger.debug(`[${MODULE}][showKnowledgeBaseModal] Populating form for existing KB. ID: ${ctx.state.knowledgeBase.id}`, { context: MODULE });\n      const kb = ctx.state.knowledgeBase;\n      if (form) {\n        form.elements[\"name\"].value = kb.name || \"\";\n        form.elements[\"description\"].value = kb.description || \"\";\n        const processAllFilesCheckbox = form.elements[\"process_all_files\"];\n        if (processAllFilesCheckbox) processAllFilesCheckbox.checked = false;\n\n        const autoEnableCheckbox = form.elements[\"auto_enable\"];\n        if (autoEnableCheckbox) autoEnableCheckbox.checked = kb.is_active !== false;\n      }\n      deleteBtn?.classList.remove(\"hidden\");\n\n      if (kb.repo_url) {\n        kbGitHubAttachedRepoInfo?.classList.remove(\"hidden\");\n        if (kbAttachedRepoUrlDisplay) kbAttachedRepoUrlDisplay.textContent = kb.repo_url;\n        if (kbAttachedRepoBranchDisplay) kbAttachedRepoBranchDisplay.textContent = kb.branch || 'main';\n        kbGitHubAttachForm?.classList.add(\"hidden\");\n      } else {\n        kbGitHubAttachedRepoInfo?.classList.add(\"hidden\");\n        kbGitHubAttachForm?.classList.remove(\"hidden\");\n        if (kbGitHubRepoUrlInput) kbGitHubRepoUrlInput.value = \"\";\n        if (kbGitHubBranchInput) kbGitHubBranchInput.value = \"main\";\n        if (kbGitHubFilePathsTextarea) kbGitHubFilePathsTextarea.value = \"\";\n      }\n    } else {\n      logger.debug(`[${MODULE}][showKnowledgeBaseModal] Populating form for new KB.`, { context: MODULE });\n      if (form) {\n        const processAllFilesCheckbox = form.elements[\"process_all_files\"];\n        if (processAllFilesCheckbox) processAllFilesCheckbox.checked = true;\n\n        const autoEnableCheckbox = form.elements[\"auto_enable\"];\n        if (autoEnableCheckbox) autoEnableCheckbox.checked = true;\n      }\n      deleteBtn?.classList.add(\"hidden\");\n      kbGitHubAttachedRepoInfo?.classList.add(\"hidden\");\n      kbGitHubAttachForm?.classList.remove(\"hidden\");\n      if (kbGitHubRepoUrlInput) kbGitHubRepoUrlInput.value = \"\";\n      if (kbGitHubBranchInput) kbGitHubBranchInput.value = \"main\";\n      if (kbGitHubFilePathsTextarea) kbGitHubFilePathsTextarea.value = \"\";\n    }\n\n    if (form) form.dataset.projectId = projectId; // Set projectId on form\n\n    if (ctx.modalManager?.show) {\n      /* preferred: let central ModalManager handle scroll-lock, backdrop, etc. */\n      ctx.modalManager.show('knowledge');           // alias maps to #knowledgeBaseSettingsModal\n    } else if (typeof modal.showModal === 'function') {\n      /* native <dialog> support */\n      modal.showModal();\n    } else {\n      /* last-resort fallback for browsers without <dialog> */\n      ctx.domAPI.removeClass(modal, 'hidden');\n    }\n    validateSelectedModelDimensions();\n    logger.debug(`[${MODULE}][showKnowledgeBaseModal] Modal shown.`, { context: MODULE });\n  }\n\n  /**\n   * Closes the Knowledge Base settings modal dialog if it is present and supports closing.\n   */\n  function hideKnowledgeBaseModal() {\n    logger.info(`[${MODULE}][hideKnowledgeBaseModal] Hiding KB settings modal.`, { context: MODULE });\n    const modal = ctx.elements.settingsModal;\n    if (ctx.modalManager?.hide) {\n      ctx.modalManager.hide('knowledge');\n    } else if (modal && typeof modal.close === \"function\") {\n      modal.close();\n    } else if (modal) {\n      ctx.domAPI.addClass(modal, 'hidden');\n    }\n  }\n\n  /**\n   * Loads and updates health metrics for a specific Knowledge Base by ID.\n   *\n   * Retrieves detailed health information for the given Knowledge Base, updates relevant UI elements and internal state, and returns the health data object if found.\n   *\n   * @param {string} kbId - The Knowledge Base ID to load health metrics for.\n   * @returns {Promise<Object|null>} The health data object for the Knowledge Base, or null if not found or on error.\n   */\n  async function loadKnowledgeBaseHealth(kbId) {\n    logger.info(`[${MODULE}][loadKnowledgeBaseHealth] Called for KB ID: ${kbId}`, { context: MODULE });\n    await waitForAppReady();\n    logger.debug(`[${MODULE}][loadKnowledgeBaseHealth] App is ready. Proceeding.`, { context: MODULE });\n\n    if (!kbId || !ctx.validateUUID(kbId)) {\n      logger.warn(`[${MODULE}][loadKnowledgeBaseHealth] Invalid KB ID: ${kbId}. Aborting.`, { context: MODULE });\n      return null;\n    }\n    try {\n      const projectId = ctx._getCurrentProjectId();\n      if (!projectId) {\n        logger.warn(`[${MODULE}][loadKnowledgeBaseHealth] No project ID found for KB ${kbId}. Aborting.`, { context: MODULE });\n        return null;\n      }\n      logger.debug(`[${MODULE}][loadKnowledgeBaseHealth] Project ID: ${projectId}`, { context: MODULE });\n\n      const healthResp = await ctx.apiRequest(\n        `/api/projects/${projectId}/knowledge-bases/${kbId}/status?detailed=true`,\n        { method: \"GET\" }\n      );\n      logger.debug(`[${MODULE}][loadKnowledgeBaseHealth] API response for KB ${kbId}:`, { response: healthResp, context: MODULE });\n\n      // Assuming healthResp.data contains an array of KBs or a single KB object for the project\n      // And we need to find the specific KB by kbId if multiple are returned, or it's the main object.\n      let kbHealthData = null;\n      if (Array.isArray(healthResp?.data)) {\n        kbHealthData = healthResp.data.find(kb => kb.id === kbId);\n      } else if (healthResp?.data?.id === kbId || (healthResp?.data && !Array.isArray(healthResp?.data) && Object.keys(healthResp.data).length > 0 && !kbId)) {\n        // If kbId was not initially passed, but we got a single KB object, assume it's the one.\n        // Or if a single object is returned and its ID matches.\n        kbHealthData = healthResp.data;\n      }\n\n\n      if (kbHealthData) {\n        logger.info(`[${MODULE}][loadKnowledgeBaseHealth] Health data found for KB ${kbId}.`, { data: kbHealthData, context: MODULE });\n        const { kbNameDisplay, kbModelDisplay, knowledgeFileCount, knowledgeChunkCount, knowledgeFileSize } = ctx.elements;\n\n        if (kbNameDisplay && kbHealthData.name) kbNameDisplay.textContent = kbHealthData.name;\n        if (kbModelDisplay && kbHealthData.embedding_model) kbModelDisplay.textContent = kbHealthData.embedding_model;\n\n        if (knowledgeFileCount && kbHealthData.files?.total_files !== undefined) {\n          knowledgeFileCount.textContent = kbHealthData.files.total_files;\n        }\n        if (knowledgeChunkCount && kbHealthData.vector_stats?.total_vectors !== undefined) {\n          knowledgeChunkCount.textContent = kbHealthData.vector_stats.total_vectors;\n        }\n\n        let totalSize = 0;\n        if (kbHealthData.files?.files_details) {\n          kbHealthData.files.files_details.forEach(file => totalSize += (file.file_size || 0));\n        } else if (ctx.state.knowledgeBase?.stats?.total_size_bytes && ctx.state.knowledgeBase.id === kbId) {\n          // Fallback to potentially stale component state if API doesn't provide detailed sizes\n          totalSize = ctx.state.knowledgeBase.stats.total_size_bytes;\n        }\n        if (knowledgeFileSize) {\n          knowledgeFileSize.textContent = ctx.uiUtils.formatBytes(totalSize);\n        }\n\n        if (ctx.state.knowledgeBase && ctx.state.knowledgeBase.id === kbId) {\n          logger.debug(`[${MODULE}][loadKnowledgeBaseHealth] Updating component state for KB ${kbId}.`, { context: MODULE });\n          ctx.state.knowledgeBase.name = kbHealthData.name || ctx.state.knowledgeBase.name;\n          ctx.state.knowledgeBase.embedding_model = kbHealthData.embedding_model || ctx.state.knowledgeBase.embedding_model;\n          if (kbHealthData.files) {\n            ctx.state.knowledgeBase.stats = {\n              ...ctx.state.knowledgeBase.stats,\n              file_count: kbHealthData.files.total_files || 0,\n              unprocessed_files: kbHealthData.files.pending_files || 0,\n            };\n          }\n          if (kbHealthData.vector_stats) {\n            ctx.state.knowledgeBase.stats.chunk_count = kbHealthData.vector_stats.total_vectors || 0;\n          }\n          ctx._updateStatusAlerts(ctx.state.knowledgeBase);\n        }\n      } else {\n        logger.warn(`[${MODULE}][loadKnowledgeBaseHealth] No specific health data found for KB ${kbId} in response.`, { response: healthResp, context: MODULE });\n      }\n      return kbHealthData;\n    } catch (err) {\n      logger.error(\n        `[${MODULE}][loadKnowledgeBaseHealth] Error loading health for KB ${kbId}.`,\n        { status: err?.status ?? 500, data: err, message: err?.message ?? String(err) },\n        { context: MODULE }\n      );\n      ctx._showStatusAlert(`Could not load Knowledge Base status: ${err.message}`, \"error\");\n      return null;\n    }\n  }\n\n  /**\n   * Loads and displays the list of files for a project's knowledge base.\n   *\n   * Retrieves the files associated with the specified project and knowledge base, updating the UI to show the files or a placeholder if none are found. If the project or KB ID is missing, or if an error occurs, the files list is cleared and the files section is hidden.\n   *\n   * @param {string} projectId - The project identifier.\n   * @param {string} kbId - The knowledge base identifier.\n   */\n  async function loadKnowledgeBaseFiles(projectId, kbId) {\n    logger.info(`[${MODULE}][loadKnowledgeBaseFiles] Called for project: ${projectId}, KB ID: ${kbId}`, { context: MODULE });\n    await waitForAppReady();\n    logger.debug(`[${MODULE}][loadKnowledgeBaseFiles] App is ready. Proceeding.`, { context: MODULE });\n\n    if (!projectId || !kbId) {\n      logger.warn(`[${MODULE}][loadKnowledgeBaseFiles] Project ID or KB ID missing. Clearing files list.`, { projectId, kbId, context: MODULE });\n      _renderKnowledgeBaseFiles({ files: [], pagination: { total: 0 } }); // Clear UI\n      ctx.elements.knowledgeBaseFilesSection?.classList.add(\"hidden\");\n      return;\n    }\n\n    try {\n      const response = await ctx.apiRequest(\n        `/api/projects/${projectId}/knowledge-bases/${kbId}/files`,\n        { method: \"GET\" }\n      );\n      logger.debug(`[${MODULE}][loadKnowledgeBaseFiles] API response for files list:`, { response: response, context: MODULE });\n\n      if (response.status === \"success\" && response.data) {\n        logger.info(`[${MODULE}][loadKnowledgeBaseFiles] Successfully loaded ${response.data.files?.length || 0} files for KB ${kbId}.`, { context: MODULE });\n        _renderKnowledgeBaseFiles(response.data); // UI update\n        ctx.elements.knowledgeBaseFilesSection?.classList.toggle(\"hidden\", response.data.files.length === 0);\n      } else {\n        logger.warn(`[${MODULE}][loadKnowledgeBaseFiles] API reported no success or no data for KB ${kbId}. Clearing files list.`, { response, context: MODULE });\n        _renderKnowledgeBaseFiles({ files: [], pagination: { total: 0 } }); // Clear UI\n        ctx.elements.knowledgeBaseFilesSection?.classList.add(\"hidden\");\n      }\n    } catch (error) {\n      logger.error(\n        `[${MODULE}][loadKnowledgeBaseFiles] Error loading files for KB ${kbId}.`,\n        { status: error?.status ?? 500, data: error, message: error?.message ?? String(error) },\n        { context: MODULE }\n      );\n      _renderKnowledgeBaseFiles({ files: [], pagination: { total: 0 } }); // Clear UI on error\n      ctx.elements.knowledgeBaseFilesSection?.classList.add(\"hidden\");\n      ctx._showStatusAlert(`Could not load files for Knowledge Base: ${error.message}`, \"error\");\n    }\n  }\n\n  /**\n   * Render the list of knowledge base files in the UI.\n   * @param {Object} filesData - Data containing the list of files and pagination info.\n   */\n  function _renderKnowledgeBaseFiles(filesData) {\n    const container = ctx.elements.knowledgeBaseFilesListContainer;\n    if (!container) return;\n\n    ctx._safeSetInnerHTML(container, \"\"); // Clear previous content\n\n    if (!filesData || !filesData.files || filesData.files.length === 0) {\n      ctx._safeSetInnerHTML(container, '<p class=\"text-base-content/60 text-center py-4\">No files currently in the Knowledge Base.</p>');\n      return;\n    }\n\n    const ul = ctx.domAPI.createElement(\"ul\");\n    ul.className = \"space-y-2\";\n\n    filesData.files.forEach(file => {\n      const li = ctx.domAPI.createElement(\"li\");\n      li.className = \"flex items-center justify-between p-2 bg-base-200 rounded-md hover:bg-base-300 transition-colors\";\n\n      const processingStatus = file.config?.search_processing?.status || 'unknown';\n      let statusBadgeClass = 'badge-ghost';\n      if (processingStatus === 'success') statusBadgeClass = 'badge-success';\n      else if (processingStatus === 'error') statusBadgeClass = 'badge-error';\n      else if (processingStatus === 'pending') statusBadgeClass = 'badge-warning';\n\n      ctx._safeSetInnerHTML(li, `\n        <div class=\"flex items-center gap-3 truncate\">\n          <span class=\"text-xl\">${ctx.uiUtils.fileIcon(file.file_type)}</span>\n          <div class=\"truncate\">\n            <span class=\"font-medium text-sm block truncate\" title=\"${file.filename}\">${file.filename}</span>\n            <span class=\"text-xs text-base-content/70\">${ctx.uiUtils.formatBytes(file.file_size)}</span>\n          </div>\n        </div>\n        <div class=\"flex items-center gap-2\">\n          <span class=\"badge ${statusBadgeClass} badge-sm capitalize\">${processingStatus}</span>\n          <button data-file-id=\"${file.id}\" class=\"btn btn-xs btn-error btn-outline kb-delete-file-btn\" title=\"Delete file from KB\">\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-3 w-3\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M6 18L18 6M6 6l12 12\" /></svg>\n          </button>\n        </div>\n      `);\n\n      const deleteBtn = li.querySelector(\".kb-delete-file-btn\");\n      if (deleteBtn) {\n        ctx.eventHandlers.trackListener(deleteBtn, \"click\", (e) => {\n          e.stopPropagation(); // Prevent li click if any\n          const fileId = deleteBtn.dataset.fileId;\n          const projectId = ctx._getCurrentProjectId();\n          if (projectId && fileId) {\n            _handleDeleteKnowledgeBaseFile(projectId, fileId, file.filename);\n          }\n        }, { context: \"file-deletion\" });\n      }\n      ul.appendChild(li);\n    });\n    container.appendChild(ul);\n  }\n\n  /**\n   * Deletes a file from the knowledge base after user confirmation.\n   *\n   * Prompts the user to confirm deletion of the specified file from the knowledge base. If confirmed, sends a request to remove the file and updates the file list, knowledge base health, and project statistics upon success. Displays an error alert if the deletion fails.\n   *\n   * @param {string} projectId - The ID of the project containing the knowledge base.\n   * @param {string} fileId - The ID of the file to delete.\n   * @param {string} filename - The name of the file to display in confirmation dialogs and alerts.\n   *\n   * @throws {Error} If the API request to delete the file fails.\n   */\n  async function _handleDeleteKnowledgeBaseFile(projectId, fileId, filename) {\n    logger.info(`[${MODULE}][_handleDeleteKnowledgeBaseFile] Initiating delete for file: ${filename} (ID: ${fileId}) in project ${projectId}.`, { context: MODULE });\n    await waitForAppReady();\n    logger.debug(`[${MODULE}][_handleDeleteKnowledgeBaseFile] App is ready. Proceeding.`, { context: MODULE });\n\n    const confirmed = await ctx.modalManager.confirmAction({ // Pass as object\n      title: `Delete \"${filename}\"?`,\n      message: \"Are you sure you want to remove this file from the Knowledge Base? This will delete its indexed data.\",\n      confirmText: \"Delete\",\n      confirmClass: \"btn-error\"\n    });\n\n    if (!confirmed) {\n      logger.info(`[${MODULE}][_handleDeleteKnowledgeBaseFile] Deletion of file ${fileId} cancelled by user.`, { context: MODULE });\n      return;\n    }\n    logger.debug(`[${MODULE}][_handleDeleteKnowledgeBaseFile] User confirmed deletion for file ${fileId}.`, { context: MODULE });\n\n    const kbId = ctx.state.knowledgeBase?.id;\n    try {\n      const response = await ctx.apiRequest(\n        `/api/projects/${projectId}/knowledge-bases/${kbId}/files/${fileId}`,\n        { method: \"DELETE\" }\n      );\n      logger.debug(`[${MODULE}][_handleDeleteKnowledgeBaseFile] API response for delete file ${fileId}:`, { response, context: MODULE });\n\n      if (response.status === \"success\") {\n        logger.info(`[${MODULE}][_handleDeleteKnowledgeBaseFile] Successfully deleted file ${fileId} from KB for project ${projectId}.`, { context: MODULE });\n        const kbId = ctx.state.knowledgeBase?.id;\n        if (kbId) {\n          logger.debug(`[${MODULE}][_handleDeleteKnowledgeBaseFile] Refreshing file list and health for KB ${kbId}.`, { context: MODULE });\n          loadKnowledgeBaseFiles(projectId, kbId);\n          loadKnowledgeBaseHealth(kbId);\n        }\n        if (ctx.projectManager.loadProjectStats) {\n          logger.debug(`[${MODULE}][_handleDeleteKnowledgeBaseFile] Refreshing project stats for ${projectId}.`, { context: MODULE });\n          ctx.projectManager.loadProjectStats(projectId);\n        }\n      } else {\n        logger.error(`[${MODULE}][_handleDeleteKnowledgeBaseFile] API reported failure for deleting file ${fileId}.`, { responseMessage: response.message, context: MODULE });\n        throw new Error(response.message || \"Failed to delete file from KB.\");\n      }\n    } catch (error) {\n      logger.error(\n        `[${MODULE}][_handleDeleteKnowledgeBaseFile] Error deleting file ${fileId}.`,\n        { status: error?.status ?? 500, data: error, message: error?.message ?? String(error) },\n        { context: MODULE }\n      );\n      ctx._showStatusAlert(`Error deleting file \"${filename}\": ${error.message || 'Unknown server error'}`, \"error\");\n    }\n  }\n\n  /**\n   * Attaches a GitHub repository to the current knowledge base using form input values.\n   *\n   * Validates the repository URL and gathers branch and file path information from the UI. On success, updates the knowledge base state with the attached repository details and refreshes the modal, files list, and health metrics.\n   *\n   * @remark If the repository URL is invalid or missing, the operation is aborted without user feedback. Errors during the API request are shown as status alerts.\n   */\n  async function handleAttachGitHubRepo() {\n    logger.info(`[${MODULE}][handleAttachGitHubRepo] Attempting to attach GitHub repo.`, { context: MODULE });\n    await waitForAppReady();\n    logger.debug(`[${MODULE}][handleAttachGitHubRepo] App is ready. Proceeding.`, { context: MODULE });\n\n    const projectId = ctx._getCurrentProjectId();\n    const kbId = ctx.state.knowledgeBase?.id;\n\n    if (!projectId || !kbId) {\n      logger.warn(`[${MODULE}][handleAttachGitHubRepo] Project ID or KB ID missing. Aborting.`, { projectId, kbId, context: MODULE });\n      return;\n    }\n    logger.debug(`[${MODULE}][handleAttachGitHubRepo] Project ID: ${projectId}, KB ID: ${kbId}`, { context: MODULE });\n\n    const repoUrl = ctx.elements.kbGitHubRepoUrlInput?.value.trim();\n    const branch = ctx.elements.kbGitHubBranchInput?.value.trim() || \"main\";\n    const filePathsRaw = ctx.elements.kbGitHubFilePathsTextarea?.value.trim();\n    const filePaths = filePathsRaw ? filePathsRaw.split('\\n').map(p => p.trim()).filter(p => p) : null;\n    logger.debug(`[${MODULE}][handleAttachGitHubRepo] Form data:`, { repoUrl, branch, filePathsRaw, context: MODULE });\n\n    if (!repoUrl) {\n      logger.warn(`[${MODULE}][handleAttachGitHubRepo] Repository URL is empty. Aborting.`, { context: MODULE });\n      // TODO: Show user validation error\n      return;\n    }\n    try {\n      new URL(repoUrl);\n    } catch (_err) {\n      // Invalid URL – the built-in URL constructor threw.\n      logger.warn(`[${MODULE}][handleAttachGitHubRepo] Invalid repository URL: ${repoUrl}. Aborting.`, { context: MODULE });\n      // TODO: Show user validation error\n      return;\n    }\n\n    const attachButton = ctx.elements.kbAttachRepoBtn;\n    ctx._setButtonLoading(attachButton, true, \"Attaching...\");\n    logger.debug(`[${MODULE}][handleAttachGitHubRepo] Attach button loading state set.`, { context: MODULE });\n\n    try {\n      const payload = { repo_url: repoUrl, branch };\n      if (filePaths && filePaths.length > 0) {\n        payload.file_paths = filePaths;\n      }\n      logger.debug(`[${MODULE}][handleAttachGitHubRepo] API payload:`, { payload, context: MODULE });\n\n      const response = await ctx.apiRequest(\n        `/api/projects/${projectId}/knowledge-bases/${kbId}/github/attach`,\n        { method: \"POST\", body: payload }\n      );\n      logger.debug(`[${MODULE}][handleAttachGitHubRepo] API response:`, { response, context: MODULE });\n\n      if (response.success && response.data) {\n        logger.info(`[${MODULE}][handleAttachGitHubRepo] Successfully attached GitHub repo ${repoUrl} to KB ${kbId}.`, { context: MODULE });\n        if (ctx.state.knowledgeBase) {\n          ctx.state.knowledgeBase.repo_url = response.data.repo_url; // Assuming API returns the canonical URL\n          ctx.state.knowledgeBase.branch = response.data.branch || branch; // Assuming API returns branch\n          ctx.state.knowledgeBase.file_paths = response.data.file_paths || filePaths; // Assuming API returns paths\n        }\n        showKnowledgeBaseModal();\n        loadKnowledgeBaseFiles(projectId, kbId);\n        loadKnowledgeBaseHealth(kbId);\n      } else {\n        logger.error(`[${MODULE}][handleAttachGitHubRepo] API reported failure.`, { responseMessage: response.message, context: MODULE });\n        throw new Error(response.message || \"Failed to attach GitHub repository.\");\n      }\n    } catch (error) {\n      logger.error(\n        `[${MODULE}][handleAttachGitHubRepo] Error attaching GitHub repo.`,\n        { status: error?.status ?? 500, data: error, message: error?.message ?? String(error) },\n        { context: MODULE }\n      );\n      ctx._showStatusAlert(`Error attaching repository: ${error.message || 'Unknown server error'}`, \"error\");\n    } finally {\n      ctx._setButtonLoading(attachButton, false);\n      logger.debug(`[${MODULE}][handleAttachGitHubRepo] Attach button loading state reset.`, { context: MODULE });\n    }\n  }\n\n  /**\n   * Detaches a GitHub repository from the current knowledge base after user confirmation.\n   *\n   * Prompts the user to confirm detachment, then sends a request to remove the repository and its files from the knowledge base. Updates the UI and internal state on success, or displays an error alert on failure.\n   */\n  async function handleDetachGitHubRepo() {\n    logger.info(`[${MODULE}][handleDetachGitHubRepo] Attempting to detach GitHub repo.`, { context: MODULE });\n    await waitForAppReady();\n    logger.debug(`[${MODULE}][handleDetachGitHubRepo] App is ready. Proceeding.`, { context: MODULE });\n\n    const projectId = ctx._getCurrentProjectId();\n    const kbId = ctx.state.knowledgeBase?.id;\n    const repoUrl = ctx.state.knowledgeBase?.repo_url;\n\n    if (!projectId || !kbId || !repoUrl) {\n      logger.warn(`[${MODULE}][handleDetachGitHubRepo] Project ID, KB ID, or Repo URL missing. Aborting.`, { projectId, kbId, repoUrl, context: MODULE });\n      return;\n    }\n    logger.debug(`[${MODULE}][handleDetachGitHubRepo] Project ID: ${projectId}, KB ID: ${kbId}, Repo URL: ${repoUrl}`, { context: MODULE });\n\n    const confirmed = await ctx.modalManager.confirmAction({ // Pass as object\n      title: `Detach \"${repoUrl}\"?`,\n      message: \"Are you sure you want to detach this repository? Files from this repository will be removed from the Knowledge Base.\",\n      confirmText: \"Detach\",\n      confirmClass: \"btn-error\"\n    });\n\n    if (!confirmed) {\n      logger.info(`[${MODULE}][handleDetachGitHubRepo] Detachment of repo ${repoUrl} cancelled by user.`, { context: MODULE });\n      return;\n    }\n    logger.debug(`[${MODULE}][handleDetachGitHubRepo] User confirmed detachment for repo ${repoUrl}.`, { context: MODULE });\n\n    const detachButton = ctx.elements.kbDetachRepoBtn;\n    ctx._setButtonLoading(detachButton, true, \"Detaching...\");\n    logger.debug(`[${MODULE}][handleDetachGitHubRepo] Detach button loading state set.`, { context: MODULE });\n\n    try {\n      const response = await ctx.apiRequest(\n        `/api/projects/${projectId}/knowledge-bases/${kbId}/github/detach`,\n        { method: \"POST\", body: { repo_url: repoUrl } }\n      );\n      logger.debug(`[${MODULE}][handleDetachGitHubRepo] API response:`, { response, context: MODULE });\n\n      if (response.status === \"success\" && response.data) { // Assuming response.data might contain status or confirmation\n        logger.info(`[${MODULE}][handleDetachGitHubRepo] Successfully detached GitHub repo ${repoUrl} from KB ${kbId}.`, { context: MODULE });\n        if (ctx.state.knowledgeBase) {\n          delete ctx.state.knowledgeBase.repo_url;\n          delete ctx.state.knowledgeBase.branch;\n          delete ctx.state.knowledgeBase.file_paths;\n        }\n        showKnowledgeBaseModal();\n        loadKnowledgeBaseFiles(projectId, kbId);\n        loadKnowledgeBaseHealth(kbId);\n      } else {\n        logger.error(`[${MODULE}][handleDetachGitHubRepo] API reported failure.`, { responseMessage: response.message, context: MODULE });\n        throw new Error(response.message || \"Failed to detach GitHub repository.\");\n      }\n    } catch (error) {\n      logger.error(\n        `[${MODULE}][handleDetachGitHubRepo] Error detaching GitHub repo.`,\n        { status: error?.status ?? 500, data: error, message: error?.message ?? String(error) },\n        { context: MODULE }\n      );\n      ctx._showStatusAlert(`Error detaching repository: ${error.message || 'Unknown server error'}`, \"error\");\n    } finally {\n      ctx._setButtonLoading(detachButton, false);\n      logger.debug(`[${MODULE}][handleDetachGitHubRepo] Detach button loading state reset.`, { context: MODULE });\n    }\n  }\n\n  /**\n   * Validate dimension compatibility on model change\n   */\n  function validateSelectedModelDimensions() {\n    const sel = ctx.elements.modelSelect;\n    if (!sel) return;\n    const parent = sel.closest(\".form-control\");\n    if (!parent) return;\n    let warning = parent.querySelector(\".model-error\");\n    const opt = sel.options[sel.selectedIndex];\n    if (opt.disabled) { // Assuming disabled options are due to dimension mismatch\n      if (!warning) {\n        const labelDiv = parent.querySelector(\".label:last-of-type\") || parent.querySelector(\"p.text-xs.text-base-content\\\\/70.mt-1\")?.previousElementSibling;\n        if (labelDiv) {\n          warning = ctx.domAPI.createElement(\"span\");\n          warning.className = \"label-text-alt text-error model-error\";\n          labelDiv.appendChild(warning);\n        } else { // Fallback if specific label structure not found\n          warning = ctx.domAPI.createElement(\"div\");\n          warning.className = \"text-error text-xs mt-1 model-error\";\n          sel.insertAdjacentElement(\"afterend\", warning);\n        }\n      }\n      warning.textContent = \"Changing dimensions requires reprocessing all files!\";\n      warning.classList.remove(\"hidden\");\n    } else if (warning) {\n      warning.classList.add(\"hidden\");\n      warning.textContent = \"\";\n    }\n  }\n\n  /**\n   * Update model selection dropdown\n   * @param {string|null} currentModel\n   */\n  function _updateModelSelection(currentModel) {\n    const selectEl = ctx.elements.modelSelect || ctx.domAPI.getElementById(\"embeddingModelSelect\"); // Fallback ID\n    if (!selectEl) return;\n\n    if (currentModel) {\n      let modelFound = false;\n      for (let i = 0; i < selectEl.options.length; i++) {\n        if (selectEl.options[i].value === currentModel) {\n          selectEl.selectedIndex = i;\n          modelFound = true;\n          break;\n        }\n      }\n      // If the current model isn't in the list, add it (e.g., if it's custom or from an older config)\n      if (!modelFound) {\n        const newOption = new Option(`${currentModel} (Current)`, currentModel, false, true); // text, value, defaultSelected, selected\n        selectEl.add(newOption);\n        selectEl.value = currentModel; // Ensure it's selected\n      }\n    } else {\n      selectEl.selectedIndex = 0; // Default to the first option if no current model\n    }\n    validateSelectedModelDimensions(); // Check for warnings after updating\n  }\n\n  // Module/component cleanup function\n  function cleanup() {\n    // Clean up any event listeners, intervals, etc.\n    if (ctx?.eventHandlers?.cleanupListeners) {\n      ctx.eventHandlers.cleanupListeners({ context: MODULE });\n      ctx.eventHandlers.cleanupListeners({ context: \"file-deletion\" }); // legacy sub-context\n    }\n\n    // Clear any active timers created via browserService (defensive – future-proof)\n    if (Array.isArray(activeIntervals)) {\n      activeIntervals.forEach(id => ctx.browserService?.clearInterval?.(id));\n      activeIntervals.length = 0;\n    }\n\n    // Close any open KB modals to avoid leaks\n    try {\n      ctx.modalManager?.closeModal?.('*');\n    } catch (err) {\n      // Silently ignore any errors while cleaning up modals – at this\n      // point we are shutting down and cannot recover meaningfully.\n    }\n\n  }\n\n  return {\n    toggleKnowledgeBase,\n    reprocessFiles,\n    handleKnowledgeBaseFormSubmit,\n    handleDeleteKnowledgeBase,\n    showKnowledgeBaseModal,\n    hideKnowledgeBaseModal,\n    loadKnowledgeBaseHealth,\n    loadKnowledgeBaseFiles,\n    handleAttachGitHubRepo,\n    handleDetachGitHubRepo,\n    validateSelectedModelDimensions,\n    _updateModelSelection, // Expose for direct use if needed by main component\n    cleanup, // Expose cleanup to allow proper resource release\n  };\n}\n"],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAMA,MAAM,GAAG,sBAAsB;;AAErC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASC,0BAA0BA,CAACC,GAAG,EAAE;EAC9C;AACF;AACA;EACE,MAAMC,aAAa,GAAG,CAAC,YAAY,EAAE,eAAe,EAAE,QAAQ,CAAC;EAC/D,KAAK,MAAMC,GAAG,IAAID,aAAa,EAAE;IAC/B,IAAI,CAACD,GAAG,GAAGE,GAAG,CAAC,EAAE;MACf;MACA;MACA;MACA,IAAIA,GAAG,KAAK,YAAY,EAAE;QACxB,MAAMC,kBAAkB,GACtBH,GAAG,CAACI,GAAG,EAAEC,UAAU;QAAmB;QACtCL,GAAG,CAACM,MAAM,GAAG,KAAK,CAAC,EAAED,UAAU,CAAC,CAAM;;QAExC,IAAI,OAAOF,kBAAkB,KAAK,UAAU,EAAE;UAC5CH,GAAG,CAACK,UAAU,GAAGF,kBAAkB;QACrC,CAAC,MAAM;UACL;AACV;AACA;AACA;AACA;AACA;UACU,MAAM,IAAII,KAAK,CAAC,IAAIT,MAAM,4CAA4C,CAAC;QACzE;QAEA;MACF;;MAEA;MACA,MAAM,IAAIS,KAAK,CAAC,IAAIT,MAAM,kCAAkCI,GAAG,GAAG,CAAC;IACrE;EACF;EAEA,MAAMM,iBAAiB,GAAGR,GAAG,CAACM,MAAM,GAAGN,GAAG,CAACM,MAAM,CAAC,kBAAkB,CAAC,GAAG,IAAI;EAC5E,MAAMG,MAAM,GAAGT,GAAG,CAACS,MAAM,IAAIT,GAAG,CAACM,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC;EACnD,IAAI,CAACG,MAAM,EAAE;IACX,MAAM,IAAIF,KAAK,CAAC,IAAIT,MAAM,8CAA8C,CAAC;EAC3E;EAEA,MAAMY,mBAAmB,GAAGV,GAAG,CAACU,mBAAmB,IAC9CV,GAAG,CAACM,MAAM,GAAG,qBAAqB,CAAC;EACxCN,GAAG,CAACW,cAAc,GAAGX,GAAG,CAACW,cAAc,IAAIX,GAAG,CAACM,MAAM,GAAG,gBAAgB,CAAC;;EAEzE;EACA,MAAMM,eAAe,GAAG,EAAE;EAC1B;EACA,IAAIC,gBAAgB,GAAG,IAAI;EAC3B,eAAeC,eAAeA,CAAA,EAAG;IAC/B,IAAID,gBAAgB,EAAE,OAAOA,gBAAgB,CAAC,CAAU;IACxDA,gBAAgB,GAAGH,mBAAmB,GAClCA,mBAAmB,CAACK,uBAAuB,CAAC;MAAEC,IAAI,EAAE,CAAC,KAAK;IAAE,CAAC,CAAC,GAC9DC,OAAO,CAACC,OAAO,CAAC,CAAC;IACrB,OAAOL,gBAAgB;EACzB;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,eAAeM,mBAAmBA,CAACC,OAAO,EAAE;IAC1CX,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,+CAA+CsB,OAAO,EAAE,EAAE;MAAEE,OAAO,EAAExB;IAAO,CAAC,CAAC;IACpG,MAAMgB,eAAe,CAAC,CAAC;IACvBL,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,kDAAkD,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IAE/F,MAAM0B,GAAG,GAAGxB,GAAG,CAACyB,oBAAoB,CAAC,CAAC;IACtC,IAAI,CAACD,GAAG,EAAE;MACRf,MAAM,CAACiB,IAAI,CAAC,IAAI5B,MAAM,uDAAuD,EAAE;QAAEwB,OAAO,EAAExB;MAAO,CAAC,CAAC;MACnG;IACF;IACAW,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,sCAAsC0B,GAAG,EAAE,EAAE;MAAEF,OAAO,EAAExB;IAAO,CAAC,CAAC;IAExF,IAAI;MACF,MAAM6B,IAAI,GAAG,MAAM3B,GAAG,CAACK,UAAU,CAC/B,iBAAiBmB,GAAG,yBAAyB,EAC7C;QAAEI,MAAM,EAAE,MAAM;QAAEC,IAAI,EAAE;UAAEC,MAAM,EAAEV;QAAQ;MAAE,CAC9C,CAAC;MACDX,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,sCAAsC,EAAE;QAAEiC,QAAQ,EAAEJ,IAAI;QAAEL,OAAO,EAAExB;MAAO,CAAC,CAAC;MAEnG,IAAI6B,IAAI,CAACK,MAAM,KAAK,SAAS,EAAE;QAC7BvB,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,qDAAqDsB,OAAO,gBAAgBI,GAAG,GAAG,EAAE;UAAEF,OAAO,EAAExB;QAAO,CAAC,CAAC;QAC9H;QACA,IAAI,CAACE,GAAG,CAACiC,KAAK,CAACC,aAAa,EAAE;UAC5B;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;UACU,MAAMC,IAAI,GAAG,CAACR,IAAI,EAAES,IAAI,IAAIT,IAAI,CAACS,IAAI,CAACC,iBAAiB,KAAKV,IAAI,CAACU,iBAAiB;UAClFrC,GAAG,CAACiC,KAAK,CAACC,aAAa,GAAG;YACxBI,EAAE,EAAEH,IAAI;YACRI,UAAU,EAAEf,GAAG;YACfgB,SAAS,EAAEpB;UACb,CAAC;QACH,CAAC,MAAM;UACLpB,GAAG,CAACiC,KAAK,CAACC,aAAa,CAACM,SAAS,GAAGpB,OAAO;QAC7C;QACApB,GAAG,CAACyC,sBAAsB,CAACrB,OAAO,CAAC,CAAC,CAAC;QACrC,MAAMsB,OAAO,GAAG1C,GAAG,CAACM,MAAM,CAAC,SAAS,CAAC;QACrC,IAAIoC,OAAO,IAAI,OAAOA,OAAO,CAACC,OAAO,KAAK,UAAU,EAAE;UACpDD,OAAO,CAACC,OAAO,CAAC,cAAcnB,GAAG,EAAE,EAAEoB,MAAM,CAACxB,OAAO,CAAC,CAAC;QACvD;QAEA,IAAIpB,GAAG,CAAC6C,cAAc,CAACC,kBAAkB,EAAE;UACzCrC,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,wDAAwD0B,GAAG,GAAG,EAAE;YAAEF,OAAO,EAAExB;UAAO,CAAC,CAAC;UAC3G,MAAMiD,OAAO,GAAG,MAAM/C,GAAG,CAAC6C,cAAc,CAACC,kBAAkB,CAACtB,GAAG,CAAC;UAChExB,GAAG,CAACgD,uBAAuB,CAACD,OAAO,EAAEE,cAAc,EAAEzB,GAAG,CAAC,CAAC,CAAC;QAC7D,CAAC,MAAM;UACLf,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,0GAA0G,EAAE;YAAEwB,OAAO,EAAExB;UAAO,CAAC,CAAC;UACvJE,GAAG,CAACgD,uBAAuB,CAAChD,GAAG,CAACiC,KAAK,CAACC,aAAa,EAAEV,GAAG,CAAC,CAAC,CAAC;QAC7D;MACF,CAAC,MAAM;QACLf,MAAM,CAACyC,KAAK,CAAC,IAAIpD,MAAM,8CAA8C,EAAE;UAAEqD,eAAe,EAAExB,IAAI,CAACyB,OAAO;UAAE9B,OAAO,EAAExB;QAAO,CAAC,CAAC;QAC1H,MAAM,IAAIS,KAAK,CAACoB,IAAI,CAACyB,OAAO,IAAI,yCAAyC,CAAC;MAC5E;IACF,CAAC,CAAC,OAAOC,GAAG,EAAE;MACZ5C,MAAM,CAACyC,KAAK,CACV,IAAIpD,MAAM,oEAAoE0B,GAAG,iBAAiB,EAClG;QAAEQ,MAAM,EAAEqB,GAAG,EAAErB,MAAM,IAAI,GAAG;QAAEI,IAAI,EAAEiB,GAAG;QAAED,OAAO,EAAEC,GAAG,EAAED,OAAO,IAAIR,MAAM,CAACS,GAAG;MAAE,CAAC,EAC/E;QAAE/B,OAAO,EAAExB;MAAO,CACpB,CAAC;MACD,IAAIE,GAAG,CAACsD,QAAQ,CAACC,QAAQ,EAAEvD,GAAG,CAACsD,QAAQ,CAACC,QAAQ,CAACC,OAAO,GAAG,CAACpC,OAAO,CAAC,CAAC;MACrEpB,GAAG,CAACyC,sBAAsB,CAAC,CAACrB,OAAO,CAAC,CAAC,CAAC;MACtC;IACF;EACF;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,eAAeqC,cAAcA,CAACC,SAAS,EAAE;IACvCjD,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,4CAA4C4D,SAAS,EAAE,EAAE;MAAEpC,OAAO,EAAExB;IAAO,CAAC,CAAC;IACnG,MAAMgB,eAAe,CAAC,CAAC;IACvBL,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,6CAA6C,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IAE1F,IAAI,CAACE,GAAG,CAAC2D,YAAY,CAACD,SAAS,CAAC,EAAE;MAChCjD,MAAM,CAACiB,IAAI,CAAC,IAAI5B,MAAM,yCAAyC4D,SAAS,aAAa,EAAE;QAAEpC,OAAO,EAAExB;MAAO,CAAC,CAAC;MAC3G;IACF;IACA,MAAM8D,GAAG,GAAG5D,GAAG,CAACsD,QAAQ,CAACO,eAAe;IACxC7D,GAAG,CAAC8D,iBAAiB,CAACF,GAAG,EAAE,IAAI,EAAE,eAAe,CAAC;IACjDnD,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,uDAAuD,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IAEpG,IAAI;MACF,MAAM6B,IAAI,GAAG,MAAM3B,GAAG,CAACK,UAAU,CAC/B,iBAAiBqD,SAAS,yBAAyB,EACnD;QAAE9B,MAAM,EAAE,MAAM;QAAEC,IAAI,EAAE;UAAEkC,KAAK,EAAE;QAAK;MAAE,CAC1C,CAAC;MACDtD,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,iCAAiC,EAAE;QAAEiC,QAAQ,EAAEJ,IAAI;QAAEL,OAAO,EAAExB;MAAO,CAAC,CAAC;MAE9F,IAAI6B,IAAI,CAACK,MAAM,KAAK,SAAS,EAAE;QAC7BvB,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,qEAAqE4D,SAAS,GAAG,EAAE;UAAEpC,OAAO,EAAExB;QAAO,CAAC,CAAC;QAC7H,IAAIE,GAAG,CAAC6C,cAAc,CAACC,kBAAkB,EAAE;UACzCrC,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,6DAA6D4D,SAAS,GAAG,EAAE;YAAEpC,OAAO,EAAExB;UAAO,CAAC,CAAC;UACtH,MAAM,CAACiD,OAAO,CAAC,GAAG,MAAM9B,OAAO,CAAC+C,GAAG,CAAC,CAClChE,GAAG,CAAC6C,cAAc,CAACC,kBAAkB,CAACY,SAAS,CAAC,EAChD1D,GAAG,CAAC6C,cAAc,CAACoB,gBAAgB,GAAGP,SAAS,CAAC,CAAE;UAAA,CACnD,CAAC;UACF1D,GAAG,CAACgD,uBAAuB,CAACD,OAAO,EAAEE,cAAc,EAAES,SAAS,CAAC,CAAC,CAAC;QACnE,CAAC,MAAM,IAAI1D,GAAG,CAACiC,KAAK,CAACC,aAAa,EAAEI,EAAE,EAAE;UACtC7B,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,4GAA4G,EAAE;YAAEqC,IAAI,EAAEnC,GAAG,CAACiC,KAAK,CAACC,aAAa,CAACI,EAAE;YAAEhB,OAAO,EAAExB;UAAO,CAAC,CAAC;UAC3L,MAAMoE,uBAAuB,CAAClE,GAAG,CAACiC,KAAK,CAACC,aAAa,CAACI,EAAE,CAAC,CAAC,CAAC;UAC3D,MAAM6B,sBAAsB,CAACT,SAAS,EAAE1D,GAAG,CAACiC,KAAK,CAACC,aAAa,CAACI,EAAE,CAAC,CAAC,CAAC;QACvE;MACF,CAAC,MAAM;QACL7B,MAAM,CAACyC,KAAK,CAAC,IAAIpD,MAAM,yCAAyC,EAAE;UAAEqD,eAAe,EAAExB,IAAI,CAACyB,OAAO;UAAE9B,OAAO,EAAExB;QAAO,CAAC,CAAC;QACrH,MAAM,IAAIS,KAAK,CAACoB,IAAI,CAACyB,OAAO,IAAI,8BAA8B,CAAC;MACjE;IACF,CAAC,CAAC,OAAOC,GAAG,EAAE;MACZ5C,MAAM,CAACyC,KAAK,CACV,IAAIpD,MAAM,2DAA2D4D,SAAS,GAAG,EACjF;QAAE1B,MAAM,EAAEqB,GAAG,EAAErB,MAAM,IAAI,GAAG;QAAEI,IAAI,EAAEiB,GAAG;QAAED,OAAO,EAAEC,GAAG,EAAED,OAAO,IAAIR,MAAM,CAACS,GAAG;MAAE,CAAC,EAC/E;QAAE/B,OAAO,EAAExB;MAAO,CACpB,CAAC;MACD;IACF,CAAC,SAAS;MACRE,GAAG,CAAC8D,iBAAiB,CAACF,GAAG,EAAE,KAAK,CAAC;MACjCnD,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,yDAAyD,EAAE;QAAEwB,OAAO,EAAExB;MAAO,CAAC,CAAC;IACxG;EACF;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;EACE,SAASsE,6BAA6BA,CAACC,CAAC,EAAE;IACxCA,CAAC,CAACC,cAAc,CAAC,CAAC;IAClB7D,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,kDAAkD,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IAC9F,MAAMyE,IAAI,GAAGF,CAAC,CAACG,MAAM;IACrB,MAAMd,SAAS,GAAGa,IAAI,CAACE,OAAO,CAACf,SAAS,IAAI1D,GAAG,CAACyB,oBAAoB,CAAC,CAAC;IAEtE,IAAI,CAACzB,GAAG,CAAC2D,YAAY,CAACD,SAAS,CAAC,EAAE;MAChCjD,MAAM,CAACiB,IAAI,CAAC,IAAI5B,MAAM,wDAAwD4D,SAAS,aAAa,EAAE;QAAEpC,OAAO,EAAExB;MAAO,CAAC,CAAC;MAC1H;IACF;IACAW,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,gDAAgD4D,SAAS,EAAE,EAAE;MAAEpC,OAAO,EAAExB;IAAO,CAAC,CAAC;IAExG,MAAMsC,IAAI,GAAG,IAAIsC,QAAQ,CAACH,IAAI,CAAC;IAC/B,MAAMI,OAAO,GAAG;MACdC,IAAI,EAAExC,IAAI,CAACyC,GAAG,CAAC,MAAM,CAAC;MACtBC,WAAW,EAAE1C,IAAI,CAACyC,GAAG,CAAC,aAAa,CAAC,IAAI,IAAI;MAC5CE,eAAe,EAAE3C,IAAI,CAACyC,GAAG,CAAC,iBAAiB;IAC7C,CAAC;IACDpE,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,mDAAmD,EAAE;MAAE6E,OAAO;MAAErD,OAAO,EAAExB;IAAO,CAAC,CAAC;IAEzG,IAAI,CAACE,GAAG,CAACiC,KAAK,CAACC,aAAa,EAAEI,EAAE,EAAE;MAAE;MAClCqC,OAAO,CAACK,sBAAsB,GAAGT,IAAI,CAACjB,QAAQ,CAAC,mBAAmB,CAAC,EAAEE,OAAO,IAAI,KAAK;MACrF/C,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,oEAAoE6E,OAAO,CAACK,sBAAsB,EAAE,EAAE;QAAE1D,OAAO,EAAExB;MAAO,CAAC,CAAC;IACnJ;IAEA,IAAI,CAAC6E,OAAO,CAACC,IAAI,EAAEK,IAAI,CAAC,CAAC,EAAE;MACzBxE,MAAM,CAACiB,IAAI,CAAC,IAAI5B,MAAM,2DAA2D,EAAE;QAAEwB,OAAO,EAAExB;MAAO,CAAC,CAAC;MACvG;MACA;IACF;IACA,IAAI,CAAC6E,OAAO,CAACI,eAAe,EAAE;MAC5BtE,MAAM,CAACiB,IAAI,CAAC,IAAI5B,MAAM,0EAA0E,EAAE;QAAEwB,OAAO,EAAExB;MAAO,CAAC,CAAC;MACtH;MACA;IACF;IAEA,MAAM8D,GAAG,GAAGW,IAAI,CAACW,aAAa,CAAC,uBAAuB,CAAC;IACvDlF,GAAG,CAAC8D,iBAAiB,CAACF,GAAG,EAAE,IAAI,CAAC;IAChCnD,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,mEAAmE,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IAEhHqF,wBAAwB,CAACzB,SAAS,EAAEiB,OAAO,CAAC,CAACS,OAAO,CAAC,MAAM;MACzDpF,GAAG,CAAC8D,iBAAiB,CAACF,GAAG,EAAE,KAAK,CAAC;MACjCnD,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,qEAAqE,EAAE;QAAEwB,OAAO,EAAExB;MAAO,CAAC,CAAC;IACpH,CAAC,CAAC;EACJ;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,eAAeqF,wBAAwBA,CAACzB,SAAS,EAAEiB,OAAO,EAAE;IAC1DlE,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,0DAA0D4D,SAAS,EAAE,EAAE;MAAEiB,OAAO;MAAErD,OAAO,EAAExB;IAAO,CAAC,CAAC;IAC1H,MAAMgB,eAAe,CAAC,CAAC;IACvBL,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,uDAAuD,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IAEpG,IAAI;MACF,MAAMqC,IAAI,GAAGnC,GAAG,CAACiC,KAAK,CAACC,aAAa,EAAEI,EAAE;MACxC,MAAM+C,UAAU,GAAG,CAAC,CAAClD,IAAI;MACzB1B,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,sCAAsCqC,IAAI,kBAAkBkD,UAAU,EAAE,EAAE;QAAE/D,OAAO,EAAExB;MAAO,CAAC,CAAC;MAErH,MAAM8B,MAAM,GAAGyD,UAAU,GAAG,OAAO,GAAG,MAAM;MAC5C,MAAMC,GAAG,GAAGD,UAAU,GAClB,iBAAiB3B,SAAS,oBAAoBvB,IAAI,EAAE,GACpD,iBAAiBuB,SAAS,kBAAkB;MAChDjD,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,wCAAwCwF,GAAG,aAAa1D,MAAM,EAAE,EAAE;QAAEN,OAAO,EAAExB;MAAO,CAAC,CAAC;MAE7G,MAAM6B,IAAI,GAAG,MAAM3B,GAAG,CAACK,UAAU,CAACiF,GAAG,EAAE;QAAE1D,MAAM;QAAEC,IAAI,EAAE8C;MAAQ,CAAC,CAAC;MACjElE,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,2CAA2C,EAAE;QAAEiC,QAAQ,EAAEJ,IAAI;QAAEL,OAAO,EAAExB;MAAO,CAAC,CAAC;MAExG,MAAMyF,YAAY,GAAGF,UAAU,GAAG1D,IAAI,CAACS,IAAI,GAAIT,IAAI,CAACS,IAAI,EAAEa,cAAc,IAAItB,IAAI,CAACS,IAAK;MAEtF,IAAImD,YAAY,EAAEjD,EAAE,IAAIX,IAAI,CAACK,MAAM,KAAK,SAAS,EAAE;QACjDvB,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,sEAAsE4D,SAAS,YAAY6B,YAAY,EAAEjD,EAAE,EAAE,EAAE;UAAEhB,OAAO,EAAExB;QAAO,CAAC,CAAC;QACzJ0F,sBAAsB,CAAC,CAAC;QAExB,IAAIxF,GAAG,CAAC6C,cAAc,CAACC,kBAAkB,EAAE;UACzCrC,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,6DAA6D4D,SAAS,GAAG,EAAE;YAAEpC,OAAO,EAAExB;UAAO,CAAC,CAAC;UACtH,MAAMiD,OAAO,GAAG,MAAM/C,GAAG,CAAC6C,cAAc,CAACC,kBAAkB,CAACY,SAAS,CAAC;UACtE1D,GAAG,CAACgD,uBAAuB,CAACD,OAAO,EAAEE,cAAc,EAAES,SAAS,CAAC,CAAC,CAAC;QACnE,CAAC,MAAM;UACLjD,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,gHAAgH,EAAE;YAAEwB,OAAO,EAAExB;UAAO,CAAC,CAAC;UAC7JE,GAAG,CAACgD,uBAAuB,CAAC;YAC1B,GAAGhD,GAAG,CAACiC,KAAK,CAACC,aAAa;YAC1B,GAAGqD;UACL,CAAC,EAAE7B,SAAS,CAAC,CAAC,CAAC;QACjB;MACF,CAAC,MAAM;QACLjD,MAAM,CAACyC,KAAK,CAAC,IAAIpD,MAAM,mEAAmE,EAAE;UAAEqD,eAAe,EAAExB,IAAI,CAACyB,OAAO;UAAEmC,YAAY;UAAEjE,OAAO,EAAExB;QAAO,CAAC,CAAC;QAC7J,MAAM,IAAIS,KAAK,CAACoB,IAAI,CAACyB,OAAO,IAAI,8BAA8B,CAAC;MACjE;IACF,CAAC,CAAC,OAAOC,GAAG,EAAE;MACZ5C,MAAM,CAACyC,KAAK,CACV,IAAIpD,MAAM,iEAAiE4D,SAAS,GAAG,EACvF;QAAE1B,MAAM,EAAEqB,GAAG,EAAErB,MAAM,IAAI,GAAG;QAAEI,IAAI,EAAEiB,GAAG;QAAED,OAAO,EAAEC,GAAG,EAAED,OAAO,IAAIR,MAAM,CAACS,GAAG;MAAE,CAAC,EAC/E;QAAE/B,OAAO,EAAExB;MAAO,CACpB,CAAC;MACD,IAAIuD,GAAG,CAACrB,MAAM,KAAK,GAAG,EAAE;QACtBvB,MAAM,CAACiB,IAAI,CACT,IAAI5B,MAAM,6FAA6F,EACvG;UAAEkC,MAAM,EAAEqB,GAAG,EAAErB,MAAM,IAAI,GAAG;UAAEI,IAAI,EAAEiB,GAAG;UAAED,OAAO,EAAEC,GAAG,EAAED,OAAO,IAAIR,MAAM,CAACS,GAAG;QAAE,CAAC,EAC/E;UAAE/B,OAAO,EAAExB;QAAO,CACpB,CAAC;QACD,IAAIE,GAAG,CAAC6C,cAAc,CAACC,kBAAkB,EAAE;UACzC,IAAI;YACF,MAAMC,OAAO,GAAG,MAAM/C,GAAG,CAAC6C,cAAc,CAACC,kBAAkB,CAACY,SAAS,CAAC;YACtE1D,GAAG,CAACgD,uBAAuB,CAACD,OAAO,EAAEE,cAAc,EAAES,SAAS,CAAC,CAAC,CAAC;YACjE8B,sBAAsB,CAAC,CAAC;UAC1B,CAAC,CAAC,OAAOC,YAAY,EAAE;YACrBhF,MAAM,CAACyC,KAAK,CACV,IAAIpD,MAAM,yEAAyE,EACnF;cAAEkC,MAAM,EAAEyD,YAAY,EAAEzD,MAAM,IAAI,GAAG;cAAEI,IAAI,EAAEqD,YAAY;cAAErC,OAAO,EAAEqC,YAAY,EAAErC,OAAO,IAAIR,MAAM,CAAC6C,YAAY;YAAE,CAAC,EACnH;cAAEnE,OAAO,EAAExB;YAAO,CACpB,CAAC;UACH;QACF;MACF,CAAC,MAAM;QACL;QACAE,GAAG,CAAC0F,gBAAgB,CAAC,0BAA0BrC,GAAG,CAACD,OAAO,IAAI,sBAAsB,EAAE,EAAE,OAAO,CAAC;MAClG;IACF;EACF;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;EACE,eAAeuC,yBAAyBA,CAAA,EAAG;IACzClF,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,iDAAiD,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IAC7F,MAAMgB,eAAe,CAAC,CAAC;IACvBL,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,wDAAwD,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IAErG,MAAM4D,SAAS,GAAG1D,GAAG,CAACyB,oBAAoB,CAAC,CAAC;IAC5C,MAAMU,IAAI,GAAGnC,GAAG,CAACiC,KAAK,CAACC,aAAa,EAAEI,EAAE;IAExC,IAAI,CAACoB,SAAS,IAAI,CAACvB,IAAI,EAAE;MACvB1B,MAAM,CAACiB,IAAI,CAAC,IAAI5B,MAAM,qEAAqE,EAAE;QAAE4D,SAAS;QAAEvB,IAAI;QAAEb,OAAO,EAAExB;MAAO,CAAC,CAAC;MAClI;IACF;IACAW,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,4CAA4C4D,SAAS,YAAYvB,IAAI,EAAE,EAAE;MAAEb,OAAO,EAAExB;IAAO,CAAC,CAAC;IAEpH,MAAM8F,SAAS,GAAG,MAAM5F,GAAG,CAAC6F,YAAY,CAACC,aAAa,CAAC;MAAE;MACvDC,KAAK,EAAE,wBAAwB;MAC/B3C,OAAO,EAAE,gGAAgG;MACzG4C,WAAW,EAAE,QAAQ;MACrBC,YAAY,EAAE;IAChB,CAAC,CAAC;IAGF,IAAI,CAACL,SAAS,EAAE;MACdnF,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,0DAA0D,EAAE;QAAEwB,OAAO,EAAExB;MAAO,CAAC,CAAC;MACtG;IACF;IAEA,MAAMoG,YAAY,GAAGlG,GAAG,CAACsD,QAAQ,CAAC6C,sBAAsB;IACxDnG,GAAG,CAAC8D,iBAAiB,CAACoC,YAAY,EAAE,IAAI,EAAE,aAAa,CAAC;IACxDzF,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,+DAA+D,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IAE5G,IAAI;MACF,MAAM6B,IAAI,GAAG,MAAM3B,GAAG,CAACK,UAAU,CAC/B,iBAAiBqD,SAAS,oBAAoBvB,IAAI,EAAE,EACpD;QAAEP,MAAM,EAAE;MAAS,CACrB,CAAC;MACDnB,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,4CAA4C,EAAE;QAAEiC,QAAQ,EAAEJ,IAAI;QAAEL,OAAO,EAAExB;MAAO,CAAC,CAAC;MAEzG,IAAI6B,IAAI,CAACK,MAAM,KAAK,SAAS,IAAIL,IAAI,CAACS,IAAI,EAAEgE,UAAU,EAAE;QACtD3F,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,wDAAwDqC,IAAI,gBAAgBuB,SAAS,GAAG,EAAE;UAAEpC,OAAO,EAAExB;QAAO,CAAC,CAAC;QACpI0F,sBAAsB,CAAC,CAAC;QACxBxF,GAAG,CAACqG,kBAAkB,CAAC,CAAC;QACxB,IAAIrG,GAAG,CAAC6C,cAAc,CAACC,kBAAkB,EAAE;UACzCrC,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,8DAA8D4D,SAAS,GAAG,EAAE;YAAEpC,OAAO,EAAExB;UAAO,CAAC,CAAC;UACvH,MAAME,GAAG,CAAC6C,cAAc,CAACC,kBAAkB,CAACY,SAAS,CAAC;QACxD;MACF,CAAC,MAAM;QACLjD,MAAM,CAACyC,KAAK,CAAC,IAAIpD,MAAM,oDAAoD,EAAE;UAAEqD,eAAe,EAAExB,IAAI,CAACyB,OAAO;UAAE9B,OAAO,EAAExB;QAAO,CAAC,CAAC;QAChI,MAAM,IAAIS,KAAK,CAACoB,IAAI,CAACyB,OAAO,IAAI,kCAAkC,CAAC;MACrE;IACF,CAAC,CAAC,OAAOC,GAAG,EAAE;MACZ5C,MAAM,CAACyC,KAAK,CACV,IAAIpD,MAAM,kDAAkDqC,IAAI,gBAAgBuB,SAAS,GAAG,EAC5F;QAAE1B,MAAM,EAAEqB,GAAG,EAAErB,MAAM,IAAI,GAAG;QAAEI,IAAI,EAAEiB,GAAG;QAAED,OAAO,EAAEC,GAAG,EAAED,OAAO,IAAIR,MAAM,CAACS,GAAG;MAAE,CAAC,EAC/E;QAAE/B,OAAO,EAAExB;MAAO,CACpB,CAAC;MACDE,GAAG,CAAC0F,gBAAgB,CAAC,kCAAkCrC,GAAG,CAACD,OAAO,IAAI,sBAAsB,EAAE,EAAE,OAAO,CAAC;IAC1G,CAAC,SAAS;MACRpD,GAAG,CAAC8D,iBAAiB,CAACoC,YAAY,EAAE,KAAK,CAAC;MAC1CzF,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,iEAAiE,EAAE;QAAEwB,OAAO,EAAExB;MAAO,CAAC,CAAC;IAChH;EACF;;EAEA;AACF;AACA;AACA;AACA;EACE,eAAewG,sBAAsBA,CAAA,EAAG;IACtC7F,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,sDAAsD,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IAClG,MAAMgB,eAAe,CAAC,CAAC;IACvBL,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,qDAAqD,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IAElG,IAAI,CAACE,GAAG,CAACsD,QAAQ,CAACiD,aAAa,EAAE;MAC/BvG,GAAG,CAACsD,QAAQ,CAACiD,aAAa,GACxBvG,GAAG,CAACwG,MAAM,CAACC,cAAc,GAAG,4BAA4B,CAAC;IAC7D;IACA,IAAIC,KAAK,GAAG1G,GAAG,CAACsD,QAAQ,CAACiD,aAAa;IACtC,IAAI,CAACG,KAAK,EAAE;MACVjG,MAAM,CAACyC,KAAK,CAAC,IAAIpD,MAAM,6FAA6F,EAAE;QAAEwB,OAAO,EAAExB;MAAO,CAAC,CAAC;MAC1I;IACF;IAEA,MAAM4D,SAAS,GAAG1D,GAAG,CAACyB,oBAAoB,CAAC,CAAC;IAC5C,IAAI,CAACiC,SAAS,EAAE;MACdjD,MAAM,CAACiB,IAAI,CAAC,IAAI5B,MAAM,qEAAqE,EAAE;QAAEwB,OAAO,EAAExB;MAAO,CAAC,CAAC;MACjH;IACF;IACAW,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,yCAAyC4D,SAAS,EAAE,EAAE;MAAEpC,OAAO,EAAExB;IAAO,CAAC,CAAC;;IAEjG;IACA,IAAI;MACF,IAAIE,GAAG,CAAC6C,cAAc,CAACC,kBAAkB,EAAE;QACzCrC,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,4DAA4D4D,SAAS,0BAA0B,EAAE;UAAEpC,OAAO,EAAExB;QAAO,CAAC,CAAC;QAC5I,MAAM6G,cAAc,GAAG,MAAM3G,GAAG,CAAC6C,cAAc,CAACC,kBAAkB,CAACY,SAAS,CAAC;QAC7E,IAAIiD,cAAc,IAAI,OAAOA,cAAc,CAAC1D,cAAc,KAAK,WAAW,EAAE;UAC1EjD,GAAG,CAACiC,KAAK,CAACC,aAAa,GAAGyE,cAAc,CAAC1D,cAAc;UACvDxC,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,2EAA2EE,GAAG,CAACiC,KAAK,CAACC,aAAa,EAAEI,EAAE,EAAE,EAAE;YAAEhB,OAAO,EAAExB;UAAO,CAAC,CAAC;QACvJ,CAAC,MAAM,IAAI6G,cAAc,KAAK,IAAI,EAAE;UAClClG,MAAM,CAACiB,IAAI,CAAC,IAAI5B,MAAM,6DAA6D4D,SAAS,mCAAmC,EAAE;YAAEpC,OAAO,EAAExB;UAAO,CAAC,CAAC;QACvJ,CAAC,MAAM;UACLW,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,uFAAuF,EAAE;YAAE6G,cAAc;YAAErF,OAAO,EAAExB;UAAO,CAAC,CAAC;QACtJ;MACF;IACF,CAAC,CAAC,OAAOuD,GAAG,EAAE;MACZ5C,MAAM,CAACyC,KAAK,CACV,IAAIpD,MAAM,6FAA6F,EACvG;QAAEkC,MAAM,EAAEqB,GAAG,EAAErB,MAAM,IAAI,GAAG;QAAEI,IAAI,EAAEiB,GAAG;QAAED,OAAO,EAAEC,GAAG,EAAED,OAAO,IAAIR,MAAM,CAACS,GAAG;MAAE,CAAC,EAC/E;QAAE/B,OAAO,EAAExB;MAAO,CACpB,CAAC;IACH;IAEA,MAAMyE,IAAI,GAAGvE,GAAG,CAACsD,QAAQ,CAACsD,YAAY;IACtC,IAAIrC,IAAI,EAAE;MACRA,IAAI,CAACsC,KAAK,CAAC,CAAC;MACZpG,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,gDAAgD,EAAE;QAAEwB,OAAO,EAAExB;MAAO,CAAC,CAAC;MAC7F,MAAMgH,SAAS,GAAGvC,IAAI,CAACjB,QAAQ,CAAC,mBAAmB,CAAC;MACpD,IAAIwD,SAAS,EAAE;QACbA,SAAS,CAACC,KAAK,GAAG/G,GAAG,CAACiC,KAAK,CAACC,aAAa,EAAEI,EAAE,IAAI,EAAE;MACrD;IACF;IAEA0E,qBAAqB,CAAChH,GAAG,CAACiC,KAAK,CAACC,aAAa,EAAE6C,eAAe,IAAI,IAAI,CAAC;IACvEtE,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,qEAAqEE,GAAG,CAACiC,KAAK,CAACC,aAAa,EAAE6C,eAAe,EAAE,EAAE;MAAEzD,OAAO,EAAExB;IAAO,CAAC,CAAC;IAE5J,MAAMmH,SAAS,GAAGjH,GAAG,CAACsD,QAAQ,CAAC6C,sBAAsB;IACrD,MAAM;MAAEe,wBAAwB;MAAEC,wBAAwB;MAAEC,2BAA2B;MAAEC,kBAAkB;MAAEC,oBAAoB;MAAEC,mBAAmB;MAAEC;IAA0B,CAAC,GAAGxH,GAAG,CAACsD,QAAQ;IAElM,IAAItD,GAAG,CAACiC,KAAK,CAACC,aAAa,IAAIlC,GAAG,CAACiC,KAAK,CAACC,aAAa,CAACI,EAAE,EAAE;MACzD7B,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,kEAAkEE,GAAG,CAACiC,KAAK,CAACC,aAAa,CAACI,EAAE,EAAE,EAAE;QAAEhB,OAAO,EAAExB;MAAO,CAAC,CAAC;MAC3I,MAAM2H,EAAE,GAAGzH,GAAG,CAACiC,KAAK,CAACC,aAAa;MAClC,IAAIqC,IAAI,EAAE;QACRA,IAAI,CAACjB,QAAQ,CAAC,MAAM,CAAC,CAACyD,KAAK,GAAGU,EAAE,CAAC7C,IAAI,IAAI,EAAE;QAC3CL,IAAI,CAACjB,QAAQ,CAAC,aAAa,CAAC,CAACyD,KAAK,GAAGU,EAAE,CAAC3C,WAAW,IAAI,EAAE;QACzD,MAAM4C,uBAAuB,GAAGnD,IAAI,CAACjB,QAAQ,CAAC,mBAAmB,CAAC;QAClE,IAAIoE,uBAAuB,EAAEA,uBAAuB,CAAClE,OAAO,GAAG,KAAK;QAEpE,MAAMmE,kBAAkB,GAAGpD,IAAI,CAACjB,QAAQ,CAAC,aAAa,CAAC;QACvD,IAAIqE,kBAAkB,EAAEA,kBAAkB,CAACnE,OAAO,GAAGiE,EAAE,CAACjF,SAAS,KAAK,KAAK;MAC7E;MACAyE,SAAS,EAAEW,SAAS,CAACC,MAAM,CAAC,QAAQ,CAAC;MAErC,IAAIJ,EAAE,CAACK,QAAQ,EAAE;QACfZ,wBAAwB,EAAEU,SAAS,CAACC,MAAM,CAAC,QAAQ,CAAC;QACpD,IAAIV,wBAAwB,EAAEA,wBAAwB,CAACY,WAAW,GAAGN,EAAE,CAACK,QAAQ;QAChF,IAAIV,2BAA2B,EAAEA,2BAA2B,CAACW,WAAW,GAAGN,EAAE,CAACO,MAAM,IAAI,MAAM;QAC9FX,kBAAkB,EAAEO,SAAS,CAACK,GAAG,CAAC,QAAQ,CAAC;MAC7C,CAAC,MAAM;QACLf,wBAAwB,EAAEU,SAAS,CAACK,GAAG,CAAC,QAAQ,CAAC;QACjDZ,kBAAkB,EAAEO,SAAS,CAACC,MAAM,CAAC,QAAQ,CAAC;QAC9C,IAAIP,oBAAoB,EAAEA,oBAAoB,CAACP,KAAK,GAAG,EAAE;QACzD,IAAIQ,mBAAmB,EAAEA,mBAAmB,CAACR,KAAK,GAAG,MAAM;QAC3D,IAAIS,yBAAyB,EAAEA,yBAAyB,CAACT,KAAK,GAAG,EAAE;MACrE;IACF,CAAC,MAAM;MACLtG,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,uDAAuD,EAAE;QAAEwB,OAAO,EAAExB;MAAO,CAAC,CAAC;MACpG,IAAIyE,IAAI,EAAE;QACR,MAAMmD,uBAAuB,GAAGnD,IAAI,CAACjB,QAAQ,CAAC,mBAAmB,CAAC;QAClE,IAAIoE,uBAAuB,EAAEA,uBAAuB,CAAClE,OAAO,GAAG,IAAI;QAEnE,MAAMmE,kBAAkB,GAAGpD,IAAI,CAACjB,QAAQ,CAAC,aAAa,CAAC;QACvD,IAAIqE,kBAAkB,EAAEA,kBAAkB,CAACnE,OAAO,GAAG,IAAI;MAC3D;MACAyD,SAAS,EAAEW,SAAS,CAACK,GAAG,CAAC,QAAQ,CAAC;MAClCf,wBAAwB,EAAEU,SAAS,CAACK,GAAG,CAAC,QAAQ,CAAC;MACjDZ,kBAAkB,EAAEO,SAAS,CAACC,MAAM,CAAC,QAAQ,CAAC;MAC9C,IAAIP,oBAAoB,EAAEA,oBAAoB,CAACP,KAAK,GAAG,EAAE;MACzD,IAAIQ,mBAAmB,EAAEA,mBAAmB,CAACR,KAAK,GAAG,MAAM;MAC3D,IAAIS,yBAAyB,EAAEA,yBAAyB,CAACT,KAAK,GAAG,EAAE;IACrE;IAEA,IAAIxC,IAAI,EAAEA,IAAI,CAACE,OAAO,CAACf,SAAS,GAAGA,SAAS,CAAC,CAAC;;IAE9C,IAAI1D,GAAG,CAAC6F,YAAY,EAAEqC,IAAI,EAAE;MAC1B;MACAlI,GAAG,CAAC6F,YAAY,CAACqC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAW;IAChD,CAAC,MAAM,IAAI,OAAOxB,KAAK,CAACyB,SAAS,KAAK,UAAU,EAAE;MAChD;MACAzB,KAAK,CAACyB,SAAS,CAAC,CAAC;IACnB,CAAC,MAAM;MACL;MACAnI,GAAG,CAACwG,MAAM,CAAC4B,WAAW,CAAC1B,KAAK,EAAE,QAAQ,CAAC;IACzC;IACA2B,+BAA+B,CAAC,CAAC;IACjC5H,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,wCAAwC,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;EACvF;;EAEA;AACF;AACA;EACE,SAAS0F,sBAAsBA,CAAA,EAAG;IAChC/E,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,qDAAqD,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IACjG,MAAM4G,KAAK,GAAG1G,GAAG,CAACsD,QAAQ,CAACiD,aAAa;IACxC,IAAIvG,GAAG,CAAC6F,YAAY,EAAEyC,IAAI,EAAE;MAC1BtI,GAAG,CAAC6F,YAAY,CAACyC,IAAI,CAAC,WAAW,CAAC;IACpC,CAAC,MAAM,IAAI5B,KAAK,IAAI,OAAOA,KAAK,CAAC6B,KAAK,KAAK,UAAU,EAAE;MACrD7B,KAAK,CAAC6B,KAAK,CAAC,CAAC;IACf,CAAC,MAAM,IAAI7B,KAAK,EAAE;MAChB1G,GAAG,CAACwG,MAAM,CAACgC,QAAQ,CAAC9B,KAAK,EAAE,QAAQ,CAAC;IACtC;EACF;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;EACE,eAAexC,uBAAuBA,CAAC/B,IAAI,EAAE;IAC3C1B,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,gDAAgDqC,IAAI,EAAE,EAAE;MAAEb,OAAO,EAAExB;IAAO,CAAC,CAAC;IAClG,MAAMgB,eAAe,CAAC,CAAC;IACvBL,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,sDAAsD,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IAEnG,IAAI,CAACqC,IAAI,IAAI,CAACnC,GAAG,CAAC2D,YAAY,CAACxB,IAAI,CAAC,EAAE;MACpC1B,MAAM,CAACiB,IAAI,CAAC,IAAI5B,MAAM,6CAA6CqC,IAAI,aAAa,EAAE;QAAEb,OAAO,EAAExB;MAAO,CAAC,CAAC;MAC1G,OAAO,IAAI;IACb;IACA,IAAI;MACF,MAAM4D,SAAS,GAAG1D,GAAG,CAACyB,oBAAoB,CAAC,CAAC;MAC5C,IAAI,CAACiC,SAAS,EAAE;QACdjD,MAAM,CAACiB,IAAI,CAAC,IAAI5B,MAAM,yDAAyDqC,IAAI,aAAa,EAAE;UAAEb,OAAO,EAAExB;QAAO,CAAC,CAAC;QACtH,OAAO,IAAI;MACb;MACAW,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,0CAA0C4D,SAAS,EAAE,EAAE;QAAEpC,OAAO,EAAExB;MAAO,CAAC,CAAC;MAElG,MAAM2I,UAAU,GAAG,MAAMzI,GAAG,CAACK,UAAU,CACrC,iBAAiBqD,SAAS,oBAAoBvB,IAAI,uBAAuB,EACzE;QAAEP,MAAM,EAAE;MAAM,CAClB,CAAC;MACDnB,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,kDAAkDqC,IAAI,GAAG,EAAE;QAAEJ,QAAQ,EAAE0G,UAAU;QAAEnH,OAAO,EAAExB;MAAO,CAAC,CAAC;;MAE5H;MACA;MACA,IAAI4I,YAAY,GAAG,IAAI;MACvB,IAAIC,KAAK,CAACC,OAAO,CAACH,UAAU,EAAErG,IAAI,CAAC,EAAE;QACnCsG,YAAY,GAAGD,UAAU,CAACrG,IAAI,CAACyG,IAAI,CAACpB,EAAE,IAAIA,EAAE,CAACnF,EAAE,KAAKH,IAAI,CAAC;MAC3D,CAAC,MAAM,IAAIsG,UAAU,EAAErG,IAAI,EAAEE,EAAE,KAAKH,IAAI,IAAKsG,UAAU,EAAErG,IAAI,IAAI,CAACuG,KAAK,CAACC,OAAO,CAACH,UAAU,EAAErG,IAAI,CAAC,IAAI0G,MAAM,CAACC,IAAI,CAACN,UAAU,CAACrG,IAAI,CAAC,CAAC4G,MAAM,GAAG,CAAC,IAAI,CAAC7G,IAAK,EAAE;QACtJ;QACA;QACAuG,YAAY,GAAGD,UAAU,CAACrG,IAAI;MAChC;MAGA,IAAIsG,YAAY,EAAE;QAChBjI,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,uDAAuDqC,IAAI,GAAG,EAAE;UAAEC,IAAI,EAAEsG,YAAY;UAAEpH,OAAO,EAAExB;QAAO,CAAC,CAAC;QAC9H,MAAM;UAAEmJ,aAAa;UAAEC,cAAc;UAAEC,kBAAkB;UAAEC,mBAAmB;UAAEC;QAAkB,CAAC,GAAGrJ,GAAG,CAACsD,QAAQ;QAElH,IAAI2F,aAAa,IAAIP,YAAY,CAAC9D,IAAI,EAAEqE,aAAa,CAAClB,WAAW,GAAGW,YAAY,CAAC9D,IAAI;QACrF,IAAIsE,cAAc,IAAIR,YAAY,CAAC3D,eAAe,EAAEmE,cAAc,CAACnB,WAAW,GAAGW,YAAY,CAAC3D,eAAe;QAE7G,IAAIoE,kBAAkB,IAAIT,YAAY,CAACY,KAAK,EAAEC,WAAW,KAAKC,SAAS,EAAE;UACvEL,kBAAkB,CAACpB,WAAW,GAAGW,YAAY,CAACY,KAAK,CAACC,WAAW;QACjE;QACA,IAAIH,mBAAmB,IAAIV,YAAY,CAACe,YAAY,EAAEC,aAAa,KAAKF,SAAS,EAAE;UACjFJ,mBAAmB,CAACrB,WAAW,GAAGW,YAAY,CAACe,YAAY,CAACC,aAAa;QAC3E;QAEA,IAAIC,SAAS,GAAG,CAAC;QACjB,IAAIjB,YAAY,CAACY,KAAK,EAAEM,aAAa,EAAE;UACrClB,YAAY,CAACY,KAAK,CAACM,aAAa,CAACC,OAAO,CAACC,IAAI,IAAIH,SAAS,IAAKG,IAAI,CAACC,SAAS,IAAI,CAAE,CAAC;QACtF,CAAC,MAAM,IAAI/J,GAAG,CAACiC,KAAK,CAACC,aAAa,EAAE8H,KAAK,EAAEC,gBAAgB,IAAIjK,GAAG,CAACiC,KAAK,CAACC,aAAa,CAACI,EAAE,KAAKH,IAAI,EAAE;UAClG;UACAwH,SAAS,GAAG3J,GAAG,CAACiC,KAAK,CAACC,aAAa,CAAC8H,KAAK,CAACC,gBAAgB;QAC5D;QACA,IAAIZ,iBAAiB,EAAE;UACrBA,iBAAiB,CAACtB,WAAW,GAAG/H,GAAG,CAACkK,OAAO,CAACC,WAAW,CAACR,SAAS,CAAC;QACpE;QAEA,IAAI3J,GAAG,CAACiC,KAAK,CAACC,aAAa,IAAIlC,GAAG,CAACiC,KAAK,CAACC,aAAa,CAACI,EAAE,KAAKH,IAAI,EAAE;UAClE1B,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,8DAA8DqC,IAAI,GAAG,EAAE;YAAEb,OAAO,EAAExB;UAAO,CAAC,CAAC;UAClHE,GAAG,CAACiC,KAAK,CAACC,aAAa,CAAC0C,IAAI,GAAG8D,YAAY,CAAC9D,IAAI,IAAI5E,GAAG,CAACiC,KAAK,CAACC,aAAa,CAAC0C,IAAI;UAChF5E,GAAG,CAACiC,KAAK,CAACC,aAAa,CAAC6C,eAAe,GAAG2D,YAAY,CAAC3D,eAAe,IAAI/E,GAAG,CAACiC,KAAK,CAACC,aAAa,CAAC6C,eAAe;UACjH,IAAI2D,YAAY,CAACY,KAAK,EAAE;YACtBtJ,GAAG,CAACiC,KAAK,CAACC,aAAa,CAAC8H,KAAK,GAAG;cAC9B,GAAGhK,GAAG,CAACiC,KAAK,CAACC,aAAa,CAAC8H,KAAK;cAChCI,UAAU,EAAE1B,YAAY,CAACY,KAAK,CAACC,WAAW,IAAI,CAAC;cAC/Cc,iBAAiB,EAAE3B,YAAY,CAACY,KAAK,CAACgB,aAAa,IAAI;YACzD,CAAC;UACH;UACA,IAAI5B,YAAY,CAACe,YAAY,EAAE;YAC7BzJ,GAAG,CAACiC,KAAK,CAACC,aAAa,CAAC8H,KAAK,CAACO,WAAW,GAAG7B,YAAY,CAACe,YAAY,CAACC,aAAa,IAAI,CAAC;UAC1F;UACA1J,GAAG,CAACwK,mBAAmB,CAACxK,GAAG,CAACiC,KAAK,CAACC,aAAa,CAAC;QAClD;MACF,CAAC,MAAM;QACLzB,MAAM,CAACiB,IAAI,CAAC,IAAI5B,MAAM,mEAAmEqC,IAAI,eAAe,EAAE;UAAEJ,QAAQ,EAAE0G,UAAU;UAAEnH,OAAO,EAAExB;QAAO,CAAC,CAAC;MAC1J;MACA,OAAO4I,YAAY;IACrB,CAAC,CAAC,OAAOrF,GAAG,EAAE;MACZ5C,MAAM,CAACyC,KAAK,CACV,IAAIpD,MAAM,0DAA0DqC,IAAI,GAAG,EAC3E;QAAEH,MAAM,EAAEqB,GAAG,EAAErB,MAAM,IAAI,GAAG;QAAEI,IAAI,EAAEiB,GAAG;QAAED,OAAO,EAAEC,GAAG,EAAED,OAAO,IAAIR,MAAM,CAACS,GAAG;MAAE,CAAC,EAC/E;QAAE/B,OAAO,EAAExB;MAAO,CACpB,CAAC;MACDE,GAAG,CAAC0F,gBAAgB,CAAC,yCAAyCrC,GAAG,CAACD,OAAO,EAAE,EAAE,OAAO,CAAC;MACrF,OAAO,IAAI;IACb;EACF;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;EACE,eAAee,sBAAsBA,CAACT,SAAS,EAAEvB,IAAI,EAAE;IACrD1B,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,iDAAiD4D,SAAS,YAAYvB,IAAI,EAAE,EAAE;MAAEb,OAAO,EAAExB;IAAO,CAAC,CAAC;IACxH,MAAMgB,eAAe,CAAC,CAAC;IACvBL,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,qDAAqD,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IAElG,IAAI,CAAC4D,SAAS,IAAI,CAACvB,IAAI,EAAE;MACvB1B,MAAM,CAACiB,IAAI,CAAC,IAAI5B,MAAM,6EAA6E,EAAE;QAAE4D,SAAS;QAAEvB,IAAI;QAAEb,OAAO,EAAExB;MAAO,CAAC,CAAC;MAC1I2K,yBAAyB,CAAC;QAAEnB,KAAK,EAAE,EAAE;QAAEoB,UAAU,EAAE;UAAEC,KAAK,EAAE;QAAE;MAAE,CAAC,CAAC,CAAC,CAAC;MACpE3K,GAAG,CAACsD,QAAQ,CAACsH,yBAAyB,EAAEhD,SAAS,CAACK,GAAG,CAAC,QAAQ,CAAC;MAC/D;IACF;IAEA,IAAI;MACF,MAAMlG,QAAQ,GAAG,MAAM/B,GAAG,CAACK,UAAU,CACnC,iBAAiBqD,SAAS,oBAAoBvB,IAAI,QAAQ,EAC1D;QAAEP,MAAM,EAAE;MAAM,CAClB,CAAC;MACDnB,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,wDAAwD,EAAE;QAAEiC,QAAQ,EAAEA,QAAQ;QAAET,OAAO,EAAExB;MAAO,CAAC,CAAC;MAEzH,IAAIiC,QAAQ,CAACC,MAAM,KAAK,SAAS,IAAID,QAAQ,CAACK,IAAI,EAAE;QAClD3B,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,iDAAiDiC,QAAQ,CAACK,IAAI,CAACkH,KAAK,EAAEN,MAAM,IAAI,CAAC,iBAAiB7G,IAAI,GAAG,EAAE;UAAEb,OAAO,EAAExB;QAAO,CAAC,CAAC;QACrJ2K,yBAAyB,CAAC1I,QAAQ,CAACK,IAAI,CAAC,CAAC,CAAC;QAC1CpC,GAAG,CAACsD,QAAQ,CAACsH,yBAAyB,EAAEhD,SAAS,CAACiD,MAAM,CAAC,QAAQ,EAAE9I,QAAQ,CAACK,IAAI,CAACkH,KAAK,CAACN,MAAM,KAAK,CAAC,CAAC;MACtG,CAAC,MAAM;QACLvI,MAAM,CAACiB,IAAI,CAAC,IAAI5B,MAAM,uEAAuEqC,IAAI,wBAAwB,EAAE;UAAEJ,QAAQ;UAAET,OAAO,EAAExB;QAAO,CAAC,CAAC;QACzJ2K,yBAAyB,CAAC;UAAEnB,KAAK,EAAE,EAAE;UAAEoB,UAAU,EAAE;YAAEC,KAAK,EAAE;UAAE;QAAE,CAAC,CAAC,CAAC,CAAC;QACpE3K,GAAG,CAACsD,QAAQ,CAACsH,yBAAyB,EAAEhD,SAAS,CAACK,GAAG,CAAC,QAAQ,CAAC;MACjE;IACF,CAAC,CAAC,OAAO/E,KAAK,EAAE;MACdzC,MAAM,CAACyC,KAAK,CACV,IAAIpD,MAAM,wDAAwDqC,IAAI,GAAG,EACzE;QAAEH,MAAM,EAAEkB,KAAK,EAAElB,MAAM,IAAI,GAAG;QAAEI,IAAI,EAAEc,KAAK;QAAEE,OAAO,EAAEF,KAAK,EAAEE,OAAO,IAAIR,MAAM,CAACM,KAAK;MAAE,CAAC,EACvF;QAAE5B,OAAO,EAAExB;MAAO,CACpB,CAAC;MACD2K,yBAAyB,CAAC;QAAEnB,KAAK,EAAE,EAAE;QAAEoB,UAAU,EAAE;UAAEC,KAAK,EAAE;QAAE;MAAE,CAAC,CAAC,CAAC,CAAC;MACpE3K,GAAG,CAACsD,QAAQ,CAACsH,yBAAyB,EAAEhD,SAAS,CAACK,GAAG,CAAC,QAAQ,CAAC;MAC/DjI,GAAG,CAAC0F,gBAAgB,CAAC,4CAA4CxC,KAAK,CAACE,OAAO,EAAE,EAAE,OAAO,CAAC;IAC5F;EACF;;EAEA;AACF;AACA;AACA;EACE,SAASqH,yBAAyBA,CAACK,SAAS,EAAE;IAC5C,MAAMC,SAAS,GAAG/K,GAAG,CAACsD,QAAQ,CAAC0H,+BAA+B;IAC9D,IAAI,CAACD,SAAS,EAAE;IAEhB/K,GAAG,CAACiL,iBAAiB,CAACF,SAAS,EAAE,EAAE,CAAC,CAAC,CAAC;;IAEtC,IAAI,CAACD,SAAS,IAAI,CAACA,SAAS,CAACxB,KAAK,IAAIwB,SAAS,CAACxB,KAAK,CAACN,MAAM,KAAK,CAAC,EAAE;MAClEhJ,GAAG,CAACiL,iBAAiB,CAACF,SAAS,EAAE,gGAAgG,CAAC;MAClI;IACF;IAEA,MAAMG,EAAE,GAAGlL,GAAG,CAACwG,MAAM,CAAC2E,aAAa,CAAC,IAAI,CAAC;IACzCD,EAAE,CAACE,SAAS,GAAG,WAAW;IAE1BN,SAAS,CAACxB,KAAK,CAACO,OAAO,CAACC,IAAI,IAAI;MAC9B,MAAMuB,EAAE,GAAGrL,GAAG,CAACwG,MAAM,CAAC2E,aAAa,CAAC,IAAI,CAAC;MACzCE,EAAE,CAACD,SAAS,GAAG,kGAAkG;MAEjH,MAAME,gBAAgB,GAAGxB,IAAI,CAACyB,MAAM,EAAEC,iBAAiB,EAAExJ,MAAM,IAAI,SAAS;MAC5E,IAAIyJ,gBAAgB,GAAG,aAAa;MACpC,IAAIH,gBAAgB,KAAK,SAAS,EAAEG,gBAAgB,GAAG,eAAe,CAAC,KAClE,IAAIH,gBAAgB,KAAK,OAAO,EAAEG,gBAAgB,GAAG,aAAa,CAAC,KACnE,IAAIH,gBAAgB,KAAK,SAAS,EAAEG,gBAAgB,GAAG,eAAe;MAE3EzL,GAAG,CAACiL,iBAAiB,CAACI,EAAE,EAAE;AAChC;AACA,kCAAkCrL,GAAG,CAACkK,OAAO,CAACwB,QAAQ,CAAC5B,IAAI,CAAC6B,SAAS,CAAC;AACtE;AACA,sEAAsE7B,IAAI,CAAC8B,QAAQ,KAAK9B,IAAI,CAAC8B,QAAQ;AACrG,yDAAyD5L,GAAG,CAACkK,OAAO,CAACC,WAAW,CAACL,IAAI,CAACC,SAAS,CAAC;AAChG;AACA;AACA;AACA,+BAA+B0B,gBAAgB,yBAAyBH,gBAAgB;AACxF,kCAAkCxB,IAAI,CAACxH,EAAE;AACzC;AACA;AACA;AACA,OAAO,CAAC;MAEF,MAAM2E,SAAS,GAAGoE,EAAE,CAACnG,aAAa,CAAC,qBAAqB,CAAC;MACzD,IAAI+B,SAAS,EAAE;QACbjH,GAAG,CAAC6L,aAAa,CAACC,aAAa,CAAC7E,SAAS,EAAE,OAAO,EAAG5C,CAAC,IAAK;UACzDA,CAAC,CAAC0H,eAAe,CAAC,CAAC,CAAC,CAAC;UACrB,MAAMC,MAAM,GAAG/E,SAAS,CAACxC,OAAO,CAACuH,MAAM;UACvC,MAAMtI,SAAS,GAAG1D,GAAG,CAACyB,oBAAoB,CAAC,CAAC;UAC5C,IAAIiC,SAAS,IAAIsI,MAAM,EAAE;YACvBC,8BAA8B,CAACvI,SAAS,EAAEsI,MAAM,EAAElC,IAAI,CAAC8B,QAAQ,CAAC;UAClE;QACF,CAAC,EAAE;UAAEtK,OAAO,EAAE;QAAgB,CAAC,CAAC;MAClC;MACA4J,EAAE,CAACgB,WAAW,CAACb,EAAE,CAAC;IACpB,CAAC,CAAC;IACFN,SAAS,CAACmB,WAAW,CAAChB,EAAE,CAAC;EAC3B;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACE,eAAee,8BAA8BA,CAACvI,SAAS,EAAEsI,MAAM,EAAEJ,QAAQ,EAAE;IACzEnL,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,iEAAiE8L,QAAQ,SAASI,MAAM,gBAAgBtI,SAAS,GAAG,EAAE;MAAEpC,OAAO,EAAExB;IAAO,CAAC,CAAC;IAChK,MAAMgB,eAAe,CAAC,CAAC;IACvBL,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,6DAA6D,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IAE1G,MAAM8F,SAAS,GAAG,MAAM5F,GAAG,CAAC6F,YAAY,CAACC,aAAa,CAAC;MAAE;MACvDC,KAAK,EAAE,WAAW6F,QAAQ,IAAI;MAC9BxI,OAAO,EAAE,uGAAuG;MAChH4C,WAAW,EAAE,QAAQ;MACrBC,YAAY,EAAE;IAChB,CAAC,CAAC;IAEF,IAAI,CAACL,SAAS,EAAE;MACdnF,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,sDAAsDkM,MAAM,qBAAqB,EAAE;QAAE1K,OAAO,EAAExB;MAAO,CAAC,CAAC;MAC7H;IACF;IACAW,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,sEAAsEkM,MAAM,GAAG,EAAE;MAAE1K,OAAO,EAAExB;IAAO,CAAC,CAAC;IAE5H,MAAMqC,IAAI,GAAGnC,GAAG,CAACiC,KAAK,CAACC,aAAa,EAAEI,EAAE;IACxC,IAAI;MACF,MAAMP,QAAQ,GAAG,MAAM/B,GAAG,CAACK,UAAU,CACnC,iBAAiBqD,SAAS,oBAAoBvB,IAAI,UAAU6J,MAAM,EAAE,EACpE;QAAEpK,MAAM,EAAE;MAAS,CACrB,CAAC;MACDnB,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,kEAAkEkM,MAAM,GAAG,EAAE;QAAEjK,QAAQ;QAAET,OAAO,EAAExB;MAAO,CAAC,CAAC;MAElI,IAAIiC,QAAQ,CAACC,MAAM,KAAK,SAAS,EAAE;QACjCvB,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,+DAA+DkM,MAAM,wBAAwBtI,SAAS,GAAG,EAAE;UAAEpC,OAAO,EAAExB;QAAO,CAAC,CAAC;QACrJ,MAAMqC,IAAI,GAAGnC,GAAG,CAACiC,KAAK,CAACC,aAAa,EAAEI,EAAE;QACxC,IAAIH,IAAI,EAAE;UACR1B,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,4EAA4EqC,IAAI,GAAG,EAAE;YAAEb,OAAO,EAAExB;UAAO,CAAC,CAAC;UAChIqE,sBAAsB,CAACT,SAAS,EAAEvB,IAAI,CAAC;UACvC+B,uBAAuB,CAAC/B,IAAI,CAAC;QAC/B;QACA,IAAInC,GAAG,CAAC6C,cAAc,CAACoB,gBAAgB,EAAE;UACvCxD,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,kEAAkE4D,SAAS,GAAG,EAAE;YAAEpC,OAAO,EAAExB;UAAO,CAAC,CAAC;UAC3HE,GAAG,CAAC6C,cAAc,CAACoB,gBAAgB,CAACP,SAAS,CAAC;QAChD;MACF,CAAC,MAAM;QACLjD,MAAM,CAACyC,KAAK,CAAC,IAAIpD,MAAM,4EAA4EkM,MAAM,GAAG,EAAE;UAAE7I,eAAe,EAAEpB,QAAQ,CAACqB,OAAO;UAAE9B,OAAO,EAAExB;QAAO,CAAC,CAAC;QACrK,MAAM,IAAIS,KAAK,CAACwB,QAAQ,CAACqB,OAAO,IAAI,gCAAgC,CAAC;MACvE;IACF,CAAC,CAAC,OAAOF,KAAK,EAAE;MACdzC,MAAM,CAACyC,KAAK,CACV,IAAIpD,MAAM,yDAAyDkM,MAAM,GAAG,EAC5E;QAAEhK,MAAM,EAAEkB,KAAK,EAAElB,MAAM,IAAI,GAAG;QAAEI,IAAI,EAAEc,KAAK;QAAEE,OAAO,EAAEF,KAAK,EAAEE,OAAO,IAAIR,MAAM,CAACM,KAAK;MAAE,CAAC,EACvF;QAAE5B,OAAO,EAAExB;MAAO,CACpB,CAAC;MACDE,GAAG,CAAC0F,gBAAgB,CAAC,wBAAwBkG,QAAQ,MAAM1I,KAAK,CAACE,OAAO,IAAI,sBAAsB,EAAE,EAAE,OAAO,CAAC;IAChH;EACF;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;EACE,eAAe+I,sBAAsBA,CAAA,EAAG;IACtC1L,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,6DAA6D,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IACzG,MAAMgB,eAAe,CAAC,CAAC;IACvBL,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,qDAAqD,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IAElG,MAAM4D,SAAS,GAAG1D,GAAG,CAACyB,oBAAoB,CAAC,CAAC;IAC5C,MAAMU,IAAI,GAAGnC,GAAG,CAACiC,KAAK,CAACC,aAAa,EAAEI,EAAE;IAExC,IAAI,CAACoB,SAAS,IAAI,CAACvB,IAAI,EAAE;MACvB1B,MAAM,CAACiB,IAAI,CAAC,IAAI5B,MAAM,kEAAkE,EAAE;QAAE4D,SAAS;QAAEvB,IAAI;QAAEb,OAAO,EAAExB;MAAO,CAAC,CAAC;MAC/H;IACF;IACAW,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,yCAAyC4D,SAAS,YAAYvB,IAAI,EAAE,EAAE;MAAEb,OAAO,EAAExB;IAAO,CAAC,CAAC;IAEjH,MAAMsM,OAAO,GAAGpM,GAAG,CAACsD,QAAQ,CAACgE,oBAAoB,EAAEP,KAAK,CAAC9B,IAAI,CAAC,CAAC;IAC/D,MAAM+C,MAAM,GAAGhI,GAAG,CAACsD,QAAQ,CAACiE,mBAAmB,EAAER,KAAK,CAAC9B,IAAI,CAAC,CAAC,IAAI,MAAM;IACvE,MAAMoH,YAAY,GAAGrM,GAAG,CAACsD,QAAQ,CAACkE,yBAAyB,EAAET,KAAK,CAAC9B,IAAI,CAAC,CAAC;IACzE,MAAMqH,SAAS,GAAGD,YAAY,GAAGA,YAAY,CAACE,KAAK,CAAC,IAAI,CAAC,CAACC,GAAG,CAACC,CAAC,IAAIA,CAAC,CAACxH,IAAI,CAAC,CAAC,CAAC,CAACyH,MAAM,CAACD,CAAC,IAAIA,CAAC,CAAC,GAAG,IAAI;IAClGhM,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,sCAAsC,EAAE;MAAEsM,OAAO;MAAEpE,MAAM;MAAEqE,YAAY;MAAE/K,OAAO,EAAExB;IAAO,CAAC,CAAC;IAElH,IAAI,CAACsM,OAAO,EAAE;MACZ3L,MAAM,CAACiB,IAAI,CAAC,IAAI5B,MAAM,8DAA8D,EAAE;QAAEwB,OAAO,EAAExB;MAAO,CAAC,CAAC;MAC1G;MACA;IACF;IACA,IAAI;MACF,IAAI6M,GAAG,CAACP,OAAO,CAAC;IAClB,CAAC,CAAC,OAAOQ,IAAI,EAAE;MACb;MACAnM,MAAM,CAACiB,IAAI,CAAC,IAAI5B,MAAM,qDAAqDsM,OAAO,aAAa,EAAE;QAAE9K,OAAO,EAAExB;MAAO,CAAC,CAAC;MACrH;MACA;IACF;IAEA,MAAM+M,YAAY,GAAG7M,GAAG,CAACsD,QAAQ,CAACwJ,eAAe;IACjD9M,GAAG,CAAC8D,iBAAiB,CAAC+I,YAAY,EAAE,IAAI,EAAE,cAAc,CAAC;IACzDpM,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,4DAA4D,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IAEzG,IAAI;MACF,MAAM6E,OAAO,GAAG;QAAEmD,QAAQ,EAAEsE,OAAO;QAAEpE;MAAO,CAAC;MAC7C,IAAIsE,SAAS,IAAIA,SAAS,CAACtD,MAAM,GAAG,CAAC,EAAE;QACrCrE,OAAO,CAACoI,UAAU,GAAGT,SAAS;MAChC;MACA7L,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,wCAAwC,EAAE;QAAE6E,OAAO;QAAErD,OAAO,EAAExB;MAAO,CAAC,CAAC;MAE9F,MAAMiC,QAAQ,GAAG,MAAM/B,GAAG,CAACK,UAAU,CACnC,iBAAiBqD,SAAS,oBAAoBvB,IAAI,gBAAgB,EAClE;QAAEP,MAAM,EAAE,MAAM;QAAEC,IAAI,EAAE8C;MAAQ,CAClC,CAAC;MACDlE,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,yCAAyC,EAAE;QAAEiC,QAAQ;QAAET,OAAO,EAAExB;MAAO,CAAC,CAAC;MAEhG,IAAIiC,QAAQ,CAACiL,OAAO,IAAIjL,QAAQ,CAACK,IAAI,EAAE;QACrC3B,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,+DAA+DsM,OAAO,UAAUjK,IAAI,GAAG,EAAE;UAAEb,OAAO,EAAExB;QAAO,CAAC,CAAC;QACnI,IAAIE,GAAG,CAACiC,KAAK,CAACC,aAAa,EAAE;UAC3BlC,GAAG,CAACiC,KAAK,CAACC,aAAa,CAAC4F,QAAQ,GAAG/F,QAAQ,CAACK,IAAI,CAAC0F,QAAQ,CAAC,CAAC;UAC3D9H,GAAG,CAACiC,KAAK,CAACC,aAAa,CAAC8F,MAAM,GAAGjG,QAAQ,CAACK,IAAI,CAAC4F,MAAM,IAAIA,MAAM,CAAC,CAAC;UACjEhI,GAAG,CAACiC,KAAK,CAACC,aAAa,CAAC6K,UAAU,GAAGhL,QAAQ,CAACK,IAAI,CAAC2K,UAAU,IAAIT,SAAS,CAAC,CAAC;QAC9E;QACAhG,sBAAsB,CAAC,CAAC;QACxBnC,sBAAsB,CAACT,SAAS,EAAEvB,IAAI,CAAC;QACvC+B,uBAAuB,CAAC/B,IAAI,CAAC;MAC/B,CAAC,MAAM;QACL1B,MAAM,CAACyC,KAAK,CAAC,IAAIpD,MAAM,iDAAiD,EAAE;UAAEqD,eAAe,EAAEpB,QAAQ,CAACqB,OAAO;UAAE9B,OAAO,EAAExB;QAAO,CAAC,CAAC;QACjI,MAAM,IAAIS,KAAK,CAACwB,QAAQ,CAACqB,OAAO,IAAI,qCAAqC,CAAC;MAC5E;IACF,CAAC,CAAC,OAAOF,KAAK,EAAE;MACdzC,MAAM,CAACyC,KAAK,CACV,IAAIpD,MAAM,wDAAwD,EAClE;QAAEkC,MAAM,EAAEkB,KAAK,EAAElB,MAAM,IAAI,GAAG;QAAEI,IAAI,EAAEc,KAAK;QAAEE,OAAO,EAAEF,KAAK,EAAEE,OAAO,IAAIR,MAAM,CAACM,KAAK;MAAE,CAAC,EACvF;QAAE5B,OAAO,EAAExB;MAAO,CACpB,CAAC;MACDE,GAAG,CAAC0F,gBAAgB,CAAC,+BAA+BxC,KAAK,CAACE,OAAO,IAAI,sBAAsB,EAAE,EAAE,OAAO,CAAC;IACzG,CAAC,SAAS;MACRpD,GAAG,CAAC8D,iBAAiB,CAAC+I,YAAY,EAAE,KAAK,CAAC;MAC1CpM,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,8DAA8D,EAAE;QAAEwB,OAAO,EAAExB;MAAO,CAAC,CAAC;IAC7G;EACF;;EAEA;AACF;AACA;AACA;AACA;EACE,eAAemN,sBAAsBA,CAAA,EAAG;IACtCxM,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,6DAA6D,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IACzG,MAAMgB,eAAe,CAAC,CAAC;IACvBL,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,qDAAqD,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IAElG,MAAM4D,SAAS,GAAG1D,GAAG,CAACyB,oBAAoB,CAAC,CAAC;IAC5C,MAAMU,IAAI,GAAGnC,GAAG,CAACiC,KAAK,CAACC,aAAa,EAAEI,EAAE;IACxC,MAAM8J,OAAO,GAAGpM,GAAG,CAACiC,KAAK,CAACC,aAAa,EAAE4F,QAAQ;IAEjD,IAAI,CAACpE,SAAS,IAAI,CAACvB,IAAI,IAAI,CAACiK,OAAO,EAAE;MACnC3L,MAAM,CAACiB,IAAI,CAAC,IAAI5B,MAAM,6EAA6E,EAAE;QAAE4D,SAAS;QAAEvB,IAAI;QAAEiK,OAAO;QAAE9K,OAAO,EAAExB;MAAO,CAAC,CAAC;MACnJ;IACF;IACAW,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,yCAAyC4D,SAAS,YAAYvB,IAAI,eAAeiK,OAAO,EAAE,EAAE;MAAE9K,OAAO,EAAExB;IAAO,CAAC,CAAC;IAEvI,MAAM8F,SAAS,GAAG,MAAM5F,GAAG,CAAC6F,YAAY,CAACC,aAAa,CAAC;MAAE;MACvDC,KAAK,EAAE,WAAWqG,OAAO,IAAI;MAC7BhJ,OAAO,EAAE,sHAAsH;MAC/H4C,WAAW,EAAE,QAAQ;MACrBC,YAAY,EAAE;IAChB,CAAC,CAAC;IAEF,IAAI,CAACL,SAAS,EAAE;MACdnF,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,gDAAgDsM,OAAO,qBAAqB,EAAE;QAAE9K,OAAO,EAAExB;MAAO,CAAC,CAAC;MACxH;IACF;IACAW,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,gEAAgEsM,OAAO,GAAG,EAAE;MAAE9K,OAAO,EAAExB;IAAO,CAAC,CAAC;IAEvH,MAAMoN,YAAY,GAAGlN,GAAG,CAACsD,QAAQ,CAAC6J,eAAe;IACjDnN,GAAG,CAAC8D,iBAAiB,CAACoJ,YAAY,EAAE,IAAI,EAAE,cAAc,CAAC;IACzDzM,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,4DAA4D,EAAE;MAAEwB,OAAO,EAAExB;IAAO,CAAC,CAAC;IAEzG,IAAI;MACF,MAAMiC,QAAQ,GAAG,MAAM/B,GAAG,CAACK,UAAU,CACnC,iBAAiBqD,SAAS,oBAAoBvB,IAAI,gBAAgB,EAClE;QAAEP,MAAM,EAAE,MAAM;QAAEC,IAAI,EAAE;UAAEiG,QAAQ,EAAEsE;QAAQ;MAAE,CAChD,CAAC;MACD3L,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,yCAAyC,EAAE;QAAEiC,QAAQ;QAAET,OAAO,EAAExB;MAAO,CAAC,CAAC;MAEhG,IAAIiC,QAAQ,CAACC,MAAM,KAAK,SAAS,IAAID,QAAQ,CAACK,IAAI,EAAE;QAAE;QACpD3B,MAAM,CAACY,IAAI,CAAC,IAAIvB,MAAM,+DAA+DsM,OAAO,YAAYjK,IAAI,GAAG,EAAE;UAAEb,OAAO,EAAExB;QAAO,CAAC,CAAC;QACrI,IAAIE,GAAG,CAACiC,KAAK,CAACC,aAAa,EAAE;UAC3B,OAAOlC,GAAG,CAACiC,KAAK,CAACC,aAAa,CAAC4F,QAAQ;UACvC,OAAO9H,GAAG,CAACiC,KAAK,CAACC,aAAa,CAAC8F,MAAM;UACrC,OAAOhI,GAAG,CAACiC,KAAK,CAACC,aAAa,CAAC6K,UAAU;QAC3C;QACAzG,sBAAsB,CAAC,CAAC;QACxBnC,sBAAsB,CAACT,SAAS,EAAEvB,IAAI,CAAC;QACvC+B,uBAAuB,CAAC/B,IAAI,CAAC;MAC/B,CAAC,MAAM;QACL1B,MAAM,CAACyC,KAAK,CAAC,IAAIpD,MAAM,iDAAiD,EAAE;UAAEqD,eAAe,EAAEpB,QAAQ,CAACqB,OAAO;UAAE9B,OAAO,EAAExB;QAAO,CAAC,CAAC;QACjI,MAAM,IAAIS,KAAK,CAACwB,QAAQ,CAACqB,OAAO,IAAI,qCAAqC,CAAC;MAC5E;IACF,CAAC,CAAC,OAAOF,KAAK,EAAE;MACdzC,MAAM,CAACyC,KAAK,CACV,IAAIpD,MAAM,wDAAwD,EAClE;QAAEkC,MAAM,EAAEkB,KAAK,EAAElB,MAAM,IAAI,GAAG;QAAEI,IAAI,EAAEc,KAAK;QAAEE,OAAO,EAAEF,KAAK,EAAEE,OAAO,IAAIR,MAAM,CAACM,KAAK;MAAE,CAAC,EACvF;QAAE5B,OAAO,EAAExB;MAAO,CACpB,CAAC;MACDE,GAAG,CAAC0F,gBAAgB,CAAC,+BAA+BxC,KAAK,CAACE,OAAO,IAAI,sBAAsB,EAAE,EAAE,OAAO,CAAC;IACzG,CAAC,SAAS;MACRpD,GAAG,CAAC8D,iBAAiB,CAACoJ,YAAY,EAAE,KAAK,CAAC;MAC1CzM,MAAM,CAACc,KAAK,CAAC,IAAIzB,MAAM,8DAA8D,EAAE;QAAEwB,OAAO,EAAExB;MAAO,CAAC,CAAC;IAC7G;EACF;;EAEA;AACF;AACA;EACE,SAASuI,+BAA+BA,CAAA,EAAG;IACzC,MAAM+E,GAAG,GAAGpN,GAAG,CAACsD,QAAQ,CAAC+J,WAAW;IACpC,IAAI,CAACD,GAAG,EAAE;IACV,MAAME,MAAM,GAAGF,GAAG,CAACG,OAAO,CAAC,eAAe,CAAC;IAC3C,IAAI,CAACD,MAAM,EAAE;IACb,IAAIE,OAAO,GAAGF,MAAM,CAACpI,aAAa,CAAC,cAAc,CAAC;IAClD,MAAMuI,GAAG,GAAGL,GAAG,CAACM,OAAO,CAACN,GAAG,CAACO,aAAa,CAAC;IAC1C,IAAIF,GAAG,CAACG,QAAQ,EAAE;MAAE;MAClB,IAAI,CAACJ,OAAO,EAAE;QACZ,MAAMK,QAAQ,GAAGP,MAAM,CAACpI,aAAa,CAAC,qBAAqB,CAAC,IAAIoI,MAAM,CAACpI,aAAa,CAAC,uCAAuC,CAAC,EAAE4I,sBAAsB;QACrJ,IAAID,QAAQ,EAAE;UACZL,OAAO,GAAGxN,GAAG,CAACwG,MAAM,CAAC2E,aAAa,CAAC,MAAM,CAAC;UAC1CqC,OAAO,CAACpC,SAAS,GAAG,uCAAuC;UAC3DyC,QAAQ,CAAC3B,WAAW,CAACsB,OAAO,CAAC;QAC/B,CAAC,MAAM;UAAE;UACPA,OAAO,GAAGxN,GAAG,CAACwG,MAAM,CAAC2E,aAAa,CAAC,KAAK,CAAC;UACzCqC,OAAO,CAACpC,SAAS,GAAG,qCAAqC;UACzDgC,GAAG,CAACW,qBAAqB,CAAC,UAAU,EAAEP,OAAO,CAAC;QAChD;MACF;MACAA,OAAO,CAACzF,WAAW,GAAG,sDAAsD;MAC5EyF,OAAO,CAAC5F,SAAS,CAACC,MAAM,CAAC,QAAQ,CAAC;IACpC,CAAC,MAAM,IAAI2F,OAAO,EAAE;MAClBA,OAAO,CAAC5F,SAAS,CAACK,GAAG,CAAC,QAAQ,CAAC;MAC/BuF,OAAO,CAACzF,WAAW,GAAG,EAAE;IAC1B;EACF;;EAEA;AACF;AACA;AACA;EACE,SAASf,qBAAqBA,CAACgH,YAAY,EAAE;IAC3C,MAAMC,QAAQ,GAAGjO,GAAG,CAACsD,QAAQ,CAAC+J,WAAW,IAAIrN,GAAG,CAACwG,MAAM,CAACC,cAAc,CAAC,sBAAsB,CAAC,CAAC,CAAC;IAChG,IAAI,CAACwH,QAAQ,EAAE;IAEf,IAAID,YAAY,EAAE;MAChB,IAAIE,UAAU,GAAG,KAAK;MACtB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGF,QAAQ,CAACP,OAAO,CAAC1E,MAAM,EAAEmF,CAAC,EAAE,EAAE;QAChD,IAAIF,QAAQ,CAACP,OAAO,CAACS,CAAC,CAAC,CAACpH,KAAK,KAAKiH,YAAY,EAAE;UAC9CC,QAAQ,CAACN,aAAa,GAAGQ,CAAC;UAC1BD,UAAU,GAAG,IAAI;UACjB;QACF;MACF;MACA;MACA,IAAI,CAACA,UAAU,EAAE;QACf,MAAME,SAAS,GAAG,IAAIC,MAAM,CAAC,GAAGL,YAAY,YAAY,EAAEA,YAAY,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC;QACtFC,QAAQ,CAAChG,GAAG,CAACmG,SAAS,CAAC;QACvBH,QAAQ,CAAClH,KAAK,GAAGiH,YAAY,CAAC,CAAC;MACjC;IACF,CAAC,MAAM;MACLC,QAAQ,CAACN,aAAa,GAAG,CAAC,CAAC,CAAC;IAC9B;IACAtF,+BAA+B,CAAC,CAAC,CAAC,CAAC;EACrC;;EAEA;EACA,SAASiG,OAAOA,CAAA,EAAG;IACjB;IACA,IAAItO,GAAG,EAAE6L,aAAa,EAAE0C,gBAAgB,EAAE;MACxCvO,GAAG,CAAC6L,aAAa,CAAC0C,gBAAgB,CAAC;QAAEjN,OAAO,EAAExB;MAAO,CAAC,CAAC;MACvDE,GAAG,CAAC6L,aAAa,CAAC0C,gBAAgB,CAAC;QAAEjN,OAAO,EAAE;MAAgB,CAAC,CAAC,CAAC,CAAC;IACpE;;IAEA;IACA,IAAIqH,KAAK,CAACC,OAAO,CAAChI,eAAe,CAAC,EAAE;MAClCA,eAAe,CAACiJ,OAAO,CAACvH,EAAE,IAAItC,GAAG,CAACW,cAAc,EAAE6N,aAAa,GAAGlM,EAAE,CAAC,CAAC;MACtE1B,eAAe,CAACoI,MAAM,GAAG,CAAC;IAC5B;;IAEA;IACA,IAAI;MACFhJ,GAAG,CAAC6F,YAAY,EAAE4I,UAAU,GAAG,GAAG,CAAC;IACrC,CAAC,CAAC,OAAOpL,GAAG,EAAE;MACZ;MACA;IAAA;EAGJ;EAEA,OAAO;IACLlC,mBAAmB;IACnBsC,cAAc;IACdW,6BAA6B;IAC7BuB,yBAAyB;IACzBW,sBAAsB;IACtBd,sBAAsB;IACtBtB,uBAAuB;IACvBC,sBAAsB;IACtBgI,sBAAsB;IACtBc,sBAAsB;IACtB5E,+BAA+B;IAC/BrB,qBAAqB;IAAE;IACvBsH,OAAO,CAAE;EACX,CAAC;AACH","ignoreList":[]}