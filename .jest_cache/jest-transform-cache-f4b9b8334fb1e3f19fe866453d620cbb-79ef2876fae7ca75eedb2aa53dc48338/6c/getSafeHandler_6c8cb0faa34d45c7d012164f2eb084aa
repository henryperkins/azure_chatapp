42985b45b613ae8d6abba3ec09345808
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.createSafeHandler = createSafeHandler;
exports.default = void 0;
exports.getSafeHandler = getSafeHandler;
function createSafeHandler({
  DependencySystem,
  logger
} = {}) {
  if (!DependencySystem) throw new Error('[createSafeHandler] DependencySystem required');
  if (!logger) throw new Error('[createSafeHandler] logger required');
  const raw = DependencySystem.modules?.get?.('safeHandler');
  function safeHandler(fn, ctx = 'safeHandler') {
    return typeof raw === 'function' ? raw(fn, ctx) : typeof raw?.safeHandler === 'function' ? raw.safeHandler(fn, ctx) : (...a) => {
      try {
        return fn(...a);
      } catch (err) {
        logger.error('[safeHandler] wrapped fn failed', err, {
          context: 'safeHandler:' + ctx
        });
      }
    };
  }
  return {
    safeHandler,
    cleanup() {}
  };
}

// Legacy named export (unchanged signature)
function getSafeHandler(DependencySystem) {
  return createSafeHandler({
    DependencySystem,
    logger: {
      error() {}
    }
  }).safeHandler;
}

// Default export for compatibility
var _default = exports.default = createSafeHandler;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjcmVhdGVTYWZlSGFuZGxlciIsIkRlcGVuZGVuY3lTeXN0ZW0iLCJsb2dnZXIiLCJFcnJvciIsInJhdyIsIm1vZHVsZXMiLCJnZXQiLCJzYWZlSGFuZGxlciIsImZuIiwiY3R4IiwiYSIsImVyciIsImVycm9yIiwiY29udGV4dCIsImNsZWFudXAiLCJnZXRTYWZlSGFuZGxlciIsIl9kZWZhdWx0IiwiZXhwb3J0cyIsImRlZmF1bHQiXSwic291cmNlcyI6WyJnZXRTYWZlSGFuZGxlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZnVuY3Rpb24gY3JlYXRlU2FmZUhhbmRsZXIoeyBEZXBlbmRlbmN5U3lzdGVtLCBsb2dnZXIgfSA9IHt9KSB7XG4gIGlmICghRGVwZW5kZW5jeVN5c3RlbSkgdGhyb3cgbmV3IEVycm9yKCdbY3JlYXRlU2FmZUhhbmRsZXJdIERlcGVuZGVuY3lTeXN0ZW0gcmVxdWlyZWQnKTtcbiAgaWYgKCFsb2dnZXIpICAgICAgICAgIHRocm93IG5ldyBFcnJvcignW2NyZWF0ZVNhZmVIYW5kbGVyXSBsb2dnZXIgcmVxdWlyZWQnKTtcblxuICBjb25zdCByYXcgPSBEZXBlbmRlbmN5U3lzdGVtLm1vZHVsZXM/LmdldD8uKCdzYWZlSGFuZGxlcicpO1xuXG4gIGZ1bmN0aW9uIHNhZmVIYW5kbGVyKGZuLCBjdHggPSAnc2FmZUhhbmRsZXInKSB7XG4gICAgcmV0dXJuIHR5cGVvZiByYXcgPT09ICdmdW5jdGlvbidcbiAgICAgID8gcmF3KGZuLCBjdHgpXG4gICAgICA6ICh0eXBlb2YgcmF3Py5zYWZlSGFuZGxlciA9PT0gJ2Z1bmN0aW9uJ1xuICAgICAgICAgID8gcmF3LnNhZmVIYW5kbGVyKGZuLCBjdHgpXG4gICAgICAgICAgOiAoLi4uYSkgPT4ge1xuICAgICAgICAgICAgICB0cnkgeyByZXR1cm4gZm4oLi4uYSk7IH1cbiAgICAgICAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcignW3NhZmVIYW5kbGVyXSB3cmFwcGVkIGZuIGZhaWxlZCcsIGVycixcbiAgICAgICAgICAgICAgICAgIHsgY29udGV4dDogJ3NhZmVIYW5kbGVyOicgKyBjdHggfSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHsgc2FmZUhhbmRsZXIsIGNsZWFudXAoKSB7fSB9O1xufVxuXG4vLyBMZWdhY3kgbmFtZWQgZXhwb3J0ICh1bmNoYW5nZWQgc2lnbmF0dXJlKVxuZXhwb3J0IGZ1bmN0aW9uIGdldFNhZmVIYW5kbGVyKERlcGVuZGVuY3lTeXN0ZW0pIHtcbiAgcmV0dXJuIGNyZWF0ZVNhZmVIYW5kbGVyKHsgRGVwZW5kZW5jeVN5c3RlbSwgbG9nZ2VyOiB7IGVycm9yKCl7fSB9IH0pLnNhZmVIYW5kbGVyO1xufVxuXG4vLyBEZWZhdWx0IGV4cG9ydCBmb3IgY29tcGF0aWJpbGl0eVxuZXhwb3J0IGRlZmF1bHQgY3JlYXRlU2FmZUhhbmRsZXI7XG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQU8sU0FBU0EsaUJBQWlCQSxDQUFDO0VBQUVDLGdCQUFnQjtFQUFFQztBQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRTtFQUNuRSxJQUFJLENBQUNELGdCQUFnQixFQUFFLE1BQU0sSUFBSUUsS0FBSyxDQUFDLCtDQUErQyxDQUFDO0VBQ3ZGLElBQUksQ0FBQ0QsTUFBTSxFQUFXLE1BQU0sSUFBSUMsS0FBSyxDQUFDLHFDQUFxQyxDQUFDO0VBRTVFLE1BQU1DLEdBQUcsR0FBR0gsZ0JBQWdCLENBQUNJLE9BQU8sRUFBRUMsR0FBRyxHQUFHLGFBQWEsQ0FBQztFQUUxRCxTQUFTQyxXQUFXQSxDQUFDQyxFQUFFLEVBQUVDLEdBQUcsR0FBRyxhQUFhLEVBQUU7SUFDNUMsT0FBTyxPQUFPTCxHQUFHLEtBQUssVUFBVSxHQUM1QkEsR0FBRyxDQUFDSSxFQUFFLEVBQUVDLEdBQUcsQ0FBQyxHQUNYLE9BQU9MLEdBQUcsRUFBRUcsV0FBVyxLQUFLLFVBQVUsR0FDbkNILEdBQUcsQ0FBQ0csV0FBVyxDQUFDQyxFQUFFLEVBQUVDLEdBQUcsQ0FBQyxHQUN4QixDQUFDLEdBQUdDLENBQUMsS0FBSztNQUNSLElBQUk7UUFBRSxPQUFPRixFQUFFLENBQUMsR0FBR0UsQ0FBQyxDQUFDO01BQUUsQ0FBQyxDQUN4QixPQUFPQyxHQUFHLEVBQUU7UUFDVlQsTUFBTSxDQUFDVSxLQUFLLENBQUMsaUNBQWlDLEVBQUVELEdBQUcsRUFDakQ7VUFBRUUsT0FBTyxFQUFFLGNBQWMsR0FBR0o7UUFBSSxDQUFDLENBQUM7TUFDdEM7SUFDRixDQUFFO0VBQ1o7RUFFQSxPQUFPO0lBQUVGLFdBQVc7SUFBRU8sT0FBT0EsQ0FBQSxFQUFHLENBQUM7RUFBRSxDQUFDO0FBQ3RDOztBQUVBO0FBQ08sU0FBU0MsY0FBY0EsQ0FBQ2QsZ0JBQWdCLEVBQUU7RUFDL0MsT0FBT0QsaUJBQWlCLENBQUM7SUFBRUMsZ0JBQWdCO0lBQUVDLE1BQU0sRUFBRTtNQUFFVSxLQUFLQSxDQUFBLEVBQUUsQ0FBQztJQUFFO0VBQUUsQ0FBQyxDQUFDLENBQUNMLFdBQVc7QUFDbkY7O0FBRUE7QUFBQSxJQUFBUyxRQUFBLEdBQUFDLE9BQUEsQ0FBQUMsT0FBQSxHQUNlbEIsaUJBQWlCIiwiaWdub3JlTGlzdCI6W119