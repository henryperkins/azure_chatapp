{"version":3,"names":["_selectorConstants","require","createProjectListComponent","deps","DependencySystem","Error","projectManager","initialProjectManager","eventHandlers","modalManager","app","storage","sanitizer","htmlSanitizer","domAPI","browserService","domReadinessService","APP_CONFIG","logger","uiStateService","eventService","MODULE_CONTEXT","sanitize","ELEMENT_IDS","SELECTORS","projectListContainer","replace","projectListView","elementId","_doc","element","gridElement","isRendering","eventBus","EventTarget","STATE_COMPONENT","getState","key","defaultValue","setState","value","_setState","partial","Object","entries","forEach","_loadCustomization","_getProjectId","p","uuid","id","project_id","projectId","ID","_id","_waitForDOMUpdate","Promise","resolve","getWindow","requestAnimationFrame","setTimeout","_removeAllSkeletons","allSkeletons","querySelectorAll","skeleton","remove","loadingGrid","getElementById","addClass","style","display","state","Proxy","get","_target","set","ownKeys","initialize","waitForEvent","timeout","TIMEOUTS","PROJECT_LIST_TEMPLATE","context","templateErr","warn","dependenciesAndElements","domSelectors","observeMutations","PROJECT_LIST_ELEMENTS","err","error","_showErrorState","message","getDocument","querySelector","createElement","className","setAttribute","appendChild","_bindEventListeners","_bindCreateProjectButtons","dispatchEvent","CustomEvent","detail","success","doc","isAuthenticated","_loadProjects","_showLoginRequired","_safeSetInnerHTML","el","rawHtml","safe","setInnerHTML","_clearElement","textContent","safeHandlerRaw","modules","safeHandler","fn","projectsLoadedHandler","e","renderProjects","trackListener","description","busErr","_handleCardClick","_handleProjectCreated","_handleProjectUpdated","handleAuthStateChange","authenticated","projectFilterTabs","show","auth","AuthBus","once","debug","_bindFilterEvents","parent","newGrid","oldGrid","oldSkeletons","parentNode","projects","length","renderErr","container","tabSelector","tabs","tab","_bindSingleFilterTab","dataset","filter","_bindFilterTablistKeyboardNav","filterValue","clickHandler","_setFilter","event","preventDefault","focus","currentTab","activeElement","includes","idx","indexOf","nextIdx","prevIdx","_updateActiveTab","_updateUrl","activeTabId","isActive","classList","toggle","mobileGridPanel","navigationService","updateUrlParams","data","reason","loading","_extractProjects","_showEmptyState","fragment","createDocumentFragment","_project","_createProjectCard","_makeVisible","opacity","hide","add","extractResourceList","list","Array","isArray","paths","path","segments","split","result","valid","seg","hasProjects","fallbackEl","loadProjects","_showLoadingState","_handleAction","action","project","find","String","onViewProject","_openEditModal","_confirmDelete","projectCard","target","closest","actionBtn","stopPropagation","isCreateButton","updatedProject","findIndex","newProjects","bindListener","btn","APP_READY_WAIT","mm","isReadyPromise","_","then","catch","_openNewProjectModal","updateContent","modalEl","nameInput","name","useDeleteModal","confirmDelete","bind","confirmAction","ok","title","confirmText","confirmClass","onConfirm","onCancel","_executeDelete","deleteProject","removeClass","i","raw","emptyDiv","createBtn","filterTabs","loginDiv","loginBtn","msg","errorDiv","retryBtn","card","_computeCardClasses","append","_buildCardHeader","_buildCardDescription","_buildCardFooter","theme","customization","themeBg","themeText","header","titleEl","actions","icon","label","btnDef","_createActionButton","showDescription","footer","showDate","updated_at","dateEl","_formatDate","badges","pinned","pinBadge","tip","archived","archiveBadge","button","iconString","trim","dateString","date","Date","toLocaleDateString","undefined","year","month","day","saved","getItem","JSON","parse","_getDefaultCustomization","projectObjOrId","setCurrentProject","projectObj","pid","navigateToProject","destroy","cleanupListeners","setProjectManager","pm"],"sources":["projectListComponent.js"],"sourcesContent":["// VENDOR-EXEMPT-SIZE: Core module pending refactor in Q3-25\n/**\n * ProjectListComponent – guarded factory\n * Handles rendering and interaction with the project list UI.\n * Compliant with all frontend code guardrails (.clinerules).\n *\n * To use:\n *   import { createProjectListComponent } from './projectListComponent.js';\n *   const plc = createProjectListComponent({ ...dependencies });\n *   plc.initialize();\n *   // ... later, to clean up:\n *   plc.destroy();\n */\n\nimport { SELECTORS } from \"./utils/selectorConstants.js\";\n\nexport function createProjectListComponent(deps) {\n    // ----- Dependency Validation -----\n    if (!deps || !deps.DependencySystem) throw new Error('[ProjectListComponent] Missing dependencies object or DependencySystem to factory.');\n\n    const {\n        projectManager: initialProjectManager,\n        eventHandlers,\n        modalManager,\n        app,\n        storage,\n        sanitizer: htmlSanitizer,\n        domAPI,\n        browserService,\n        domReadinessService,\n        APP_CONFIG,\n        logger,\n        DependencySystem,\n        uiStateService = null,\n        eventService\n    } = deps;\n\n    // Allow projectManager to be reassigned later via setProjectManager()\n    let projectManager = initialProjectManager;\n\n    const MODULE_CONTEXT = \"ProjectListComponent\";\n\n    // Allow projectManager to be null initially - it gets set later via setProjectManager()\n    if (!eventHandlers || !storage || !htmlSanitizer)\n        throw new Error(\"[ProjectListComponent] Missing required dependencies: eventHandlers, storage, sanitizer.\");\n    if (!domAPI)\n        throw new Error(\"[ProjectListComponent] domAPI injection is mandatory.\");\n    if (!domReadinessService)\n        throw new Error(\"[ProjectListComponent] domReadinessService DI is mandatory.\");\n    if (!logger)\n        throw new Error(\"[ProjectListComponent] logger DI is mandatory.\");\n    if (typeof htmlSanitizer.sanitize !== \"function\")\n        throw new Error(\"[ProjectListComponent] htmlSanitizer must provide a .sanitize(html) method.\");\n\n    // ----- Internal State -----\n    // Primary container used by the new template plus legacy fallback\n    // Strip any leading class (.) or id (#) markers so we end up with raw id names\n    // Prefer the new container ID first to avoid timing issues with legacy selector\n    const ELEMENT_IDS = [\n        SELECTORS.projectListContainer.replace('#', '').replace('.', ''),\n        SELECTORS.projectListView.replace('#', '')\n    ];\n    let elementId = ELEMENT_IDS[0]; // default to container which is present in current template\n    let _doc = null;\n    let element = null;\n    let gridElement = null;\n    let isRendering = false;\n    const eventBus = eventService || new EventTarget();\n\n    // Migrate state to UIStateService\n    const STATE_COMPONENT = 'ProjectListComponent';\n\n    function getState(key, defaultValue = null) {\n        return uiStateService ? uiStateService.getState(STATE_COMPONENT, key) || defaultValue : defaultValue;\n    }\n\n    function setState(key, value) {\n        if (uiStateService) {\n            uiStateService.setState(STATE_COMPONENT, key, value);\n        }\n    }\n\n    function _setState(partial) {\n        if (uiStateService) {\n            Object.entries(partial).forEach(([key, value]) => {\n                setState(key, value);\n            });\n        }\n    }\n\n    // Initialize default state values\n    if (uiStateService) {\n        setState('projects', getState('projects', []));\n        setState('filter', getState('filter', 'all'));\n        setState('loading', getState('loading', false));\n        setState('customization', getState('customization', _loadCustomization()));\n    }\n    function _getProjectId(p) {\n        /*\n         * Ensure we capture the ID regardless of backend naming convention.\n         * Accepts (in priority order): uuid, id, project_id, projectId, ID, _id.\n         */\n        if (!p || typeof p !== 'object') return null;\n        return (\n            p.uuid ??\n            p.id ??\n            p.project_id ??\n            p.projectId ??\n            p.ID ??\n            p._id ??\n            null\n        );\n    }\n\n    // Helper to wait for DOM updates after template injection\n    function _waitForDOMUpdate() {\n        return new Promise(resolve => {\n            browserService.getWindow().requestAnimationFrame(() => {\n                browserService.setTimeout(resolve, 0);\n            });\n        });\n    }\n\n    // Helper to remove all skeleton elements globally\n    function _removeAllSkeletons() {\n        const allSkeletons = domAPI.querySelectorAll('.animate-pulse');\n        allSkeletons.forEach(skeleton => skeleton.remove());\n\n        // Hide global loading grid if present\n        const loadingGrid = domAPI.getElementById('loadingState');\n        if (loadingGrid) {\n            domAPI.addClass(loadingGrid, 'hidden');\n            loadingGrid.style.display = 'none';\n        }\n    }\n\n    // --- State access helper ---\n    // Use getState/setState/_setState for all state access.\n    // For convenience, define a local getter for state.\n    const state = new Proxy({}, {\n        get(_target, key) {\n            return getState(key);\n        },\n        set(_target, key, value) {\n            setState(key, value);\n            return true;\n        },\n        ownKeys() {\n            // Not used, but required for Proxy completeness\n            return [];\n        }\n    });\n\n    // ----- Initialization/Readiness -----\n    async function initialize() {\n        try {\n            // Wait for template load event before waiting for children\n            try {\n                await domReadinessService.waitForEvent('projectListHtmlLoaded', {\n                    timeout: APP_CONFIG?.TIMEOUTS?.PROJECT_LIST_TEMPLATE ?? 15000,\n                    context: MODULE_CONTEXT + '_template'\n                });\n            } catch (templateErr) {\n                logger.warn('[ProjectListComponent][initialize] Template load event timeout/failed, attempting to continue', templateErr, { context: MODULE_CONTEXT });\n                // Avoid throwing - attempt to continue\n            }\n\n            // CRITICAL: Wait for DOM to fully update after template injection\n            await _waitForDOMUpdate();\n\n            // Now wait for the main container element\n            await domReadinessService.dependenciesAndElements({\n                deps: ['projectManager', 'eventHandlers'],\n                domSelectors: [SELECTORS.projectListView, SELECTORS.projectListContainer],  // Wait for either container ID\n                observeMutations: true,\n                timeout: APP_CONFIG?.TIMEOUTS?.PROJECT_LIST_ELEMENTS ?? 15000,\n                context: MODULE_CONTEXT + '_init'\n            });\n        } catch (err) {\n            logger.error('[ProjectListComponent][initialize] dependenciesAndElements failed', err, { context: MODULE_CONTEXT });\n            _showErrorState(\"Project list UI failed to load: required elements missing.<br>\" + (err?.message || \"\"));\n            throw err;\n        }\n\n        _doc = domAPI.getDocument?.();\n\n        // Try primary id, then legacy, then any matching selector\n        element =\n            domAPI.getElementById(elementId) ||\n            domAPI.getElementById(ELEMENT_IDS[1]) ||\n            domAPI.querySelector(`${SELECTORS.projectListView}, ${SELECTORS.projectListContainer}`);\n\n        if (!element) {\n            logger.error(`[ProjectListComponent] Element #${elementId} not found. Cannot initialize.`, null, { context: MODULE_CONTEXT });\n            _showErrorState(`Project list container <code>#${elementId}</code> not found.`);\n            throw new Error(`[ProjectListComponent] Element #${elementId} not found.`);\n        }\n\n        // Find or create grid element with better fallback logic\n        gridElement = domAPI.querySelector('.mobile-grid', element) ||\n            domAPI.getElementById('projectCardsPanel');\n\n        if (!gridElement) {\n            // Create the grid if it doesn't exist\n            logger.warn('[ProjectListComponent] Grid element not found, creating fallback', { context: MODULE_CONTEXT });\n            gridElement = domAPI.createElement('div');\n            gridElement.className = \"mobile-grid mobile-p-safe w-full\";\n            gridElement.setAttribute('role', 'tabpanel');\n            gridElement.setAttribute('aria-labelledby', 'filterTabAll');\n            gridElement.setAttribute('id', 'projectCardsPanel');\n            element.appendChild(gridElement);\n        }\n\n        _bindEventListeners();\n        _bindCreateProjectButtons();\n\n        eventBus.dispatchEvent(new CustomEvent('initialized', { detail: { success: true } }));\n\n        try {\n            const doc = domAPI.getDocument();\n            if (doc) {\n                domAPI.dispatchEvent(doc, new CustomEvent('projectListComponentInitialized', { detail: { success: true } }));\n            }\n        } catch (err) {\n            logger.error('[ProjectListComponent] Failed to dispatch initialized event', err, { context: MODULE_CONTEXT });\n        }\n\n        // Remove any local isAuthenticated flags, always use appModule.state.isAuthenticated or listen to auth.AuthBus\n\n        if (app?.state?.isAuthenticated) {\n            _loadProjects();\n        } else {\n            _showLoginRequired();\n        }\n    }\n\n    function _safeSetInnerHTML(el, rawHtml) {\n        const safe = htmlSanitizer.sanitize(rawHtml);\n        domAPI.setInnerHTML(el, safe);\n    }\n    function _clearElement(el) {\n        el.textContent = \"\";\n    }\n    function _bindEventListeners() {\n        const doc = domAPI?.getDocument?.();\n        // Normalize safeHandler retrieved via DI (from DependencySystem, not app)\n        const safeHandlerRaw = DependencySystem?.modules?.get?.('safeHandler');\n        const safeHandler =\n            typeof safeHandlerRaw === 'function'\n                ? safeHandlerRaw\n                : (typeof safeHandlerRaw?.safeHandler === 'function'\n                    ? safeHandlerRaw.safeHandler\n                    : (fn) => fn); // graceful fallback – pass-through\n        const projectsLoadedHandler = (e) => renderProjects(e.detail);\n\n        eventHandlers.trackListener(\n            doc,\n            \"projectsLoaded\",\n            safeHandler(projectsLoadedHandler, 'ProjectListComponent:projectsLoaded'),\n            { context: MODULE_CONTEXT }\n        );\n\n        /* ------------------------------------------------------------------\n         * Some environments may fail to rebroadcast the \"projectsLoaded\"\n         * CustomEvent on the global document (e.g. when running inside\n         * testing frameworks with a stubbed Document or when domAPI.dispatchEvent\n         * throws due to a polyfill mismatch).  To guarantee the component is\n         * updated we ALSO subscribe directly to ProjectManager.eventBus when\n         * available.\n         * ------------------------------------------------------------------ */\n        try {\n            if (projectManager?.eventBus) {\n                eventHandlers.trackListener(\n                    projectManager.eventBus,\n                    'projectsLoaded',\n                    safeHandler(projectsLoadedHandler, 'ProjectListComponent:PMBus:projectsLoaded'),\n                    { context: MODULE_CONTEXT, description: 'ProjectManagerBus projectsLoaded listener' }\n                );\n            }\n        } catch (busErr) {\n            logger.error('[ProjectListComponent] Failed to subscribe to ProjectManager.eventBus projectsLoaded', busErr, { context: MODULE_CONTEXT });\n        }\n        eventHandlers.trackListener(\n            gridElement,\n            \"click\",\n            safeHandler((e) => _handleCardClick(e), 'ProjectListComponent:gridElement:click'),\n            { context: MODULE_CONTEXT }\n        );\n        eventHandlers.trackListener(\n            doc,\n            \"projectCreated\",\n            safeHandler((e) => _handleProjectCreated(e.detail), 'ProjectListComponent:projectCreated'),\n            { context: MODULE_CONTEXT }\n        );\n        eventHandlers.trackListener(\n            doc,\n            \"projectUpdated\",\n            safeHandler((e) => _handleProjectUpdated(e.detail), 'ProjectListComponent:projectUpdated'),\n            { context: MODULE_CONTEXT }\n        );\n\n        const handleAuthStateChange = async (e) => {\n            const { authenticated } = e.detail || {};\n            if (authenticated) {\n                try {\n                    await domReadinessService.dependenciesAndElements({\n                        deps: ['app', 'projectManager', 'eventHandlers', 'auth'],\n                        domSelectors: [\n                            SELECTORS.projectListContainer,\n                            '.mobile-grid',\n                            SELECTORS.projectFilterTabs\n                        ],\n                        timeout: 10000,\n                        context: MODULE_CONTEXT + '_authStateChange'\n                    });\n                    await initialize();\n                    await show();\n                    await _loadProjects();\n                } catch (err) {\n                    logger.error('[ProjectListComponent][handleAuthStateChange] App or DOM readiness failed (post-auth)', err, { context: MODULE_CONTEXT });\n                }\n            } else {\n                _showLoginRequired();\n            }\n        };\n\n        // Listen to both variants on the document\n        eventHandlers.trackListener(doc, \"authStateChanged\", safeHandler(handleAuthStateChange, 'ProjectListComponent:authStateChanged'), { context: MODULE_CONTEXT });\n        eventHandlers.trackListener(doc, \"auth:stateChanged\", safeHandler(handleAuthStateChange, 'ProjectListComponent:auth:stateChanged'), { context: MODULE_CONTEXT });\n        // Also react to \"authReady\" which fires once after initial verification\n        eventHandlers.trackListener(doc, \"authReady\", safeHandler(handleAuthStateChange, 'ProjectListComponent:authReady'), { context: MODULE_CONTEXT });\n        eventHandlers.trackListener(doc, \"auth:ready\", safeHandler(handleAuthStateChange, 'ProjectListComponent:auth:ready'), { context: MODULE_CONTEXT });\n\n        // NEW: Subscribe directly to AuthBus if available for more reliable auth updates\n        try {\n            const auth = DependencySystem?.modules?.get?.('auth');\n            if (auth?.AuthBus) {\n                eventHandlers.trackListener(\n                    auth.AuthBus,\n                    'authStateChanged',\n                    safeHandler(handleAuthStateChange, 'ProjectListComponent:AuthBus:authStateChanged'),\n                    { context: MODULE_CONTEXT, description: 'AuthBus authStateChanged listener' }\n                );\n                // Listen once for authReady to capture initial ready event\n                eventHandlers.trackListener(\n                    auth.AuthBus,\n                    'authReady',\n                    safeHandler(handleAuthStateChange, 'ProjectListComponent:AuthBus:authReady'),\n                    { context: MODULE_CONTEXT, description: 'AuthBus authReady listener', once: true }\n                );\n                logger.debug('[ProjectListComponent] Subscribed to AuthBus \"authStateChanged\" and \"authReady\".', { context: MODULE_CONTEXT });\n            } else {\n                logger.warn('[ProjectListComponent] AuthBus not available – relying on document-level auth events only.', { context: MODULE_CONTEXT });\n            }\n        } catch (busErr) {\n            logger.error('[ProjectListComponent] Failed to subscribe to AuthBus authStateChanged', busErr, { context: MODULE_CONTEXT });\n        }\n\n        _bindFilterEvents();\n\n        // Re-bind when template HTML arrives\n        eventHandlers.trackListener(\n            domAPI.getDocument(),\n            'projectListHtmlLoaded',\n            () => {\n                // Re-bind filter tabs now that the real template is in the DOM\n                _bindFilterEvents();\n\n                // Update gridElement reference to the one inserted by the template\n                const parent =\n                    element ||\n                    domAPI.getElementById(elementId) ||\n                    domAPI.querySelector('#projectListView, .project-list-container');\n                const newGrid = parent ? domAPI.querySelector('.mobile-grid', parent) : null;\n\n                if (newGrid && newGrid !== gridElement) {\n                    // CRITICAL FIX: Remove the old grid element to prevent orphaned skeletons\n                    const oldGrid = gridElement;\n                    gridElement = newGrid;\n\n                    // Remove old grid if it exists and has no parent (orphaned)\n                    if (oldGrid && oldGrid !== newGrid) {\n                        // Clean up any skeletons in the old grid before removal\n                        const oldSkeletons = domAPI.querySelectorAll('.animate-pulse', oldGrid);\n                        oldSkeletons.forEach(skeleton => skeleton.remove());\n\n                        // If old grid is orphaned (no parent), remove it entirely\n                        if (!oldGrid.parentNode) {\n                            oldGrid.remove();\n                        }\n                    }\n\n                    // Attach the click listener to the newly injected grid\n                    eventHandlers.trackListener(\n                        gridElement,\n                        'click',\n                        safeHandler((e) => _handleCardClick(e), 'ProjectListComponent:gridElement:click'),\n                        { context: MODULE_CONTEXT, description: 'gridElementClickRebind' }\n                    );\n                }\n\n                // If projects were already loaded before the template arrived, render them again so\n                // the user does not remain on the skeleton loading state.\n                if (state.projects && state.projects.length > 0) {\n                    try {\n                        renderProjects(state.projects);\n                    } catch (renderErr) {\n                        logger.error('[ProjectListComponent] Failed to re-render projects after template load', renderErr, { context: MODULE_CONTEXT });\n                    }\n                }\n            },\n            { once: true, context: MODULE_CONTEXT, description: 'rebindFilterTabsAfterTemplate' }\n        );\n    }\n    function _bindFilterEvents() {\n        const container = domAPI?.getElementById ? domAPI.getElementById(\"projectFilterTabs\") : domAPI.getElementById(\"projectFilterTabs\");\n        if (!container) return;\n        const tabSelector = \".project-tab[data-filter], .tab[data-filter]\";\n        const tabs = domAPI?.querySelectorAll\n            ? [...domAPI.querySelectorAll(tabSelector, container)]\n            : [...container.querySelectorAll(tabSelector)];\n        tabs.forEach(tab => _bindSingleFilterTab(tab, tab.dataset.filter));\n        _bindFilterTablistKeyboardNav(container, tabs);\n    }\n    function _bindSingleFilterTab(tab, filterValue) {\n        if (!filterValue) return;\n        const clickHandler = () => _setFilter(filterValue);\n        eventHandlers.trackListener(tab, \"click\", clickHandler, { context: MODULE_CONTEXT + ':bindSingleFilterTab:click' });\n\n        eventHandlers.trackListener(tab, \"keydown\", (event) => {\n            if (event.key === \"Enter\" || event.key === \" \") {\n                event.preventDefault();\n                _setFilter(filterValue);\n                tab.focus();\n            }\n        }, { context: MODULE_CONTEXT + ':bindSingleFilterTab:keydown' });\n    }\n    function _bindFilterTablistKeyboardNav(container, tabs) {\n        eventHandlers.trackListener(container, \"keydown\", (event) => {\n            const currentTab = (_doc || domAPI.getDocument()).activeElement;\n            if (!tabs.includes(currentTab)) return;\n            let idx = tabs.indexOf(currentTab);\n            if (event.key === \"ArrowRight\" || event.key === \"Right\") {\n                event.preventDefault();\n                const nextIdx = (idx + 1) % tabs.length;\n                tabs[nextIdx].focus();\n            } else if (event.key === \"ArrowLeft\" || event.key === \"Left\") {\n                event.preventDefault();\n                const prevIdx = (idx - 1 + tabs.length) % tabs.length;\n                tabs[prevIdx].focus();\n            } else if (event.key === \"Home\") {\n                event.preventDefault();\n                tabs[0].focus();\n            } else if (event.key === \"End\") {\n                event.preventDefault();\n                tabs[tabs.length - 1].focus();\n            }\n        }, { context: MODULE_CONTEXT + ':bindFilterTablistKeyboardNav' });\n    }\n    function _setFilter(filter) {\n        _setState({ filter });\n        _updateActiveTab();\n        _updateUrl(filter);\n        _loadProjects();\n    }\n    function _updateActiveTab() {\n        const tabs = domAPI?.querySelectorAll\n            ? domAPI.querySelectorAll(\"#projectFilterTabs .project-tab[data-filter], #projectFilterTabs .tab[data-filter]\")\n            : domAPI.querySelectorAll(\"#projectFilterTabs .project-tab[data-filter], #projectFilterTabs .tab[data-filter]\");\n\n        let activeTabId = null;\n        tabs.forEach((tab) => {\n            const isActive = tab.dataset.filter === state.filter;\n            tab.classList.toggle(\"tab-active\", isActive);\n            tab.classList.toggle(\"active\", isActive);\n            tab.setAttribute(\"aria-selected\", isActive ? \"true\" : \"false\");\n            tab.setAttribute(\"tabindex\", isActive ? \"0\" : \"-1\");\n            if (isActive) activeTabId = tab.id;\n        });\n\n        const mobileGridPanel = domAPI?.querySelector\n            ? domAPI.querySelector(\".mobile-grid\", element)\n            : element.querySelector(\".mobile-grid\");\n        if (mobileGridPanel && activeTabId) {\n            mobileGridPanel.setAttribute(\"aria-labelledby\", activeTabId);\n        }\n    }\n    function _updateUrl(filter) {\n        try {\n            const navigationService = DependencySystem?.modules?.get?.('navigationService');\n            if (navigationService &&\n                typeof navigationService.updateUrlParams === 'function'\n            ) {\n                navigationService.updateUrlParams({ filter }, true);\n            }\n        } catch (e) {\n            logger.error('[ProjectListComponent] updateUrlParams failed', e, { context: MODULE_CONTEXT });\n        }\n    }\n    function renderProjects(data) {\n        if (isRendering) return;\n        isRendering = true;\n        try {\n            if (data && data.error && data.reason === 'auth_required') {\n                _setState({ loading: false }); // Clear loading state on auth error\n                _showLoginRequired();\n                return;\n            }\n            if (data && data.error && typeof data.error === 'string') {\n                _setState({ loading: false }); // Clear loading state on general error\n                _showErrorState(data.error || \"Failed to load projects.\");\n                return;\n            }\n            const projects = _extractProjects(data);\n            _setState({ projects: projects || [], loading: false }); // Clear loading state when data arrives\n\n            if (!gridElement) return;\n\n            // CRITICAL FIX: Remove ALL skeleton elements globally before rendering\n            _removeAllSkeletons();\n\n            if (!projects?.length) {\n                _setState({ loading: false }); // Clear loading state for empty results\n                _showEmptyState();\n                return;\n            }\n            _clearElement(gridElement);\n            const fragment = (_doc || domAPI.getDocument()).createDocumentFragment();\n            projects.forEach((_project) => {\n                if (_project && typeof _project === \"object\")\n                    fragment.appendChild(_createProjectCard(_project));\n            });\n            gridElement.appendChild(fragment);\n            _makeVisible();\n        } catch (err) {\n            logger.error('[ProjectListComponent][renderProjects]', err, { context: MODULE_CONTEXT });\n        } finally {\n            isRendering = false;\n        }\n    }\n    function _makeVisible() {\n        if (gridElement) {\n            gridElement.classList.remove(\"hidden\");\n            gridElement.style.display = \"\";\n        }\n        if (element) {\n            element.classList.remove(\"hidden\", \"opacity-0\");\n            element.style.opacity = '1';\n            element.style.display = \"\";\n        }\n    }\n\n    async function hide() {\n        try {\n            if (element) {\n                element.classList.add('hidden');\n                element.style.display = 'none';\n            }\n            if (gridElement) {\n                gridElement.classList.add('hidden');\n                gridElement.style.display = 'none';\n            }\n            return true;\n        } catch (err) {\n            logger.error('[ProjectListComponent][hide] failed', err, { context: MODULE_CONTEXT });\n            return false;\n        }\n    }\n    /**\n     * Extract an array of project objects from an arbitrary API\n     * response using the single-source helper exposed by\n     * ProjectManager.  Falls back to the legacy extraction logic\n     * for maximum backward compatibility.\n     *\n     * @param {*} data – raw API response\n     * @returns {Array<Object>} array of project objects (possibly empty)\n     */\n    function _extractProjects(data) {\n        /* ------------------------------------------------------------------\n         * 1️⃣  Preferred single-source method (ProjectManager helper)\n         * ------------------------------------------------------------------ */\n        if (projectManager && typeof projectManager.extractResourceList === 'function') {\n            try {\n                /** projectManager.extractResourceList will normalise the\n                 *   result to an array (or empty array) based on the keys\n                 *   that we pass in.                                                */\n                const list = projectManager.extractResourceList(data, ['projects']);\n                if (Array.isArray(list)) {\n                    return list;\n                }\n            } catch (err) {\n                logger?.warn?.('[ProjectListComponent] extractResourceList failed – falling back to legacy logic', err, { context: MODULE_CONTEXT });\n            }\n        }\n\n        /* ------------------------------------------------------------------\n         * 2️⃣  Legacy fallback – retained for robustness with older servers\n         * ------------------------------------------------------------------ */\n        if (Array.isArray(data)) return data;\n        const paths = ['projects', 'data.projects', 'data'];\n        for (const path of paths) {\n            const segments = path.split('.');\n            let result = data;\n            let valid = true;\n            for (const seg of segments) {\n                if (result && typeof result === 'object' && seg in result) {\n                    result = result[seg];\n                } else {\n                    valid = false;\n                    break;\n                }\n            }\n            if (valid && Array.isArray(result)) return result;\n            if (valid && result && typeof result === 'object' && result.id) {\n                return [result];\n            }\n        }\n        return [];\n    }\n    async function show() {\n        if (isRendering) return;\n\n        // IMPROVED: Better element availability check with fallback creation\n        if (!gridElement) {\n            gridElement = domAPI.querySelector('.mobile-grid', element) ||\n                domAPI.getElementById('projectCardsPanel');\n\n            if (!gridElement) {\n                logger.warn('[ProjectListComponent][show] Creating missing grid element', { context: MODULE_CONTEXT });\n                gridElement = domAPI.createElement('div');\n                gridElement.className = \"mobile-grid mobile-p-safe w-full\";\n                gridElement.setAttribute('role', 'tabpanel');\n                gridElement.setAttribute('aria-labelledby', 'filterTabAll');\n                gridElement.setAttribute('id', 'projectCardsPanel');\n                element.appendChild(gridElement);\n            }\n        }\n\n        // Remove the problematic elementsReady call that causes timeouts\n        // The elements should already be ready from initialize()\n\n        // CONSOLIDATED: Check authentication state before showing content\n        const isAuthenticated = typeof projectManager?.isAuthenticated === 'function'\n            ? projectManager.isAuthenticated()\n            : (app?.state?.isAuthenticated ?? false);\n\n        logger.debug('[ProjectListComponent][show] Checking auth state before showing content', {\n            isAuthenticated,\n            hasProjects: !!((state.projects || []).length > 0),\n            context: MODULE_CONTEXT\n        });\n\n        if (!isAuthenticated) {\n            _showLoginRequired();\n            return;\n        }\n\n        /* ------------------------------------------------------------------\n         * Authenticated path – ensure any login-required fallback is removed\n         * ------------------------------------------------------------------ */\n        const fallbackEl = domAPI.querySelector('.project-list-fallback', element);\n        if (fallbackEl) {\n            fallbackEl.remove();\n        }\n\n        _makeVisible();\n        if (state.projects && state.projects.length > 0 && !isRendering) {\n            try {\n                renderProjects(state.projects);\n            } catch (err) {\n                logger.error('[ProjectListComponent][show] renderProjects failed', err, { context: MODULE_CONTEXT });\n            }\n        } else if (!state.projects || state.projects.length === 0) {\n            _loadProjects();\n        }\n    }\n    async function _loadProjects() {\n        try {\n            await domReadinessService.dependenciesAndElements({\n                deps: ['auth'],\n                context: MODULE_CONTEXT + '_loadProjects'\n            });\n\n            // CONSOLIDATED: Check authentication state before loading projects\n            const isAuthenticated = typeof projectManager?.isAuthenticated === 'function'\n                ? projectManager.isAuthenticated()\n                : (app?.state?.isAuthenticated ?? false);\n\n            if (!isAuthenticated) {\n                logger.debug('[ProjectListComponent][_loadProjects] User not authenticated, showing login required', { context: MODULE_CONTEXT });\n                _showLoginRequired();\n                return;\n            }\n\n            if (state.loading) return;\n            if (!projectManager?.loadProjects) return;\n            _setState({ loading: true });\n            _showLoadingState();\n            await projectManager.loadProjects(state.filter);\n            // NOTE: Loading state is cleared in renderProjects() when data arrives\n        } catch (error) {\n            logger.error('[ProjectListComponent][_loadProjects] Failed to load projects', error, { context: MODULE_CONTEXT });\n            _showErrorState(\"Failed to load projects\");\n            _setState({ loading: false }); // Clear loading state on error\n        }\n    }\n    function _handleAction(action, projectId) {\n        const project = (state.projects || []).find(\n            (p) => String(_getProjectId(p)) === projectId\n        );\n        if (!project) return;\n        switch (action) {\n            case \"view\":\n                onViewProject(_getProjectId(project));\n                break;\n            case \"edit\":\n                _openEditModal(project);\n                break;\n            case \"delete\":\n                _confirmDelete(project);\n                break;\n            default:\n        }\n    }\n    function _handleCardClick(e) {\n        const projectCard = e.target.closest('.project-card');\n        if (!projectCard) { return; }\n        const projectId = projectCard.dataset.projectId;\n        if (!projectId) { return; }\n        const actionBtn = e.target.closest(\"[data-action]\");\n        if (actionBtn) { e.stopPropagation(); return; }\n        const isCreateButton = e.target.closest('#createProjectBtn');\n        if (isCreateButton) { return; }\n        // CONSOLIDATED: Single source of truth - only check app.state\n        if (app?.state?.isAuthenticated) {\n            onViewProject(projectId);\n        } else {\n            eventBus.dispatchEvent(new CustomEvent(\"requestLogin\"));\n        }\n    }\n    function _handleProjectCreated(project) {\n        if (!project) return;\n        _setState({ projects: [project, ...(state.projects || [])] });\n        renderProjects(state.projects);\n    }\n    function _handleProjectUpdated(updatedProject) {\n        if (!updatedProject) return;\n        const idx = (state.projects || []).findIndex(\n            (p) => String(_getProjectId(p)) === String(_getProjectId(updatedProject))\n        );\n        if (idx >= 0) {\n            const newProjects = [...state.projects];\n            newProjects[idx] = updatedProject;\n            _setState({ projects: newProjects });\n            renderProjects(state.projects);\n        }\n    }\n    function _bindCreateProjectButtons() {\n        if (!modalManager) return;\n        if (!eventHandlers?.trackListener)\n            throw new Error(\"[ProjectListComponent] eventHandlers.trackListener is required for button events.\");\n\n        const doc = domAPI.getDocument();\n\n        // Helper to attach the delegated click listener\n        const bindListener = () => {\n            eventHandlers.trackListener(\n                doc,\n                'click',\n                async (e) => {\n                    const btn = e.target.closest('#createProjectBtn');\n                    if (!btn) return;\n\n                    // Ensure full app readiness before attempting to open the modal.\n                    await domReadinessService.waitForEvent('app:ready', {\n                        timeout: APP_CONFIG.TIMEOUTS?.APP_READY_WAIT ?? 30000,\n                        context: MODULE_CONTEXT + ':createProjectBtn:click'\n                    });\n\n                    let mm = modalManager || DependencySystem?.modules?.get?.('modalManager');\n\n                    /* Wait for ModalManager internal readiness */\n                    try {\n                        if (mm?.isReadyPromise) await mm.isReadyPromise();\n                    } catch (_) { /* ignore – handled by guard below */ }\n\n                    if (!mm?.show) {\n                        logger.warn('[ProjectListComponent] ModalManager not ready on createProjectBtn click', {\n                            context: MODULE_CONTEXT\n                        });\n                        return;\n                    }\n\n                    mm.show('project');\n                },\n                { context: MODULE_CONTEXT, description: 'delegate:createProjectBtn' }\n            );\n        };\n\n        /*\n         * Always wait for the replay-capable `app:ready` event before wiring the\n         * “New Project” click listener. domReadinessService.waitForEvent()\n         * resolves immediately if the event already fired, so this covers both\n         * cold-boot and late-boot scenarios without relying on brittle\n         * appModule.state.initializing checks.\n         */\n        domReadinessService\n            .waitForEvent('app:ready', {\n                timeout: APP_CONFIG.TIMEOUTS?.APP_READY_WAIT ?? 30000,\n                context: MODULE_CONTEXT + ':bindCreateProjectBtn'\n            })\n            .then(bindListener)\n            .catch((err) => {\n                logger.warn('[ProjectListComponent] app:ready wait failed/timeout, binding createProjectBtn anyway', {\n                    error: err?.message,\n                    context: MODULE_CONTEXT\n                });\n                bindListener();\n            });\n    }\n    function _openNewProjectModal() {\n        if (!modalManager?.show) { return; }\n        modalManager.show(\"project\");\n    }\n    function _openEditModal(project) {\n        if (!modalManager?.show) { return; }\n        modalManager.show(\"project\", {\n            updateContent: (modalEl) => {\n                const nameInput = modalEl.querySelector(\"#projectModalNameInput\");\n                if (nameInput) nameInput.value = project.name || \"\";\n            }\n        });\n    }\n    async function _confirmDelete(project) {\n        if (!modalManager) return;\n\n        const useDeleteModal = typeof modalManager.confirmDelete === 'function';\n        const fn = useDeleteModal ? modalManager.confirmDelete.bind(modalManager)\n            : modalManager.confirmAction?.bind(modalManager);\n\n        if (!fn) return;\n\n        let ok = false;\n        try {\n            ok = await new Promise(resolve => {\n                fn({\n                    title: `Delete \"${project.name}\"?`,\n                    message: 'This cannot be undone.',\n                    confirmText: 'Delete',\n                    confirmClass: 'btn-error',\n                    onConfirm: () => resolve(true),\n                    onCancel: () => resolve(false)\n                });\n            });\n        } catch (err) {\n            logger.error('[ProjectListComponent][_confirmDelete]', err, { context: MODULE_CONTEXT });\n        }\n        if (ok) _executeDelete(project.id);\n    }\n    async function _executeDelete(projectId) {\n        if (!projectManager?.deleteProject) return;\n        try {\n            await projectManager.deleteProject(projectId);\n            _loadProjects();\n        } catch (err) {\n            logger.error('[ProjectListComponent][_executeDelete]', err, { context: MODULE_CONTEXT });\n        }\n    }\n    function _showLoadingState() {\n        if (!gridElement) return;\n\n        // CRITICAL FIX: Remove any existing skeletons globally before creating new ones\n        _removeAllSkeletons();\n\n        // Show global loading grid during load\n        const loadingGrid = domAPI.getElementById('loadingState');\n        if (loadingGrid) {\n            domAPI.removeClass(loadingGrid, 'hidden');\n            loadingGrid.style.display = '';\n        }\n\n        _clearElement(gridElement);\n        gridElement.classList.add(\"mobile-grid\");\n        for (let i = 0; i < 6; i++) {\n            const skeleton = domAPI.createElement(\"div\");\n            skeleton.className = \"bg-base-200 animate-pulse rounded-box p-4 mb-2 max-w-full w-full\";\n            const raw = `\n              <div class=\"h-6 bg-base-300 rounded w-3/4 mb-3\"></div>\n              <div class=\"h-4 bg-base-300 rounded w-full mb-2\"></div>\n              <div class=\"h-4 bg-base-300 rounded w-2/3 mb-2\"></div>\n              <div class=\"h-3 bg-base-300 rounded w-1/3 mt-6\"></div>\n            `;\n            _safeSetInnerHTML(skeleton, raw);\n            gridElement.appendChild(skeleton);\n        }\n    }\n    function _showEmptyState() {\n        _makeVisible();\n        if (!gridElement) return;\n        _clearElement(gridElement);\n        gridElement.classList.add(\"mobile-grid\");\n        const emptyDiv = domAPI.createElement(\"div\");\n        emptyDiv.className = \"project-list-empty\";\n        _safeSetInnerHTML(emptyDiv, `\n          <svg class=\"w-16 h-16 mx-auto text-base-content/30\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\" d=\"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10\" />\n          </svg>\n          <p class=\"mt-4 text-lg text-base-content\">No projects found</p>\n          <p class=\"mt-1\">Create a new project to get started</p>\n          <button id=\"createProjectBtn\" class=\"btn btn-primary mt-4\">Create Project</button>\n        `);\n        gridElement.appendChild(emptyDiv);\n        const createBtn = domAPI.getElementById(\"createProjectBtn\");\n        if (createBtn) {\n            eventHandlers.trackListener(\n                createBtn,\n                \"click\",\n                () => _openNewProjectModal(),\n                { context: MODULE_CONTEXT + ':showEmptyState:createBtn' }\n            );\n        }\n    }\n    function _showLoginRequired() {\n        if (!element) return;\n        // Preserve header, filters, and search; only reset the project grid contents\n        if (gridElement) {\n            _clearElement(gridElement);\n        }\n\n        // ──────────────────────────────────────────────────────────────\n        // Guarantee #projectCardsPanel exists at ALL times.\n        // When _clearElement() runs we lose the grid, causing appInitializer\n        // domVerify (post-UI check) to throw.  Re-create or re-attach the\n        // grid here so the selector is permanently present regardless of\n        // authentication state or template timing.\n        // ──────────────────────────────────────────────────────────────\n        gridElement = domAPI.getElementById('projectCardsPanel');\n        if (!gridElement) {\n            gridElement = domAPI.createElement(\"div\");\n            gridElement.id = \"projectCardsPanel\";\n            gridElement.className = \"mobile-grid mobile-p-safe w-full\";\n            gridElement.setAttribute(\"role\", \"tabpanel\");\n            gridElement.setAttribute(\"aria-labelledby\", \"filterTabAll\");\n        }\n        if (!gridElement.parentNode || gridElement.parentNode !== element) {\n            element.appendChild(gridElement);\n        }\n        // ──────────────────────────────────────────────────────────────\n        // Also guarantee #projectFilterTabs exists to satisfy appInitializer\n        // even when loginRequired UI is shown.\n        // ──────────────────────────────────────────────────────────────\n        let filterTabs = domAPI.getElementById('projectFilterTabs');\n        if (!filterTabs) {\n            filterTabs = domAPI.createElement('div');\n            filterTabs.id = 'projectFilterTabs';\n            filterTabs.className = 'project-tabs hidden';\n        }\n        if (!filterTabs.parentNode || filterTabs.parentNode !== element) {\n            element.appendChild(filterTabs);\n        }\n\n        element.classList.add(\"grid\", \"project-list\");\n        const loginDiv = domAPI.createElement(\"div\");\n        loginDiv.className = \"project-list-fallback\";\n        _safeSetInnerHTML(loginDiv, `\n          <p class=\"mt-4 text-lg\">Please log in to view your projects</p>\n          <button id=\"loginButton\" class=\"btn btn-primary mt-4\">Login</button>\n        `);\n        element.appendChild(loginDiv);\n        const loginBtn = domAPI.getElementById(\"loginButton\");\n        if (loginBtn) {\n            eventHandlers.trackListener(\n                loginBtn,\n                \"click\",\n                (e) => {\n                    e.preventDefault();\n\n                    // Bubble the request up to global listeners so ModalManager can react\n                    const doc = domAPI.getDocument();\n                    if (doc && typeof domAPI.dispatchEvent === 'function') {\n                        domAPI.dispatchEvent(doc, new CustomEvent('requestLogin'));\n                    }\n\n                    // Keep local bus notification (optional, component-internal)\n                    eventBus.dispatchEvent(new CustomEvent('requestLogin'));\n                },\n                { context: MODULE_CONTEXT, description: 'loginBtn:requestLogin' }\n            );\n        }\n    }\n    function _showErrorState(message) {\n        if (!element) return;\n        _clearElement(element);\n        element.classList.add(\"grid\", \"project-list\");\n        const msg = message || \"An unknown error occurred.\";\n        const errorDiv = domAPI.createElement(\"div\");\n        errorDiv.className = \"project-list-error\";\n        _safeSetInnerHTML(errorDiv, `\n          <svg class=\"w-16 h-16 mx-auto text-error/60\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"1.5\"\n                  d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n          </svg>\n          <p class=\"mt-4 text-lg text-error\">${msg}</p>\n          <button id=\"retryButton\" class=\"btn btn-outline btn-error mt-4\">Retry</button>\n          <div class=\"mt-4 text-sm text-base-content/70\">\n            If the issue persists, check console logs for more details.\n          </div>\n        `);\n        element.appendChild(errorDiv);\n        const retryBtn = domAPI.getElementById(\"retryButton\");\n        if (retryBtn) {\n            eventHandlers.trackListener(\n                retryBtn,\n                \"click\",\n                () => _loadProjects(),\n                { context: MODULE_CONTEXT + ':showErrorState:retryBtn' }\n            );\n        }\n    }\n    function _createProjectCard(project) {\n        const card = domAPI.createElement(\"div\");\n        card.className = _computeCardClasses(project);\n        const projectId = _getProjectId(project) ?? \"\";\n        card.dataset.projectId = String(projectId);\n        card.append(\n            _buildCardHeader(project),\n            _buildCardDescription(project),\n            _buildCardFooter(project)\n        );\n        return card;\n    }\n    function _computeCardClasses(_project) {\n        const theme = state.customization?.theme || \"default\";\n        const themeBg = theme === \"default\" ? \"bg-base-100\" : `bg-${theme}`;\n        const themeText = theme === \"default\" ? \"text-base-content\" : `text-${theme}-content`;\n        return `project-card ${themeBg} ${themeText} shadow-md hover:shadow-lg transition-all border border-base-300 rounded-box p-4 flex flex-col h-full mb-3 max-w-full w-full overflow-hidden`;\n    }\n    function _buildCardHeader(project) {\n        const header = domAPI.createElement(\"div\");\n        header.className = \"flex justify-between items-start\";\n        const titleEl = domAPI.createElement(\"h3\");\n        titleEl.className = \"font-semibold text-lg sm:text-xl mb-2 project-name truncate\";\n        titleEl.textContent = project.name || project.title || \"Unnamed Project\";\n        const actions = domAPI.createElement(\"div\");\n        actions.className = \"flex gap-1\";\n        const projectId = _getProjectId(project);\n        [\n            {\n                action: \"view\",\n                icon: `\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"\n                    d=\"M15 12a3 3 0 11-6 0 3 3 0 016 0z\" />\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"\n                    d=\"M2.458 12C3.732 7.943 7.523 5 12 5\n                       c4.478 0 8.268 2.943 9.542 7\n                       -1.274 4.057-5.064 7-9.542 7\n                       -4.477 0-8.268-2.943-9.542-7z\" />\n            </svg>\n          `,\n                label: \"View Project\"\n            },\n            {\n                action: \"edit\",\n                icon: `\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4\" fill=\"none\"\n                 viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"\n                    d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5\n                       m-1.414-9.414a2 2 0 112.828 2.828\n                       L11.828 15H9v-2.828l8.586-8.586z\" />\n            </svg>\n          `,\n                label: \"Edit Project\"\n            },\n            {\n                action: \"delete\",\n                icon: `\n            <svg xmlns=\"http://www.w3.org/2000/svg\" class=\"h-4 w-4\" fill=\"none\"\n                 viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n              <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\"\n                    d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862\n                       a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4\n                       a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n            </svg>\n          `,\n                label: \"Delete Project\",\n                className: \"text-error hover:bg-error/10\"\n            }\n        ].forEach((btnDef) => {\n            actions.appendChild(_createActionButton({ ...btnDef, projectId }));\n        });\n        header.appendChild(titleEl);\n        header.appendChild(actions);\n        return header;\n    }\n    function _buildCardDescription(project) {\n        if (state.customization?.showDescription && project.description) {\n            const description = domAPI.createElement(\"p\");\n            description.className = \"text-sm text-base-content/70 mb-3 line-clamp-2\";\n            description.textContent = project.description;\n            return description;\n        }\n        return domAPI.createElement(\"span\");\n    }\n    function _buildCardFooter(project) {\n        const footer = domAPI.createElement(\"div\");\n        footer.className = \"mt-auto pt-2 flex justify-between text-xs text-base-content/70\";\n        if (state.customization?.showDate && project.updated_at) {\n            const dateEl = domAPI.createElement(\"span\");\n            dateEl.textContent = _formatDate(project.updated_at);\n            footer.appendChild(dateEl);\n        }\n        const badges = domAPI.createElement(\"div\");\n        badges.className = \"flex gap-1\";\n        if (project.pinned) {\n            const pinBadge = domAPI.createElement(\"span\");\n            pinBadge.textContent = \"📌\";\n            pinBadge.classList.add(\"tooltip\");\n            pinBadge.dataset.tip = \"Pinned\";\n            badges.appendChild(pinBadge);\n        }\n        if (project.archived) {\n            const archiveBadge = domAPI.createElement(\"span\");\n            archiveBadge.textContent = \"📦\";\n            archiveBadge.classList.add(\"tooltip\");\n            archiveBadge.dataset.tip = \"Archived\";\n            badges.appendChild(archiveBadge);\n        }\n        footer.appendChild(badges);\n        return footer;\n    }\n    function _createActionButton(btnDef) {\n        const button = domAPI.createElement(\"button\");\n        button.className = `btn btn-ghost btn-xs btn-square min-w-[44px] min-h-[44px] ${btnDef.className || \"\"}`;\n        button.setAttribute(\"aria-label\", btnDef.label);\n        button.dataset.action = btnDef.action;\n        button.title = btnDef.label;\n        let iconString = btnDef.icon;\n        if (typeof iconString !== \"string\" || !iconString.trim()) {\n            iconString = `<svg width=\"16\" height=\"16\" fill=\"currentColor\"><rect width=\"16\" height=\"16\" fill=\"grey\"/></svg>`;\n        }\n        _safeSetInnerHTML(button, iconString);\n        eventHandlers.trackListener(button, 'click', (e) => {\n            e.stopPropagation();\n            _handleAction(btnDef.action, btnDef.projectId);\n        }, { context: MODULE_CONTEXT + ':createActionButton:click' });\n        return button;\n    }\n    function _formatDate(dateString) {\n        if (!dateString) return \"\";\n        try {\n            const date = new Date(dateString);\n            return date.toLocaleDateString(undefined, {\n                year: 'numeric',\n                month: '2-digit',\n                day: '2-digit'\n            });\n        } catch (err) {\n            logger.error('[ProjectListComponent][_formatDate]', err, { context: MODULE_CONTEXT });\n            return dateString;\n        }\n    }\n    function _loadCustomization() {\n        try {\n            const saved = storage.getItem(\"projectCardsCustomization\");\n            return saved ? JSON.parse(saved) : _getDefaultCustomization();\n        } catch (err) {\n            logger.error('[ProjectListComponent][_loadCustomization]', err, { context: MODULE_CONTEXT });\n            return _getDefaultCustomization();\n        }\n    }\n    function _getDefaultCustomization() {\n        return {\n            theme: \"default\",\n            showDescription: true,\n            showDate: true\n        };\n    }\n    // --- Navigation callback can be overridden after creation ---\n    function onViewProject(projectObjOrId) {\n        const projectId =\n            typeof projectObjOrId === 'object' && projectObjOrId.id\n                ? projectObjOrId.id\n                : projectObjOrId;\n        // --- Set project context before navigation using single-source helper ---\n        if (projectManager && typeof projectManager.setCurrentProject === 'function') {\n            if (typeof projectObjOrId === 'object' && projectObjOrId.id) {\n                projectManager.setCurrentProject(projectObjOrId);\n            } else if (projectId) {\n                // Attempt to find full object from current state before falling back\n                const projectObj =\n                    state.projects.find((p) => {\n                        const pid = p?.uuid ?? p?.id ?? p?.project_id ?? p?.ID ?? null;\n                        return String(pid) === String(projectId);\n                    }) || { id: projectId };\n                projectManager.setCurrentProject(projectObj);\n            }\n        } else if (app && typeof app.setCurrentProject === 'function') {\n            // Fallback for legacy code paths (should be removed once all modules use projectManager)\n            if (typeof projectObjOrId === 'object' && projectObjOrId.id) {\n                app.setCurrentProject(projectObjOrId);\n            } else if (projectId) {\n                app.setCurrentProject({ id: projectId });\n            }\n        }\n        const navigationService = DependencySystem?.modules?.get?.('navigationService');\n        if (navigationService && typeof navigationService.navigateToProject === 'function') {\n            navigationService.navigateToProject(projectId);\n        }\n    }\n    // --- Exposed cleanup API per .clinerules ---\n    function destroy() {\n        if (eventHandlers && typeof eventHandlers.cleanupListeners === 'function') {\n            eventHandlers.cleanupListeners({ context: MODULE_CONTEXT });\n        }\n        if (domReadinessService && typeof domReadinessService.destroy === 'function') {\n            domReadinessService.destroy();\n        }\n    }\n\n    return {\n        initialize,\n        destroy,\n        renderProjects, // for test/debug\n        show,\n        hide,\n        onViewProject, // can be overridden\n        eventBus,\n        setProjectManager: (pm) => {\n            projectManager = pm;\n        }\n    };\n}\n\n// No top-level logic, no test/polyfill code outside factory per .clinerules.\n"],"mappings":"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","ignoreList":[]}