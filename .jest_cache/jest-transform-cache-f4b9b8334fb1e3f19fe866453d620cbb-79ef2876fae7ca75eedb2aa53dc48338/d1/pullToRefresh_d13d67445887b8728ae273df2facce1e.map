{"version":3,"names":["createPullToRefresh","element","onRefresh","eventHandlers","domAPI","browserService","threshold","ctx","dataset","ptrBound","startY","currentY","isPulling","refreshTriggered","pullIndicator","getElementById","id","createElement","Math","random","toString","slice","className","setInnerHTML","parentElement","insertBefore","firstChild","appendChild","reset","setStyle","removeClass","handleTouchStart","e","scrollTop","touches","clientY","handleTouchMove","pullDistance","pullPercent","min","addClass","preventDefault","handleTouchEnd","Promise","resolve","finally","setTimeout","trackListener","context","cleanup","cleanupListeners"],"sources":["pullToRefresh.js"],"sourcesContent":["export function createPullToRefresh({\n  element, onRefresh,\n  eventHandlers, domAPI, browserService,\n  threshold = 70, ctx = 'pull-to-refresh'\n}) {\n  if (!element || element.dataset.ptrBound === '1') return;\n  element.dataset.ptrBound = '1';\n\n  let startY = 0;\n  let currentY = 0;\n  let isPulling = false;\n  let refreshTriggered = false;\n\n  // Create pull indicator element if not present\n  let pullIndicator = domAPI.getElementById?.('pullToRefreshIndicator_' + (element.id || ''));\n  if (!pullIndicator) {\n    pullIndicator = domAPI.createElement('div');\n    pullIndicator.id = 'pullToRefreshIndicator_' + (element.id || Math.random().toString(36).slice(2));\n    pullIndicator.className = 'pull-indicator';\n    domAPI.setInnerHTML(pullIndicator, `\n      <div class=\"mobile-loading-indicator\"></div>\n      <span class=\"ml-2\">Pull to refresh</span>\n    `);\n    if (element.parentElement) {\n      domAPI.insertBefore(element.parentElement, pullIndicator, element.parentElement.firstChild);\n    } else {\n      domAPI.appendChild(element, pullIndicator);\n    }\n  }\n\n  function reset() {\n    domAPI.setStyle(pullIndicator, 'transform', 'translateY(-50px)');\n    domAPI.removeClass(pullIndicator, 'visible');\n    isPulling = false;\n    refreshTriggered = false;\n  }\n\n  // Touch start handler\n  const handleTouchStart = (e) => {\n    if (element.scrollTop <= 0) {\n      startY = e.touches[0].clientY;\n      isPulling = true;\n    }\n  };\n\n  // Touch move handler\n  const handleTouchMove = (e) => {\n    if (!isPulling) return;\n\n    currentY = e.touches[0].clientY;\n    const pullDistance = currentY - startY;\n\n    if (pullDistance > 0) {\n      const pullPercent = Math.min(pullDistance / 100, 1);\n      domAPI.setStyle(pullIndicator, 'transform', `translateY(${pullDistance / 2}px)`);\n      if (pullDistance > 20) {\n        domAPI.addClass(pullIndicator, 'visible');\n      }\n      if (pullDistance > threshold && !refreshTriggered) {\n        domAPI.setInnerHTML(pullIndicator, `\n          <div class=\"mobile-loading-indicator\"></div>\n          <span class=\"ml-2\">Release to refresh</span>\n        `);\n      }\n      e.preventDefault();\n    }\n  };\n\n  // Touch end handler\n  const handleTouchEnd = (e) => {\n    if (!isPulling) return;\n\n    const pullDistance = currentY - startY;\n\n    if (pullDistance > threshold) {\n      refreshTriggered = true;\n      domAPI.setInnerHTML(pullIndicator, `\n        <div class=\"mobile-loading-indicator animate-spin\"></div>\n        <span class=\"ml-2\">Refreshing...</span>\n      `);\n      Promise.resolve(onRefresh?.()).finally(() => {\n        browserService.setTimeout(reset, 1000);\n      });\n    } else {\n      reset();\n    }\n  };\n\n  eventHandlers.trackListener(\n    element,\n    'touchstart',\n    handleTouchStart,\n    { context: ctx }\n  );\n  eventHandlers.trackListener(\n    element,\n    'touchmove',\n    handleTouchMove,\n    { context: ctx }\n  );\n  eventHandlers.trackListener(\n    element,\n    'touchend',\n    handleTouchEnd,\n    { context: ctx }\n  );\n\n  return {\n    cleanup() {\n      eventHandlers.cleanupListeners({ context: ctx });\n      element.dataset.ptrBound = '';\n    }\n  };\n}\n"],"mappings":"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","ignoreList":[]}